!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="1a542309-1159-33c2-bfce-48f6bb2b27f3")}catch(e){}}();
define(["require","exports","./c_api_v2_unauthed_client","./c_spectrum_util_raf_throttle","./c_bem","./c_dotlottie_common_chunk-B7OIQIGJ","./e_file_viewer_static_scl_page_file","./c_hive_schemas_sharing-request_access_user_events","./e_data_modules_stormcrow","./e_edison","./c_api_v2_routes_plan_configuration_provider","./c_core_i18n","./c_over-quota_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./e_core_exception","react"],(function(e,a,r,t,n,i,s,o,l,_,c,d,f,S,u){"use strict";function E(e){if(e&&e.__esModule)return e;var a=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(a,r,t.get?t:{enumerable:!0,get:function(){return e[r]}})}})),a.default=e,Object.freeze(a)}var g=E(u);var T,m,p,A,O,F,I;a.UserFlow=void 0,(T=a.UserFlow||(a.UserFlow={})).TRANSFER_MANAGEMENT_MODAL="transfer_management_modal",T.MANAGEMENT_LIST_VIEW="management_list_view",T.CREATION="creation",T.RECIPIENT="recipient",T.BROWSE="browse",T.TRANSFER_CREATION_MODAL="transfer_creation_modal",a.ModalVisibilityChange=void 0,(m=a.ModalVisibilityChange||(a.ModalVisibilityChange={})).OPEN="open",m.CANCEL="cancel",m.OK="ok",a.SettingsVisibilityChange=void 0,(p=a.SettingsVisibilityChange||(a.SettingsVisibilityChange={})).OPEN="open",p.CLOSE="close",a.TransferListView=void 0,(A=a.TransferListView||(a.TransferListView={}))[A.Active=0]="Active",A[A.Expired=1]="Expired",A[A.All=2]="All",a.Actions=void 0,(O=a.Actions||(a.Actions={})).ChangeSettingsModalState="FileTransfers/ChangeSettingsModalState",O.ChangeConfirmTransferDeletionModalState="FileTransfers/ChangeConfirmTransferDeletionModalState",O.LogCopyTransferLink="FileTransfers/LogCopyTransferLink",O.DeleteTransferSummary="FileTransfers/DeleteTransferSummary",O.ExpireTransferSummary="FileTransfers/ExpireTransferSummary",O.ReactivateTransferSummary="FileTransfers/ReactivateTransferSummary",O.FinishedEditing="FileTransfers/FinishedEditing",O.HideOnboardingStep="FileTransfers/HideOnboardingStep",O.InitApp="FileTransfers/InitApp",O.LogAllItemsUploaded="FileTransfers/LogAllItemsUploaded",O.LogAutoDownload="FileTransfers/LogAutoDownload",O.LogOnboarding="FileTransfers/LogOnboarding",O.LogEmailFeedback="FileTransfers/LogEmailFeedback",O.LogUpsell="FileTransfers/LogUpsell",O.MarkOnboardingStepComplete="FileTransfers/MarkOnboardingStepComplete",O.MarkServerRestrictedFiles="FileTransfers/MarkServerRestrictedFiles",O.MetadataUpdated="FileTransfers/MetadataUpdated",O.SendTransferViaEmail="FileTransfers/SendTransferViaEmail",O.ReceivedTransferRowClick="FileTransfers/ReceivedTransferRowClick",O.TransferManagementTabClick="FileTransfers/TransferManagementTabClick",O.SetActiveUserId="FileTransfers/SetActiveUserId",O.SetBackground="FileTransfers/SetBackground",O.SetBackgroundPreview="FileTransfers/SetBackroundPreview",O.SetLogo="FileTransfers/SetLogo",O.SaveLogo="FileTransfers/SaveLogo",O.SetCurrentTransfer="FileTransfers/SetCurrentTransfer",O.SetExpiration="FileTransfers/SetExpiration",O.SetIsShared="FileTransfers/SetShareStatus",O.SetIsShareComplete="FileTransfer/SetShareComplete",O.ChangeManagementModalState="FileTransfers/ChangeManagementModalState",O.SetProductConfig="FileTransfers/SetProductConfig",O.SetRecipients="FileTransfers/SetRecipients",O.SetShareUrl="FileTransfers/SetShareUrl",O.SetFileTransfersUserMetadata="FileTransfers/SetFileTransfersUserMetadata",O.UpdateTransferSummaries="FileTransfers/UpdateTransferSummaries",O.UpdateReceivedTransferSummaries="FileTransfers/UpdateReceivedTransferSummaries",O.ViewFeedbackForm="FileTransfers/ViewFeedbackForm",O.TemporarilySaveEmailFormInfo="FileTransfers/TemporarilySaveEmailFormInfo",O.ClearSavedEmailFormInfo="FileTransfers/ClearSavedEmailFormInfo",O.LogInternetDisconnected="FileTransfers/LogInternetDisconnected",O.LogOnboardingStepShown="FileTransfers/LogOnboardingStepShown",O.MarkOnboardingStepShown="FileTransfers/MarkOnboardingStepShown",O.LogShareError="FileTransfers/LogShareError",O.UpdateSettingsFromManagementModal="FileTransfers/UpdateSettingsFromManagementModal",O.LogSettingsClicked="LogSettingsClicked",O.RemoveReceivedTransferFromList="FileTransfers/RemoveReceivedTransferFromList",O.LogRemoveReceivedTransferClicked="FileTransfers/LogRemoveReceivedTransferClicked",O.LogViewReplayFileTransferPrompt="FileTransfers/ViewReplayFileTransferPrompt",O.LogClickReplayFileTransferPrompt="FileTransfers/ClickReplayFileTransferPrompt",O.LogClickDownloadSUSIFooter="FileTransfers/LogClickDownloadSUSIFooter",O.LogHeadlessBrowserDetected="FileTransfers/LogHeadlessBrowserDetected",a.ExpirationOption=void 0,(F=a.ExpirationOption||(a.ExpirationOption={}))[F.SEVEN_DAYS=7]="SEVEN_DAYS",F[F.THIRTY_DAYS=30]="THIRTY_DAYS",F[F.NINETY_DAYS=90]="NINETY_DAYS",F[F.CUSTOM=0]="CUSTOM",function(e){e.EXPIRED="expired",e.SHARED="shared"}(I||(I={}));var D,R,N;a.ExpirationOption.SEVEN_DAYS,a.ExpirationOption.SEVEN_DAYS,a.ExpirationOption.THIRTY_DAYS,function(e){e.WAITING="waiting",e.FAILED="failed",e.UPLOADING="uploading",e.COMPLETED="completed"}(D||(D={})),o.computeDomains(null!==(R=window.__DEV_SERVER_HOSTNAME__)&&void 0!==R?R:"")[0].WEB_STATIC_CLOUDFLARE_CDN_HOST,o.computeDomains(null!==(N=window.__DEV_SERVER_HOSTNAME__)&&void 0!==N?N:"")[0].WEB_STATIC_CLOUDFLARE_CDN_HOST;const L="NULL";var v,C,h;!function(e){e.CUSTOMIZE_DESIGN="customize_design",e.DOWNLOAD_ALL="download_all",e.DISABLE_DOWNLOAD_NOTIFICATIONS="disable_download_notifications",e.EMAIL_JUST_VERIFIED="email_just_verified",e.EMAIL_TYPE="email_type",e.FEEDBACK="feedback",e.LIKE_EMAIL="like_email",e.RECP_TRACKING="ftref",e.SAVE_TO_DROPBOX="s2d",e.SEND_REMINDERS="send_reminders",e.MANAGEMENT_RECEIVED_DOWNLOAD="management_received_download"}(v||(v={})),function(e){e[e.ADD_FILES=0]="ADD_FILES",e[e.UPLOAD_PROGRESS=1]="UPLOAD_PROGRESS",e[e.REDESIGNED_EMAIL_SENT_CONFIRMATION=2]="REDESIGNED_EMAIL_SENT_CONFIRMATION",e[e.REDESIGNED_SHARE_LINK_CONFIRMATION=3]="REDESIGNED_SHARE_LINK_CONFIRMATION"}(C||(C={})),function(e){e[e.VIEW_FILES=0]="VIEW_FILES",e[e.DOWNLOAD_CONFIRMATION=1]="DOWNLOAD_CONFIRMATION"}(h||(h={}));var M;!function(e){e.CUSTOM_BACKGROUND="custom_background",e.EXPIRATION="expiration",e.EXPIRED_TRANSFERS="expired_transfers",e.OVER_LIMIT="over_limit",e.PASSWORD="password",e.TRANSFER_LOGO="transfer_logo",e.SHOW_WHO_HAS_DOWNLOADED="show_who_has_downloaded",e.MANAGE_PAGE_UPSELL_BANNER="manage_page_upsell_banner",e.SHARING_SETTINGS_UPSELL_BANNER="sharing_settings_upsell_banner"}(M||(M={}));var k,w;s.format_bytes$1(107374182400,0),s.format_bytes$1(268435456e3,0),function(e){e.ABOUT_PAGE="about",e.CREATE_PAGE="create",e.VIEW_PAGE="view",e.VIEW_EXPIRED_PAGE="view_expired",e.VIEW_DELETED_PAGE="view_deleted",e.LIST_PAGE="list"}(k||(k={})),function(e){e.TRY_PROFESSIONAL="try_professional",e.BUY_PROFESSIONAL="buy_professional",e.CONTACT_ADMIN="contact_admin",e.TRY_BUSINESS_ADVANCED="try_business_advanced",e.BUY_TRANSFER="buy_transfer"}(w||(w={}));var b,y,P,U,V,x;a.UploadStatus=void 0,(b=a.UploadStatus||(a.UploadStatus={}))[b.Waiting=0]="Waiting",b[b.Uploading=1]="Uploading",b[b.Success=2]="Success",b[b.Error=3]="Error",function(e){e.Dropbox="dropbox",e.Computer="computer",e.Transfer="transfer"}(y||(y={})),a.OriginalFileSource=void 0,(P=a.OriginalFileSource||(a.OriginalFileSource={})).Dropbox="dropbox",P.Computer="computer",P.Unknown="unknown",function(e){e.DRAG_DROP="drag_drop",e.DROPBOX_CHOOSER_ADDITIONAL="dropbox_chooser_additional",e.DROPBOX_CHOOSER_INITIAL="dropbox_chooser_initial",e.UPLOAD_BUTTON_ADDITIONAL="upload_button_additional",e.UPLOAD_BUTTON_INITIAL="upload_button_initial",e.DESKTOP_CONTEXT_MENU="desktop_context_menu",e.PAGELET_ON_LOAD="pagelet_on_load",e.TRANSFER_CREATION_MODAL_ON_LOAD="transfer_creation_modal_on_load"}(U||(U={})),function(e){e.EmptyFile="empty_file",e.IgnoredFile="ignored_file",e.OverMaxFileSize="over_max_file_size",e.PointerFile="pointer_file",e.TemporaryFile="temporary_file",e.InvalidChar="invalid_char",e.TimeOut="time_out",e.NotFound="not_found",e.NoPermission="no_permission",e.Restricted="restricted",e.InvalidArgs="invalid_args",e.Unknown="unknown"}(V||(V={})),function(e){e.CancelButton="cancel_button",e.WindowClose="window_close"}(x||(x={}));var B;function G(e){return a=>function(e){return e.value?e.value[".tag"]:"other"}(a)===e}!function(e){e[e.NOT_STARTED=0]="NOT_STARTED",e[e.DOWNLOADING=1]="DOWNLOADING",e[e.ERROR=2]="ERROR",e[e.PAUSED=3]="PAUSED",e[e.FETCHING_TOKENS=4]="FETCHING_TOKENS",e[e.CANCELED=5]="CANCELED",e[e.COMPLETED=6]="COMPLETED"}(B||(B={}));const W=G("image"),Y=G("video");function H(e){return e.ns("stacks")}const K=d.defineMessage({id:"l6ovbV",defaultMessage:"Adding files to Stackâ€¦"}),q=d.defineMessage({id:"+sy8AO",defaultMessage:"Files added to Stack"}),X=d.defineMessage({id:"EnTfEk",defaultMessage:"No files to add to Stack"});const Q=d.defineMessage({id:"bE01xd",defaultMessage:"You are not allowed to create Stacks"}),j=d.defineMessage({id:"AjUqKc",defaultMessage:"Invalid Stack name"}),$=d.defineMessage({id:"AAW0rI",defaultMessage:"Stack data too large"}),z=d.defineMessage({id:"XXD6Af",defaultMessage:"Failed to create Stack"}),J=d.defineMessage({id:"2+K1rd",defaultMessage:"Failed to add items to Stack"}),Z=e=>{switch(e){case"not_allowed":return Q;case"invalid_name":return j;case"stack_data_too_large":return $;case"enqueue_error":return J;default:return z}},ee="custom:get_all_stacks",ae=s.getCustomRequestQueryKey(ee),re=s.createCustomRequestQuery({requestMethod:ee,queryFn:({apiArg:e})=>async()=>{const a=(null==e?void 0:e.isMergingFssStacksDashStacksEnabled)?void 0:{fss_stacks:!0},r=(await H(new s.ActiveUserApiV2Client).rpc("query_stacks",{fields:{name:!0,max_hlc:!0,sharing_data:!0},stack_types:a},{})).stacks||[];return r.sort(((e,a)=>{var r,t;const n=e.max_hlc_micros||0,i=a.max_hlc_micros||0,s=null===(r=e.user_data)||void 0===r?void 0:r.is_pinned;return!!s==!!(null===(t=a.user_data)||void 0===t?void 0:t.is_pinned)?i-n:s?-1:1})),{apiData:r,pkgData:null}},getQueryKey:ae});a.COMPLETED_TRANSFER_BROWSE_ENTRY_ONBOARDING="completedTransferBrowseEntryOnboarding",a.CUSTOM_BACKGROUND_ID="custom",a.CUSTOM_LOGO_ID="custom_logo",a.GetStacksRoutes=H,a.NULL_FILE_TRANSFER_KEY=L,a.STACK_SIZE_LIMIT=200,a.asyncAddToStack=async(a,r,t,n,i,o)=>{const _=await s.fetchExperimentVariant("dash_2025_10_07_merging_fss_stacks_and_dash_stacks");((e,a)=>{e.invalidateQueries({queryKey:ae({isMergingFssStacksDashStacksEnabled:a})}),re.prefetchQuery(e,{apiArg:{isMergingFssStacksDashStacksEnabled:a}})})(r,!!("ON"===(null==_?void 0:_.variant)));const{AddToStackModal:c}=await new Promise((function(a,r){e(["./c_stacks_add_to_stack"],a,r)}));return s.Modal$1.showInstance(g.createElement(l.QueryClientProvider,{client:r},g.createElement(d.Provider,{value:a},g.createElement(c,{files:n,navigate:t,sectionName:o,actionSurface:i}))))},a.asyncShowBrowseEntryPointOnboardingModal=a=>{new Promise((function(a,r){e(["./c_file_transfers_containers_browse_entry_point_onboarding_modal"],a,r)})).then((({showBrowseEntryPointOnboardingModal:e})=>e(a)))},a.canAddToStack=e=>e.length<=200,a.createStackAndAddFiles=async function(e,a,t,n,i){var o;if(!t.length)return void s.Snackbar.fail(e.formatMessage(X));s.Snackbar.sync(e.formatMessage(K));const l=H(new s.ActiveUserApiV2Client);try{const{stack:o}=await l.rpc("create_stack",{stack_data:{...n,creation_type:{".tag":"fss_stack"}}},{});if(!o||!o.sharing_id||!o.namespace_id){const e=new r.ApiError;throw e.error={".tag":"other"},e}return await l.rpc("create_fss_stack_item_batch_async",{parent_ns_id:o.namespace_id,item_list:t},{}),await new Promise((e=>setTimeout(e,Math.min(100*t.length,1e4)))),s.Snackbar.complete(e.formatMessage(q)),a(`/stacks/${o.sharing_id}${i?`?${i}`:""}`),o}catch(a){S.reportException({err:a,tags:["create-stack-and-add-files"]});const t=r.filterApiError(a),n=t?null===(o=t.error)||void 0===o?void 0:o[".tag"]:void 0;return void s.Snackbar.fail(e.formatMessage(Z(n)))}},a.folderEligibleForTransfer=e=>!s.File.isNoAccessSharedFolder(e),a.getLocalStorageBooleanValueForKey=function(e){const a=localStorage.getItem(e);return null===a?null:"true"===a},a.getTransferFilesKey=function(e){return e||L},a.isAtRoot=function(e){return null===function(e){let a;if("dest"in e)a=e.dest;else if("fullPath"in e){if(!e.fullPath)return null;a=e.fullPath,"/"===a.charAt(0)&&(a=e.fullPath.substring(1))}else{if(!("path"in e))throw new Error("file must be either PluploadFile, StateFileInfo, or FileSystemEntry");if(!e.path)return null;a=e.path}const r=a.split("/");if(r.length<=1)return null;return r[0]}(e)},a.isColorBackground=function(e){return!!e.color_hex&&!e.asset},a.isImageBackground=function(e){return!!e.asset&&W(e.asset)},a.isVideoBackground=function(e){return!!e.asset&&Y(e.asset)},a.redirectToCreateTransferWithFiles=(e,a)=>{f.showOQModalOrContinue({action:"transfer",continueCallback:function(){const r=function(e){return e.map((e=>e.file_id.replace("id:",""))).join(".")}(e);var t;s.Snackbar.sync(d.intl.formatMessage({id:"EmOY+w",defaultMessage:"Creating new transfer..."}),!1,"create-transfer"),s.redirect((t={referrer:a,fileids:r},new i.URI({scheme:"https",authority:o.getDomains().WEBSERVER,path:"/transfer",query:t}).toString()))},abortCallback:()=>{}})},a.setLocalStorageValueForKey=function(e,a){localStorage.setItem(e,a.toString())},a.shouldShowTransferInSplitShare=(e,a)=>e&&a.length>0&&!a.some((e=>e.is_cloud_doc))&&!a.some(s.File.isNoAccessSharedFolder),a.updateStackAndAddFiles=async function(e,a,r,t,n){if(!t.length)return s.Snackbar.fail(e.formatMessage(X)),!1;s.Snackbar.sync(e.formatMessage(K));try{return n&&n.length&&await H(new s.ActiveUserApiV2Client).rpc("update_stack",{namespace_id:r.namespace_id,stack_data_updates:n},{}),await H(new s.ActiveUserApiV2Client).rpc("create_fss_stack_item_batch_async",{parent_ns_id:r.namespace_id,item_list:t},{}),await new Promise((e=>setTimeout(e,Math.min(100*t.length,1e4)))),s.Snackbar.complete(e.formatMessage(q)),a(`/stacks/${r.sharing_id}`),!0}catch(a){return S.reportException({err:a,tags:["add-to-stack"]}),s.Snackbar.fail(e.formatMessage(J)),!1}},a.useAllStacks=()=>{var e;const a="ON"===(null===(e=s.useExperimentVariant("dash_2025_10_07_merging_fss_stacks_and_dash_stacks"))||void 0===e?void 0:e.variant);return re.useQuery({apiArg:{isMergingFssStacksDashStacksEnabled:a}})}}));
//# sourceMappingURL=c_stacks_async_add_to_stack.js-vflq36Lhv.map

//# debugId=1a542309-1159-33c2-bfce-48f6bb2b27f3