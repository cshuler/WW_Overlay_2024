!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="a92c2e3e-0b99-316b-8659-611a91e9249f")}catch(e){}}();
define(["require","exports","react","./e_file_viewer_static_scl_page_file","./e_data_modules_stormcrow","./c_over-quota_utils_use_get_plans","./c_core_i18n","./c_growth-components_auto-layout-modal_auto_layout_modal","./c_growth-components_over-quota-file-viewer-modal","./c_over-quota_utils_oq_price_decrease_helper","./e_edison","./c_bem","./c_api_v2_routes_plan_configuration_provider","./c_spectrum_util_raf_throttle","./e_core_exception","./c_init_data_edison","./c_dotlottie_common_chunk-B7OIQIGJ","./c_src_sink_index","./c_lodash-es_lodash","./c_react-use_misc_util","./c_api_v2_routes_restorations_provider","./c_api_v2_unauthed_client","./c_hive_schemas_sharing-request_access_user_events","./c_core_notify","react-dom","./c_api_v2_routes_team_insights_provider","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_pap-events_navigation_select_create_folder_action","react/jsx-runtime","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_dig-icons_assets_ui-icon_line_tag","./c_trial-cards_trial-plan-card","./c_dig-components_meter_index","./c_react-hookz_web_useRafCallback","metaserver/static/js/langpack","./c_custom_campaigns_out_of_space_modal_out_of_space_checkout_modal_logger"],(function(e,o,t,a,n,l,i,r,s,_,c,u,d,v,m,p,f,w,g,C,O,h,P,M,S,E,b,k,q,I,L,T,y,R,A,N,D,U){"use strict";function x(e){return e&&e.__esModule?e:{default:e}}var Q=x(t);const V="OVER_QUOTA_RESTRICTIONS_MODAL",F=({action:o,continueCallback:n,abortCallback:c,filePreview:u,fileName:d,downloadFileHandler:v})=>{var m,p,f,w,g,C,O,h,P,M;const[S,E]=Q.default.useState(!1),{user:b}=a.useActiveUser(),{quotaUpsellInfo:k,isLoadingQuotaUpsellInfo:q}=a.useQuotaUpsellInfo(b),{shouldUseSmallSkus:I}=_.useOverquotaPriceDecrease(b),{plansInfo:L,isLoadingPlansInfo:T}=l.useGetPlans({planNames:["basic","plus"],revenueContentLocation:"oq_restrictions_modal"}),{plansInfo:y,isLoadingPlansInfo:R}=l.useGetPlans({planNames:["basic","basic500"],revenueContentLocation:"oq_smaller_skus_modal"}),A=I?y:L,N=I?R:T,D=t.useRef(!1),U="ON"===a.useExperimentVariant("overquota_glide_modal").variant,x=(null===(m=null==k?void 0:k.quota)||void 0===m?void 0:m.used)||0,F=l.getViewMode(o),[W,B]=Q.default.useState(window.innerWidth<=l.OVER_QUOTA_RESTRICTIONS_MODAL_MIN_WIDTH_DESKTOP);Q.default.useLayoutEffect((()=>{function e(){B(window.innerWidth<=l.OVER_QUOTA_RESTRICTIONS_MODAL_MIN_WIDTH_DESKTOP)}return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);const G=(null===(w=null===(f=null===(p=null==k?void 0:k.quota)||void 0===p?void 0:p.allocation)||void 0===f?void 0:f.individual)||void 0===w?void 0:w.allocated)||0,H=F!==l.ViewMode.UploadOrCreate&&((null===(g=null==k?void 0:k.restrictions)||void 0===g?void 0:g.show_restrictions_warning)||!1),z=void 0!==(null===(C=null==k?void 0:k.quota)||void 0===C?void 0:C.used)&&void 0!==(null===(O=null==L?void 0:L.PLUS)||void 0===O?void 0:O.quota_bytes)&&k.quota.used<L.PLUS.quota_bytes,K=a.getOverQuotaReason(null==k?void 0:k.overquota_reason),j=null!==(h=_.getOrganicOrChurnedFromString(K))&&void 0!==h?h:"unlabeled",J=null===(P=null==k?void 0:k.restrictions)||void 0===P?void 0:P.overquota_start_time_utc_seconds,X=J?Date.now()/1e3-J:void 0,Y=(null===(M=null==k?void 0:k.restrictions)||void 0===M?void 0:M.show_restrictions_warning)&&!!J&&0!==J,Z=I?"dropbox500":A&&z?"plus":"none",$=t.useMemo((()=>({overQuotaSweepBlockingModalAction:o,quotaLimit:G,quotaUsed:x,organicOrChurned:j,secondsOverquota:X,hardblocked:!H,planShown:Z,restrictionsStartDateShown:Y})),[G,x,j,X,H,o,A,z,Y]);if(t.useEffect((()=>{N||q||D.current||(_.logShownOverquotaRestrictionsModal($),D.current=!0)}),[$,N,q]),t.useEffect((()=>{N||q||D.current||(new Promise((function(o,t){e(["./c_custom_campaigns_out_of_space_modal_out_of_space_modal_doorman_wrapper"],o,t)})),new Promise((function(o,t){e(["./c_checkout_components_portable_checkout_frame"],o,t)})).then((function(e){return e.portable_checkout_frame_esnext})))}),[N,q]),N||q)return null;const ee=()=>{_.logSelectOverquotaRestrictionsModal("view_plans",$),U?(E(!0),a.openDoormanUpsellModal({modalVersion:"glide-upsell-modal-dp-only",trialCardsLocation:a.TrialCardsLocation.OVERQUOTA_RESTRICTIONS_MODAL,reloadPageAfterPurchase:!0,onClose:()=>{H?n():c()},onDisplayed:()=>{a.unmountModal(void 0,V),E(!1)}})):(c(),a.redirect("/out-of-space?_tk=oq_restrictions_modal"),a.unmountModal(void 0,V))},oe=()=>{_.logSelectOverquotaRestrictionsModal("manage_files",$),a.redirect("/home?_tk=oq_restrictions_modal&pathway=download_and_delete_tooltip_tour&sort_by_size_desc=true"),c(),a.unmountModal(void 0,V)};let te;v&&(te=()=>{_.logSelectOverquotaRestrictionsModal("download_file",$),null==v||v()});if(F===l.ViewMode.Preview&&!H&&!z&&!W)return Q.default.createElement(i.Provider,{value:i.intl},Q.default.createElement(s.OverQuotaFileViewerModal,{open:!0,onClose:()=>{n(),a.unmountModal(void 0,V)},headerText:l.PREVIEW_TITLE(d||""),bodyText:l.OVER_QUOTA_DELETION_WARNING(a.format_bytes(i.intl,x),a.format_bytes(i.intl,G)),badgeText:l.WARNING_BADGE,ctaText:l.VIEW_PLANS,onCtaClick:ee,filePreview:u,secondaryCtaText:l.MANAGE_FILES,secondaryCtaOnClick:oe,tertiaryCtaText:l.DOWNLOAD_FILE,tertiaryCtaOnClick:te,showCloseButton:!1,isPrimaryCtaLoading:S}));const ae=l.getAutoLayoutModalProps({viewMode:F,isMobileView:W,fileName:d,quotaUpsellInfo:k,warningMode:H,usedLessThanPlusQuota:z,filePreview:u,planContent:A,quotaUsedBytes:x,quotaAllocatedBytes:G,shouldUseSmallSkus:I,onViewPlansClick:ee,onCloseClick:e=>{e.preventDefault(),e.stopPropagation(),_.logSelectOverquotaRestrictionsModal("close_button",$),H?n():c(),a.unmountModal(void 0,V)},onDownloadFileClick:te,onManageFilesClick:oe,onGetPlanClick:()=>{_.logSelectOverquotaRestrictionsModal("get_plan",$),l.openPortableCheckoutModal({isOpen:!0,productPlanType:I?a.ProductPlanType.BASIC_PLUS:a.ProductPlanType.PLUS,onCloseClick:()=>{H?n():c(),a.unmountModal(void 0,l.PORTABLE_CHECKOUT_MODAL_ID)},onIframeLoadSuccess:()=>{_.logShownPortableCheckoutModalSuccess(),a.unmountModal(void 0,V)},onIframeLoadError:()=>{c(),_.logShownPortableCheckoutModalError(),a.unmountModal(void 0,V),I?a.redirect("/buy/dbx500?_tk=oq_restrictions_modal"):a.redirect("/buy/plus?_tk=oq_restrictions_modal")},onPurchaseSuccess:()=>{c(),_.logSelectPortableCheckoutModalPurchaseSuccess(),a.reload()}})}});return Q.default.createElement(i.Provider,{value:i.intl},Q.default.createElement(r.AutoLayoutModal,{...ae,isPrimaryCtaLoading:S}))};F.displayName="FunctionalOverQuotaRestrictionsModal";o.openOverQuotaRestrictionsModal=e=>{a.mountModal(Q.default.createElement(n.QueryClientProvider,{client:n.queryClient},Q.default.createElement(F,{action:e.action,continueCallback:e.continueCallback,abortCallback:e.abortCallback,filePreview:e.filePreview,fileName:e.fileName,downloadFileHandler:e.downloadFileHandler})),void 0,V)}}));
//# sourceMappingURL=c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal.js-vflJL3r9p.map

//# debugId=a92c2e3e-0b99-316b-8659-611a91e9249f