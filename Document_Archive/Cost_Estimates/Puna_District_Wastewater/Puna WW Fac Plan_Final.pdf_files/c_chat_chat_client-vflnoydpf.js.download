!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="afd49454-4e48-3700-901f-d011810c504c")}catch(e){}}();
define(["exports","./c_spectrum_util_raf_throttle","./c_dotlottie_common_chunk-B7OIQIGJ","./e_file_viewer_static_scl_page_file","./e_core_exception","react","./e_edison","./c_bem","./c_api_v2_routes_plan_configuration_provider","./c_init_data_edison","./c_src_sink_index","./c_lodash-es_lodash","./c_react-use_misc_util","./c_api_v2_routes_restorations_provider","./e_data_modules_stormcrow","./c_api_v2_routes_team_insights_provider","./c_api_v2_unauthed_client","./c_hive_schemas_sharing-request_access_user_events","./c_core_i18n","metaserver/static/js/langpack","./c_core_notify","react-dom","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_pap-events_navigation_select_create_folder_action","react/jsx-runtime"],(function(t,e,a,i,s,n,r,o,h,c,d,_,p,l,m,T,u,g,C,S,E,O,I,A,v,N){"use strict";var R,f,P,y,D;!function(t){t[t.SNAPENGAGE=0]="SNAPENGAGE",t[t.DIALOGUE_CHAT=1]="DIALOGUE_CHAT",t[t.SOLVVY=2]="SOLVVY"}(R||(R={})),e.proto3.util.setEnumType(R,"chat.ChatProviderType",[{no:0,name:"SNAPENGAGE"},{no:1,name:"DIALOGUE_CHAT"},{no:2,name:"SOLVVY"}]),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.MINIMIZED_PROACTIVE=1]="MINIMIZED_PROACTIVE"}(f||(f={})),e.proto3.util.setEnumType(f,"chat.ProactiveMessageType",[{no:0,name:"DEFAULT"},{no:1,name:"MINIMIZED_PROACTIVE"}]),function(t){t[t.HIDDEN=0]="HIDDEN",t[t.SHOW_PROVIDER_REACTIVE_BUTTON=1]="SHOW_PROVIDER_REACTIVE_BUTTON"}(P||(P={})),e.proto3.util.setEnumType(P,"chat.ChatInitialState",[{no:0,name:"HIDDEN"},{no:1,name:"SHOW_PROVIDER_REACTIVE_BUTTON"}]),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.LEX=1]="LEX",t[t.RASA=2]="RASA"}(y||(y={})),e.proto3.util.setEnumType(y,"chat.DialogueBotProvider",[{no:0,name:"UNKNOWN"},{no:1,name:"LEX"},{no:2,name:"RASA"}]),function(t){t[t.CX_SUPPORT=0]="CX_SUPPORT",t[t.BUSINESS=1]="BUSINESS",t[t.CX_SPECIALIZED=2]="CX_SPECIALIZED",t[t.SCALED_ONBOARDING=3]="SCALED_ONBOARDING"}(D||(D={})),e.proto3.util.setEnumType(D,"chat.DialogueBotType",[{no:0,name:"CX_SUPPORT"},{no:1,name:"BUSINESS"},{no:2,name:"CX_SPECIALIZED"},{no:3,name:"SCALED_ONBOARDING"}]);class L extends e.Message{constructor(t){super(),this.cookieDomain="",this.cookieCampaignName="",this.legacyCookieCampaignName="",e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new L).fromBinary(t,e)}static fromJson(t,e){return(new L).fromJson(t,e)}static fromJsonString(t,e){return(new L).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(L,t,a)}}L.runtime=e.proto3,L.typeName="chat.ChatMetadata",L.fields=e.proto3.util.newFieldList((()=>[{no:1,name:"cookie_domain",kind:"scalar",T:9},{no:2,name:"cookie_campaign_name",kind:"scalar",T:9},{no:3,name:"legacy_cookie_campaign_name",kind:"scalar",T:9}]));class w extends e.Message{constructor(t){super(),this.snapengageIframeOrigin="",e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new w).fromBinary(t,e)}static fromJson(t,e){return(new w).fromJson(t,e)}static fromJsonString(t,e){return(new w).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(w,t,a)}}w.runtime=e.proto3,w.typeName="chat.SnapengageChatMetadata",w.fields=e.proto3.util.newFieldList((()=>[{no:4,name:"snapengage_iframe_origin",kind:"scalar",T:9}]));class V extends e.Message{constructor(t){super(),this.solvvyIframeOrigin="",e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new V).fromBinary(t,e)}static fromJson(t,e){return(new V).fromJson(t,e)}static fromJsonString(t,e){return(new V).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(V,t,a)}}V.runtime=e.proto3,V.typeName="chat.SolvvyChatMetadata",V.fields=e.proto3.util.newFieldList((()=>[{no:1,name:"solvvy_iframe_origin",kind:"scalar",T:9}]));class U extends e.Message{constructor(t){super(),this.chatHmac="",this.email="",this.firstName="",this.lastName="",this.pageLoadTs="",this.pricings=[],this.sessionId="",this.userId="",this.serviceTier="",this.experiments={},this.locale="",this.countryCode="",this.authToken="",e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new U).fromBinary(t,e)}static fromJson(t,e){return(new U).fromJson(t,e)}static fromJsonString(t,e){return(new U).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(U,t,a)}}U.runtime=e.proto3,U.typeName="chat.UserProperties",U.fields=e.proto3.util.newFieldList((()=>[{no:1,name:"chat_hmac",kind:"scalar",T:9},{no:2,name:"email",kind:"scalar",T:9},{no:3,name:"first_name",kind:"scalar",T:9},{no:4,name:"last_name",kind:"scalar",T:9},{no:5,name:"page_load_ts",kind:"scalar",T:9},{no:6,name:"pricings",kind:"scalar",T:9,repeated:!0},{no:7,name:"session_id",kind:"scalar",T:9},{no:8,name:"user_id",kind:"scalar",T:9},{no:9,name:"service_tier",kind:"scalar",T:9},{no:10,name:"experiments",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:11,name:"locale",kind:"scalar",T:9},{no:12,name:"country_code",kind:"scalar",T:9},{no:13,name:"auth_token",kind:"scalar",T:9}]));class k extends e.Message{constructor(t){super(),this.widgetId="",e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new k).fromBinary(t,e)}static fromJson(t,e){return(new k).fromJson(t,e)}static fromJsonString(t,e){return(new k).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(k,t,a)}}k.runtime=e.proto3,k.typeName="chat.SnapengageChatSystemSettings",k.fields=e.proto3.util.newFieldList((()=>[{no:1,name:"widget_id",kind:"scalar",T:9}]));class H extends e.Message{constructor(t){super(),this.name="",this.active=!1,e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new H).fromBinary(t,e)}static fromJson(t,e){return(new H).fromJson(t,e)}static fromJsonString(t,e){return(new H).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(H,t,a)}}H.runtime=e.proto3,H.typeName="chat.DialogueExperiment",H.fields=e.proto3.util.newFieldList((()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"active",kind:"scalar",T:8}]));class W extends e.Message{constructor(t){super(),this.botProvider=y.UNKNOWN,this.environment="",this.settingsHmac="",this.experiments=[],this.botType=D.CX_SUPPORT,this.proactiveIntent="",this.portaled=!1,e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new W).fromBinary(t,e)}static fromJson(t,e){return(new W).fromJson(t,e)}static fromJsonString(t,e){return(new W).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(W,t,a)}}W.runtime=e.proto3,W.typeName="chat.DialogueChatSystemSettings",W.fields=e.proto3.util.newFieldList((()=>[{no:2,name:"bot_provider",kind:"enum",T:e.proto3.getEnumType(y)},{no:3,name:"environment",kind:"scalar",T:9},{no:4,name:"settings_hmac",kind:"scalar",T:9},{no:5,name:"experiments",kind:"message",T:H,repeated:!0},{no:6,name:"bot_type",kind:"enum",T:e.proto3.getEnumType(D)},{no:7,name:"proactive_intent",kind:"scalar",T:9},{no:8,name:"portaled",kind:"scalar",T:8}]));class M extends e.Message{constructor(t){super(),this.proactiveType=f.DEFAULT,this.whenToShowControlledByProvider=!1,this.secondsUntilShown=e.protoInt64.zero,this.coolOffPeriodMinutes=e.protoInt64.zero,e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new M).fromBinary(t,e)}static fromJson(t,e){return(new M).fromJson(t,e)}static fromJsonString(t,e){return(new M).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(M,t,a)}}M.runtime=e.proto3,M.typeName="chat.ProactiveSettings",M.fields=e.proto3.util.newFieldList((()=>[{no:1,name:"proactive_type",kind:"enum",T:e.proto3.getEnumType(f)},{no:2,name:"when_to_show_controlled_by_provider",kind:"scalar",T:8},{no:3,name:"seconds_until_shown",kind:"scalar",T:4},{no:4,name:"cool_off_period_minutes",kind:"scalar",T:4}]));class B extends e.Message{constructor(t){super(),this.widgetId="",e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new B).fromBinary(t,e)}static fromJson(t,e){return(new B).fromJson(t,e)}static fromJsonString(t,e){return(new B).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(B,t,a)}}B.runtime=e.proto3,B.typeName="chat.ChatHmacInput",B.fields=e.proto3.util.newFieldList((()=>[{no:1,name:"widget_id",kind:"scalar",T:9}]));class b extends e.Message{constructor(t){super(),this.campaignId=e.protoInt64.zero,this.versionId=e.protoInt64.zero,this.campaignName="",this.versionName="",this.systemSettings={case:void 0},this.mustHaveAvailableAgents=!1,this.greetingMessage="",this.chatInitialState=P.HIDDEN,this.persistenceCookie="",this.deprecatedExperimentNameToLog="",this.deprecatedExperimentVariantToLog="",this.isControl=!1,e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new b).fromBinary(t,e)}static fromJson(t,e){return(new b).fromJson(t,e)}static fromJsonString(t,e){return(new b).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(b,t,a)}}b.runtime=e.proto3,b.typeName="chat.CampaignResult",b.fields=e.proto3.util.newFieldList((()=>[{no:1,name:"campaign_id",kind:"scalar",T:4},{no:2,name:"version_id",kind:"scalar",T:4},{no:3,name:"campaign_name",kind:"scalar",T:9},{no:4,name:"version_name",kind:"scalar",T:9},{no:5,name:"snapengage_chat_system_settings",kind:"message",T:k,oneof:"system_settings"},{no:14,name:"dialogue_chat_system_settings",kind:"message",T:W,oneof:"system_settings"},{no:6,name:"must_have_available_agents",kind:"scalar",T:8},{no:7,name:"proactive_settings",kind:"message",T:M},{no:8,name:"greeting_message",kind:"scalar",T:9},{no:9,name:"chat_initial_state",kind:"enum",T:e.proto3.getEnumType(P)},{no:10,name:"persistence_cookie",kind:"scalar",T:9},{no:11,name:"deprecated_experiment_name_to_log",kind:"scalar",T:9},{no:12,name:"deprecated_experiment_variant_to_log",kind:"scalar",T:9},{no:13,name:"is_control",kind:"scalar",T:8},{no:15,name:"chat_hmac_input",kind:"message",T:B}]));class F extends e.Message{constructor(t){super(),e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new F).fromBinary(t,e)}static fromJson(t,e){return(new F).fromJson(t,e)}static fromJsonString(t,e){return(new F).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(F,t,a)}}F.runtime=e.proto3,F.typeName="chat.ChatProviderMetadata",F.fields=e.proto3.util.newFieldList((()=>[{no:1,name:"snapengage",kind:"message",T:w}]));class G extends e.Message{constructor(t){super(),this.resume=!1,this.chatProviderType=R.SNAPENGAGE,this.chatProviderMetadata={case:void 0},this.loggingCorrelationId="",this.featureGates={},e.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new G).fromBinary(t,e)}static fromJson(t,e){return(new G).fromJson(t,e)}static fromJsonString(t,e){return(new G).fromJsonString(t,e)}static equals(t,a){return e.proto3.util.equals(G,t,a)}}G.runtime=e.proto3,G.typeName="chat.ChatInitializerProperties",G.fields=e.proto3.util.newFieldList((()=>[{no:1,name:"chat_metadata",kind:"message",T:L},{no:2,name:"user_properties",kind:"message",T:U},{no:3,name:"campaign_result",kind:"message",T:b},{no:4,name:"resume",kind:"scalar",T:8},{no:5,name:"chat_provider_type",kind:"enum",T:e.proto3.getEnumType(R)},{no:6,name:"snapengage_chat_metadata",kind:"message",T:w,oneof:"chat_provider_metadata"},{no:10,name:"solvvy_chat_metadata",kind:"message",T:V,oneof:"chat_provider_metadata"},{no:7,name:"logging_correlation_id",kind:"scalar",T:9},{no:8,name:"feature_gates",kind:"map",K:9,V:{kind:"scalar",T:8}},{no:9,name:"provider_metadata",kind:"message",T:F}]));const q=t=>void 0!==t.campaignId,J=t=>"string"==typeof t,x=(t,e)=>!!t&&(q(t)&&q(e)?t.campaignId===e.campaignId:!(!J(t)||!J(e))&&t===e),z=t=>q(t)?t.systemSettings&&"snapengageChatSystemSettings"===t.systemSettings.case?t.systemSettings.value.widgetId:null:t;var K,X;!function(t){t.UNKNOWN="unknown",t.OFFLINE="offline",t.ONLINE="online"}(K||(K={})),function(t){t.START_TRANSFER="startTransfer",t.END_TRANSFER="endTransfer",t.ERROR_ON_TRANSFER="errorOnTransfer"}(X||(X={}));class Z{constructor(t){}}class Q{constructor(t,e){this.setupChatEnvironment=t=>{},this.startReactiveChat=()=>{},this.startSupportChat=t=>{},this.setCookieBannerInfo=t=>{},this.regsiterVisibilityChangeCallback=t=>{}}}class $ extends Z{constructor(t){super(t),this.DEFAULT_WIDGET_ID="d5c1efed-d0ef-4fca-8c7d-faff398ad272",this.getDefaultChatIdentifier=()=>this.DEFAULT_WIDGET_ID,this.loadChatIfNecessary=t=>{},this.requestAgentStatusUpdate=t=>{},this.showProviderReactiveChatButton=()=>{},this.handleProviderDrivenOpen=()=>{},this.startChat=(t,e)=>{},this.updateHmac=()=>{},this.addBottomMargin=()=>{},this.removeBottomMargin=()=>{},this.handleTransferEvent=t=>{}}}const j=new class{constructor(){this.getChatProvider=(t,e)=>{if(t===R.SNAPENGAGE)return new $(e);throw new Error(`Unknown chat provider type ${t}`)}}};function Y(t){return"1508d082-aa3d-468f-9ac3-cfeb7d5a8435"===t||"c0b3fc4d-5e75-4c65-b5c0-db72be2085f7"===t}var tt,et,at,it,st,nt;!function(t){t.INITIALIZED="initialized",t.IMPRESSION_FAILED="impression_failed",t.CLICK="click",t.IMPRESSION="impression",t.INTERACT="interact",t.DISMISSED="dismissed",t.CLOSE="close",t.ERROR="error",t.TRANSFER="transfer"}(tt||(tt={})),function(t){t.CONTROL_VERSION="control_version",t.NO_ONLINE_AGENTS="no_online_agents",t.NOT_ENOUGH_TIME_ON_PAGE="not_enough_time_on_page",t.CHAT_IS_NOT_ALLOWED="chat_is_not_allowed",t.CHAT_IS_NOT_INITIALIZED="chat_is_not_initialized",t.ANOTHER_CHAT_STARTED="another_chat_started",t.COOLOFF_PERIOD="COOLOFF_PERIOD"}(et||(et={})),function(t){t.CHAT_ICON="chat_icon",t.PROACTIVE_CHAT="proactive_chat",t.RESUMED_CHAT="resumed_chat",t.REACTIVE_CHAT="reactive_chat"}(at||(at={})),function(t){t.UNKNOWN="unknown",t.RESUMED_CHAT="resumed_chat",t.PROACTIVE_CHAT="proactive_chat",t.REACTIVE_CHAT="reactive_chat",t.TRANSFERRED_CHAT="transferred_chat"}(it||(it={})),function(t){t.ATTEMPT_TO_START_UNINITIALIZED_CHAT="attempt_to_start_uninitialized_chat",t.CHAT_STARTED_FROM_UNKNOWN_SOURCE="chat_started_from_unknown_source",t.ATTEMPT_START_PROACTIVE_CHAT_WITHOUT_MESSAGE="attempt_start_proactive_chat_without_message"}(st||(st={})),function(t){t.DEFAULT="default",t.HIVE_VORTEX_COMBO="hive_vortex_combo"}(nt||(nt={}));class rt{constructor(t){this.logger=t}logEvent(t,e,a){const s={entity_type:"chat",event_name:t,correlation_id:e.correlationId,event_id:a,user_id:this.toNumber(e.userId),entity_id:this.toNumber(e.campaignId),version_id:this.toNumber(e.versionId),platform:e.platform,event_details:this.getEventDetails(t,e)};this.logger.log(new i.MegaphoneEventsRow(s))}toNumber(t,e=-1){return null==t||""===t?e:"string"==typeof t?parseInt(t,10):"number"==typeof t?t:t.toNumber()}getEventDetails(t,e){const a={...e.eventDetails};let i=e.widgetId;return e.eventDetails.widgetOverride&&(i=e.eventDetails.widgetOverride),a.widget_id=i,a}}const ot=new i.HiveLogger,ht=new i.VortexComboLogger;const ct=new class{getChatLogger(t=nt.DEFAULT){const e=t===nt.HIVE_VORTEX_COMBO?ht:ot;return new rt(e)}};function dt(t){var e,a,s;const n=null!==(e=null==t?void 0:t.path)&&void 0!==e?e:"/team/admin/engaged_chat",r=null!==(a=null==t?void 0:t.routeParams)&&void 0!==a?a:{},o=null!==(s=null==t?void 0:t.base)&&void 0!==s?s:window.location.origin;return new i.AjaxURL(i.replacePattern(n,r),o)}const _t="MegaphoneChatCooloff";var pt,lt;!function(t){t[t.NOT_SHOWN=0]="NOT_SHOWN",t[t.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_LOAD=1]="TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_LOAD",t[t.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_AGENT_STATUS_UPDATE=2]="TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_AGENT_STATUS_UPDATE",t[t.REQUESTED_PROVIDER_TO_SHOW_REACTIVE_BUTTON=3]="REQUESTED_PROVIDER_TO_SHOW_REACTIVE_BUTTON",t[t.SHOWING_PROVIDER_REACTIVE_BUTTON=4]="SHOWING_PROVIDER_REACTIVE_BUTTON",t[t.SHOWING_CHAT=5]="SHOWING_CHAT",t[t.TO_START_ON_LOAD=6]="TO_START_ON_LOAD",t[t.TO_START_ON_AGENT_STATUS_UPDATE=7]="TO_START_ON_AGENT_STATUS_UPDATE",t[t.REQUESTED_PROVIDER_TO_START_CHAT=8]="REQUESTED_PROVIDER_TO_START_CHAT",t[t.CHAT_ONGOING=9]="CHAT_ONGOING"}(pt||(pt={})),t.ChatStartSourceType=void 0,(lt=t.ChatStartSourceType||(t.ChatStartSourceType={}))[lt.REACTIVE=0]="REACTIVE",lt[lt.PROACTIVE=1]="PROACTIVE",lt[lt.RESUME=2]="RESUME",lt[lt.TRANSFER=3]="TRANSFER",lt[lt.PROVIDER_DRIVEN_PROACTIVE=4]="PROVIDER_DRIVEN_PROACTIVE";class mt extends Q{constructor(e,s,n){super(e,s),this.setupChatEnvironment=e=>{if(this._isSetup)return;if(e.featureGates.enable_vortex_logger&&(this.logger=this.loggerFactory.getChatLogger(nt.HIVE_VORTEX_COMBO)),!this.shouldAllowChat())return;if(this.initProperties=e,this.setupTime=new Date,this.hasFirstLoadOccured=!1,this.state={lifecycleState:pt.NOT_SHOWN,hasShownAChat:!1,interactedWithChat:!1,cookieBannerState:{isVisible:!1}},!e.chatMetadata)throw new Error("Did not provide chat metadata.");if(this.metadata=e.chatMetadata,!e.userProperties)throw new Error("Did not provide user properties.");const a=this.getChatProviderMetadata(e),i=e.campaignResult;if(this.setupProvider(i,a,e.userProperties,e.chatProviderType),i&&i.isControl)this.setupControlLogging(i);else{const a=i&&i.chatInitialState===P.SHOW_PROVIDER_REACTIVE_BUTTON;if(e.resume){const e=this.chatCampaignWrapper||this.defaultChatWrapper;this.deprecatedLogChatAction("chat_persistence",z(e.chatCampaign)),this.intializeStartingChat(e,t.ChatStartSourceType.RESUME)}else this.setupProactivePropertiesIfNeeded(),a&&(this.attemptToShowProviderReactiveChatButton(),this.deprecatedMaybeLogExperiment(i))}window.addEventListener("beforeunload",(()=>{this.maybeLogImpressionFailedOnUnload()}))},this.startReactiveChat=()=>{if(!this.hasFirstLoadOccured)return void this.deferStartChat();if(this.logEvent(tt.CLICK,{source:"startReactiveChat"}),!this.shouldAllowChat())return void this.logEvent(tt.IMPRESSION_FAILED,{failed_reason:et.CHAT_IS_NOT_ALLOWED});if(this.logAndRaiseIfNotSetup(),!this.canStartChat())return;let e=this.chatCampaignWrapper;const a=e&&q(e.chatCampaign)&&e.chatCampaign.isControl;if(!this.chatCampaignWrapper||a)return e=this.defaultChatWrapper,this.deprecatedLogChatAction("chat_initiated",z(e.chatCampaign)),void this.intializeStartingChat(e,t.ChatStartSourceType.REACTIVE);this.deprecatedLogChatAction("chat_initiated",z(e.chatCampaign)),this.intializeStartingChat(this.chatCampaignWrapper,t.ChatStartSourceType.REACTIVE)},this.startSupportChat=e=>{this.hasFirstLoadOccured?(this.logEvent(tt.CLICK,{source:"startSupportChat",widgetOverride:e}),this.shouldAllowChat()?(this.logAndRaiseIfNotSetup(),this.canStartChat()&&(this.supportChatWrapper={chatCampaign:e,chatCampaignState:this.getInitialChatCampaignState()},Y(e)&&i.WebRequest$2({url:dt(),data:{chatId:e}}),this.deprecatedLogChatAction("support_chat_initiated",e),this.intializeStartingChat(this.supportChatWrapper,t.ChatStartSourceType.REACTIVE))):this.logEvent(tt.IMPRESSION_FAILED,{failed_reason:et.CHAT_IS_NOT_ALLOWED,widgetOverride:e})):this.deferStartChat(e)},this.isSetup=()=>this._isSetup,this.setCookieBannerInfo=t=>{this.state.cookieBannerState={isVisible:t},this.adjustProviderMarginOnStateChange()},this.regsiterVisibilityChangeCallback=t=>{this.onVisibilityChangeCallbacks.push(t)},this.deferStartChat=t=>{this.deferredStartChatCallback=()=>{t?this.startSupportChat(t):this.startReactiveChat()}},this.updateChatVisibility=t=>{this.onVisibilityChangeCallbacks.forEach((e=>e(t)))},this.adjustProviderMarginOnStateChange=()=>{this.state.cookieBannerState.isVisible?this.state.lifecycleState===pt.CHAT_ONGOING||this.state.lifecycleState===pt.SHOWING_CHAT?this.provider.removeBottomMargin():this.provider.addBottomMargin():this.provider.removeBottomMargin()},this.modifyLifecycleState=t=>{this.state.lifecycleState=t,this.adjustProviderMarginOnStateChange()},this.logAndRaiseIfNotSetup=()=>{if(!this._isSetup)throw this.logEvent(tt.IMPRESSION_FAILED,{failed_reason:et.CHAT_IS_NOT_INITIALIZED}),this.logError(st.ATTEMPT_TO_START_UNINITIALIZED_CHAT),new Error("Started chat without being initialized")},this.setupProvider=(t,e,a,i)=>{const s={chatCampaign:t,metadata:e,userProperties:a,onAgentStatusUpdate:this.onAgentStatusUpdate,onChatLoadStatusUpdate:this.onChatLoadStatusUpdate,onChatShown:this.onChatShown,onChatStarted:this.onChatStarted,onChatClosed:this.onChatClosed,onChatMinimized:this.onChatMinimized,onChatMaximized:this.onChatMaximized,onProviderDrivenOpenProactive:this.onProviderDrivenOpenProactive,onProviderReactiveButtonShown:this.onProviderReactiveButtonShown,onSwitchProviderWithNewCampaign:this.onSwitchProviderWithNewCampaign};t&&(this.chatCampaignWrapper={chatCampaign:t,chatCampaignState:this.getInitialChatCampaignState()}),this.provider=this.getChatProvider(i,s),this.defaultChatWrapper={chatCampaign:this.provider.getDefaultChatIdentifier(),chatCampaignState:this.getInitialChatCampaignState()},this._isSetup=!0},this.attemptToShowProviderReactiveChatButton=()=>{const e=this.chatCampaignWrapper;e&&q(e.chatCampaign)&&(this.state.campaign=e.chatCampaign,this.state.source_type=t.ChatStartSourceType.REACTIVE,e.chatCampaignState.isLoaded?q(e.chatCampaign)&&e.chatCampaign.mustHaveAvailableAgents?this.attemptToShowReactiveButtonChatThatMustHaveAgents(e):this.requestProviderToShowProviderReactiveButton():this.requestProviderToLoadChatToShowProviderReactiveButton(e))},this.requestProviderToShowProviderReactiveButton=()=>{this.modifyLifecycleState(pt.REQUESTED_PROVIDER_TO_SHOW_REACTIVE_BUTTON),this.provider.showProviderReactiveChatButton();const t=this.chatCampaignWrapper||this.defaultChatWrapper;this.deprecatedLogChatAction("minimized_chat_initiated",z(t.chatCampaign))},this.requestProviderToGetAgentStatusUpdateToShowProviderReactiveButton=t=>{this.modifyLifecycleState(pt.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_AGENT_STATUS_UPDATE),this.provider.requestAgentStatusUpdate(t.chatCampaign)},this.requestProviderToLoadChatToShowProviderReactiveButton=t=>{this.modifyLifecycleState(pt.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_LOAD),this.provider.loadChatIfNecessary(t.chatCampaign)},this.canStartChat=()=>{const t=this.state.lifecycleState;return t===pt.NOT_SHOWN||t===pt.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_LOAD||t===pt.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_AGENT_STATUS_UPDATE||t===pt.REQUESTED_PROVIDER_TO_SHOW_REACTIVE_BUTTON||t===pt.SHOWING_PROVIDER_REACTIVE_BUTTON},this.intializeStartingChat=(t,e)=>{this.state.source_type=e,this.state.campaign=t.chatCampaign,this.attemptToStartChat(t)},this.attemptToStartChat=e=>{const a=this.state.source_type,i=a===t.ChatStartSourceType.PROACTIVE||a===t.ChatStartSourceType.PROVIDER_DRIVEN_PROACTIVE;e.chatCampaignState.isLoaded?i&&q(e.chatCampaign)&&e.chatCampaign.mustHaveAvailableAgents?this.attemptToStartChatThatMustHaveAgents(e,a===t.ChatStartSourceType.PROVIDER_DRIVEN_PROACTIVE):a===t.ChatStartSourceType.PROVIDER_DRIVEN_PROACTIVE?this.requestProviderToHandleProviderDrivenOpen():this.requestProviderToStartChat(e):this.requestProviderToLoadChatToStartChat(e)},this.requestProviderToHandleProviderDrivenOpen=()=>{this.provider.handleProviderDrivenOpen(),this.modifyLifecycleState(pt.SHOWING_CHAT)},this.requestProviderToStartChat=e=>{this.modifyLifecycleState(pt.REQUESTED_PROVIDER_TO_START_CHAT),this.provider.startChat(e.chatCampaign,this.state.source_type===t.ChatStartSourceType.PROACTIVE)},this.requestProviderToGetAgentStatusUpdateToStartChat=t=>{this.modifyLifecycleState(pt.TO_START_ON_AGENT_STATUS_UPDATE),this.provider.requestAgentStatusUpdate(t.chatCampaign)},this.setupProactivePropertiesIfNeeded=()=>{const e=this.chatCampaignWrapper;if(!e||!q(e.chatCampaign))return;const a=e.chatCampaign,i=a.proactiveSettings;if(!i||i.whenToShowControlledByProvider||a.isControl)return;if(!a.greetingMessage)return void this.logError(st.ATTEMPT_START_PROACTIVE_CHAT_WITHOUT_MESSAGE);const s=this.readProactiveChatCooloffCookie();if(s)return void this.logEvent(tt.IMPRESSION_FAILED,{failed_reason:et.COOLOFF_PERIOD,debug_info:s},a);const n=1e3*Number(i.secondsUntilShown);setTimeout((()=>{this.state.hasShownAChat||this.state.campaign&&this.state.campaign!==a?this.logEvent(tt.IMPRESSION_FAILED,{failed_reason:et.ANOTHER_CHAT_STARTED},a):this.intializeStartingChat(e,t.ChatStartSourceType.PROACTIVE)}),n)},this.setupControlLogging=t=>{const e=t.proactiveSettings,a=()=>{let e=et.CONTROL_VERSION;this.readProactiveChatCooloffCookie()?e=et.COOLOFF_PERIOD:this.state.campaign&&this.state.campaign!==t?e=et.ANOTHER_CHAT_STARTED:this.chatCampaignWrapper&&this.chatCampaignWrapper.chatCampaignState.agentStatus!==K.ONLINE&&q(this.chatCampaignWrapper.chatCampaign)&&this.chatCampaignWrapper.chatCampaign.mustHaveAvailableAgents&&(e=et.NO_ONLINE_AGENTS),this.logEvent(tt.IMPRESSION_FAILED,{failed_reason:e},t)};if(!e)return void a();const i=1e3*Number(e.secondsUntilShown);setTimeout(a,i),setTimeout((()=>this.deprecatedMaybeLogExperiment(t)),i)},this.getPersistenceCookie=t=>q(t)?t.persistenceCookie:`SNAPENGAGE:${t}`,this.setChatVisibleCookie=t=>{if(!this.metadata)return;const e=this.getPersistenceCookie(t),i=this.getLegacyCampaignIdentifierToCookieStr(t);i&&a.Cookies.create(this.metadata.legacyCookieCampaignName,i,.084,this.metadata.cookieDomain),a.Cookies.create(this.metadata.cookieCampaignName,e,1,this.metadata.cookieDomain)},this.maybeSetProactiveChatCooloffCookie=(e,i)=>{if(this.metadata&&e===t.ChatStartSourceType.PROACTIVE&&i&&q(i.chatCampaign)&&i.chatCampaign.proactiveSettings&&i.chatCampaign.proactiveSettings.coolOffPeriodMinutes){const t=i.chatCampaign,e=(new Date).getTime(),s=`${t.campaignId}:${t.versionId}:${e}`,n=Number(t.proactiveSettings.coolOffPeriodMinutes)/1440;a.Cookies.create(_t,s,n,this.metadata.cookieDomain)}},this.readProactiveChatCooloffCookie=()=>a.Cookies.read(_t),this.getInitialChatCampaignState=()=>({isLoaded:!1,agentStatus:K.UNKNOWN}),this.getWrapperFromIdentifier=t=>this.chatCampaignWrapper&&x(this.chatCampaignWrapper.chatCampaign,t)?this.chatCampaignWrapper:x(this.defaultChatWrapper.chatCampaign,t)?this.defaultChatWrapper:this.supportChatWrapper&&x(this.supportChatWrapper.chatCampaign,t)?this.supportChatWrapper:void 0,this.getLegacyCampaignIdentifierToCookieStr=t=>q(t)?"snapengageChatSystemSettings"===t.systemSettings.case?t.systemSettings.value.widgetId:null:t,this.legacyToggleOutsideChatVisibilityOnAgentStatusUpdate=t=>{this.modifyVisibility("[data-snap-engage-visibility]",!1),t===K.ONLINE?this.modifyVisibility('[data-snap-engage-visibility="online"]',!0):this.modifyVisibility('[data-snap-engage-visibility="offline"]',!0)},this.modifyVisibility=(t,e)=>{const a=e?"inline":"none",i=document.querySelectorAll(t);for(let t=0;t<i.length;t++){const e=i[t];e instanceof HTMLElement&&(e.style.display=a)}},this.onAgentStatusUpdate=(t,e)=>{const a=x(this.state.campaign,t),i=this.state.lifecycleState,s=i===pt.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_AGENT_STATUS_UPDATE&&a,n=i===pt.TO_START_ON_AGENT_STATUS_UPDATE&&a,r=this.getWrapperFromIdentifier(t);void 0!==r&&(r.chatCampaignState.agentStatus=e,this.legacyToggleOutsideChatVisibilityOnAgentStatusUpdate(e),s?this.attemptToShowProviderReactiveChatButton():n&&this.attemptToStartChat(r))},this.onChatLoadStatusUpdate=(t,e)=>{if(!this.hasFirstLoadOccured&&e){this.hasFirstLoadOccured=!0;const e=((new Date).valueOf()-this.setupTime.valueOf()).toString();this.logEvent(tt.INITIALIZED,{init_latency_ms:e}),this.deprecatedLogChatAction("snapengage_loaded",z(t),{total_time:e}),this.deferredStartChatCallback&&this.deferredStartChatCallback()}const a=x(this.state.campaign,t),i=this.state.lifecycleState,s=i===pt.TO_SHOW_PROVIDER_REACTIVE_BUTTON_ON_LOAD&&a,n=i===pt.TO_START_ON_LOAD&&a,r=this.getWrapperFromIdentifier(t);void 0!==r&&(r.chatCampaignState.isLoaded=e,e&&this.provider.requestAgentStatusUpdate(t),s?this.attemptToShowProviderReactiveChatButton():n&&this.attemptToStartChat(r))},this.onProviderReactiveButtonShown=()=>{this.state.lifecycleState===pt.REQUESTED_PROVIDER_TO_SHOW_REACTIVE_BUTTON&&(this.modifyLifecycleState(pt.SHOWING_PROVIDER_REACTIVE_BUTTON),this.logEvent(tt.IMPRESSION,{impression_type:at.CHAT_ICON}))},this.onProviderDrivenOpenProactive=e=>{this.chatCampaignWrapper&&x(this.chatCampaignWrapper.chatCampaign,e)&&(this.state.hasShownAChat||(this.logEvent(tt.IMPRESSION,{impression_type:at.PROACTIVE_CHAT}),this.deprecatedMaybeLogExperiment(e),this.deprecatedLogChatAction("proactive_chat_opened",z(e)),this.canStartChat()&&this.intializeStartingChat(this.chatCampaignWrapper,t.ChatStartSourceType.PROVIDER_DRIVEN_PROACTIVE))),this.updateChatVisibility(!0)},this.onChatShown=e=>{this.state.lifecycleState!==pt.SHOWING_PROVIDER_REACTIVE_BUTTON&&this.state.lifecycleState!==pt.REQUESTED_PROVIDER_TO_START_CHAT||x(this.state.campaign,e),this.modifyLifecycleState(pt.SHOWING_CHAT),this.state.campaign=e,this.state.hasShownAChat=!0,this.state.source_type===t.ChatStartSourceType.RESUME?(this.provider.updateHmac(),this.state.interactedWithChat=!0,this.logEvent(tt.IMPRESSION,{impression_type:at.RESUMED_CHAT})):this.state.source_type!==t.ChatStartSourceType.REACTIVE||this.impressionLogged||this.logEvent(tt.IMPRESSION,{impression_type:at.REACTIVE_CHAT}),this.updateChatVisibility(!0)},this.onChatStarted=e=>{const a=this.state.source_type;if(void 0!==a){let s;this.state.interactedWithChat=!0;let n=it.UNKNOWN;a===t.ChatStartSourceType.RESUME?(s="chat_persistence_init",n=it.RESUMED_CHAT):a===t.ChatStartSourceType.PROACTIVE||a===t.ChatStartSourceType.PROVIDER_DRIVEN_PROACTIVE?(s="proactive_chat_initiated",n=it.PROACTIVE_CHAT,Y(z(e))&&i.WebRequest$2({url:dt(),data:{chatId:z(e)}})):a===t.ChatStartSourceType.REACTIVE?(s="reactive_chat_initiated",n=it.REACTIVE_CHAT):a===t.ChatStartSourceType.TRANSFER&&(n=it.TRANSFERRED_CHAT),this.logEvent(tt.INTERACT,{interaction_type:n}),void 0!==s&&this.deprecatedLogChatAction(s,z(e))}else this.logError(st.CHAT_STARTED_FROM_UNKNOWN_SOURCE);this.setChatVisibleCookie(e),this.modifyLifecycleState(pt.CHAT_ONGOING)},this.onChatClosed=(t,e)=>{let a;this.handleCookieOnClosed(this.state.source_type,this.chatCampaignWrapper);let i=K.UNKNOWN;void 0!==e.agentStatus&&(a=e.agentStatus===K.ONLINE?"online":"offline",i=e.agentStatus===K.ONLINE?K.ONLINE:K.OFFLINE),this.deprecatedLogChatAction("snapengage_chat_close",z(t),{type:e.chatType,agent_status:a});const s=this.state.interactedWithChat?tt.CLOSE:tt.DISMISSED;this.logEvent(s,{agents_status:i,chat_form_type:e.chatType}),this.updateChatVisibility(!1),this.resetChatState()},this.onChatMinimized=t=>{this.updateChatVisibility(!1),this.modifyLifecycleState(pt.SHOWING_PROVIDER_REACTIVE_BUTTON)},this.onChatMaximized=t=>{this.updateChatVisibility(!0),this.modifyLifecycleState(pt.SHOWING_CHAT)},this.onSwitchProviderWithNewCampaign=(e,a)=>{const i=this.provider;let s;i.handleTransferEvent(X.START_TRANSFER);try{const t=this.getChatProviderMetadata(e);if(!e.userProperties)throw new Error("User properties cannot be empty");this.setupProvider(e.campaignResult,t,e.userProperties,e.chatProviderType),s=e.campaignResult}catch{return void i.handleTransferEvent(X.ERROR_ON_TRANSFER)}this.logEvent(tt.TRANSFER,{},s),this.onChatLoadStatusUpdate(a,!1),this.onAgentStatusUpdate(a,K.UNKNOWN),this.resetChatState(),this.provider.requestAgentStatusUpdate(s),i.handleTransferEvent(X.END_TRANSFER),this.setChatVisibleCookie(s),this.intializeStartingChat(this.chatCampaignWrapper,t.ChatStartSourceType.TRANSFER)},this.getChatProviderMetadata=t=>{let e;if("snapengageChatMetadata"!==t.chatProviderMetadata.case)throw new Error("No provider metadata provided");return e=t.chatProviderMetadata.value,e},this.maybeLogImpressionFailedOnUnload=()=>{if(!this.impressionLogged){const t=(new Date).valueOf()-this.setupTime.valueOf();this.logEvent(tt.IMPRESSION_FAILED,{failed_reason:et.NOT_ENOUGH_TIME_ON_PAGE,time_on_page_ms:t.toString()})}},this.logEvent=(t,e,a)=>{t!==tt.IMPRESSION&&t!==tt.IMPRESSION_FAILED||(this.impressionLogged=!0),this.logger.logEvent(t,this.createEventData(e,a))},this.logError=t=>{this.logEvent(tt.ERROR,{error_type:t})},this.createEventData=(t,e)=>{let i="-1",s=-1,n=-1,r="";if(this.initProperties.userProperties&&(i=this.initProperties.userProperties.userId),e)s=Number(e.campaignId),n=Number(e.versionId),r="snapengageChatSystemSettings"===e.systemSettings.case&&e.systemSettings.value.widgetId||"";else{const t=this.chatCampaignWrapper||this.defaultChatWrapper;t&&(r=z(t.chatCampaign)||"",q(t.chatCampaign)&&(s=Number(t.chatCampaign.campaignId),n=Number(t.chatCampaign.versionId)))}return t.chat_session_id||(t.chat_session_id=a.Cookies.read("SnapABugChatSession")||""),{userId:i,campaignId:s,versionId:n,widgetId:r,correlationId:this.initProperties.loggingCorrelationId,platform:"WEB",eventDetails:t}},this.loggerFactory=n,this.logger=n.getChatLogger(),this.getChatProvider=e,this.shouldAllowChat=s,this._isSetup=!1,this.onVisibilityChangeCallbacks=[]}attemptToShowReactiveButtonChatThatMustHaveAgents(t){const e=t.chatCampaignState.agentStatus;e===K.UNKNOWN?this.requestProviderToGetAgentStatusUpdateToShowProviderReactiveButton(t):e===K.OFFLINE?(this.deprecatedLogChatAction("chat_agent_must_be_online_but_was_offline",z(t.chatCampaign)),this.logEvent(tt.IMPRESSION_FAILED,{failed_reason:et.NO_ONLINE_AGENTS}),this.resetChatState()):this.requestProviderToShowProviderReactiveButton()}attemptToStartChatThatMustHaveAgents(t,e){const a=t.chatCampaignState.agentStatus;a===K.UNKNOWN?this.requestProviderToGetAgentStatusUpdateToStartChat(t):a===K.OFFLINE?(this.logEvent(tt.IMPRESSION_FAILED,{failed_reason:et.NO_ONLINE_AGENTS}),this.resetChatState()):e?this.requestProviderToHandleProviderDrivenOpen():this.requestProviderToStartChat(t)}requestProviderToLoadChatToStartChat(t){this.modifyLifecycleState(pt.TO_START_ON_LOAD),this.provider.loadChatIfNecessary(t.chatCampaign)}handleCookieOnClosed(t,e){this.metadata&&(a.Cookies.delete(this.metadata.cookieCampaignName),a.Cookies.delete(this.metadata.legacyCookieCampaignName),this.maybeSetProactiveChatCooloffCookie(t,e))}deprecatedLogChatAction(t,e,a){if(!e)return;const s={...{chat_widget_id:e,url:i.get_href()},...a};i.TeamsWebActionsLogger.log(t,s),i.getAMPWebLogger().logEventCount("chat_events",t,{chat_widget_id:e})}deprecatedMaybeLogExperiment(t){q(t)}resetChatState(){this.modifyLifecycleState(pt.NOT_SHOWN),this.state.campaign=void 0,this.state.source_type=void 0,this.state.interactedWithChat=!1}}const Tt=new mt(j.getChatProvider,(()=>top===window),ct);t.ChatClientSingleton=Tt,t._ChatClientSingleton=mt,t.moduleInit=function(t){const a=e.unmarshalProto(t,G);Tt.setupChatEnvironment(a)}}));
//# sourceMappingURL=c_chat_chat_client.js-vfl5R-5g_.map

//# debugId=afd49454-4e48-3700-901f-d011810c504c