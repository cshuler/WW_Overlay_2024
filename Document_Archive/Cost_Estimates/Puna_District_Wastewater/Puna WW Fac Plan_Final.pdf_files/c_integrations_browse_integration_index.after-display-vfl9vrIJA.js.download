!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d31fceec-a856-3ae3-93ca-8b9445bd3a98")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_file","./c_core_i18n","./c_stacks_async_add_to_stack","./e_data_modules_stormcrow","./e_edison","./c_features_deprecator_index","./c_inband-screen_internals_share-modal-share","./c_src_utils_initials","./c_src_bindings_provider","./c_utils_dsx_dsx-react","./c_spectrum_util_raf_throttle","./c_api_v2_unauthed_client","./c_bem","./c_dotlottie_common_chunk-B7OIQIGJ","./c_api_v2_routes_plan_configuration_provider","./c_src_sink_index","./c_shareme24_main","./c_account_email","./c_account_email_verify_reasons","./c_ui_contextual-nudge_campaign-contextual-nudge-section","./c_content-member-list_internals_content-member-list","./c_dig-icons_assets_ui-icon_line_quota-reached","./c_abuse_fingerprintjs_abuse_fpjs_provider","./c_common_components_buttons","./c_abuse_fingerprintjs_abuse_fpjs_context","./c_sharing_sharing_pap_logging_send_share_invite_util","./c_dig-components_typeahead_index","./c_dig-components_chip_index","./c_dig-icons_assets_ui-icon_line_no-fill","./c_over-quota_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./c_settings-page_internals_settings-page-wrapper","./c_dig-icons_assets_ui-icon_line_qr-code","./c_dig-icons_assets_ui-icon_line_settings","./c_dig-icons_assets_ui-icon_line_stacks","./e_core_exception","./c_init_data_edison","./c_api_v2_routes_restorations_provider","./c_lodash-es_lodash","./c_hive_schemas_sharing-request_access_user_events","./c_core_notify","react-dom","./c_api_v2_routes_team_insights_provider","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_pap-events_navigation_select_create_folder_action","react/jsx-runtime","metaserver/static/js/langpack","./c_contacts_contact","./c_validators","./c_domain_restriction_utils_response_helpers","./c_proto_storefront_platform_js_init_data_payment_method_pb","./c_proto_storefront_platform_js_init_data_transition_pb","./c_proto_checkout_js_init_data_checkout_page_pb","./c_cash_common_common_pb","./c_proto_storefront_platform_js_init_data_usage_data_pb","./c_dig-icons_assets_ui-icon_line_share","./c_api-v2-client_src_dropbox","./c_react_query_helpers_queries_login_and_register_constants","./c_react-use_misc_util","./c_over-quota_utils_use_get_plans","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_dig-icons_assets_ui-icon_line_tag","./c_trial-cards_trial-plan-card","./c_dig-components_meter_index","./c_react-hookz_web_useRafCallback","./c_over-quota_utils_oq_price_decrease_helper","./c_custom_campaigns_out_of_space_modal_out_of_space_checkout_modal_logger","./c_common_components_layout","./c_user_metadata_api","./c_ui_modal_dig","./c_form","./c_account_email_verify","./c_auth_webauthn","./c_ui_locked-state-modal_open_locked_state_modal","./c_dig-components_card_index","./c_dig-icons_assets_ui-icon_line_upsell","./c_over-quota_over-quota-sweep-blocking-modal_over_quota_sweep_blocking_modal_wrapper","./c_ui_contextual-nudge_atoms","./c_dig-illustrations_spot_bowl-empty","./c_dig-icons_assets_ui-icon_line_team","./c_dig-content-icons_icons_folder-shared-default-small","./c_dig-foundations__global_slot","./c_fingerprintjs_fpjs-pro-static_fp","./c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal","./c_growth-components_auto-layout-modal_auto_layout_modal","./c_growth-components_over-quota-file-viewer-modal","./c_dig-components_tabs_index","./c_components_icons_icon_dropdown_selected","./c_date-fns__lib_requiredArgs_index"],(function(e,t,a,n,i,s,r,o,l,c,d,_,g,u,m,p,f,h,E,v,y,S,b,I,M,C,A,T,x,N,k,L,R,w,$,O,D,P,F,U,H,B,j,V,q,z,G,W,K,Y,Z,Q,X,J,ee,te,ae,ne,ie,se,re,oe,le,ce,de,_e,ge,ue,me,pe,fe,he,Ee,ve,ye,Se,be,Ie,Me,Ce,Ae,Te,xe,Ne,ke,Le,Re,we,$e,Oe,De,Pe){"use strict";function Fe(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var Ue=Fe(t);a.createApiv2Query({nsClient:i.GetStacksRoutes,rpc:"query_stacks"});const He=a.createApiv2Query({nsClient:a.GetFilesRoutes,rpc:"list_folder"}),Be=(e,t)=>{He.prefetchQuery(e,{apiArg:{path:t,limit:i.STACK_SIZE_LIMIT}})},je=(e,t=!1)=>{const a=He.useQuery({apiArg:{path:e,limit:i.STACK_SIZE_LIMIT}},{staleTime:3e5,enabled:t});return Ue.useMemo((()=>{var e;if(a.isLoading)return{isLoading:!0};if(a.error)return{isLoading:!1,isError:!0,error:a.error.appError};{const t=a.data.apiData;if(t.has_more)return{isLoading:!1,isError:!0,error:{".tag":"too_many_contents"}};const n=[];for(const a of t.entries)if("id"in a){if("folder"===a[".tag"]&&(null===(e=a.sharing_info)||void 0===e?void 0:e.no_access))continue;n.push({file_id:a.id,fq_path:a.name})}return{isError:!1,isLoading:!1,output:n}}}),[a])},Ve=(e,t=!0)=>{t?a.fail(e.formatMessage({id:"ObEiUD",defaultMessage:"Couldn’t complete this request. Try again."})):a.fail(e.formatMessage({id:"VAAIgQ",defaultMessage:"Couldn’t complete this request."}))},qe=({children:e,onFallback:t,onRequestClose:i})=>{const s=E.useData(),r=Ue.useRef(!1),o=(()=>{const e=n.useIntl();return Ue.useCallback((t=>{switch(t.loadError.type){case"METADATA_ERROR_V2":switch(t.loadError.response.error[".tag"]){case"email_unverified":return a.fail(e.formatMessage({id:"YQ+xBi",defaultMessage:"Verify your email to share this content."})),!0;case"invalid_oid":return a.fail(e.formatMessage({id:"hBQISs",defaultMessage:"This content doesn’t exist."})),!0;case"no_access":return a.fail(e.formatMessage({id:"S0dPqX",defaultMessage:"You don’t have access to this content."})),!0;case"other":return Ve(e),!0;default:return a.exhausts(t.loadError.response.error[".tag"],!1)}case"METADATA_FATAL_V2":return Ve(e),!0;default:return!1}}),[e])})();return Ue.useEffect((()=>{if("error"===s.status&&!r.current){r.current=!0;o(s)?i():t&&t()}}),[s,t,i,o]),Ue.createElement(Ue.Fragment,null,e)};qe.displayName="DataLoadingErrorWrapper";const ze=Symbol("ON_SHOW_VERIFY_EMAIL_MODAL"),{useEmitter:Ge,defaultEmitter:We}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),s=t(a.Context$6),r=t(a.Context$7),o={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(s),...a.getTags$7(r),isSm24:"true"},l={...a.getProperties$4(n),...a.getProperties$5(i),...a.getProperties$6(s),...a.getProperties$7(r)};e.key===ze&&(a.UDCL.logEnd("ops.sm24.browse_load",{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"canceled",...l}),{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEvent("ops.sm24.show_verify_email_modal",{tags:o}))})),Ke=({children:e,sessionId:t,onRequestClose:n})=>{var i,s;const r=Ge(),{viewer:o,isLoading:l}=a.useViewer(),c=!l&&!1===(null===(i=o.active_user)||void 0===i?void 0:i.is_email_verified);return Ue.default.useEffect((()=>{c&&r.select(ze).emit({sessionId:t})}),[c,t,r]),c?Ue.default.createElement(v.VerifyEmailModal,{viewer:o,user:o.active_user,reason:y.EmailVerificationReasons.SHMODAL,email:null===(s=o.active_user)||void 0===s?void 0:s.email,onShowChange:()=>{o.active_user&&v.ChangeEmail.show(o,o.active_user,y.EmailVerificationReasons.SHMODAL)},onEmailSent:()=>{v.EmailVerification.get_for_user(o,o.active_user).email_sent(void 0,y.EmailVerificationReasons.SHMODAL,!0),n()},onCancel:n}):Ue.default.createElement(Ue.default.Fragment,null,e)};Ke.displayName="EmailVerificationWrapper";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/common/components/hanging-notification.module.out-vflChWqLs.css",(e=>"._hangingNotification_ia43j_3{opacity:0;pointer-events:auto;transform:translateY(-12px);transition:opacity .15s ease-in,transform .15s ease-in}._hangingNotification_ia43j_3._visible_ia43j_14{opacity:1;transform:translateY(0);transition:opacity .2s ease-out,transform .2s ease-out}"));const Ye="_hangingNotification_ia43j_3",Ze="_visible_ia43j_14",Qe={success:a.CheckmarkCircleLine,error:a.FailLine,warning:a.WarningLine},Xe=({isVisible:e,message:t,type:n,action:i,isDismissible:s,onDismiss:r,autoDismissMs:o,style:l})=>{const c=n?Qe[n]:null;return Ue.createElement(a.Snackbar$1,{open:e,preferComposition:!0,timeout:o,onRequestClose:r,style:l},c&&Ue.createElement(a.Snackbar$1.Accessory,null,Ue.createElement(a.UIIcon,{src:c})),Ue.createElement(a.Snackbar$1.Content,null,Ue.createElement(a.Snackbar$1.Message,null,t),(i||s)&&Ue.createElement(a.Snackbar$1.Actions,null,Ue.createElement(a.Box,{display:"flex",style:{gap:"4px"}},i&&Ue.createElement(a.Button,{variant:"outline",inverse:!0,size:"small",onClick:()=>{try{null==i||i.onClick()}catch(e){}finally{r()}}},i.label),s&&Ue.createElement(a.IconButton,{variant:"outline",inverse:!0,size:"small",onClick:r},Ue.createElement(a.UIIcon,{src:a.CloseLine}))))))};Xe.displayName="NotificationContent";const Je=({isVisible:e,message:t,type:n,action:i,isDismissible:s,onDismiss:r,autoDismissMs:o=5e3})=>{const{small:l}=a.useBreakpoint({strategy:"maxWidth"}),c=d.usePlatform()===d.Platforms.DESKTOP,_=((e,t)=>{const[a,n]=Ue.useState(e);return Ue.useEffect((()=>{if(e)return void n(!0);const a=window.setTimeout((()=>n(!1)),t);return()=>window.clearTimeout(a)}),[e,t]),a})(e,250),[g,u]=Ue.useState(!1);return Ue.useEffect((()=>{if(!e||!_)return void u(!1);u(!1);const t=requestAnimationFrame((()=>{const e=requestAnimationFrame((()=>{u(!0)}));return()=>cancelAnimationFrame(e)}));return()=>cancelAnimationFrame(t)}),[e,_]),c||l?Ue.createElement(a.Snackbar$1.Position,null,Ue.createElement(Xe,{isVisible:e,message:t,type:n,action:i,isDismissible:s,onDismiss:r,autoDismissMs:o})):Ue.createElement(a.Box,{left:"0",right:"0",top:"100%",position:"absolute",paddingLeft:"Micro Medium",paddingRight:"Micro Medium",style:{zIndex:-1}},Ue.createElement("div",{className:a.cx(Ye,{[Ze]:g})},Ue.createElement(Xe,{isVisible:e,message:t,type:n,action:i,isDismissible:s,onDismiss:r,autoDismissMs:o,style:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:"var(--dig-radius__large)",borderBottomRightRadius:"var(--dig-radius__large)"}})))};Je.displayName="HangingNotification";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/common/components/mobile-drawer.module.out-vflHjQrar.css",(e=>"._outerWrapper_1lhgo_3{background:var(--dig-color__background__subtle);display:flex;flex-direction:column;height:100%;overflow:hidden}._roundedCorner_1lhgo_11{border-top-left-radius:16px;border-top-right-radius:16px}._container_1lhgo_16{background-color:var(--dig-color__background__base)}._handle_1lhgo_20{background-color:var(--dig-color__border__subtle);border-radius:2px;height:4px;margin:8px auto 0;width:32px}"));const et="_outerWrapper_1lhgo_3",tt="_roundedCorner_1lhgo_11",at="_container_1lhgo_16",nt=({isOpen:e,onRequestClose:t,isFullHeight:n,children:i,"aria-label":s,"data-testid":r="mobile-drawer"})=>{const o=n?"100%":"auto";return Ue.createElement(a.Drawer.ModalDrawer,{onRequestClose:t,"aria-label":s,isOpen:e,alignment:"bottom",height:o,className:n?void 0:tt,"data-testid":r,shouldAnimate:!0,hasScrollLock:!0},Ue.createElement(d.FocusLock,{group:"share-modal"},Ue.createElement("div",{className:a.cx(et,{[tt]:!n})},Ue.createElement(a.Drawer.Container,{className:at},Ue.createElement(a.Drawer.Body,null,i)))))};function it(e){return{class:"share",action:"click",object:"share_modal",properties:e}}nt.displayName="MobileDrawer";const st=Symbol("ON_VIEW_SHARE_MODAL_PAGE"),rt=Symbol("ON_CLICK_MORE_BUTTON"),ot=Symbol("ON_CLICK_SETTINGS_BUTTON"),lt=Symbol("ON_CLICK_STACKS_BUTTON"),ct=Symbol("ON_CLICK_INBAND_BUTTON"),dt=Symbol("ON_CLICK_TRANSFER_BUTTON"),_t=Symbol("ON_CLICK_QR_CODE_BUTTON"),gt=Symbol("ON_CLICK_COPY_LINK_BUTTON"),ut=Symbol("ON_CLICK_CONTENT_MEMBER_LIST_BUTTON"),mt=Symbol("ON_CLICK_CLOSE_BUTTON"),pt=Symbol("ON_CLICK_CLICKAWAY_BUTTON"),ft=Symbol("ON_CLICK_COLLAPSED_MEMBER_SUMMARY_BUTTON"),ht=Symbol("ON_CLICK_INHERITED_SUMMARY_ROW_BUTTON"),{useEmitter:Et,defaultEmitter:vt}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),s=t(a.Context$6),r=t(a.Context$7),o={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(s),...a.getTags$7(r)},l={...a.getProperties$4(n),...a.getProperties$5(i),...a.getProperties$6(s),...a.getProperties$7(r)};e.key===st?(a.UDCL.logEvent(function(e){return{class:"share",action:"view",object:"share_modal_page",properties:e}}({...l,shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}),{tags:{...o,shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}),a.UDCL.logEvent("ops.sm26.view_page",{tags:{...o,shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}})):e.key===rt?a.UDCL.logEvent(it({...l,shareModalElement:"more_button",shareModalType:"sm26"}),{tags:{...o,element:"more_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===ot?a.UDCL.logEvent(it({...l,shareModalElement:"settings_button",shareModalType:"sm26"}),{tags:{...o,element:"settings_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===lt?a.UDCL.logEvent(it({...l,shareModalElement:"stacks_button",shareModalType:"sm26"}),{tags:{...o,element:"stacks_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===ct?a.UDCL.logEvent(it({...l,shareModalElement:"inband_button",shareModalType:"sm26"}),{tags:{...o,element:"inband_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===dt?a.UDCL.logEvent(it({...l,shareModalElement:"transfer_button",shareModalType:"sm26"}),{tags:{...o,element:"transfer_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===_t?a.UDCL.logEvent(it({...l,shareModalElement:"qr_code_button",shareModalType:"sm26"}),{tags:{...o,element:"qr_code_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===gt?a.UDCL.logEvent(it({...l,shareModalElement:"copy_link_button",shareModalType:"sm26"}),{tags:{...o,element:"copy_link_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===ut?a.UDCL.logEvent(it({...l,shareModalElement:"content_member_list_button",shareModalType:"sm26"}),{tags:{...o,element:"content_member_list_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===mt?a.UDCL.logEvent(it({...l,shareModalElement:"close_button",shareModalType:"sm26"}),{tags:{...o,element:"close_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===pt?a.UDCL.logEvent(it({...l,shareModalElement:"clickaway",shareModalType:"sm26"}),{tags:{...o,element:"clickaway",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===ft?a.UDCL.logEvent(it({...l,shareModalElement:"collapsed_member_summary_button",shareModalType:"sm26"}),{tags:{...o,element:"collapsed_member_summary_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===ht&&a.UDCL.logEvent(it({...l,shareModalElement:"inherited_summary_row_button",shareModalType:"sm26"}),{tags:{...o,element:"inherited_summary_row_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}})}));var yt;!function(e){e.MAIN="main",e.MORE="more",e.SETTINGS="settings",e.INBAND="inband",e.COPY_LINK="copy_link",e.QR_CODE="qr_code",e.CONTENT_MEMBER_LIST="content_member_list"}(yt||(yt={}));const St={$props:_.atom({isOpen:!1,onRequestClose:()=>{},onControlledFeatureClicked:()=>{},objectIdentifier:{".tag":"file",fileId:""},onObjectIdentifierChanged:()=>Promise.resolve(),isEncrypted:!1,fileName:"",filePath:"",copyLinkMode:"integrated_v1",inbandSharingMode:"integrated_v1",settingsMode:"integrated_v1",transferMode:"controlled_v1",transferHandler:()=>{},canUserUseTransfer:!1,canContentUseTransfer:!1,canUserEnableTransfer:!1,isTransferEligibilityLoading:!1,stacksMode:"controlled_v1",stacksHandler:()=>{},canUserCreateStack:!1,isStacksContentLimitExceeded:null,referrerLoggingMetadata:{actionElement:"",actionSurface:"",contentAction:"share",tiburonOrigin:"SHARING_SDK_SANDBOX",screen:"share_screen",shareModalType:"sm26"},objectLoggingMetadata:{type:"file",name:"",size:0},itemCountResult:{isLoading:!0},objectMetadataResult:{isLoading:!0},onDataSuccess:()=>{},onDataError:()=>{},onDataCancel:()=>{}}),$currentPage:_.atom(yt.MAIN),$previousPage:_.atom(null),$clipboardWriter:_.atom(void 0),$inviteTargets:_.atom([]),$inviteMessage:_.atom(""),$initialInputKey:_.atom(void 0),$isSuggestionsOpen:_.atom(!1),$suggestedContacts:_.atom([]),$isConfidentialFolderBannerClosed:_.atom(!1),$initialSettingsTab:_.atom("object_settings"),$isOperationInProgress:_.atom(!1),$itemCount:_.atom(null),$fileNameWithoutExtension:_.atom(""),$extension:_.atom(""),$hangingNotification:_.atom(null),$expandInheritedOnContentMemberListOpen:_.atom(!1)},{StoreProvider:bt,useStore:It}=_.defineStoreProvider((e=>{const t=_.atom(yt.MAIN),n=_.atom(null),i=_.atom(void 0),s=_.atom([]),r=_.atom(""),o=_.atom(!1),l=_.atom([]),c=_.atom(!1),d=_.atom(void 0),g=_.atom("object_settings"),u=_.atom(!1),m=_.proxy((()=>{const{itemCountResult:t}=e.get();return t.isLoading||t.isError?null:t.itemCount})),p=_.proxy((()=>{const{objectIdentifier:t,fileName:n}=e.get();return"file"===t[".tag"]?a.getFileNameAndExtensionFromFileName(n).fileNameWithoutExtension:""})),f=_.proxy((()=>{const{objectIdentifier:t,fileName:n}=e.get();return"file"===t[".tag"]?a.getFileNameAndExtensionFromFileName(n).extension:""})),h=_.atom(null),E=_.atom(!1);return{$props:e,$currentPage:t,$previousPage:n,$clipboardWriter:i,$inviteTargets:s,$inviteMessage:r,$initialInputKey:d,$isSuggestionsOpen:o,$suggestedContacts:l,$isConfidentialFolderBannerClosed:c,$initialSettingsTab:g,$isOperationInProgress:u,$itemCount:m,$fileNameWithoutExtension:p,$extension:f,$hangingNotification:h,$expandInheritedOnContentMemberListOpen:E}}),St),Mt=e=>{const{objectIdentifier:t}=e,n=(e=>{const{isNonUserRelativeContext:t}=a.useSharingApiContext(),n=null==e?void 0:e.fileId,i="file"===(null==e?void 0:e.type),s=a.getFolderItemCountPackage.useQuery({apiArg:{file_id:null!=n?n:""},pkgArg:{isNonUserRelativeContext:!!t}},{staleTime:3e5,enabled:!i&&!!n});return Ue.useMemo((()=>!s||s.isLoading?{isLoading:!0}:s.isError?{isLoading:!1,isError:!0,error:s.error.appError}:{isLoading:!1,isError:!1,itemCount:s.data.apiData.item_count}),[s])})(t.fileId?{fileId:t.fileId,type:t[".tag"]}:null),i=c.useSharingObjectMetadata(e.objectIdentifier.fileId);return Ue.createElement(bt,{itemCountResult:n,objectMetadataResult:i,...e})};Mt.displayName="Provider";const Ct=(e,t)=>{e.$isOperationInProgress.get()||(t===yt.MAIN&&e.$inviteTargets.set([]),t!==yt.INBAND&&e.$initialInputKey.set(void 0),e.$previousPage.set(e.$currentPage.get()),e.$currentPage.set(t))},At=(e,t)=>{e.$hangingNotification.set(t)},Tt=e=>{e.$hangingNotification.set(null)},xt=({children:e,onRequestClose:t})=>{const a=Et(),n=It(),i=_.useAtom(n.$currentPage);Ue.useEffect((()=>{const e=e=>{"Escape"===e.key&&(a.select(pt).emit({shareModalPage:i}),e.preventDefault(),e.stopImmediatePropagation(),t())};return document.addEventListener("keydown",e,!0),()=>{document.removeEventListener("keydown",e,!0)}}),[t]);const s=Ue.useCallback((e=>{if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)){const t=e.target;t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||t.isContentEditable)||(e.preventDefault(),e.nativeEvent.stopImmediatePropagation())}}),[]);return Ue.createElement(d.FocusLock,{group:"share-modal",autoFocus:!1,returnFocus:!0},Ue.createElement("div",{onKeyDown:s},e))};xt.displayName="ModalFocusWrapper";const Nt=e=>e.formatMessage({id:"pt0AFj",defaultMessage:"Share folder"}),kt=e=>e.formatMessage({id:"iqba4e",defaultMessage:"Share file"}),Lt=e=>e.formatMessage({id:"gTmtNI",defaultMessage:"Can’t add more than 200 files to a Stack at a time"}),Rt=e=>e.formatMessage({id:"WUY+xm",defaultMessage:"Close"});a.injectInternalStyle("/static/metaserver/static/js/sharing/features/share-modal/versions/shareme26/layout/layout.module.out-vflsWvmbu.css",(e=>"._header_1flrk_2{align-items:center;background-color:var(--dig-color__background__base);border-radius:var(--dig-radius__xxlarge) var(--dig-radius__xxlarge) 0 0;display:flex;justify-content:space-between;padding:0 0 var(--dig-spacing__macro__small)}._headerInfo_1flrk_11{align-items:flex-start;display:flex;flex-direction:row;flex-shrink:0;gap:var(--dig-spacing__micro__small,8px)}._headerText_1flrk_19{display:flex;flex-direction:column;gap:0}._title_1flrk_25{align-items:center;color:var(--dig-color__text__base);margin-bottom:-4px}._subtitle_1flrk_33,._title_1flrk_25{display:flex;gap:var(--dig-spacing__micro__xsmall,4px)}._subtitle_1flrk_33{align-items:flex-start;color:var(--dig-color__text__subtle);flex-wrap:wrap}._headerSlots_1flrk_41{align-items:center;display:flex;flex-shrink:0;gap:var(--dig-spacing__micro__small,8px);justify-content:flex-end}._body_1flrk_50{display:flex;flex:1;flex-direction:column;gap:var(--dig-spacing__macro__small);min-height:0}._bodyRow_1flrk_58{flex-shrink:0}._bodyRow_1flrk_58,._bodyRowScrollable_1flrk_64{display:flex;flex-direction:column}._bodyRowScrollable_1flrk_64{flex:1;min-height:0;overflow-y:auto}._footer_1flrk_73{align-items:center;background-color:var(--dig-color__background__base);display:flex;padding:var(--dig-spacing__macro__small,24px) 0 0}._footerLeftActions_1flrk_80{margin-right:auto}._footerLeftActions_1flrk_80,._footerRightActions_1flrk_87{align-items:center;display:flex;gap:var(--dig-spacing__micro__small)}._footerRightActions_1flrk_87{margin-left:auto}"));const wt="_header_1flrk_2",$t="_headerInfo_1flrk_11",Ot="_headerText_1flrk_19",Dt="_title_1flrk_25",Pt="_headerSlots_1flrk_41",Ft="_body_1flrk_50",Ut="_bodyRow_1flrk_58",Ht="_bodyRowScrollable_1flrk_64",Bt="_footer_1flrk_73",jt="_footerLeftActions_1flrk_80",Vt="_footerRightActions_1flrk_87",qt=({children:e,scrollable:t=!1,maxHeight:a})=>{const n=a?{maxHeight:`${a}px`}:void 0;return Ue.createElement("div",{className:t?Ht:Ut,style:n},e)};qt.displayName="Row";const zt=({children:e})=>e?Ue.createElement("div",{"data-testid":"sm26-body",className:Ft},e):null;zt.displayName="BodyBase";const Gt=Object.assign(zt,{Row:qt}),Wt=({icon:e,firstLabel:t,secondLabel:n})=>Ue.createElement(b.Metadata2,{size:"small",withDividers:"bullet"},Ue.createElement(b.Metadata2.Item,null,e&&Ue.createElement(b.Metadata2.UIIcon,{src:e}),Ue.createElement(b.Metadata2.Label,null,Ue.createElement(a.Truncate,{location:.5},t))),n&&Ue.createElement(b.Metadata2.Item,null,Ue.createElement(b.Metadata2.Label,null,n)));Wt.displayName="HeaderSubtitle";const Kt=({backButton:e,title:t,subtitle:i})=>{return Ue.createElement("div",{className:$t},e&&Ue.createElement(a.IconButton,{variant:"borderless",shape:"standard",size:"large","aria-label":(s=n.intl,s.formatMessage({id:"RDsqXu",defaultMessage:"Back"})),onClick:e.onClick,"data-testid":"back-button"},Ue.createElement(a.UIIcon,{src:a.ChevronLeftLine})),Ue.createElement("div",{className:Ot},Ue.createElement("div",{className:Dt},Ue.createElement(a.Title,{size:"small",weightVariant:"emphasized"},t)),i&&Ue.createElement(Wt,{...i})));var s};Kt.displayName="HeaderInfo";const Yt=e=>{const t=Ue.useRef(null),[n,i]=Ue.useState(!1),s=Ue.useCallback((()=>{i(!0)}),[]),r=Ue.useCallback((()=>{i(!1)}),[]),o=Ue.useCallback((()=>{i(!0)}),[]),l=Ue.useCallback((()=>{i(!1)}),[]);if("custom"===e.type)return Ue.createElement(Ue.Fragment,null,e.children);if(e.isLoading)return Ue.createElement(a.Skeleton.Box,{height:32,width:32,"data-testid":`${e.testId}-loading`});if(e.isDisabled){const i=!!e.disabledTooltip;return Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{ref:t,onMouseEnter:s,onMouseLeave:r,onFocus:o,onBlur:l,tabIndex:0,role:"button","aria-label":e.label,"aria-disabled":!0},Ue.createElement(a.IconButton,{variant:"borderless",shape:"standard",size:"medium","data-testid":e.testId,disabled:!0},Ue.createElement(a.UIIcon,{src:e.icon}))),i&&Ue.createElement(a.Tooltip.Control,{open:n,placement:"bottom",auto:!0,triggerRef:t},Ue.createElement(a.Text,null,e.disabledTooltip)))}return Ue.createElement(a.IconButton,{variant:"borderless",shape:"standard",size:"medium","aria-label":e.label,onClick:e.onClick,"data-testid":e.testId},Ue.createElement(a.UIIcon,{src:e.icon}))};Yt.displayName="Slot";const Zt=({info:e,children:t})=>Ue.createElement("div",{"data-testid":"sm26-header",className:wt},Ue.createElement(a.Split,{width:"100%"},Ue.createElement(a.Split.Item,null,Ue.createElement(Kt,{...e})),Ue.createElement(a.Split.Item,{style:{marginLeft:"auto"}},t&&Ue.createElement("div",{className:Pt},t))));Zt.displayName="HeaderBase";const Qt=Object.assign(Zt,{Slot:Yt}),Xt=(e,t=5)=>{const a=Math.max(1,Math.floor(t)),n=Math.max(0,Math.floor(e)),i=Math.pow(10,a)-1;return n>i?`${i.toLocaleString()}+`:n.toLocaleString()},Jt=e=>{if(null!==e)return n.intl.formatMessage({id:"u5gsFM",defaultMessage:"{formattedCount} {count, plural, one {item} other {items}}"},{count:e,formattedCount:Xt(e)})};function ea(e){const t=_.useAtom(e.$itemCount),a=_.useStore(e.$fileNameWithoutExtension),n=_.useStore(e.$extension),{fileName:i,objectIdentifier:s}=_.useAtom(e.$props);return"file"!==s[".tag"]?{icon:I.FolderLine,firstLabel:i,secondLabel:Jt(t)}:{icon:I.FileLine,firstLabel:a,secondLabel:n?n.toLocaleUpperCase():""}}const ta=()=>{var e;const t=It(),i=_.useAtom(t.$props),s=ea(t),r=_.useAtom(t.$expandInheritedOnContentMemberListOpen),o=Ue.useRef(r);r&&(o.current=!0),Ue.useEffect((()=>{r&&t.$expandInheritedOnContentMemberListOpen.set(!1)}),[r,t]);const l=Ue.useCallback((()=>{Ct(t,t.$previousPage.get()||yt.MAIN)}),[t]),d=Ue.useCallback((e=>{const{shouldOpenLinkSettings:a,initialTab:n}=e;let i;i=(null!=a?a:"edit_link_settings"===n||"view_link_settings"===n)?"edit_link_settings"===n?"edit_link_settings":"view_link_settings":"object_settings",t.$initialSettingsTab.set(i),Ct(t,yt.SETTINGS)}),[t]),{onRequestClose:g}=i,u=Ue.useCallback((e=>{e?g():Ct(t,yt.MAIN)}),[t,g]),m=Ue.useCallback((()=>{c.invalidateSharingObjectMetadata(i.objectIdentifier),c.invalidateNewApiObjectMetadata(i.objectIdentifier),b.invalidateListSharedLinks(i.objectIdentifier),a.invalidateObjectMembers(i.objectIdentifier),Ct(t,yt.INBAND)}),[i.objectIdentifier,t]),p=Ue.useCallback((()=>{Ct(t,yt.INBAND)}),[t]);return Ue.createElement(Ue.Fragment,null,Ue.createElement(Qt,{info:{backButton:{onClick:l},title:(f=n.intl,f.formatMessage({id:"iQ/N79",defaultMessage:"Who can access"})),subtitle:s}}),Ue.createElement(Gt,null,Ue.createElement(Gt.Row,{scrollable:!0},Ue.createElement(b.ContentMemberList,{objectIdentifier:i.objectIdentifier,openLinkSettings:d,onRequestClose:u,onConfirmationModalShownChange:null!==(e=i.onConfirmationModalShownChange)&&void 0!==e?e:()=>{},onTransferFolderOwnership:m,onChangeConfidentiality:p,onObjectIdentifierChanged:i.onObjectIdentifierChanged,shouldUseSm26Design:!0,expandInheritedOnLoad:o.current}))));var f};ta.displayName="ContentMemberListPage";const aa=()=>{const e=It(),t=_.useAtom(e.$props),i=_.useStore(e.$clipboardWriter),{objectIdentifier:s,onRequestClose:r,settingsMode:o}=t,l=ea(e),c=Et(),d=Ue.useCallback((t=>{c.select(ot).emit({shareModalPage:yt.COPY_LINK}),"integrated_v1"!==o||_.batch((()=>{t.shouldOpenLinkSettings?e.$initialSettingsTab.set("edit_link_settings"===t.initialTab?"edit_link_settings":"view_link_settings"):e.$initialSettingsTab.set("object_settings"),Ct(e,yt.SETTINGS)}))}),[c,e,o]),g=Ue.useCallback((()=>{e.$isOperationInProgress.set(!0)}),[e]),u=Ue.useCallback((()=>{e.$isOperationInProgress.set(!1)}),[e]);return Ue.createElement(Ue.Fragment,null,Ue.createElement(Qt,{info:{title:(m=n.intl,m.formatMessage({id:"d32enr",defaultMessage:"Copy link to"})),subtitle:l}},Ue.createElement(Qt.Slot,{type:"iconButton",icon:a.CloseLine,label:Rt(n.intl),onClick:r,testId:"copy-link-close-button",isLoading:!1,isDisabled:!1,disabledTooltip:null})),Ue.createElement(Gt,null,Ue.createElement(Gt.Row,null,Ue.createElement(E.CopyLinkScreen,{key:s.fileId,oid:s,settingsHandler:d,onRequestClose:r,clipboardWriter:i,onBlockClickaway:g,onUnblockClickaway:u,shouldUseSm26Design:!0}))));var m};aa.displayName="CopyLinkPage";const na=e=>e.formatMessage({id:"RYuEPZ",defaultMessage:"Some of these emails aren’t on your Dropbox team."}),ia=e=>e.formatMessage({id:"c7+ulZ",defaultMessage:"This email isn’t on your Dropbox team."}),sa=e=>e.formatMessage({id:"Vp93jb",defaultMessage:"One or more of these emails is no longer active."}),ra=e=>e.formatMessage({id:"Eowy6P",defaultMessage:"Automatic groups can only be added to team folders."}),oa=e=>e.formatMessage({id:"LKdcDm",defaultMessage:"Some of these emails aren’t on your Dropbox team."}),la=e=>e.formatMessage({id:"mvBmmQ",defaultMessage:"This email isn’t on your Dropbox team."}),ca=e=>e.formatMessage({id:"0IC8VF",defaultMessage:"You don’t have permission to share with some of these people."}),da=e=>e.formatMessage({id:"8tC+2X",defaultMessage:"Only groups can be added to team folders."}),_a=e=>e.formatMessage({id:"UrkgWp",defaultMessage:"You don’t have permission to share with some of these people due to restrictions on their end."}),ga=e=>e.formatMessage({id:"S+fqGv",defaultMessage:"One or more of the emails you entered are invalid."}),ua=e=>e.formatMessage({id:"KxgNgG",defaultMessage:"Add message (optional)"}),ma=e=>e.formatMessage({id:"30bVmM",defaultMessage:"Add a note"}),pa=e=>e.formatMessage({id:"Qd1iC2",defaultMessage:"Sharing..."}),fa=(e,t)=>t?pa(e):(e=>e.formatMessage({id:"lHCrsZ",defaultMessage:"Share"}))(e),ha=(e,t)=>"editor"===t[".tag"]?(e=>e.formatMessage({id:"J3CMt1",defaultMessage:"can edit"}))(e):(e=>e.formatMessage({id:"xOIBKS",defaultMessage:"can view"}))(e),Ea=(e,t)=>e.formatMessage({id:"lvjqTm",defaultMessage:"Shared <st>{name}</st>."},{st:e=>Ue.createElement("strong",{key:a.getName(t)},e),name:c.Emstring.em_snippet(a.getName(t),a.SNIPPET_SIZES.FILENAME)}),va=e=>e.formatMessage({id:"nf2M+i",defaultMessage:"There was a problem completing this request."}),ya=e=>e.formatMessage({id:"PbG9/M",defaultMessage:"You don’t have access to this content."}),Sa=e=>e.formatMessage({id:"ktVMZy",defaultMessage:"Your team settings don’t allow sharing outside your team."}),ba=e=>e.formatMessage({id:"ccjg/d",defaultMessage:"You entered an invalid name or email address."}),Ia=e=>e.formatMessage({id:"KWUYO4",defaultMessage:"You’ve hit the limit of invites for today. Try again later."}),Ma=e=>e.formatMessage({id:"CTRWVL",defaultMessage:"You don’t have permission to do this. Contact the owner."}),Ca=e=>e.formatMessage({id:"xoQiJt",defaultMessage:"You haven’t verified your email. Check your email and try again."}),Aa=e=>e.formatMessage({id:"kJSilf",defaultMessage:"Couldn’t share, but it might work if you reload the page and try again."}),Ta=e=>e.formatMessage({id:"FysM91",defaultMessage:"Something went wrong on our end. Refresh the page and try again."}),xa=e=>e.formatMessage({id:"A35Dw0",defaultMessage:"You need to upgrade your account to do this."}),Na=e=>e.formatMessage({id:"ebZyPl",defaultMessage:"You’re sharing with too many people."}),ka=e=>e.formatMessage({id:"Bcojaq",defaultMessage:"Contact support"}),La=(e,t)=>e.formatMessage({id:"0UrAT5",defaultMessage:"Couldn’t create shared folder. Your Dropbox account is {number, plural, one{1 shared folder} other {{number} shared folders}} over the limit."},{number:t}),Ra=e=>e.formatMessage({id:"/sRvdA",defaultMessage:"Folder updates in progress — please try again later."}),wa=(e,t,n)=>{const i=a.getName(n),s=a.getParentFolderName(n);return t?e.formatMessage({id:"5xCeTo",defaultMessage:"Removing members from <strong>{folderName}</strong>…"},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ue.createElement("strong",null,e)}):""===s?e.formatMessage({id:"90I244",defaultMessage:"Sharing <strong>{folderName}</strong> with everyone…"},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ue.createElement("strong",null,e)}):e.formatMessage({id:"16RnmU",defaultMessage:"Sharing <strong>{folderName}</strong> with members of <strong>{parentFolderName}</strong>…"},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),parentFolderName:c.Emstring.em_snippet(s,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ue.createElement("strong",null,e)})},$a=(e,t)=>t?e.formatMessage({id:"1HgFQB",defaultMessage:"Couldn’t remove members. Try again."}):e.formatMessage({id:"ypun4U",defaultMessage:"Couldn’t share folder. Try sharing again."}),Oa=e=>e.formatMessage({id:"b0sjjf",defaultMessage:"Learn more"}),Da=()=>{const e=n.useIntl();return Ue.default.createElement(a.Box,{style:{display:"flex",flexDirection:"column",height:"310px"}},Ue.default.createElement(C.ButtonWrapper,null,Ue.default.createElement(C.HorizontalButton,{disabled:!0},Ue.default.createElement(a.Skeleton.Avatar,{size:"medium",style:{marginRight:"var(--dig-spacing__dimension__12)"}}),Ue.default.createElement(a.Skeleton.Text,{size:"large",width:200}))),Ue.default.createElement(a.Box,{style:{marginTop:"var(--dig-spacing__dimension__12)"}},Ue.default.createElement(a.StylelessButton,{disabled:!0,className:C.baseButton,style:{height:"190px",width:"100%",padding:"var(--dig-spacing__dimension__16)"}},Ue.default.createElement(a.Box,{style:{display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"flex-start",rowGap:"var(--dig-spacing__dimension__16)"}},Ue.default.createElement(a.Skeleton.Text,{width:330,style:{margin:0}}),Ue.default.createElement(a.Skeleton.Text,{width:330,style:{margin:0}}),Ue.default.createElement(a.Skeleton.Text,{width:330,style:{margin:0}}))),Ue.default.createElement(a.Box,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"var(--dig-spacing__dimension__12)"}},Ue.default.createElement(a.Skeleton.Text,{size:"large",width:200}),Ue.default.createElement(a.Button,{variant:"primary",size:"medium",fullWidth:!1,disabled:!0},fa(e,!1)))))};Da.displayName="LoadingScreen";const Pa=/^['#&A-Za-z0-9._%+-]+@[A-Za-z0-9-][A-Za-z0-9.-]*\.[A-Za-z]{2,15}$/,Fa={$props:_.atom({oid:{".tag":"file",fileId:""},objectMetadataResult:{isLoading:!0},accountMetadataResult:{isLoading:!0},sharingPrefsResult:{isLoading:!0},inviteMessage:"",inviteTargets:[],hasUpdatedAccountMetadata:!1,onCloseClick:()=>{},onTargetsDropdownFocusChange:()=>{},onInviteMessageChange:()=>{},onInviteTargetsChange:()=>{},onShareStart:()=>{},onInbandShareSuccess:()=>{},onShareFailure:()=>{},onStartInband:()=>{},onObjectIdentifierChanged:()=>Promise.resolve(),shouldTransitionAccessoryAreaEnter:!1,isConfidentialFolderBannerClosed:!1}),$inviteTargets:_.atom([]),$inviteMessage:_.atom(""),$inviteTargetValidations:_.atom({}),$isDataBeingUpdated:_.atom(!1),$isInviteSending:_.atom(!1),$shouldPostMessageAsComment:_.atom(!1),$isInviteMessageTooLong:_.atom(!1),$changeConfidentialityData:_.atom(null),$isSuggestionsOpen:_.atom(!1),$isProgressiveButtonHovered:_.atom(!1),$progressiveButtonHoverStartTime:_.atom(0),$componentViewTime:_.atom(0),$inviteTargetsWithValidEmails:_.atom([]),$inviteTargetsWithInvalidEmails:_.atom([]),$objectIdentifierId:_.atom(""),$sharingAccessLevel:_.atom(l.VIEWER),$canInviteViewer:_.atom(!1),$canInviteEditor:_.atom(!1),$isFolder:_.atom(!1),$isConfidentialFolder:_.atom(!1),$isNewFolder:_.atom(!1)},{StoreProvider:Ua,useStore:Ha}=_.defineStoreProvider((e=>{const t=_.proxy((()=>e.get().inviteMessage),(t=>e.get().onInviteMessageChange(t))),n=_.proxy((()=>e.get().inviteTargets),(t=>e.get().onInviteTargetsChange(t))),i=_.proxy((()=>n.get().filter((e=>"group"===e[".tag"]||Pa.test(e.email))))),s=_.proxy((()=>n.get().filter((e=>"group"!==e[".tag"]&&!Pa.test(e.email))))),r=_.atom({}),o=_.atom(!1),c=_.atom(!1),d=_.atom(!1),g=_.atom(!1),u=_.atom(null),m=_.atom(!1),p=_.atom(!1),f=_.atom(0),h=_.atom(0),E=_.atom(a.getContentIdOrPathFromObjectIdentifier(e.get().oid)),v=_.proxy((()=>{const t=e.get().sharingPrefsResult;return t.isLoading||t.isError?null:t.output})),y=_.proxy((()=>{const t=e.get().objectMetadataResult;return t.isLoading||t.isError?null:t.output})),S=_.proxy((()=>{const e=v.get(),t=y.get();return!(!e||!t)&&a.getCanInvite(t,l.EDITOR)})),b=_.proxy((()=>{const e=v.get(),t=y.get();return!(!e||!t)&&a.getCanInvite(t,l.VIEWER)})),I=_.proxy((()=>{const e=v.get();return e&&S.get()?l.getUserDefaultInbandAccessLevel(e):l.VIEWER})),M=_.atom(I.get()),C=_.proxy((()=>{const e=y.get();return!!e&&a.getIsFolder(e)})),A=_.proxy((()=>{const e=y.get();return!!e&&a.getIsConfidentialFolder(e)})),T=_.proxy((()=>{var t;return null!==(t=e.get().isNewFolder)&&void 0!==t&&t}));return{$props:e,$inviteMessage:t,$inviteTargets:n,$inviteTargetsWithInvalidEmails:s,$inviteTargetsWithValidEmails:i,$inviteTargetValidations:r,$isDataBeingUpdated:o,$isInviteSending:c,$shouldPostMessageAsComment:d,$isInviteMessageTooLong:g,$changeConfidentialityData:u,$isSuggestionsOpen:m,$isProgressiveButtonHovered:p,$progressiveButtonHoverStartTime:f,$componentViewTime:h,$objectIdentifierId:E,$sharingAccessLevel:M,$canInviteViewer:b,$canInviteEditor:S,$isFolder:C,$isConfidentialFolder:A,$isNewFolder:T}}),Fa),Ba=e=>{const t=c.useSharingObjectMetadata(e.oid.fileId),a=c.useSharingAccountInfo(),n=l.useSharingPrefs();return n.isLoading?Ue.createElement(Da,null):Ue.createElement(Ua,{objectMetadataResult:t,accountMetadataResult:a,sharingPrefsResult:n,...e})};Ba.displayName="Provider";const ja="share-modal-evolution-access-level-dropdown",Va=`${ja}__portaled-menu`,qa=()=>{const e=n.useIntl(),t=Ha(),i=_.useAtom(t.$sharingAccessLevel),s=_.useAtom(t.$isInviteSending),r=_.useAtom(t.$canInviteEditor),o=_.useAtom(t.$canInviteViewer),c=(r?1:0)+(o?1:0),g=1===c,u=(()=>{const e=d.useLogger(),t=Ha(),a=_.useAtom(t.$sharingAccessLevel);return Ue.useCallback((n=>{e("SHARE_MODAL_SHARE__LINK_ACCESS_LEVEL__CHANGE",{previous:a,next:{".tag":n}}),t.$sharingAccessLevel.set({".tag":n})}),[t,e,a])})(),m=a.Emstring.em_snippet(ha(e,i),Math.floor(7.5),.5),p=m!==ha(e,i);return Ue.createElement(a.Box,{className:a.cx([`${ja}`,c>1?`${ja}__with-menu`:void 0]),borderRadius:"Small",style:{minWidth:"auto",display:"flex",whiteSpace:"pre-wrap",flexWrap:"wrap",alignItems:"center"},"data-testid":"access-level-dropdown"},Ue.createElement(a.Menu.Wrapper,{onSelection:u,style:{verticalAlign:"bottom",whiteSpace:"nowrap",height:"100%"},className:Va,matchContainingWidth:!0},(({getContentProps:t,getTriggerProps:n})=>Ue.createElement(Ue.Fragment,null,p?Ue.createElement(a.Box,{...n()},Ue.createElement(a.Tooltip,{title:ha(e,i),openDelay:1e3},Ue.createElement(a.Button,{variant:"opacity","aria-label":ha(e,i),withDropdownIcon:!0,size:"xlarge",disabled:s||g},m))):Ue.createElement(a.Button,{...n(),variant:"opacity","aria-label":ha(e,i),withDropdownIcon:!0,size:"xlarge",disabled:s||g},m),Ue.createElement(a.Menu.Content,{"data-sharing-sdk":"1",...t(),placement:"bottom-end"},Ue.createElement(a.Menu.Segment,null,o?Ue.createElement(a.Menu.SelectItem,{key:"view",value:"viewer",selected:"editor"!==i[".tag"]},Ue.createElement(a.Text,null,ha(e,l.VIEWER))):null,r?Ue.createElement(a.Menu.SelectItem,{key:"edit",value:"editor",selected:"editor"===i[".tag"]},Ue.createElement(a.Text,null,ha(e,l.EDITOR))):null))))))};qa.displayName="AccessLevelDropdown";const za=e=>{const t=Ha(),n=(e=>{const t=d.useEndpoint(l.validateTargets),n=d.useEndpoint(l.targetsSearch),i=d.useLogger(),s=Ha();return Ue.useCallback((async()=>{const r=s.$inviteTargets.get();if(0===r.length)return void s.$inviteTargetValidations.set({});const o=s.$inviteTargetsWithInvalidEmails.get(),d=new Set,_=new Map;await Promise.all(o.map((async e=>{if("email"!==e[".tag"])return;const t=await n({query:e.email,limit:10,force_refresh:!1});if("SUCCESS"===t.status){const a=t.output.find((t=>"group"===t[".tag"]&&t.name.toLowerCase()===e.email.toLowerCase()));if(a&&"group"===a[".tag"]){const t=l.getUniqueId(e);d.add(t),_.set(t,a)}}})));const g=o.filter((e=>!d.has(l.getUniqueId(e)))).reduce(((e,t)=>({...e,[l.getUniqueId(t)]:{member:l.toMemberSelector(t),result:{".tag":"disallowed",disallowed:{".tag":"invalid_target"}},target_invite_eligibility:{".tag":"other"}}})),{});if(s.$inviteTargetValidations.set({...s.$inviteTargetValidations.get(),...g}),_.size>0){const e=s.$inviteTargets.get(),t=e.map((e=>{const t=l.getUniqueId(e);return _.get(t)||e}));if(t.some(((t,a)=>t!==e[a])))return void s.$inviteTargets.set(t)}if(0===s.$inviteTargetsWithValidEmails.get().length)return;const u=Object.values(s.$inviteTargetValidations.get()).map((e=>e?c.getUniqueId(e.member):null)),m=s.$inviteTargetsWithValidEmails.get().filter((e=>{const t=c.getUniqueId(l.toMemberSelector(e));return!u.includes(t)}));if(0===m.length)return;const p=a.getIsFile(e)?"file":"folder",f=s.$objectIdentifierId.get();i("SHARE_MODAL_SHARE__PREVALIDATION__API_START",null);const h=await t({access_level:s.$sharingAccessLevel.get(),content_id:f,content_type:{".tag":p},members:m.map(l.toMemberSelector)});if("ERROR"===h.status)return void i("SHARE_MODAL_SHARE__PREVALIDATION__API_ERROR",{error:h.error});if("FATAL"===h.status)return void i("SHARE_MODAL_SHARE__PREVALIDATION__API_FATAL",{error:h.error});i("SHARE_MODAL_SHARE__PREVALIDATION__API_SUCCESS",null);const E=s.$inviteTargets.get(),v=s.$sharingAccessLevel.get(),y=e,S=a.getContentIdOrPathFromObjectIdentifier(s.$props.get().oid);r===E&&s.$sharingAccessLevel.get()===v&&f===S&&e===y&&s.$inviteTargetValidations.set({...s.$inviteTargetValidations.get(),...l.normalize(h.output.results)})}),[s,t,i,e])})(e);Ue.useEffect((()=>{const e=[t.$inviteTargets.obs(n),t.$sharingAccessLevel.obs((()=>{n()})),t.$objectIdentifierId.obs((()=>{t.$inviteTargetValidations.set({}),n()}))];return t.$props.get().inviteTargets.length>0&&n(),()=>e.forEach((e=>e()))}),[])},Ga=Symbol("ON_IMMEDIATE_TRANSITION"),Wa=Symbol("ON_INVITE__START"),Ka=Symbol("ON_ADD_FILE_MEMBER_API_ERROR"),Ya=Symbol("ON_ADD_FILE_MEMBER_API_FATAL"),Za=Symbol("ON_ADD_FILE_MEMBER_API_SUCCESS"),Qa=Symbol("ON_SHARE_FILE_FOLDER_FAILURE"),Xa=Symbol("ON_SHARE_FILE_FOLDER_FAILURE_CONTINUE"),Ja=Symbol("ON_ADD_FOLDER_MEMBER_API_ERROR"),en=Symbol("ON_ADD_FOLDER_MEMBER_API_FATAL"),tn=Symbol("ON_ADD_FOLDER_MEMBER_API_SUCCESS"),an=Symbol("ON_BEFORE_UNLOAD_DURING_INVITE"),nn=Symbol("ON_UNLOAD_DURING_INVITE"),{useEmitter:sn,defaultEmitter:rn}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),s=t(a.Context$6),r=a.getShareModalTypeFromString("sm24"),o={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(s)},c={...a.getProperties$4(n),...a.getProperties$5(i),...a.getProperties$6(s)};if(e.key!==Wa)if(e.key!==Za&&e.key!==tn){if(e.key===Ya||e.key===en)return a.UDCL.logEnd(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:"network",fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:{...o,errorReason:"network"},eventState:"failed",key:e.payload.actionKey}),void(Date.now()-e.payload.startTime>11e4&&a.UDCL.logEvent("ops.inband.likely_api_timeout",{tags:o}));if(e.key===Qa){const t=l.getShareInviteErrorReasonFromString(T.inbandShareResponseToErrorEnum[e.payload.error])||"undefined_error";return a.UDCL.logEnd(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:t,fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:{...o,errorReason:t},eventState:"failed",key:e.payload.actionKey}),void a.UDCL.logEvent("ops.sm24.share_file_folder_failure",{tags:{...o,errorReason:e.payload.error}})}if(e.key!==Xa){if(e.key===Ja){const t=l.getShareInviteErrorReasonFromString(T.inbandShareResponseToErrorEnum[e.payload.error])||"undefined_error";return a.UDCL.logEnd(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:t,fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:{...o,errorReason:t},eventState:"failed",key:e.payload.actionKey}),void a.UDCL.logEvent("ops.sm24.add_folder_member_api_failure",{tags:{...o,errorReason:e.payload.error}})}if(e.key===Ka){const t=l.getShareInviteErrorReasonFromString(T.inbandShareResponseToErrorEnum[e.payload.error])||"undefined_error";return a.UDCL.logEnd(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:t,fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:{...o,errorReason:t},eventState:"failed",key:e.payload.actionKey}),void a.UDCL.logEvent("ops.sm24.add_file_member_api_failure",{tags:{...o,errorReason:e.payload.error}})}if(e.key!==Ga)if(e.key!==an){if(e.key!==nn)return a.exhausts(e,void 0);a.UDCL.logEnd(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,fromNotifyInherited:!1,eventState:"canceled",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:{...o,errorReason:"navigation"},eventState:"canceled",key:e.payload.actionKey})}else{const t=Date.now()-e.payload.startTime,n=Math.round(1e4*t)/1e4;a.UDCL.logEvent("ops.inband.before_unload_during_invite",{tags:{...o,timeBucket:n.toString()}})}else a.UDCL.logEvent(l.PAP_Select_FlexibleSharingEntrypointAction({...c,flexibleSharingEntryPointAction:"inband_immediate",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...o,action:"inband_immediate"}})}else a.UDCL.logEvent("ops.sm24.share_file_folder_failure",{tags:{...o,errorReason:e.payload.error}})}else a.UDCL.logEnd(T.PAP_Send_ShareInvite({validationTraceId:void 0,numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,fromNotifyInherited:!1,sckeySha1:e.payload.sckeySha1,eventState:"success",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:o,eventState:"success",key:e.payload.actionKey});else a.UDCL.logStart(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,fromNotifyInherited:!1,shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:o,key:e.payload.actionKey})})),on=e=>{const t=Ha(),i=_.useAtom(t.$inviteTargets),s=_.useAtom(t.$inviteTargetValidations),r=n.useIntl(),o=d.useLogger();return Ue.useMemo((()=>{let t=null;const n=Object.values(s).reduce(((e,t)=>"allowed"===t.result[".tag"]&&"outside_of_team"===t.result.allowed[".tag"]||"disallowed"===t.result[".tag"]&&"outside_of_team"===t.result.disallowed[".tag"]?e+1:e),0);for(const c of i){const i=l.getUniqueId(c),d=s[i];if(d)if("disallowed"===d.result[".tag"]){const i=d.result.disallowed[".tag"];if("invalid_target"===i){t={level:"error",message:ga(r)};break}if("invalid_member"===i){if("group"===c[".tag"]){t={level:"error",message:ra(r)};break}t={level:"error",message:sa(r)};break}"outside_of_team"===i?t={level:"error",message:n>1?oa(r):la(r)}:"no_permission"===i?t=e&&a.getIsCollection(e)&&"group"===c[".tag"]?{level:"error",message:r.formatMessage({id:"vLSoUY",defaultMessage:"Collection sharing for groups is currently not supported"})}:{level:"error",message:ca(r)}:"target_is_individual"===i?t={level:"error",message:da(r)}:"target_not_same_team_restricted"===i?t={level:"error",message:_a(r)}:(o("SHARE_MODAL_SHARE__PREVALIDATION__UNKNOWN_TAG",{value:i}),t={level:"error",message:ga(r)})}else if(!t&&"allowed"===d.result[".tag"]){const e=d.result.allowed[".tag"];if("no_warning"===e)continue;"outside_of_team"===e?t=t||{level:"warn",message:n>1?na(r):ia(r)}:o("SHARE_MODAL_SHARE__PREVALIDATION__UNKNOWN_TAG",{value:e})}}return t}),[o,r,i,s,e])},ln=(e,t)=>{const i=Ha(),s=n.useIntl(),r=c.useShowSharingNotification(),o=d.useLogger(),g=d.usePlatform(),u=d.useEndpoint(l.addFileMember),m=d.useEndpoint(l.addFolderMember),p=d.useEndpoint(l.validateTargets),f=c.useAction(c.action),h=(()=>{const e=n.useIntl(),t=c.useShowSharingNotification();return Ue.useCallback((a=>"access_error"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:ya(e)}),a.error[".tag"]):"user_error"===a.error[".tag"]&&"email_unverified"===a.error.user_error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Ca(e)}),a.error.user_error[".tag"]):"invalid_comment"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:va(e)}),a.error[".tag"]):"rate_limit"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Ia(e)}),a.error[".tag"]):(a.error[".tag"],t({type:c.SharingNotificationType.FAILURE,message:va(e)}),a.error[".tag"])),[e,t])})(),E=(()=>{const e=n.useIntl(),t=c.useShowSharingNotification();return Ue.useCallback((a=>"NetworkFailure"!==a.type&&"PollingNetworkFailure"!==a.type||429!==a.value.response.statusCode?"ApiError"===a.type&&"email_unverified"===a.value.response.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Ca(e)}),a.value.response.error[".tag"]):"ApiError"===a.type&&"no_permission"===a.value.response.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Ma(e)}),a.value.response.error[".tag"]):"ApiError"!==a.type||"too_many_mounts"!==a.value.response.error[".tag"]||"tree_size_exceeded"!==a.value.response.error.too_many_mounts[".tag"]&&"home_mounts_exceeded"!==a.value.response.error.too_many_mounts[".tag"]&&"total_mounts_exceeded"!==a.value.response.error.too_many_mounts[".tag"]?"ApiError"===a.type&&"bad_path"===a.value.response.error[".tag"]&&"already_shared"===a.value.response.error.bad_path[".tag"]?a.value.response.error.bad_path[".tag"]:"PollingApiError"===a.type&&"internal_error"===a.value.response.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE_WITH_HELP,message:Aa(e),helpUrl:"/support",helpMessage:ka(e)},{message:Ta(e)}),a.value.response.error[".tag"]):(t({type:c.SharingNotificationType.FAILURE,message:va(e)}),"PollingTimeout"===a.type?"network":"PollingFailed"===a.type?"failed":"ApiError"===a.type||"PollingApiError"===a.type?a.value.response.error[".tag"]:"undefined"):(t({type:c.SharingNotificationType.FAILURE_WITH_HELP,message:La(e,a.value.response.error.too_many_mounts.limit-a.value.response.error.too_many_mounts.current_count),helpMessage:Oa(e),helpUrl:"https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate"}),a.value.response.error.too_many_mounts[".tag"]):(t({type:c.SharingNotificationType.FAILURE_WITH_HELP,message:Ra(e),helpUrl:"/help/9259"}),"network")),[e,t])})(),v=(()=>{const e=n.useIntl(),t=c.useShowSharingNotification();return Ue.useCallback((a=>"access_error"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:ya(e)}),a.error[".tag"]):"email_unverified"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Ca(e)}),a.error[".tag"]):"bad_member"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:ba(e)}),a.error[".tag"]):"cant_share_outside_team"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Sa(e)}),a.error[".tag"]):"too_many_members"===a.error[".tag"]||"too_many_pending_invites"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Na(e)}),a.error[".tag"]):"insufficient_plan"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:xa(e)}),a.error[".tag"]):"team_folder"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Sa(e)}),a.error[".tag"]):"no_permission"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Ma(e)}),a.error[".tag"]):"rate_limit"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Ia(e)}),a.error[".tag"]):(t({type:c.SharingNotificationType.FAILURE,message:va(e)}),a.error[".tag"])),[e,t])})(),y=sn(),{user:S}=a.useActiveUser(),b=l.useOnPostInbandShareHook(),I=_.useAtom(i.$sharingAccessLevel),M=on(e),{oid:C,onShareStart:T,onShareFailure:x,onInbandShareSuccess:N,onObjectIdentifierChanged:k}=_.useAtom(i.$props),{getVisitorData:L}=A.useAbuseFpjsContext();return Ue.useCallback((async()=>{if(i.$isInviteSending.get())return;const n=i.$inviteTargets.get(),A=I[".tag"],R=i.$isNewFolder.get();let w=C;const $={numRecipients:n.length,accessLevel:"viewer"===A?"view":"edit",actionKey:Math.random().toString(),isNewFolder:R,startTime:Date.now()};if(o("SHARE_MODAL_SHARE__INVITE__START",null),y.select(Wa).emit($),T(null),i.$isInviteSending.set(!0),i.$inviteTargetsWithInvalidEmails.get().length>0)return;o("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_START",null);const O=a.getContentIdOrPathFromObjectIdentifier(C),D=await p({members:i.$inviteTargetsWithValidEmails.get().map(l.toMemberSelector),content_type:{".tag":"file"===C[".tag"]?"file":"file_folder"===C[".tag"]?"folder":"shared_folder"},access_level:{".tag":A},content_id:O});if("ERROR"===D.status&&o("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_ERROR",{error:D.error}),"FATAL"===D.status&&o("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_FATAL",{error:D.error}),"SUCCESS"===D.status&&(o("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_SUCCESS",null),i.$inviteTargetValidations.set(l.normalize(D.output.results))),M&&"error"===M.level)return o("SHARE_MODAL_SHARE__INVITE__CANCELLED",null),void i.$isInviteSending.set(!1);const P=e=>(o("SHARE_MODAL_SHARE__INVITE__NAVIGATE_ATTEMPT",null),y.select(an).emit($),e.preventDefault(),e.returnValue="",""),F=()=>{o("SHARE_MODAL_SHARE__INVITE__NAVIGATE_AWAY",null),y.select(nn).emit($)};i.$props.get().onShareStart(null),window.addEventListener("beforeunload",P),window.addEventListener("unload",F);const U=()=>{i.$isInviteSending.set(!1),window.removeEventListener("beforeunload",P),window.removeEventListener("unload",F),x(null)},H=i.$props.get().inviteMessage,B=i.$shouldPostMessageAsComment.get(),j=(null==S?void 0:S.email)||"";if("file"===C[".tag"]){const e=await L("INBAND_SHARE_MODAL_FILE",j);o("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_START",null);const t=await u({access_level:{".tag":A},file:O,members:n.map(l.toMemberSelector),custom_message:H,add_message_as_comment:B&&H.length>0,fp_sealed_result:e.sealedResult});if("ERROR"===t.status){o("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_ERROR",{response:t});const e=h(t);return y.select(Ka).emit({...$,error:e}),void U()}if("FATAL"===t.status)return o("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_FATAL",{response:t}),y.select(Ya).emit($),U(),void r({type:c.SharingNotificationType.FAILURE_WITH_HELP,message:Aa(s),helpUrl:"/support",helpMessage:ka(s)},{message:Ta(s)});a.invalidateObjectMembers(C),o("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_SUCCESS",{response:t});const i=t.output[0]&&t.output[0].sckey_sha1&&t.output[0].sckey_sha1;y.select(Za).emit({...$,sckeySha1:i})}if("file_folder"===C[".tag"]||"shared_folder"===C[".tag"]||"collection"===C[".tag"]){let t="file_folder"===C[".tag"]?"":"collection"===C[".tag"]?C.nsId:C.sharedFolderId;if("file_folder"===C[".tag"]){o("SHARE_MODAL_SHARE__INVITE__SHARE_FILE_FOLDER__START",null);const n=await f({path:C.path,timeout:12e4,interval:1e3});if(n.success){t=n.value.response.output.shared_folder_id;const e=n.value.response.output.folder_id;g===d.Platforms.DESKTOP&&(w={".tag":"shared_folder",sharedFolderId:t,fileId:e})}else{if("ApiError"!==n.type||"bad_path"!==n.value.response.error[".tag"]||"already_shared"!==n.value.response.error.bad_path[".tag"]){U(),o("SHARE_MODAL_SHARE__INVITE__SHARE_FILE_FOLDER__FAILURE",{output:n});const e=E(n);return void y.select(Qa).emit({...$,error:e})}{t=n.value.response.error.bad_path.shared_folder_id;const e=n.value.response.error.bad_path.folder_id;g===d.Platforms.DESKTOP&&(w={".tag":"shared_folder",sharedFolderId:t,fileId:e});const a=E(n);y.select(Xa).emit({...$,error:a})}}o("SHARE_MODAL_SHARE__INVITE__SHARE_FILE_FOLDER__SUCCESS",null),await c.invalidateSharingObjectMetadata(w),a.isNewApiMetadata(e)&&await c.invalidateNewApiObjectMetadata(w)}const i=await L("INBAND_SHARE_MODAL_FOLDER",j);o("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_START",null);const _=await m({shared_folder_id:t,...{...H?{custom_message:H}:{}},members:n.map((e=>({access_level:{".tag":A},member:l.toMemberSelector(e)}))),fp_sealed_result:i.sealedResult});if("ERROR"===_.status){o("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_ERROR",{response:_});const e=v(_);return y.select(Ja).emit({...$,error:e}),void U()}if("FATAL"===_.status)return o("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_FATAL",{response:_}),y.select(en).emit($),U(),void r({type:c.SharingNotificationType.FAILURE,message:Aa(s)},{message:Ta(s)});o("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_SUCCESS",{response:_}),w={".tag":"shared_folder",sharedFolderId:t,fileId:C.fileId},await a.invalidateObjectMembers(w),await c.invalidateSharingObjectMetadata(w),await c.invalidateNewApiObjectMetadata(w);const u=void 0;y.select(tn).emit({...$,sckeySha1:u})}i.$isInviteSending.set(!1),window.removeEventListener("beforeunload",P),window.removeEventListener("unload",F);const V=1===n.length?((e,t,n)=>e.formatMessage({id:"KvzV8x",defaultMessage:"Shared <st>{name}</st>. {recipient} will receive an email."},{st:e=>Ue.createElement("strong",{key:a.getName(t)},e),name:c.Emstring.em_snippet(a.getName(t),a.SNIPPET_SIZES.FILENAME),recipient:n}))(s,e,l.getContactChipDisplayName(n[0])):((e,t)=>e.formatMessage({id:"ZO+R7/",defaultMessage:"Shared <st>{name}</st>. Emails will be sent to all recipients."},{st:e=>Ue.createElement("strong",{key:a.getName(t)},e),name:c.Emstring.em_snippet(a.getName(t),a.SNIPPET_SIZES.FILENAME)}))(s,e);r({type:c.SharingNotificationType.COMPLETED,message:Ea(s,e)},{message:V}),w&&await(null==k?void 0:k(w)),_.batch((()=>{i.$inviteTargets.set([]),i.$inviteMessage.set("")})),N(),"SUCCESS"===D.status&&(i.$props.get().shouldDisablePostInbandShareHooks||b({objectMetadata:e,objectIdentifier:C,inviteTargets:n,targetsValidateResult:D.output,sharingPrefs:t,user:S}))}),[i,I,o,y,T,C,p,M,S,r,s,e,N,x,L,u,h,m,f,g,E,v,k,b,t])},cn=e=>{const t=n.useIntl(),i=d.useLogger(),s=c.useShowSharingNotification();return Ue.useCallback((async(n,r,o,l)=>{const d=((e,t,n)=>{const i=a.getName(n),s=a.getParentFolderName(n);return t?e.formatMessage({id:"7POTZF",defaultMessage:"Members removed from <strong>{folderName}</strong>."},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ue.createElement("strong",null,e)}):void 0===s||""===s?e.formatMessage({id:"nni9pE",defaultMessage:"<strong>{folderName}</strong> shared with everyone."},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ue.createElement("strong",null,e)}):e.formatMessage({id:"qvP8A+",defaultMessage:"<strong>{folderName}</strong> shared with members of <strong>{parentFolderName}</strong>."},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),parentFolderName:c.Emstring.em_snippet(s,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ue.createElement("strong",null,e)})})(t,r,e);s(o?{type:c.SharingNotificationType.COMPLETED_WITH_UNDO,message:d,undoOnClick:()=>null==l?void 0:l(n)}:{type:c.SharingNotificationType.COMPLETED,message:d}),i("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_CONFIDENTIALITY__FINISH",null)}),[t,s,i,e])},dn=e=>{const t=Ha(),{oid:i}=_.useAtom(t.$props),s=(e=>{const t=n.useIntl(),i=c.useShowSharingNotification(),s=Ha(),r=d.useLogger(),{onObjectIdentifierChanged:o}=_.useAtom(s.$props),l=c.useAction(c.action$1),g=c.useAction(c.action),u=cn(e);return Ue.useCallback((async(n,s,d,_)=>{if("shared_folder"!==n[".tag"]&&"file_folder"!==n[".tag"])return;r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_CONFIDENTIALITY__START",null),i({type:c.SharingNotificationType.IN_PROGRESS,message:wa(t,s,e)});let m=n;if("file_folder"===m[".tag"]){r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_START",null);const l=await g({path:m.path,confidentiality:s?{".tag":"confidential"}:{".tag":"not_confidential"},timeout:12e4,interval:1e3});if(l.success)return r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_SUCCESS",null),m={".tag":"shared_folder",sharedFolderId:l.value.response.output.shared_folder_id,fileId:n.fileId},await(null==o?void 0:o(m)),a.isNewApiMetadata(e)&&await c.invalidateNewApiObjectMetadata(n),u(m,s,d,_),void a.invalidateObjectMembers(m);if("ApiError"!==l.type||"bad_path"!==l.value.response.error[".tag"]||"already_shared"!==l.value.response.error.bad_path[".tag"])return r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_FAILURE",null),void i({type:c.SharingNotificationType.FAILURE,message:$a(t,s)});r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_SUCCESS",null),m={".tag":"shared_folder",sharedFolderId:l.value.response.error.bad_path.shared_folder_id,fileId:n.fileId},await(null==o?void 0:o(m)),a.isNewApiMetadata(e)&&await c.invalidateNewApiObjectMetadata(n),r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_SUCCESS",null)}if(r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_ACCESS_INHERITANCE__API_START",null),!(await l({setAccessInheritanceArg:{access_inheritance:s?{".tag":"no_inherit"}:{".tag":"inherit"},shared_folder_id:m.sharedFolderId},timeout:12e4,interval:1e3})).success)return r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_ACCESS_INHERITANCE__API_FAILURE",null),void i({type:c.SharingNotificationType.FAILURE,message:$a(t,s)});r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_ACCESS_INHERITANCE__API_SUCCESS",null),u(m,s,d,_),a.invalidateObjectMembers(m)}),[t,i,r,e,u,l,g,o])})(e);return Ue.useCallback((async e=>s(i,e,!0,(async t=>s(t,!e,!1)))),[i,s])},_n=(e,t,n)=>n?((e,t)=>e.formatMessage({id:"6jTcuT",defaultMessage:"Share with {teamName}"},{teamName:c.Emstring.em_snippet(t,a.SNIPPET_SIZES.DISPLAY_NAME)}))(e,t):(e=>e.formatMessage({id:"P5jM9e",defaultMessage:"Share"}))(e),gn=(e,t,n,i,s)=>s?((e,t,n)=>e.formatMessage({id:"ipUgQi",defaultMessage:"Share <b>{folderName}</b> with everyone at {teamName}?"},{folderName:c.Emstring.em_snippet(t,a.SNIPPET_SIZES.FOLDER_NAME),teamName:c.Emstring.em_snippet(n,a.SNIPPET_SIZES.DISPLAY_NAME),b:e=>Ue.createElement("b",{style:{fontWeight:"var(--type__title__standard--fontweight_strong)"}},e)}))(e,n,t):((e,t,n)=>e.formatMessage({id:"znRNbl",defaultMessage:"Share <b>{folderName}</b> with everyone who can access <b>{parentFolderName}</b>?"},{folderName:c.Emstring.em_snippet(t,a.SNIPPET_SIZES.FOLDER_NAME),parentFolderName:c.Emstring.em_snippet(n,a.SNIPPET_SIZES.FOLDER_NAME),b:e=>Ue.createElement("b",{style:{fontWeight:"var(--type__title__standard--fontweight_strong)"}},e)}))(e,n,i),un=(e,t,a,n,i)=>i?((e,t,a)=>e.formatMessage({id:"R8xJiq",defaultMessage:"<b>{folderName}</b> won’t be shared privately any more. Everyone at {teamName} will have access to this folder."},{folderName:t,teamName:a,b:e=>Ue.createElement("b",{style:{fontWeight:"var(--type__body__standard--fontweight_strong)"}},e)}))(e,a,t):((e,t)=>e.formatMessage({id:"ioGEl6",defaultMessage:"Everyone who can access <b>{parentFolderName}</b> will be able to access this folder."},{parentFolderName:t,b:e=>Ue.createElement("b",{style:{fontWeight:"var(--type__body__standard--fontweight_strong)"}},e)}))(e,n),mn=({objectMetadata:e})=>{const t=n.useIntl(),i=Ha(),s=_.useAtom(i.$changeConfidentialityData),r=(()=>{const e=Ha();return Ue.useCallback((()=>{e.$changeConfidentialityData.set(null)}),[e])})(),o=dn(e);if(!s)return null;const l=a.getName(e),c=a.getParentFolderName(e),d=""===c,g=_n(t,s.teamName,d),u=gn(t,s.teamName,l,c,d),m=un(t,s.teamName,l,c,d);return Ue.createElement(Ue.Fragment,null,Ue.createElement(a.Modal,{open:!0,isCentered:!0,withCloseButton:"Close",onRequestClose:r},Ue.createElement(a.Modal.Header,{"data-sharing-sdk":"1",hasBottomSpacing:"title-standard"},Ue.createElement(a.Modal.Title,null,u)),Ue.createElement(a.Modal.Body,{"data-sharing-sdk":"1"},m),Ue.createElement(a.Modal.Footer,{"data-sharing-sdk":"1"},Ue.createElement(a.Button,{variant:"opacity",onClick:r},(e=>e.formatMessage({id:"i3tRYX",defaultMessage:"Cancel"}))(t)),Ue.createElement(a.Button,{variant:"primary",onClick:()=>{o(!1),r()}},g))))};mn.displayName="ChangeConfidentialityModal";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/inband-screen-v2/internals/message-field.module.out-vflefczAX.css",(e=>"._message-field_cxkr1_1{display:flex;flex-direction:column;flex-grow:1;margin-bottom:-3px;padding-top:0;position:relative}._message-field_cxkr1_1 textarea{background-color:var(--dig-color__background__base);border:1px solid var(--dig-color__border__subtle);flex-grow:1}._message-field_cxkr1_1._message-field-invalid_cxkr1_16 textarea{border-color:var(--dig-color__alert__base)}._message-field-invalid_cxkr1_16 textarea:focus-visible{border-color:var(--dig-color__alert__base);box-shadow:0 0 0 3px var(--dig-color__alert__base--state-1);outline:none}._message-field-with-banner_cxkr1_26 textarea{border-bottom-color:var(--dig-color__primary__surface--state-2);border-bottom-left-radius:0;border-bottom-right-radius:0;min-height:114px}._message-field-textarea-mobile_cxkr1_34{font-size:16px}._top-right-button_cxkr1_38{position:absolute;right:11px;top:8px}._summarized-banner_cxkr1_44{border:1px solid var(--dig-color__primary__surface--state-2);border-top:none;border-top-left-radius:0;border-top-right-radius:0;z-index:-1}._summarized-banner-message_cxkr1_53{color:var(--dig-color__primary__base);font-weight:500}._summarized-banner-icon_cxkr1_58{color:var(--dig-color__foldericon__icon)}"));const pn="_message-field_cxkr1_1",fn="_message-field-invalid_cxkr1_16",hn="_message-field-textarea-mobile_cxkr1_34",En=({isInviteMessageTooLong:e})=>{const t=n.useIntl(),i=Ha(),s=d.useLogger(),r=_.useStore(i.$isInviteSending),[o,l]=Ue.useState(i.$inviteMessage.get()),[c,g]=Ue.useState(!1),u=Ue.useCallback((e=>{i.$isInviteMessageTooLong.set(e.currentTarget.value.length>2e3),s("SHARE_MODAL_SHARE__MESSAGE_CHANGED",null),l(e.currentTarget.value),i.$inviteMessage.set(e.currentTarget.value)}),[s,i]),m=f.is_mobile_or_tablet();return Ue.createElement(a.Box,{className:a.cx(pn,{[fn]:e}),paddingTop:"Micro Large"},Ue.createElement(a.TextArea,{className:a.cx(m?hn:void 0),value:o,placeholder:ua(t),"aria-label":ma(t),onChange:e=>{l(e.currentTarget.value),c||u(e)},disabled:r,isInvalid:e,"data-testid":"ib-message-field-textarea",onCompositionStart:()=>g(!0),onCompositionEnd:e=>{g(!1),u(e)}}))};En.displayName="MessageField";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/inband-screen-v2/internals/share-modal-share.module.out-vflDUldWT.css",(e=>"._action-row_1x6i6_1{display:flex;flex-direction:column;min-height:310px;row-gap:var(--dig-spacing__micro__medium);width:100%}._action-row-expand-from-accessory-area_1x6i6_12{animation:_action-row-expand-accessory-area_1x6i6_1 var(--duration__surface) var(--easing__transition) forwards;min-height:64px;overflow:hidden}._action-section_1x6i6_19{border:1px solid var(--dig-color__border__subtle);border-radius:var(--dig-radius__medium);min-width:0;position:relative;transition:border var(--duration__micro-fast) var(--easing__transition);width:100%;z-index:1}._action-section-top_1x6i6_29{display:flex;height:48px}._action-section-active_1x6i6_34{border-color:var(--dig-color__secondary__base);box-shadow:none}._action-section-active_1x6i6_34,._action-section-active_1x6i6_34:hover,._action-section_1x6i6_19:focus-within{box-shadow:var(--dig-utilities__boxshadow__focus-ring);transition:box-shadow var(--duration__micro-fast) var(--easing__transition)}._accessory-section_1x6i6_46{animation:_fade-in_1x6i6_1 var(--duration__micro-fast) var(--easing__transition) forwards;display:flex;flex-direction:column;flex-grow:1;height:100%;row-gap:var(--dig-spacing__micro__medium);width:100%}._action-row-expand-from-accessory-area_1x6i6_12 ._accessory-section_1x6i6_46{animation:_fade-in_1x6i6_1 var(--duration__surface) var(--easing__transition) forwards}@media (prefers-reduced-motion:reduce){._action-row-expand-from-accessory-area_1x6i6_12,._action-row-expand-from-accessory-area_1x6i6_12 ._accessory-section_1x6i6_46{animation-timing-function:var(--easing__linear)}}@keyframes _action-row-expand-accessory-area_1x6i6_1{0%{max-height:64px;min-height:64px}to{min-height:286px;overflow:visible}}@keyframes _fade-in_1x6i6_1{0%{opacity:0}to{opacity:1}}._action-section-bottom_1x6i6_90{align-items:center;display:flex;height:48px;justify-content:space-between}._add-icon-small_1x6i6_98{height:var(--dig-spacing__dimension__24);margin-top:var(--dig-spacing__dimension__6);min-width:var(--dig-spacing__dimension__24);width:var(--dig-spacing__dimension__24)}._add-icon-small_1x6i6_98 svg{height:var(--dig-spacing__dimension__16);width:var(--dig-spacing__dimension__16)}._add-icon_1x6i6_98,._add-icon_1x6i6_98>svg{transition:min-width var(--duration__surface) var(--easing__transition),width var(--duration__surface) var(--easing__transition),background-color var(--duration__surface) var(--easing__transition),color var(--duration__surface) var(--easing__transition),height var(--duration__surface) var(--easing__transition),margin-top var(--duration__surface) var(--easing__transition)}._add-icon-shrink_1x6i6_123{animation:_shrink-icon_1x6i6_1 var(--duration__micro-fast) var(--easing__transition) forwards}._add-icon-shrink_1x6i6_123>svg{animation:_shrink-icon-svg_1x6i6_1 var(--duration__micro-fast) var(--easing__transition) forwards}@keyframes _shrink-icon_1x6i6_1{0%{height:var(--dig-spacing__dimension__36);margin-top:0;min-width:var(--dig-spacing__dimension__36);width:var(--dig-spacing__dimension__36)}to{height:var(--dig-spacing__dimension__24);margin-top:5px;min-width:var(--dig-spacing__dimension__24);width:var(--dig-spacing__dimension__24)}}@keyframes _shrink-icon-svg_1x6i6_1{0%{height:var(--dig-spacing__dimension__24);width:var(--dig-spacing__dimension__24)}to{height:var(--dig-spacing__dimension__16);width:var(--dig-spacing__dimension__16)}}._add-members-directly-action-section_1x6i6_172{border-color:var(--dig-color__border__subtle);border-radius:var(--dig-radius__small);border-style:solid;border-width:2px;position:relative;z-index:1}._add-members-directly-action-section_1x6i6_172 ._add-icon_1x6i6_98{margin-top:0}._add-members-directly-action-section-active_1x6i6_185,._add-members-directly-action-section_1x6i6_172:focus-within{border-color:var(--dig-color__utility__focus-ring)}._add-members-directly-action-section-active_1x6i6_185 ._add-icon_1x6i6_98,._add-members-directly-action-section_1x6i6_172:focus-within ._add-icon_1x6i6_98,._add-members-directly-action-section_1x6i6_172:hover ._add-icon_1x6i6_98{background:var(--dig-color__primary__base);color:var(--dig-color__background__base)}._add-members-directly-action-section-bottom_1x6i6_197{padding:var(--dig-spacing__micro__medium);padding-top:var(--dig-spacing__micro__medium)}._add-members-directly-action-section-active_1x6i6_185 ._add-icon-sending_1x6i6_202,._add-members-directly-action-section_1x6i6_172:focus-within ._add-icon-sending_1x6i6_202,._add-members-directly-action-section_1x6i6_172:hover ._add-icon-sending_1x6i6_202{background:var(--dig-color__disabled__base)}._add-members-directly-action-section_1x6i6_172 ._add-icon-sending_1x6i6_202>svg,._add-members-directly-action-section-active_1x6i6_185 ._add-icon-sending_1x6i6_202>svg,._add-members-directly-action-section_1x6i6_172:focus-within ._add-icon-sending_1x6i6_202>svg,._add-members-directly-action-section_1x6i6_172:hover ._add-icon-sending_1x6i6_202>svg{color:var(--dig-color__disabled__on-surface)}"));const vn="_action-row_1x6i6_1",yn="_action-row-expand-from-accessory-area_1x6i6_12",Sn="_action-section_1x6i6_19",bn="_action-section-top_1x6i6_29",In="_action-section-active_1x6i6_34",Mn="_accessory-section_1x6i6_46",Cn="_action-section-bottom_1x6i6_90",An=Symbol("ON_SHOW_SUGGESTIONS"),Tn=Symbol("ON_SELECT_SUGGESTION"),{useEmitter:xn,defaultEmitter:Nn}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),s=t(a.Context$6),r=t(a.Context$7),o={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(s),...a.getTags$7(r)};e.key!==An?e.key!==Tn||a.UDCL.logEvent("ops.sm24.select_tokenizer_suggestion",{tags:{...o,method:e.payload.method,suggestionIndex:e.payload.index.toString()}}):a.UDCL.logEvent("ops.sm24.show_tokenizer_suggestions",{tags:{...o,numSuggestions:e.payload.numSuggestions.toString()}})}));a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/targets-tokenizer-v2/internals/targets-tokenizer.module.out-vfl1ljyyT.css",(e=>"._share-tokenizer_1w72x_1{-ms-overflow-style:none;align-items:center;color-scheme:var(--dig-color-scheme);display:flex;max-height:48px;max-width:100%;min-height:40px;min-width:auto;overflow-x:hidden;scrollbar-width:none;width:100%}._share-tokenizer-with-targets_1w72x_17{overflow-x:auto}._share-tokenizer-text-input-container_1w72x_21{border:none;box-shadow:none;cursor:text;min-width:300px;outline:none;position:relative}._share-tokenizer-text-input-container_1w72x_21:focus-within{border:none;box-shadow:none;outline:none}._share-tokenizer-text-input-container_1w72x_21:has(input:focus){border:none;box-shadow:none;outline:none}._share-tokenizer-typeahead-container_1w72x_45{border-radius:var(--dig-radius__small);width:100%}._share-tokenizer-with-targets_1w72x_17:not(._share-tokenizer_1w72x_1) ._share-tokenizer-typeahead-container_1w72x_45{transform:translate(-14px)}input._share-tokenizer-text-input_1w72x_21[type=text]{font-family:var(--type__body__standard--fontfamily);font-size:var(--type__body__standard--fontsize);line-height:var(--type__body__standard--lineheight_label);min-height:var(--dig-spacing__dimension__24);min-width:2ch;width:0}input._share-tokenizer-text-input-mobile_1w72x_67[type=text]{font-size:16px}._screen-reader-only_1w72x_71{height:1px;left:-10000px;overflow:hidden;position:absolute;top:auto;width:1px}"));const kn="_share-tokenizer_1w72x_1",Ln="_share-tokenizer-with-targets_1w72x_17",Rn="_share-tokenizer-text-input-container_1w72x_21",wn="_share-tokenizer-typeahead-container_1w72x_45",$n="_share-tokenizer-text-input_1w72x_21",On="_share-tokenizer-text-input-mobile_1w72x_67",Dn="_screen-reader-only_1w72x_71",Pn=e=>e.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."}),Fn=e=>e.formatMessage({id:"Au33+R",defaultMessage:"Successfully connected your contacts from Google"}),Un=e=>e.formatMessage({id:"sgP44K",defaultMessage:"Failed to connect your contacts from Google"}),Hn=e=>e.formatMessage({id:"6EE+ph",defaultMessage:"Suggested people list"}),Bn=e=>e.formatMessage({id:"CkYgqG",defaultMessage:"Sign in to import contacts"}),jn=e=>e.formatMessage({id:"2/+46g",defaultMessage:"Connected"}),Vn=e=>e.formatMessage({id:"JbMFlW",defaultMessage:"Importing contacts"}),qn=e=>e.formatMessage({id:"ABdC2z",defaultMessage:"external member"}),zn="IMPORT_CONTACTS",Gn=[zn],Wn=/['&A-Za-z0-9\._%+-]+@[A-Za-z0-9-][A-Za-z0-9\.-]*\.[A-Za-z]{2,15}/gi,Kn=/[,|;>\s]/,Yn="Enter",Zn="Google",Qn="/static/images/index/google-logo-color.svg",Xn=e=>e.map((e=>{if("email"===e[".tag"]||"user"===e[".tag"]){const t=e.email.trim();return t.length===e.email.length?e:{...e,email:t}}return e})),Jn=e=>{const t={};return e.filter((e=>{const a=l.getUniqueId(e);return!t[a]&&(t[a]=!0,!0)}))},ei=({store:e,target:t,isDisabled:i,maxChars:s})=>{const r=n.useIntl(),o=ai(e,t),d=c.Emstring.em_snippet(l.getContactChipDisplayName(t),null!=s?s:a.SNIPPET_SIZES.EMAIL_SHORT_WITH_OVERFLOW,.6),g=ti(t,r),u=l.getAvatarUrl(t),m=l.getUniqueId(t),p=_.useStore(e.$inviteTargetValidation)[m],[f,h]=Ue.useState(!1),E=p&&"allowed"===p.result[".tag"]&&"no_warning"!==p.result.allowed[".tag"]&&"not_dropbox_user"!==p.result.allowed[".tag"],v=p&&"allowed"===p.result[".tag"]&&"outside_of_team"===p.result.allowed[".tag"],y=Ue.createElement(a.Box,{display:"flex",position:"absolute",alignItems:"center",backgroundColor:"Secondary Base",color:"Background Base",tabIndex:0,borderRadius:"Circular",style:{right:"-1px",bottom:"-1px"}},Ue.createElement(a.UIIcon,{color:"Background Base",height:12,width:12,src:k.ExternalMemberLine})),S=Ue.createElement(a.Box,{position:"relative",marginLeft:"4",marginRight:"4"},Ue.createElement(a.Avatar,{src:u||"",size:"xsmall",hasNoOutline:!0,"aria-hidden":!0},g),E&&y),b=((e,t)=>e.formatMessage({id:"cVF7dM",defaultMessage:"Sharing with {label} - press backspace or delete to remove"},{label:t}))(r,d),I="name"in t&&""!==t.name,M="email"in t&&""!==t.email;return Ue.createElement(a.Tooltip,{openDelay:1e3,title:Ue.createElement(a.Box,{display:"flex",flexDirection:"column",alignItems:"center"},I&&Ue.createElement(a.Tooltip.Text,{withMargin:!1,isBold:!0,size:"small"},t.name),M&&Ue.createElement(a.Tooltip.Text,{withMargin:!1,isBold:!I,color:I?"subtle":void 0,size:"small"},t.email),v&&Ue.createElement(a.Tooltip.Text,{withMargin:!1,color:"subtle",size:"small"},qn(r)))},Ue.createElement(N.Chip,{size:"medium",onDelete:f?o:void 0,variant:"standard",disabled:i,"aria-label":b,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),style:{marginRight:"var(--dig-spacing__micro__xsmall)"}},Ue.createElement(N.Chip.AvatarAccessory,null,S),Ue.createElement(N.Chip.Content,null,d)))};ei.displayName="EmailChip";const ti=(e,t)=>"user"===e[".tag"]?c.getUserInitials(e.name,t.locale):"group"===e[".tag"]?c.getGroupInitials(e.name):"email"===e[".tag"]?c.getUserInitials(e.email,t.locale):a.exhausts(e,""),ai=(e,t)=>Ue.useCallback((()=>{const a=e.$inviteTargets.get().filter((e=>e!==t));_.batch((()=>{e.$inviteTargets.set(a),e.$query.set("")}))}),[e,t]),ni=e=>{const t=d.useEndpoint(l.listLinkedServices);return Ue.useCallback((async()=>{if(e.$isLinkedServicesUpdating.get())return;const a=await t(null);"SUCCESS"===a.status?_.batch((()=>{e.$linkedServices.set(a.output),e.$isLinkedServicesUpdating.set(!1)})):_.batch((()=>{e.$linkedServices.set(null),e.$isLinkedServicesUpdating.set(!1)}))}),[e,t])},ii=e=>"user"===e[".tag"]||"group"===e[".tag"]?e.name:"email"===e[".tag"]?e.email:"",si=({target:e})=>{const t=n.useIntl(),i=l.getUniqueId(e),s=ri(e,t),r=ii(e),o=l.formatSubTitle(e,t),c=l.getAvatarUrl(e);return Ue.createElement(x.Typeahead.Row,{"data-testid":"typeahead-suggestion",className:"targets-tokenizer-suggestion",key:i,value:e,withTitle:r,withSubtitle:o,withLeftAccessory:Ue.createElement(a.Avatar,{src:c||void 0,hasNoOutline:!0,alt:r,"aria-hidden":"true"},s)})};si.displayName="Suggestion";const ri=(e,t)=>"user"===e[".tag"]?c.getUserInitials(e.name,t.locale):"group"===e[".tag"]?c.getGroupInitials(e.name):"email"===e[".tag"]?c.getUserInitials(e.email,t.locale):a.exhausts(e,""),oi=e=>{const t=n.useIntl(),i=c.useShowSharingNotification(),s=d.useLogger(),r=ni(e),o=d.useRedirectWindowToken();return Ue.useCallback((async()=>{if(e.$isConnectingToGoogle.get()||null===o)return;e.$isConnectingToGoogle.set(!0);let n=null;const l=()=>{i({type:c.SharingNotificationType.FAILURE,message:Un(t)}),null!==n&&clearInterval(n),window.removeEventListener("message",g),r().then((()=>{e.$isConnectingToGoogle.set(!1)}))},d=new URLSearchParams({service:"1",is_popup:"true",action:"link_contacts",prompt_select:"true",token:o,user_id:e.$user.get().id.toString(),is_desktop:"false"}),_=window.open(`/profile_services/start_auth_flow?${d.toString()}`,"Google","width=600,height=600,resizable=1,scrollbars=1");if(null===_)return l();n=setInterval((()=>{_.closed&&l()}),1e3);const g=o=>{let d;try{d=JSON.parse(o.data)}catch(e){return}if(a.isObjectOf({type:a.isExactly("db:profile_service:auth_complete"),payload:a.isObjectOf({success:a.isBoolean})})(d)){if(d.payload.success)return u=_,s("TEAMS_WEB",{name:a.TeamsWebEventName.ImportContactsComplete,extra:{provider:"google",path:window.location.pathname}}),i({type:c.SharingNotificationType.COMPLETED,message:Fn(t)}),null!==n&&clearInterval(n),window.removeEventListener("message",g),r().then((()=>{e.$isConnectingToGoogle.set(!1)})),void(null==u||u.close());var u;l(),_.close()}};window.addEventListener("message",g)}),[e,t,s,r,o,i])},li=e=>(e.match(Wn)||[]).map(l.createFromEmail),ci=e=>Ue.useCallback((t=>{const a=t.currentTarget.value,n=(i=a,Kn.test(i)?li(i):[]);var i;_.batch((()=>{e.$isTypeaheadForcedOpen.set(!1),n.length>0?(e.$inviteTargets.set([...e.$inviteTargets.get(),...n]),e.$query.set("")):e.$query.set(a)}))}),[e]),di=e=>{const t=(e=>{const t=d.useEndpoint(l.targetsSearch),a=d.useLogger(),i=n.useIntl(),s=c.useShowSharingNotification();return Ue.useCallback((async()=>{const n=e.$query.get(),r=await t({query:n,force_refresh:!1,limit:10});if(e.$query.get()===n){if(a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_START",null),"SUCCESS"!==r.status)return"ERROR"===r.status?a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_ERROR",{response:r}):a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_FATAL",{response:r}),s({type:c.SharingNotificationType.FAILURE,message:Pn(i)}),void e.$searchSuggestionsRaw.set([]);a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_SUCCESS",{response:r}),_.batch((()=>{e.$latestSuggestionsQuery.set(n),e.$searchSuggestionsRaw.set(r.output)}))}}),[e,t,a,s,i])})(e),a=(e=>{const[t,a]=Ue.useState(e);return Ue.useEffect((()=>{const t=setTimeout((()=>a(e)),150);return()=>clearTimeout(t)}),[e]),t})(_.useStore(e.$query));Ue.useEffect((()=>{t()}),[a])},_i=({results:e,suggestionMax:t})=>Ue.createElement("div",{className:Dn,"aria-live":"polite"},e.slice(0,t).map(((e,t)=>Ue.createElement("div",{key:t},e!==zn&&ii(e)))));_i.displayName="ScreenReaderLiveResults";const gi=({store:e})=>{const t=n.useIntl(),i=_.useStore(e.$isConnectingToGoogle),s=_.useStore(e.$isConnectedToGoogle),r=_.useStore(e.$isLinkedServicesUpdating);return d.useRedirectWindowToken()?i?Ue.createElement(x.Typeahead.Row,{"data-testid":"typeahead-import-contacts",className:"typeahead-import-contacts",key:zn,withLeftAccessory:Ue.createElement(a.Avatar,{src:Qn}),value:zn,withTitle:Zn,withSubtitle:Vn(t)}):r?null:s?Ue.createElement(x.Typeahead.Row,{"data-testid":"typeahead-import-contacts",className:"typeahead-import-contacts",key:zn,withLeftAccessory:Ue.createElement(a.Avatar,{src:Qn}),value:zn,withTitle:Zn,withSubtitle:jn(t)}):Ue.createElement(x.Typeahead.Row,{"data-testid":"typeahead-import-contacts",className:"typeahead-import-contacts",key:zn,withLeftAccessory:Ue.createElement(a.Avatar,{src:Qn}),value:zn,withTitle:Zn,withSubtitle:Bn(t)}):null};gi.displayName="ImportContacts";const ui=e=>{var t;const i=(e=>{const{isNonUserRelativeContext:t}=a.useSharingApiContext();return _.useInitStore({props:e,isNonUserRelativeContext:t},(e=>{var t,n;const i=_.proxy((()=>e.get().props)),s=_.proxy((()=>e.get().isNonUserRelativeContext)),r=_.store(!1),o=_.store(!1),c=_.store(!1),d=_.store(null!==(t=i.get().autoFocus)&&void 0!==t&&t),g=_.store(!1),u=_.store(null),m=_.store(null!==(n=i.get().initialQuery)&&void 0!==n?n:""),p=_.store(""),f=_.proxy((()=>i.get().isActive)),h=_.proxy((()=>i.get().user)),E=_.proxy((()=>i.get().accessLevel)),v=_.proxy((()=>i.get().isEmailSectionActive)),y=_.proxy((()=>i.get().inviteTargets),(e=>i.get().onInviteTargetsChange(Xn(Jn(e))))),S=_.proxy((()=>i.get().inviteTargetValidation)),b=_.proxy((()=>y.get().length>0)),I=_.proxy((()=>i.get().objectMetadata)),M=_.proxy((()=>a.getCanInvite(I.get(),E.get()))),C=_.proxy((()=>{const e=u.get();return e?l.getIsServiceConnected(e,{".tag":"google"})&&l.getDoesServiceHavePermissionGranted(e,{".tag":"google"},{".tag":"contacts"}):null})),A=_.proxy((()=>h.get().is_team)),T=_.proxy((()=>a.getIsTeamSharedFolder(I.get()))),x=_.proxy((()=>i.get().autoFocus)),N=_.proxy((()=>c.get())),k=_.store([]),L=_.proxy((e=>{const t=T.get(),a=h.get().email,n=y.get().map(l.getUniqueId),i={},r=s.get(),o=k.get().filter((e=>{const s=l.getUniqueId(e);return!(i[s]||(i[s]=!0,n.includes(s)||!l.canCreateLinksForFolder(t,h.get().is_tmr_member)&&"group"!==e[".tag"]||!(r||"email"!==e[".tag"]&&"user"!==e[".tag"]||e.email!==a)))}));return null!==e&&e.length===o.length&&e.every(((e,t)=>e===o[t]),!0)?e:o})),R=_.proxy((e=>{const t=T.get(),a=m.get(),n=t||""===a,i=[...L.get().slice(0,9),...n?[]:Gn];return null!==e&&e.length===i.length&&e.reduce(((e,t,a)=>e&&t===i[a]),!0)?e:i}));return{$accessLevel:E,$user:h,$canInvite:M,$inviteTargets:y,$inviteTargetValidation:S,$hasInviteTargets:b,$isConnectedToGoogle:C,$isConnectingToGoogle:r,$isFocused:o,$isLinkedServicesUpdating:c,$isTeamAccount:A,$isTeamFolder:T,$isTypeaheadForcedOpen:d,$isTypeaheadOpen:g,$isUpdatingGoogleConnectionStatus:N,$linkedServices:u,$objectMetadata:I,$query:m,$latestSuggestionsQuery:p,$searchSuggestionsRaw:k,$searchSuggestions:L,$suggestions:R,$isEmailSectionActive:v,$autoFocus:x,$isActive:f,$props:i}}))})(e),{isSuggestionsOpen:s,isInviteSending:r,isActionRowTransitionInProgress:o,inbandInputAreaRef:d,inputRef:g,inviteTargets:u,setSuggestionsOpen:m,onTargetsDropdownFocusChange:p}=e,h=n.useIntl(),E=Ue.useRef(null),v=_.useStore(i.$query),y=_.useStore(i.$inviteTargets),S=_.useStore(i.$hasInviteTargets),b=Ue.useRef(y.length),I=_.useStore(i.$suggestions),M=_.useStore(i.$canInvite),C=_.useStore(i.$isTypeaheadForcedOpen)&&M,A=null!==(t=_.useStore(i.$autoFocus))&&void 0!==t&&t;di(i),(e=>{const t=ni(e);Ue.useEffect((()=>{t()}),[t])})(i),(e=>{const t=xn(),a=_.useStore(e.$searchSuggestions),n=_.useStore(e.$isTypeaheadOpen);Ue.useEffect((()=>{if(n){const e=a.slice(0,9).length;e>0&&n&&t.select(An).emit({numSuggestions:e})}}),[a,t,n])})(i);const T=(e=>{const t=xn(),a=oi(e),n=_.useStore(e.$searchSuggestions);return Ue.useCallback(((i,s)=>{_.batch((()=>{var r,o;if(i===zn){if(e.$isTypeaheadForcedOpen.set(!0),e.$isConnectingToGoogle.get())return;if(e.$isConnectedToGoogle.get())return;return e.$query.set(""),void a()}t.select(Tn).emit({index:n.findIndex((e=>e===i)),method:s.nativeEvent instanceof KeyboardEvent?"keyboard":"click"}),e.$query.set(""),e.$inviteTargets.set([...e.$inviteTargets.get(),i]),null===(o=null===(r=e.$props.get().inputRef)||void 0===r?void 0:r.current)||void 0===o||o.focus()}))}),[e,a,t,n])})(i),k=(e=>{const t=xn();return Ue.useCallback((a=>{const n=e.$query.get();if(a.key===Yn&&a.shiftKey)return void a.preventDefault();"Backspace"!==a.key&&"Delete"!==a.key||""===n&&e.$inviteTargets.get().length>0&&e.$inviteTargets.set(e.$inviteTargets.get().slice(0,-1));const i=n===e.$latestSuggestionsQuery.get(),s=Wn.test(n);if(a.key===Yn){const a=document.getElementById("targets-tokenizer-input-search");if(a&&"scrollIntoView"in a&&a.scrollIntoView(),i&&!s&&e.$searchSuggestions.get().length>0)t.select(Tn).emit({index:0,method:"keyboard"}),_.batch((()=>{e.$inviteTargets.set([...e.$inviteTargets.get(),e.$searchSuggestions.get()[0]]),e.$query.set("")}));else if(""!==n){const t=li(n);t.length>0?_.batch((()=>{e.$inviteTargets.set([...e.$inviteTargets.get(),...t]),e.$query.set("")})):_.batch((()=>{e.$inviteTargets.set([...e.$inviteTargets.get(),l.createFromEmail(n)]),e.$query.set("")}))}}}),[e,t])})(i),L=ci(i),{inputPlaceholder:R,truncatedInputPlaceholder:w}=(e=>{var t;const i=n.useIntl(),s=_.useStore(e.$hasInviteTargets),r=_.useStore(e.$isTeamFolder),o=_.useStore(e.$isTeamAccount),l=_.useStore(e.$user).is_tmr_member,d=null===(t=_.useStore(e.$props).shouldTruncatePlaceholder)||void 0===t||t;return Ue.useMemo((()=>{let e;return e=s?void 0:r&&!l?(e=>e.formatMessage({id:"VMGE6I",defaultMessage:"Group names"}))(i):o?(e=>e.formatMessage({id:"+nKRfb",defaultMessage:"Add an email, name, or group"}))(i):(e=>e.formatMessage({id:"bdV6O3",defaultMessage:"Add an email or name"}))(i),{inputPlaceholder:e,truncatedInputPlaceholder:d&&e?c.Emstring.em_snippet(e,a.SNIPPET_SIZES.TOKENIZER_PLACEHOLDER,1):e}}),[r,o,i,l,s,d])})(i),$=(e=>Ue.useCallback((({isOpen:t})=>{if(t)e.$isTypeaheadOpen.set(!0);else{const t=li(e.$query.get());_.batch((()=>{t.length>0&&(e.$inviteTargets.set([...e.$inviteTargets.get(),...t]),e.$query.set("")),e.$isTypeaheadForcedOpen.set(!1),e.$isTypeaheadOpen.set(!1),e.$isFocused.set(!1)}))}}),[e]))(i),O=(e=>Ue.useCallback((()=>{var t,a;null===(a=(t=e.$props.get()).onUserInteraction)||void 0===a||a.call(t),e.$isTypeaheadForcedOpen.set(!1),e.$isFocused.set(!0)}),[e]))(i),[D,P]=Ue.useState(!1),F=(e=>Ue.useCallback((t=>t===zn?Ue.createElement(gi,{store:e}):Ue.createElement(si,{target:t})),[e]))(i),U=Ue.useRef(!1),H=Ue.useRef(void 0),B=r||!M,j=Ue.useCallback(((e,t)=>{const a=t.includes(zn)?t.length-1:t.length,n=e&&a>0;U.current!==n&&(U.current=n,null==p||p(n)),m(e)}),[p,m]);Ue.useEffect((()=>{const e=H.current;e&&(j(e.isOpen,e.suggestions),H.current=void 0)}));const V=Ue.useCallback((()=>{s||i.$isTypeaheadForcedOpen.set(!0)}),[i.$isTypeaheadForcedOpen,s]),q=Ue.useCallback((()=>{var e;null===(e=null==g?void 0:g.current)||void 0===e||e.focus(),i.$isTypeaheadForcedOpen.set(!0)}),[g,i]);Ue.useEffect((()=>{M&&0===u.length&&!o&&q()}),[M,q,u,o]),Ue.useEffect((()=>{if(b.current<y.length){const e=document.getElementById("targets-tokenizer-input-search");e&&"scrollIntoView"in e&&e.scrollIntoView()}b.current=y.length}),[y.length]);const z=Ue.useCallback((e=>{e.preventDefault();const t=document.getElementById("targets-tokenizer-wrapper");t&&(t.scrollLeft+=e.deltaY+e.deltaX)}),[]);Ue.useEffect((()=>{const e=document.getElementById("targets-tokenizer-wrapper");return e&&e.addEventListener("wheel",z),()=>{e&&e.removeEventListener("wheel",z)}}),[z]);const G=f.is_mobile_or_tablet();Ue.useEffect((()=>{const e=y.length;D&&0===e&&P(!1)}),[D,y.length,P]);const W=Ue.useMemo((()=>{const e=y.length;if(0===e)return null;if(D)return Ue.createElement(Ue.Fragment,null,y.map(((e,t)=>Ue.createElement(ei,{store:i,key:t,target:e,isDisabled:B}))));if(1===e)return Ue.createElement(ei,{store:i,target:y[0],isDisabled:B});return Ue.createElement(Ue.Fragment,null,Ue.createElement(ei,{store:i,key:0,target:y[0],isDisabled:B}),Ue.createElement(N.Chip,{size:"medium",variant:"standard",disabled:B,onClick:e=>{e.stopPropagation(),P(!0)},style:{marginRight:"4px"}},Ue.createElement(N.Chip.Content,null,((e,t)=>e.formatMessage({id:"VwYjK8",defaultMessage:"+ {count} more"},{count:t}))(h,e-1))))}),[D,B,h,i,y,P]);return Ue.createElement(a.DIGContext.Provider,{value:{featureLevel:"experimental"}},Ue.createElement(x.Typeahead.Wrapper,{className:a.cx(kn,{[Ln]:S}),id:"targets-tokenizer-wrapper",onSelection:T,hasMaxHeight:!0,isPortaled:G,onToggle:$,openMenuOnFocus:!1},(({getTriggerProps:e,getContentProps:t})=>{const{open:n,...i}=t({}),s=(n||C)&&I.length>0;return H.current={isOpen:s,suggestions:I},Ue.createElement(Ue.Fragment,null,Ue.createElement(a.TextInput.Container,{className:a.cx(Rn),ref:E,size:"small",onClick:q,"data-uxa-log":"sm24-tokenizer","data-uxa-interactions":"shown"},Ue.createElement(a.Box,{style:{alignItems:"center",display:"flex",flexWrap:"nowrap",margin:"-4px -2px",width:"100%"}},W,Ue.createElement(a.TextInput.Input,{...e({onChange:L,onKeyDown:k,onFocus:O}),className:a.cx($n,{[On]:G}),ref:g,disabled:B,value:v,"aria-label":R,placeholder:w,"data-testid":"targets-tokenizer-input",id:"targets-tokenizer-input-search",autoComplete:"off",autoFocus:A,onClick:V,style:s?{width:"auto"}:void 0}))),Ue.createElement(x.Typeahead.Container,{...i,triggerRef:d,open:s,"data-testid":"typeahead-container",className:wn,auto:!1,placement:"bottom","aria-label":Hn(h)},Ue.createElement(_i,{results:I,suggestionMax:3}),Ue.createElement(x.Typeahead.Results,{results:I,renderRow:F,initialResults:""===v?3:10,maxResults:10})))})))};ui.displayName="TargetsTokenizer";const mi=Ue.memo((({isActive:e,objectMetadata:t,accountMetadata:a,inbandInputAreaRef:n,inputRef:i,onFocusChange:s,isActionRowTransitionInProgress:r,initialQuery:o})=>{const l=Ha(),g=_.useStore(l.$inviteTargets),u=_.useStore(l.$inviteTargetValidations),m=_.useStore(l.$isInviteSending),p=_.useAtom(l.$sharingAccessLevel),f=(e=>Ue.useMemo((()=>c.convertAccountMetadataToUser(e)),[e]))(a),h=_.useStore(l.$isSuggestionsOpen),E=Ue.useCallback((e=>{l.$isSuggestionsOpen.set(e)}),[l.$isSuggestionsOpen]),v=(()=>{const e=d.useLogger(),t=Ha();return Ue.useCallback((a=>{e("SHARE_MODAL_SHARE__INVITE_TARGETS__CHANGE",null),t.$props.get().onInviteTargetsChange(a)}),[t,e])})();return Ue.createElement(ui,{accessLevel:p,objectMetadata:t,inviteTargets:g,onInviteTargetsChange:v,onTargetsDropdownFocusChange:s,inviteTargetValidation:u,user:f,isInviteSending:m,inbandInputAreaRef:n,inputRef:i,isActive:e,isSuggestionsOpen:h,setSuggestionsOpen:E,shouldTruncatePlaceholder:!1,isActionRowTransitionInProgress:r,initialQuery:o})}));mi.displayName="TargetsTokenizer";const pi=({objectMetadata:e,accountMetadata:t,sharingPrefs:i,onCloseClick:s,isConfidentialFolderBannerClosed:r})=>{var o;const c=n.useIntl(),g=Ha(),u=Ue.useRef(null),m=Ue.useRef(null),p=d.usePlatform()===d.Platforms.METASERVER,{initialInput:f,onInitialInputUsed:h,onConfidentialFolderBannerClose:E}=_.useAtom(g.$props),v=_.useAtom(g.$isInviteSending),y=_.useAtom(g.$inviteTargets),S=_.useAtom(g.$isConfidentialFolder),b=_.useAtom(g.$isInviteMessageTooLong);Ue.useEffect((()=>{f&&h&&h()}),[f,h]);const I=on(e),M=ln(e,i),C=(()=>{const e=Ha();return Ue.useCallback((t=>{e.$changeConfidentialityData.set({teamName:t})}),[e.$changeConfidentialityData])})(),A=null!==(o=a.getOwnerTeamName(e))&&void 0!==o?o:"",T=_.useAtom(g.$isSuggestionsOpen),x=y.length>0,{shouldTransitionAccessoryAreaEnter:N}=_.useAtom(g.$props),[k,R]=Ue.useState(!1),[w,$]=Ue.useState(N),{onStartInband:O}=_.useAtom(g.$props),D=_.useAtom(g.$componentViewTime),P=Ue.useRef(!1),F=sn(),U=pa(c);Ue.useEffect((()=>{if(!P.current&&D>0){P.current=!0;const e=Date.now()-D;O&&O(),F.select(Ga).emit({timeSinceView:e})}}),[D,F,O]);const H=Ue.useCallback((()=>{$(!1)}),[$]),B=!k&&!T;return Ue.createElement("div",{className:a.cx(vn,{[yn]:N}),onAnimationEnd:H},Ue.createElement("div",{id:"shareme24-ib-action-container",style:{width:"100%",position:"relative"},"data-testid":"ib-action-area"},Ue.createElement(a.Box,{className:"banner-group",marginBottom:S?"Micro Small":"0"},!r&&S?Ue.createElement(l.ConfidentialFolderSection,{teamName:A,parentFolderName:a.getParentFolderName(e),isRestoreAccessEnabled:a.getCanDoAction(e,a.UPDATE_CONFIDENTIALITY_TAG),onRestoreAccessClick:C,onBannerClose:E}):null,Ue.createElement(mn,{objectMetadata:e})),Ue.createElement(a.Box,{display:"flex",flexDirection:"row",columnGap:"Micro Medium"},Ue.createElement(a.Box,{flexDirection:"column",className:a.cx(Sn,{[In]:k||T}),backgroundColor:"Background Base",onClick:()=>{!(null==m?void 0:m.current)||x||T||m.current.focus()}},Ue.createElement(a.Box,{className:bn,ref:u,display:"flex",flexDirection:"row",alignItems:"center",width:"100%",style:{minHeight:"var(--dig-spacing__dimension__36)"}},Ue.createElement(mi,{isActive:k||T,objectMetadata:e,accountMetadata:t,inbandInputAreaRef:u,inputRef:m,onFocusChange:R,isActionRowTransitionInProgress:w,initialQuery:f}))),B&&Ue.createElement(qa,null))),Ue.createElement("div",{className:Mn},Ue.createElement(En,{isInviteMessageTooLong:b}),b&&Ue.createElement(a.Text,{color:"error","data-testid":"ib-message-above-limit-message"},((e,t)=>e.formatMessage({id:"dH+HYp",defaultMessage:"Message must be under {limit} characters."},{limit:t}))(c,2e3)),Ue.createElement(a.Box,{className:Cn},Ue.createElement(a.Button,{disabled:v||null!=I&&"error"===I.level||!x||b,style:{width:"100%",height:"48px",alignSelf:"center"},onClick:()=>{p?L.showOQModalOrContinue({beforeShowModal:()=>{s()},show:L.Show.EnforceRestrictionsOnly,action:"share_add_people",continueCallback:()=>M(),abortCallback:()=>{}}):M()},variant:"primary",size:"xlarge","data-uxa-log":"sharing-modal-footer-button-send-email","data-testid":"ib-share-send-email-button"},v&&Ue.createElement(a.Spinner,{size:"xsmall","aria-valuetext":null==U?void 0:U.toString(),monochromatic:!0,withTrack:!0,style:{marginRight:"var(--spacing__unit--1)"}}),v?U:fa(c,v)))))};pi.displayName="InbandShare";const fi=()=>{const e=Ha(),t=_.useAtom(e.$props),{accountMetadataResult:a,objectMetadataResult:n,sharingPrefsResult:i,onCloseClick:s,isConfidentialFolderBannerClosed:r}=t,o=n.isLoading,l=!n.isLoading&&!n.isError,c=a.isLoading,d=!a.isLoading&&!a.isError,g=i.isLoading,u=!i.isLoading&&!i.isError,m=l&&d&&u;return o||c||g?Ue.createElement(Da,null):m?Ue.createElement(Ei,{objectMetadata:n.output,accountMetadata:a.output,sharingPrefs:i.output,onCloseClick:s,isConfidentialFolderBannerClosed:r}):null};fi.displayName="InbandWithStore";const hi=e=>Ue.createElement(Ba,{...e},Ue.createElement(fi,null));hi.displayName="Inband";const Ei=({objectMetadata:e,accountMetadata:t,sharingPrefs:a,onCloseClick:n,isConfidentialFolderBannerClosed:i})=>{const s=Ha(),r=_.useAtom(s.$inviteTargets),o=_.useAtom(s.$sharingAccessLevel);return za(e),Ue.useEffect((()=>{s.$componentViewTime.set(Date.now())}),[s]),Ue.createElement(M.AbuseFpjsProvider,{loadingComponent:Ue.createElement(Da,null)},Ue.createElement(d.MetadataProvider,{sharingInviteTargets:r,sharingAccessLevel:o},Ue.createElement(pi,{objectMetadata:e,accountMetadata:t,sharingPrefs:a,onCloseClick:n,isConfidentialFolderBannerClosed:i})))};Ei.displayName="InbandInner";const vi=()=>{const e=It(),{objectIdentifier:t,objectMetadataResult:i,onRequestClose:s,onInbandShareCompleted:r,onConfirmationModalShownChange:o,shouldResetToMainAfterInbandShare:d,shouldDisablePostInbandShareHooks:g}=_.useAtom(e.$props),u="file"!==t[".tag"],m=Et(),p=_.useStore(e.$inviteTargets),f=_.useStore(e.$inviteMessage),h=_.useStore(e.$initialInputKey),v=Ue.useCallback((t=>{e.$inviteMessage.set(t)}),[e]),y=Ue.useCallback((t=>{e.$inviteTargets.set(t)}),[e]),S=Ue.useCallback((()=>{e.$isOperationInProgress.set(!0)}),[e]),I=Ue.useCallback((()=>{e.$isOperationInProgress.set(!1)}),[e]),M=Ue.useCallback((()=>{e.$isOperationInProgress.set(!1),r&&r(),d&&(_.batch((()=>{e.$inviteTargets.set([]),e.$inviteMessage.set("")})),Ct(e,yt.MAIN)),a.invalidateObjectMembers(t),c.invalidateSharingObjectMetadata(t),c.invalidateNewApiObjectMetadata(t)}),[e,t,r,d]),C=Ue.useCallback((t=>{e.$isSuggestionsOpen.set(t)}),[e]),A=Ue.useCallback((()=>{}),[]),T=Ue.useCallback((async()=>{}),[]),x=_.useStore(e.$isConfidentialFolderBannerClosed),N=Ue.useCallback((()=>{e.$isConfidentialFolderBannerClosed.set(!0)}),[e.$isConfidentialFolderBannerClosed]),k=ea(e),{user:L,isLoading:R}=a.useActiveUser(),w=!i.isLoading&&!i.isError&&null!=i.output&&!a.getIsLinkOnlyMode(i.output)&&(a.getCanInvite(i.output,l.VIEWER)||a.getCanInvite(i.output,l.EDITOR));Ue.useEffect((()=>{w&&!R&&L&&E.prefetch(L,t)}),[w,R,L,t]);return Ue.createElement(Ue.Fragment,null,Ue.createElement(Qt,{info:{backButton:{onClick:()=>{Ct(e,yt.MAIN)}},title:u?Nt(n.intl):kt(n.intl),subtitle:k}},Ue.createElement(Qt.Slot,{type:"custom"},Ue.createElement(b.ContentMemberFacepileButton,{oid:t,onClick:()=>{m.select(ut).emit({shareModalPage:yt.INBAND}),Ct(e,yt.CONTENT_MEMBER_LIST)},onView:()=>{}}))),Ue.createElement(Gt,null,Ue.createElement(Gt.Row,null,Ue.createElement(hi,{oid:t,inviteMessage:f,inviteTargets:p,hasUpdatedAccountMetadata:!1,onCloseClick:s,onTargetsDropdownFocusChange:C,onInviteMessageChange:v,onInviteTargetsChange:y,onShareStart:S,onShareFailure:I,onInbandShareSuccess:M,onStartInband:A,onConfirmationModalShownChange:o,onConfidentialFolderBannerClose:N,onObjectIdentifierChanged:T,isConfidentialFolderBannerClosed:x,shouldDisablePostInbandShareHooks:g,initialInput:h}))))};vi.displayName="InbandPage";const yi=e=>{switch(e.type){case"iconButton":return Ue.createElement(a.IconButton,{variant:e.variant,size:"xlarge",onClick:e.onClick,"data-testid":e.testId,disabled:e.disabled,style:{borderRadius:"var(--dig-radius__xlarge)"},"aria-label":e.label},Ue.createElement(a.UIIcon,{src:e.icon,width:24,height:24}));case"button":return Ue.createElement(a.Button,{variant:e.variant,size:"xlarge",onClick:e.onClick,"data-testid":e.testId,withIconStart:e.icon&&Ue.createElement(a.UIIcon,{src:e.icon}),disabled:e.disabled,"aria-label":e.label},e.label);case"custom":return Ue.createElement(Ue.Fragment,null,e.children)}};yi.displayName="Action";const Si=({children:e})=>{const t=Ue.Children.toArray(e),{leftActions:a,rightActions:n}=t.reduce(((e,t)=>(Ue.isValidElement(t)&&"object"==typeof t.props&&null!==t.props&&("align"in t.props&&"left"===t.props.align?e.leftActions.push(t):"align"in t.props&&"right"===t.props.align&&e.rightActions.push(t)),e)),{leftActions:[],rightActions:[]});return Ue.createElement("div",{"data-testid":"sm26-footer",className:Bt},a.length>0&&Ue.createElement("div",{className:jt},a),n.length>0&&Ue.createElement("div",{className:Vt},n))};Si.displayName="FooterBase";const bi=Object.assign(Si,{Action:yi});a.injectInternalStyle("/static/metaserver/static/js/sharing/features/share-modal/versions/shareme26/pages/main/main.module.out-vflLMlDY5.css",(e=>"._inbandSection_1d338_2{gap:var(--dig-spacing__micro__large)}._inbandSection_1d338_2,._inputSection_1d338_8{display:flex;flex-direction:column}._suggestedChips_1d338_13{align-items:center;display:flex;gap:8px}._memberList_1d338_20{display:flex;flex-direction:column;gap:4px;height:108px}._memberListTitle_1d338_27{color:var(--dig-color__text__subtle);font-size:var(--dig-type__size__text__small);font-style:normal;font-weight:400;line-height:var(--dig-type__lineheight__label__small)}._ownerListing_1d338_35{border-radius:var(--dig-radius__large,12px);height:40px;min-height:40px}._ownerListing_1d338_35,._userInfo_1d338_43{align-items:center;display:flex}._userInfo_1d338_43{flex:1;gap:12px;min-width:0}._permission_1d338_51{align-items:center;background:transparent;border:none;border-radius:var(--dig-radius__large,12px);cursor:pointer;display:flex;gap:4px;height:40px;justify-content:center;padding:4px 10px;transition:background-color .2s}"));const Ii="_inbandSection_1d338_2",Mi="_inputSection_1d338_8",Ci="_suggestedChips_1d338_13",Ai=e=>{const{handleChipClick:t}=e,n=It(),i=_.useAtom(n.$inviteTargets),s=(e=>{const{isNonUserRelativeContext:t}=a.useSharingApiContext(),n=a.sharingTargetsSearchPackage.useQuery({apiArg:{...e},pkgArg:{isNonUserRelativeContext:t}},{staleTime:3e5,retryDelay:e=>Math.min(1e3*2**e,3e4),retry:3});return Ue.useMemo((()=>n.isLoading?{isLoading:!0}:n.error?{isLoading:!1,isError:!0,error:n.error.appError}:n.data&&n.data.apiData?{output:n.data.apiData.entries.map((e=>{if("user"===e[".tag"]){const t=e;return""===t.dbx_account_id?l.createFromEmail(t.name):e}return"group"===e[".tag"]?e:null})).filter((e=>null!=e)),isLoading:!1,isError:!1}:{isLoading:!1,isError:!0,error:{".tag":"other"}}),[n])})(),r=s.isLoading,o=!r,c=o&&s.isError,d=(o&&!c?s.output:[]).filter((e=>!i.find((t=>l.getUniqueId(t)===l.getUniqueId(e))))).slice(0,3),g=r,u=o&&!c&&d.length>0,m=Ue.useCallback((e=>{const t=l.getContactChipDisplayName(e);switch(e[".tag"]){case"email":if(t.length>20){const e=t.split("@")[0],n=t.split("@")[1];return`${a.Emstring.em_snippet(e,10)}@${a.Emstring.em_snippet(n,10)}`}return t;case"user":case"group":return a.Emstring.em_snippet(t,20,.5);default:return t}}),[]);return Ue.createElement("div",{className:Ci},g&&Ue.createElement(Ti,{numChips:3}),u&&d.map((e=>Ue.createElement(N.Chip,{key:l.getUniqueId(e),size:"medium",variant:"standard",isSelected:i.includes(e),onClick:()=>t(e),"data-testid":`chip-${l.getUniqueId(e)}`},Ue.createElement(N.Chip.IconAccessory,null,Ue.createElement(a.UIIcon,{src:a.AddLine,size:"small"})),Ue.createElement(N.Chip.Content,null,m(e))))))};Ai.displayName="ContactChips";const Ti=({numChips:e})=>Ue.createElement("div",{"data-testid":"chip-skeleton-row",style:{display:"flex",gap:"8px",alignItems:"center"}},Array.from({length:e}).map(((e,t)=>Ue.createElement(N.Chip,{style:{width:"120px"},key:t,size:"medium",variant:"standard",isSelected:!1,onClick:()=>{},"data-testid":`chip-skeleton-${t}`},Ue.createElement(N.Chip.IconAccessory,null,Ue.createElement(a.UIIcon,{src:a.AddLine,size:"small"})),Ue.createElement(N.Chip.Content,null,Ue.createElement(a.Skeleton.Text,{style:{width:"75px",borderRadius:"15px"},key:t}))))));Ti.displayName="ChipSkeletonRow";const xi=/^[a-zA-Z0-9]$/,Ni=()=>{const e=It(),t=_.useAtom(e.$props),{objectIdentifier:i,onRequestClose:s,stacksHandler:r,onControlledFeatureClicked:o,onConfirmationModalShownChange:l,onObjectIdentifierChanged:d,canUserCreateStack:g,isEncrypted:u,isStacksContentLimitExceeded:m}=t,p="file"!==i[".tag"],f=Et(),h=Ue.useCallback((t=>{Tt(e),Ct(e,t)}),[e]),E=t=>{t&&e.$initialInputKey.set(t),f.select(ct).emit({shareModalPage:yt.MAIN}),h(yt.INBAND)},v=Ue.useCallback((()=>{f.select(lt).emit({shareModalPage:yt.MAIN}),r(),o()}),[f,r,o]),y=Ue.useCallback((()=>{f.select(gt).emit({shareModalPage:yt.MAIN}),"integrated_v1"===t.copyLinkMode?h(yt.COPY_LINK):"controlled_v1"===t.copyLinkMode&&(t.copyLinkHandler(),o())}),[f,h,t,o]),S=Ue.useCallback((t=>{const{shouldOpenLinkSettings:a,initialTab:n}=t;let i;i=(null!=a?a:"edit_link_settings"===n||"view_link_settings"===n)?"edit_link_settings"===n?"edit_link_settings":"view_link_settings":"object_settings",e.$initialSettingsTab.set(i),h(yt.SETTINGS)}),[e,h]),I=Ue.useCallback((e=>{e&&s()}),[s]),M=Ue.useCallback((()=>{f.select(ot).emit({shareModalPage:yt.MAIN}),h(yt.SETTINGS)}),[f,h]),C=Ue.useCallback((()=>{f.select(rt).emit({shareModalPage:yt.MAIN}),h(yt.MORE)}),[f,h]),A=Ue.useCallback((()=>{f.select(mt).emit({shareModalPage:yt.MAIN}),s()}),[f,s]),T=Ue.useCallback((()=>{c.invalidateSharingObjectMetadata(i),c.invalidateNewApiObjectMetadata(i),b.invalidateListSharedLinks(i),a.invalidateObjectMembers(i),h(yt.MAIN)}),[i,h]),x=Ue.useCallback((()=>{h(yt.MAIN)}),[h]),N=Ue.useCallback((t=>{(null==t?void 0:t.expandInherited)?(f.select(ht).emit({shareModalPage:yt.MAIN}),((e,t)=>{e.$expandInheritedOnContentMemberListOpen.set(t)})(e,!0)):f.select(ft).emit({shareModalPage:yt.MAIN}),h(yt.CONTENT_MEMBER_LIST)}),[f,e,h]),k=ea(e),L=Ue.useMemo((()=>{const e=!u;return a.isBrowserSupportedByDash()&&!!g&&e}),[g,u]);return Ue.createElement(Ue.Fragment,null,Ue.createElement(Qt,{info:{title:p?Nt(n.intl):kt(n.intl),subtitle:k}},L&&Ue.createElement(Qt.Slot,{type:"iconButton",icon:w.CreateStackLine,label:(O=n.intl,O.formatMessage({id:"4/xudn",defaultMessage:"Add to stack"})),onClick:v,testId:"header-stacks-page-button",isLoading:null===m,isDisabled:!0===m,disabledTooltip:!0===m?Lt(n.intl):null}),Ue.createElement(Qt.Slot,{type:"iconButton",icon:a.MoreHorizontalLine,label:"More ways to share",onClick:C,testId:"header-more-page-button",isLoading:!1,isDisabled:!1,disabledTooltip:null}),Ue.createElement(Qt.Slot,{type:"iconButton",icon:$.SettingsLine,label:"Sharing settings",onClick:M,testId:"header-settings-page-button",isLoading:!1,isDisabled:!1,disabledTooltip:null})),Ue.createElement(Gt,null,Ue.createElement(Gt.Row,null,Ue.createElement("div",{className:Ii},Ue.createElement("div",{className:Mi},Ue.createElement(R.TokenizerButton,{oid:i,onTokenizerButtonClick:E,onTokenizerKeyDown:e=>{"Enter"===e.key?E():xi.test(e.key)&&E(e.key)},shareModalVersion:"sm26"})),Ue.createElement(Ai,{handleChipClick:t=>{e.$inviteTargets.set([t]),h(yt.INBAND)}}))),Ue.createElement(Gt.Row,null,Ue.createElement(b.ContentMemberList,{objectIdentifier:i,openLinkSettings:S,onRequestClose:I,onConfirmationModalShownChange:null!=l?l:()=>{},onTransferFolderOwnership:T,onChangeConfidentiality:x,onObjectIdentifierChanged:d,maxLines:3,onViewAllMembers:N,shouldUseSm26Design:!0}))),Ue.createElement(bi,null,Ue.createElement(bi.Action,{type:"button",align:"left",variant:"outline",label:"Copy link",icon:a.LinkLine,onClick:y,testId:"main-page-copy-link-button",disabled:"controlled_v1"===t.copyLinkMode&&t.isSimpleCopyLinkPending}),Ue.createElement(bi.Action,{type:"button",align:"right",variant:"primary",label:"Done",onClick:A,testId:"main-page-done-button",disabled:!1})));var O};Ni.displayName="MainPage";const ki=()=>{const e=It(),{onControlledFeatureClicked:t,transferHandler:i}=_.useAtom(e.$props),s=ea(e),r=Et();return Ue.createElement(Ue.Fragment,null,Ue.createElement(Qt,{info:{backButton:{onClick:()=>{Ct(e,yt.MAIN)}},title:(o=n.intl,o.formatMessage({id:"pFWXg8",defaultMessage:"More ways to share"})),subtitle:s}}),Ue.createElement(Gt,null,Ue.createElement(Gt.Row,null,Ue.createElement(a.List,{isSelectable:!0},Ue.createElement(a.List.Item,{onClick:()=>{r.select(_t).emit({shareModalPage:yt.MORE}),Ct(e,yt.QR_CODE)},"data-testid":"more-qr-code-button"},Ue.createElement(a.List.Accessory,null,Ue.createElement(a.UIIcon,{src:w.QrCodeLine})),Ue.createElement(a.List.Content,null,Ue.createElement(a.Text,{size:"medium"},"Create QR code")),Ue.createElement(a.List.Accessory,null,Ue.createElement(a.UIIcon,{src:a.ChevronRightLine,color:"var(--dig-color__text__subtle)"}))),Ue.createElement(a.List.Item,{onClick:()=>{r.select(dt).emit({shareModalPage:yt.MORE}),i(),t()},"data-testid":"more-transfer-button"},Ue.createElement(a.List.Accessory,null,Ue.createElement(a.UIIcon,{src:O.DropboxTransferLine})),Ue.createElement(a.List.Content,null,Ue.createElement(a.Text,{size:"medium"},"Transfer a copy")),Ue.createElement(a.List.Accessory,null,Ue.createElement(a.UIIcon,{src:a.ChevronRightLine,color:"var(--dig-color__text__subtle)"})))))));var o};ki.displayName="MorePage";const Li=()=>{const e=It(),{filePath:t,objectIdentifier:a,fileName:i}=_.useAtom(e.$props),s=ea(e);return Ue.createElement(Ue.Fragment,null,Ue.createElement(Qt,{info:{backButton:{onClick:()=>{Ct(e,yt.MORE)}},title:(r=n.intl,r.formatMessage({id:"yQ6Q51",defaultMessage:"Create QR code"})),subtitle:s}}),Ue.createElement(Gt,null,Ue.createElement(Gt.Row,null,Ue.createElement(E.GetQrCode,{objectIdentifier:a,fileName:i,filePath:t,onSettingsClick:()=>{Ct(e,yt.SETTINGS)},isSm26:!0}))));var r};Li.displayName="QRCodePage";const Ri=()=>{const e=It(),{onRequestClose:t}=_.useAtom(e.$props),i=ea(e);return Ue.createElement(Ue.Fragment,null,Ue.createElement(Qt,{info:{backButton:{onClick:()=>{Ct(e,e.$previousPage.get()||yt.MAIN)}},title:(s=n.intl,s.formatMessage({id:"4eFgJP",defaultMessage:"Settings"})),subtitle:i}},Ue.createElement(Qt.Slot,{type:"iconButton",icon:a.CloseLine,label:"Close",onClick:t,testId:"settings-close-button",isLoading:!1,isDisabled:!1,disabledTooltip:""})),Ue.createElement(Gt,null,Ue.createElement(Gt.Row,null,Ue.createElement(a.Text,{size:"medium"},"Placeholder for settings screen"))));var s};Ri.displayName="SettingsPage";a.injectInternalStyle("/static/metaserver/static/js/sharing/features/share-modal/versions/shareme26/share-modal.module.out-vflhKe1VN.css",(e=>"._shareModal_huyrg_3{--SM26_MODAL_MIN_HEIGHT:415px;--SM26_MODAL_MAX_HEIGHT:510px;display:flex;flex-direction:column;max-height:var(--SM26_MODAL_MAX_HEIGHT);min-height:var(--SM26_MODAL_MIN_HEIGHT);overflow:hidden;padding:var(--dig-spacing__macro__medium)}._shareModalMobile_huyrg_16{max-height:none;padding:var(--dig-spacing__micro__xlarge) var(--dig-spacing__micro__large)}._shareModalCopyLink_huyrg_22{min-height:auto}._shareModalMobile_huyrg_16._shareModalCopyLink_huyrg_22{padding:var(--dig-spacing__micro__xlarge) var(--dig-spacing__micro__xlarge) var(--dig-spacing__macro__medium)}"));const wi="_shareModal_huyrg_3",$i="_shareModalMobile_huyrg_16",Oi="_shareModalCopyLink_huyrg_22",Di=({children:e,onDataSuccess:t,onDataError:i,onDataCancel:s,onRequestClose:r,objectIdentifier:o})=>{const l=c.useSharingObjectMetadata(o.fileId),d=!l.isLoading&&l.isError,_=!l.isLoading&&!l.isError,g=d?l.error:void 0,u=Ue.useRef(!1),m=Ue.useRef(!1),p=Ue.useRef(!1),f=(()=>{const e=n.useIntl();return Ue.useCallback((t=>{switch(t){case"no_access":a.fail(e.formatMessage({id:"S0dPqX",defaultMessage:"You don’t have access to this content."}));break;case"invalid_oid":a.fail(e.formatMessage({id:"hBQISs",defaultMessage:"This content doesn’t exist."}));break;case"email_unverified":a.fail(e.formatMessage({id:"YQ+xBi",defaultMessage:"Verify your email to share this content."}));break;default:a.fail(e.formatMessage({id:"ObEiUD",defaultMessage:"Couldn’t complete this request. Try again."}))}}),[e])})();return Ue.useEffect((()=>{_&&!m.current&&(m.current=!0,t())}),[_,t]),Ue.useEffect((()=>{if(d&&!u.current){u.current=!0;const e=null==g?void 0:g[".tag"];f(e),r(),D.reportStack(`Failed to load object metadata for object with id: ${o.fileId}`,{severity:D.SEVERITY.CRITICAL,tags:["sharing","share-modal","sm26-data-loading-error"],exc_extra:{file_id:o.fileId,error:g}}),i()}}),[d,f,o,g,i,r]),Ue.useEffect((()=>()=>{p.current||u.current||m.current||(p.current=!0,s())}),[]),Ue.createElement(Ue.Fragment,null,e)};Di.displayName="DataLoadingWrapper";const Pi=Symbol("ON_SHOW_VERIFY_EMAIL_MODAL"),{useEmitter:Fi,defaultEmitter:Ui}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),s=t(a.Context$6),r=t(a.Context$7),o={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(s),...a.getTags$7(r),isSm26:"true"},l={...a.getProperties$4(n),...a.getProperties$5(i),...a.getProperties$6(s),...a.getProperties$7(r)};e.key===Pi&&(a.UDCL.logEnd("ops.sm26.browse_load",{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"canceled",...l}),{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEvent("ops.sm26.show_verify_email_modal",{tags:o}))})),Hi=({children:e,sessionId:t,onRequestClose:n})=>{var i,s;const r=Fi(),{viewer:o,isLoading:l}=a.useViewer(),c=!l&&!1===(null===(i=o.active_user)||void 0===i?void 0:i.is_email_verified);return Ue.default.useEffect((()=>{c&&r.select(Pi).emit({sessionId:t})}),[c,t,r]),c?Ue.default.createElement(v.VerifyEmailModal,{viewer:o,user:o.active_user,reason:y.EmailVerificationReasons.SHMODAL,email:null===(s=o.active_user)||void 0===s?void 0:s.email,onShowChange:()=>{o.active_user&&v.ChangeEmail.show(o,o.active_user,y.EmailVerificationReasons.SHMODAL)},onEmailSent:()=>{v.EmailVerification.get_for_user(o,o.active_user).email_sent(void 0,y.EmailVerificationReasons.SHMODAL,!0),n()},onCancel:n}):Ue.default.createElement(Ue.default.Fragment,null,e)};Hi.displayName="EmailVerificationWrapper";const Bi=()=>{var e,t;const i=n.useIntl(),s=It(),r=_.useStore(s.$currentPage),o=_.useAtom(s.$props),{isOpen:l,onRequestClose:g,objectIdentifier:u}=o,m=_.useStore(s.$hangingNotification),p=_.useStore(s.$isOperationInProgress),f=Et(),h=d.usePlatform()===d.Platforms.METASERVER,v=i.formatMessage({id:"U7hqO4",defaultMessage:"Share modal"}),y=Ue.useCallback((()=>{Tt(s)}),[s]),S=Ue.useCallback((e=>{At(s,e)}),[s]),b=o.hangingNotificationRef;Ue.useEffect((()=>{if(b)return b.current=e=>At(s,e),()=>{b.current=null}}),[s,b]);const I="sm26_modal",M=I+"-"+a.getContentIdOrPathFromObjectIdentifier(u)+"-"+r,C=a.useCvcInteractiveLogger(I,{shareModalPage:r}),A=Ue.useCallback(C,[C]),{trackedElementRef:T,startCvcMeasurement:x}=a.useComponentVisuallyCompleteCalculator(I,M,A,{reportOnNoChange:!0});Ue.useEffect((()=>{x()}),[x]);Ue.useEffect((()=>{f.select(st).emit({shareModalPage:r})}),[r,f]);const{small:N}=a.useBreakpoint({strategy:"maxWidth"}),k=a.cx(wi,{[$i]:N,[Oi]:r===yt.COPY_LINK}),L=Ue.createElement(c.HangingNotificationProvider,{value:S},Ue.createElement(Ue.Fragment,null,(r===yt.MAIN||r===yt.MORE)&&!N&&h&&Ue.createElement(E.OverquotaShareBannerComponent,{shouldUseSm26Design:!0}),Ue.createElement("div",{className:k},(()=>{switch(r){case yt.MAIN:return Ue.createElement(Ni,null);case yt.MORE:return Ue.createElement(ki,null);case yt.SETTINGS:return Ue.createElement(Ri,null);case yt.INBAND:return Ue.createElement(vi,null);case yt.COPY_LINK:return Ue.createElement(aa,null);case yt.CONTENT_MEMBER_LIST:return Ue.createElement(ta,null);case yt.QR_CODE:return Ue.createElement(Li,null);default:return Ue.createElement(Ni,null)}})()),Ue.createElement(Je,{isVisible:null!==m,message:null!==(e=null==m?void 0:m.message)&&void 0!==e?e:"",type:null!==(t=null==m?void 0:m.type)&&void 0!==t?t:"success",action:null==m?void 0:m.action,isDismissible:null==m?void 0:m.isDismissible,onDismiss:y}))),R=Ue.useCallback((()=>{p||(f.select(pt).emit({shareModalPage:r}),g())}),[g,f,r,p]);if(N){const e=r===yt.SETTINGS;return Ue.createElement(nt,{isOpen:l,onRequestClose:R,isFullHeight:e,"aria-label":v,"data-testid":"shareme26-drawer"},Ue.createElement("div",{ref:T,key:"share-modal-content"},L))}return Ue.createElement(a.Modal,{open:l,onRequestClose:R,width:500,"aria-label":v,"data-testid":"shareme26-modal"},Ue.createElement(xt,{onRequestClose:g},Ue.createElement("div",{ref:T,key:"share-modal-content"},L)))};Bi.displayName="ShareModalWithStore";const ji=e=>{const{isOpen:t,onRequestClose:n}=e,i=d.usePlatform()===d.Platforms.METASERVER,s=Ue.useMemo((()=>Math.random().toString()),[]);return t?i?Ue.createElement(S.ShareBlockingWrapper,{action:a.LockedStateModalAction.SHARE_MODAL,onStatusChange:e=>{e===a.Status.USER_ABORTED_ACTION&&n()}},Ue.createElement(Hi,{sessionId:s,onRequestClose:n},Ue.createElement(Di,{...e},Ue.createElement(a.ComponentVisuallyCompleteProvider,null,Ue.createElement(Mt,{...e},Ue.createElement(Bi,null)))))):Ue.createElement(Mt,{...e},Ue.createElement(a.ComponentVisuallyCompleteProvider,null,Ue.createElement(Bi,null))):null},Vi=(e,t)=>{var a;return Ue.createElement(d.SharingSdkProvider,{userApiProps:e.user,origin:null===(a=e.shareModalExtras)||void 0===a?void 0:a.origin,actionInfo:{actionSurface:e.actionSurface}},Ue.createElement(Wi,{store:t}))},qi=(e,t)=>{var a;return Ue.createElement(d.SharingSdkProvider,{userApiProps:e.user,origin:null===(a=e.shareModalExtras)||void 0===a?void 0:a.origin,actionInfo:{actionSurface:e.actionSurface}},Ue.createElement(Gi,{store:t}))},zi=e=>{const t=(e=>_.useInitStore(e,(e=>{const t=_.store(Date.now()),a=_.store(void 0),n=_.store(e.get().isOpen),i=_.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.anchorRef})),s=_.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.overlayPlacement}));return{$isOpen:n,$openFlexibleEntryPointTimestamp:t,$dwellFlexibleEntryPointActionTimestamp:a,$anchorRef:i,$overlayPlacement:s,$props:e}})))(e),{variant:n,isLoading:i}=a.useExperimentVariant("sm26_m1");a.useLogExposureOnce("sm26_m1",i);const s=Ue.useRef(!1);return Ue.useEffect((()=>{if(!s.current&&!i){s.current=!0;const i=n===a.Variant.ON?"sm26":"sm24";a.defaultEmitter$3.select(a.ON_ASYNC_SHOW_SHARE_MODAL).emit({...e,...(t=e.fileOrFolder,{fileExtension:t.ext||void 0,isDir:t.is_dir,sharedObjectType:t.is_dir?t.target_ns?"shared_folder":"folder":"file"}),shareModalType:i})}var t}),[e,i,n]),i?null:n===a.Variant.ON?Vi(e,t):qi(e,t)};zi.displayName="ShareModalBrowse";const Gi=({store:e})=>{var t,r,g;const{user:u,fileOrFolder:m,actionSurface:p,actionElement:f,onActionClicked:h}=e.$props.get(),[v,y]=Ue.useState(a.getObjectIdentifier(m)),S=a.getFilename(m),b=m.is_dir,{shareModalExtras:I,sessionId:M,displayType:C}=_.useStore(e.$props),A=null==I?void 0:I.origin,T=_.useStore(e.$isOpen),x=_.useStore(e.$anchorRef),N=_.useStore(e.$overlayPlacement),k=s.useQueryClient();b&&Be(k,m.file_id);const{variant:L}=a.useExperimentVariant("sharing_lego_settings_page"),R="V1"===L;a.useLogExposureOnce("sharing_lego_settings_page");const w=(e=>Ue.default.useCallback((()=>{e.$props.get().onRequestClose(),e.$dwellFlexibleEntryPointActionTimestamp.set(void 0)}),[e]))(e),$=(e=>Ue.default.useCallback((()=>{var t,a;null===(a=(t=e.$props.get()).onInbandShareCompleted)||void 0===a||a.call(t),e.$isOpen.set(!1),e.$props.get().onRequestClose()}),[e]))(e),O=Ue.useCallback((async e=>{a.markMilestoneAsCompleted(e,d.ActivationTileMilestoneId.SHARE_CONTENT)}),[]);Ue.useEffect((()=>{(async()=>{if(!v.fileId||""===v.fileId){const e=await c.fetchLegacySharingObjectMetadataObjectIdentifier(v);y(e)}})()}),[v]);const D=Ue.useMemo((()=>m.is_dir?m.target_ns?{type:"shared_folder"}:{type:"file_folder"}:{type:"file",name:S,size:m.bytes}),[S,m]),P=Ue.useMemo((()=>({actionSurface:p,actionElement:f,contentAction:"share",tiburonOrigin:A,screen:"share_screen",shareModalType:"sm24"})),[p,f,A]),F=_.useStore(e.$props).onSm24Fallback,{data:U,isLoading:H}=a.useSharingPrefs(),B=null!==(t=null==U?void 0:U.apiData.is_file_transfer_enabled)&&void 0!==t&&t,j=b?i.folderEligibleForTransfer(m):!m.is_cloud_doc,V=u.is_team_admin,q=H,z=!!(null===(g=null===(r=a.useDashAccess().data)||void 0===r?void 0:r.apiData.feature_attributes)||void 0===g?void 0:g.has_stacks_in_fss);let G=null,W=Ue.useMemo((()=>b?null:[{file_id:m.file_id,fq_path:m.fq_path}]),[b,m]);const K=je(m.file_id,b);K.isLoading||(K.isError?G="too_many_contents"===K.error[".tag"]:(W=K.output,G=!1));const Y=a.useShowCopyLinkMiniModalCallback(),Z=Ue.useMemo((()=>"centered"===C?{initialDisplayMode:"centered_v1"}:{initialDisplayMode:"anchored_v1",displayModeRef:x,displayModePositioning:N}),[C,x,N]),Q=Ue.useCallback((()=>{var t;const{actionSurface:a,actionElement:n,user:i,shareModalExtras:s,...r}=e.$props.get();"anchored"===r.displayType&&(null===(t=r.onHoverLocked)||void 0===t||t.call(r,{isOpen:!0}));let o=()=>{};const l=new Promise((e=>{o=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":l});navigator.clipboard.write([e])}else l.then((e=>navigator.clipboard.writeText(e)));const c={write:e=>o(e)},d="undefined"!=typeof window&&window.innerWidth<=800?"bottom":N;O(i);const _="anchored"===r.displayType?{isCenteredDisplayed:!1,anchorRef:r.anchorRef,placement:d,yOffsetDistance:5,onHoverLocked:r.onHoverLocked}:{isCenteredDisplayed:!0};Y.fn({user:i,filePath:m.file_id,setIsCreatingSharedLink:()=>{},browseFile:m,zIndexOverride:500,actionSurface:a,actionElement:n,origin:null==s?void 0:s.origin,isFromShareMe24Modal:!0,clipboardWriter:c,withLockedStateModal:!1,userActionSource:null==s?void 0:s.userActionSource,..._})}),[e.$props,N,Y,O,m]),X=Ue.useCallback((()=>{const e=`sm24_${p}_${f}`,t=[m];i.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>i.redirectToCreateTransferWithFiles(t,e),userId:u.id})}),[f,p,m,u.id]),J=(e=>Ue.useCallback((t=>{const n=e.$props.get(),i=n.user,s=n.fileOrFolder,r={...n.shareModalExtras,initialScreen:a.SETTINGS_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:t.shouldOpenLinkSettings,initialTab:t.initialTab};o.markDeprecatedHelperCallsite("browse_integration__asyncShowShareModal"),a.asyncShowShareModal(i,s,r)}),[e]))(e),ee=(e=>{const t=a.useExperimentVariant("sharing_access_management_entry_point_expansion"),n=t.isLoading?"OFF":t.variant;return Ue.useCallback((()=>{const t=e.$props.get(),i=t.user,s=t.fileOrFolder,r={...t.shareModalExtras,initialScreen:a.MANAGE_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:!1};n&&n!==a.Variant.OFF&&a.logExposure({feature:"sharing_access_management_entry_point_expansion",variant:n}),"ON"===n?a.asyncShowAccessManagementBrowse({fileOrFolder:s,user:i,actionSurface:"browse_integration_manage_permissions",actionElement:"access_management",sessionId:Math.random().toString()}):a.asyncShowShareModal(i,s,r)}),[e,n])})(e),te=Ue.useCallback((async()=>{if(!W)return;const{actionSurface:t}=e.$props.get(),s=Yi(t),r=b?S:void 0;i.asyncAddToStack(n.intl,k,a.CompatNavigate.navigate,W,s,r)}),[W,S,b,k,e.$props]);return Ue.createElement("div",null,Ue.createElement(Ke,{sessionId:M,onRequestClose:w},Ue.createElement(d.MetadataProvider,{sharingObjectIdentifier:v,shareModalSessionId:M},Ue.createElement(a.ContextProvider,{context:l.Context,value:M},Ue.createElement(a.ContextProvider,{context:a.Context$4,value:P},Ue.createElement(a.ContextProvider,{context:a.Context$5,value:D},Ue.createElement(E.Provider,{objectIdentifier:v,sessionId:M,objMetadataNewApiVariant:"OFF"},Ue.createElement(Ki,{sessionId:M,actionElement:f,actionSurface:p,isDir:b},Ue.createElement(qe,{onFallback:F,onRequestClose:w},Ue.createElement("div",{"data-testid":"shareme24-browse-internals"},Ue.createElement(E.Main,{...Z,isOpen:T,onRequestClose:w,inbandSharingMode:"controlled_v1",copyLinkMode:"controlled_v1",copyLinkHandler:Q,transferMode:"controlled_v1",transferHandler:X,settingsMode:R?"integrated_v1":"controlled_v1",settingsHandler:J,manageAccessHandler:ee,objectIdentifier:v,isEncrypted:m.is_encrypted,fileName:S,fileSize:m.bytes,filePath:m.fq_path,canUserUseTransfer:B,canContentUseTransfer:j,canUserEnableTransfer:V,isTransferEligibilityLoading:q,referrerLoggingMetadata:P,objectLoggingMetadata:D,onActionClicked:h,onInbandShareCompleted:$,canUserCreateStack:z,isFolderFileCountOverLimit:G,contents:W,createStackHandler:te,onObjectIdentifierChanged:()=>Promise.resolve()})))))))))))};Gi.displayName="ShareMe24BrowseInternals";const Wi=({store:e})=>{var t,r,o;const{user:g,fileOrFolder:u,actionSurface:m,actionElement:p,onActionClicked:f,sessionId:h,shareModalExtras:E}=_.useStore(e.$props),[v,y]=Ue.useState(a.getObjectIdentifier(u)),S=a.getFilename(u),b=u.is_dir,I=null==E?void 0:E.origin,M=_.useStore(e.$isOpen),C=Ue.useCallback((()=>{e.$props.get().onRequestClose()}),[e]),A=Ue.useCallback((()=>{var t,a;null===(a=(t=e.$props.get()).onInbandShareCompleted)||void 0===a||a.call(t)}),[e]);Ue.useEffect((()=>{(async()=>{if(!v.fileId||""===v.fileId){const e=await c.fetchLegacySharingObjectMetadataObjectIdentifier(v);y(e)}})()}),[v]);const T=Ue.useMemo((()=>u.is_dir?u.target_ns?{type:"shared_folder"}:{type:"file_folder"}:{type:"file",name:S,size:u.bytes}),[S,u]),x=Ue.useMemo((()=>({actionSurface:m,actionElement:p,contentAction:"share",tiburonOrigin:I,screen:"share_screen",shareModalType:"sm26"})),[m,p,I]),{data:N,isLoading:k}=a.useSharingPrefs(),L=null!==(t=null==N?void 0:N.apiData.is_file_transfer_enabled)&&void 0!==t&&t,R=b?i.folderEligibleForTransfer(u):!u.is_cloud_doc,w=g.is_team_admin,$=k,O=Ue.useCallback((()=>{const e=`sm26_${m}_${p}`,t=[u];i.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>i.redirectToCreateTransferWithFiles(t,e),userId:g.id})}),[p,m,u,g.id]),D=s.useQueryClient();b&&Be(D,u.file_id);const P=!!(null===(o=null===(r=a.useDashAccess().data)||void 0===r?void 0:r.apiData.feature_attributes)||void 0===o?void 0:o.has_stacks_in_fss);let F=null,U=Ue.useMemo((()=>b?null:[{file_id:u.file_id,fq_path:u.fq_path}]),[b,u]);const H=je(u.file_id,b);H.isLoading||(H.isError?F="too_many_contents"===H.error[".tag"]:(U=H.output,F=!1));const B=Ue.useCallback((async()=>{if(!U)return;const{actionSurface:t}=e.$props.get(),s=Yi(t),r=b?S:void 0;i.asyncAddToStack(n.intl,D,a.CompatNavigate.navigate,U,s,r)}),[U,S,b,D,e.$props]),j=Ue.useCallback((()=>{a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_SUCCESS).emit({sessionId:h,actionElement:p,actionSurface:m,isDir:b,shareModalType:"sm26"})}),[h,p,m,b]),V=Ue.useCallback((()=>{a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_FAILURE).emit({sessionId:h,actionElement:p,actionSurface:m,isDir:b,shareModalType:"sm26"})}),[h,p,m,b]),q=Ue.useCallback((()=>{a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_CANCEL).emit({sessionId:h,actionElement:p,actionSurface:m,isDir:b,shareModalType:"sm26"})}),[h,p,m,b]);return Ue.createElement("div",{"data-testid":"shareme26-browse-internals"},Ue.createElement(d.MetadataProvider,{sharingObjectIdentifier:v,shareModalSessionId:h},Ue.createElement(a.ContextProvider,{context:l.Context,value:h},Ue.createElement(a.ContextProvider,{context:a.Context$4,value:x},Ue.createElement(a.ContextProvider,{context:a.Context$5,value:T},Ue.createElement(ji,{isOpen:M,objectIdentifier:v,onRequestClose:C,onControlledFeatureClicked:f,copyLinkMode:"integrated_v1",inbandSharingMode:"integrated_v1",onInbandShareCompleted:A,shouldResetToMainAfterInbandShare:!0,shouldDisablePostInbandShareHooks:!1,shouldShowBackButtonOnInbandShare:!1,settingsMode:"integrated_v1",shouldResetToMainOnSettingsCancel:!1,shouldResetToMainOnSettingsSave:!1,shouldResetToMainOnUnshareComplete:!1,transferMode:"controlled_v1",transferHandler:O,canUserUseTransfer:L,canContentUseTransfer:R,canUserEnableTransfer:w,isTransferEligibilityLoading:$,stacksMode:"controlled_v1",stacksHandler:B,canUserCreateStack:P,isStacksContentLimitExceeded:F,onObjectIdentifierChanged:()=>Promise.resolve(),isEncrypted:u.is_encrypted,fileName:S,filePath:u.fq_path,referrerLoggingMetadata:x,objectLoggingMetadata:T,onDataSuccess:j,onDataError:V,onDataCancel:q}))))))};Wi.displayName="ShareMe26BrowseInternals";const Ki=({children:e,sessionId:t,actionElement:n,actionSurface:i,isDir:s})=>{const r=E.useData(),o=Ue.useRef(!1);return Ue.useEffect((()=>{if(!o.current)return"error"===r.status?(o.current=!0,void a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_FAILURE).emit({sessionId:t,actionElement:n,actionSurface:i,isDir:s,shareModalType:"sm24"})):"loaded"===r.status?(o.current=!0,void a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_SUCCESS).emit({sessionId:t,actionElement:n,actionSurface:i,isDir:s,isSharingBanned:r.accountMetadata.is_sharing_banned,shareModalType:"sm24"})):void 0}),[r.status,t,n,i,s]),Ue.useEffect((()=>()=>{o.current||(o.current=!0,a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_CANCEL).emit({sessionId:t,actionElement:n,actionSurface:i,isDir:s,shareModalType:"sm24"}))}),[]),Ue.createElement(Ue.Fragment,null,e)};Ki.displayName="DataLoadingLogger";const Yi=e=>{switch(e){case"previews":return"previews";case"search":return"search_results_page";case"quick-view-search":return"search_quick_view";case"browse_screen":return"browse_screen";case"quick-view-browse":return"browse_quick_view";default:return`unknown_${e}`}};e.ShareModalBrowse=zi,e.renderShareMe24=qi,e.renderShareMe26=Vi}));
//# sourceMappingURL=c_integrations_browse_integration_index.after-display.js-vflOznoRp.map

//# debugId=d31fceec-a856-3ae3-93ca-8b9445bd3a98