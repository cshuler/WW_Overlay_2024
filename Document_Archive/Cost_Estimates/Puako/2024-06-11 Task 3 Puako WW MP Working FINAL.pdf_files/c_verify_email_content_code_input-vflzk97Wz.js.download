!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="39e78b8e-cd30-33eb-93b1-03fe4c8c6bb3")}catch(e){}}();
define(["exports","./c_security_csrf_hmac","./e_core_exception","react","./e_file_viewer_static_scl_page_file","./c_core_i18n","./c_api_v2_unauthed_client"],(function(e,t,r,a,i,n,o){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}var c=l(a);i.injectInternalStyle("/static/metaserver/static/js/auth/verify_email/content/default.module.out-vflED8wbl.css",(e=>"._resend-button_1k60n_1{color:var(--Primary-On-Surface,#0057e0)}._code-text-input-wrapper_1k60n_5{border-radius:8px;height:80px;padding:0}._code-text-input-wrapper_1k60n_5._code-text-input-wrapper--xsmall_1k60n_15{height:60px}._code-text-input-wrapper_1k60n_5 input._code-text-input_1k60n_5[type=text]{font-size:28px;line-height:1em;padding:var(--dig-spacing__micro__xlarge);text-align:center;width:1ch}._code-text-input-wrapper_1k60n_5 input._code-text-input-small_1k60n_29[type=text]{font-size:28px;line-height:1em;padding:var(--dig-spacing__micro__large);text-align:center;width:1ch}._code-text-input-wrapper_1k60n_5 input._code-text-input-xsmall_1k60n_37[type=text]{font-size:28px;line-height:1em;padding:var(--dig-spacing__micro__medium);text-align:center;width:1ch}@media (max-width:456px){._code-text-input-wrapper_1k60n_5{height:80px}._code-text-input-wrapper_1k60n_5 input._code-text-input_1k60n_5[type=text]{font-size:20px;padding:0 var(--dig-spacing__micro__large)}._verify-email-wrapper_1k60n_55{max-width:456px}}"));var s;function p(e){return{class:"verify_email",action:"start",object:"email_verification_component_code_input",properties:e}}!function(e){e.DEFAULT="default",e.CODE="code"}(s||(s={}));const d=n.intl.formatMessage({id:"HSJula",defaultMessage:"Double-check the code and try again."}),_=n.intl.formatMessage({id:"UDcbjZ",defaultMessage:"Too many attempts. Please try again later."}),u=n.intl.formatMessage({id:"9Hycd5",defaultMessage:"Unable to verify code. Please try again later."});var f;!function(e){e.ATTEMPT_RATE_EXCEEDED="err_attempt_rate_exceeded",e.VERIFICATION_CODE_INVALID="err_verification_code_invalid",e.OTHER="err_other"}(f||(f={}));const m={attempt_rate_exceeded:f.ATTEMPT_RATE_EXCEEDED,verification_code_invalid:f.VERIFICATION_CODE_INVALID,incorrect_email_mfa:f.VERIFICATION_CODE_INVALID};e.CodeInput=e=>{const t=a.useRef(Array.from({length:6},(()=>a.createRef()))),[r,l]=a.useState(Array(6).fill("")),[g,E]=a.useState(e.twoFactorError||null),[x,v]=a.useState(!1),[y,w]=a.useState(!1),h=a.useRef("code-input-error-message");a.useEffect((()=>{x||e.twoFactorError&&(C(),w(!0),E(e.twoFactorError))}),[e.twoFactorError,x]);const D=(e,t)=>{l(r.map(((r,a)=>a===e?t:r)))},C=()=>{l(Array(6).fill("")),T(0)};a.useEffect((()=>{const t=r.join("");e.onCodeChange&&e.onCodeChange(t),t.length>0&&(w(!1),E(null)),r.every((e=>""!==e))&&k()}),[r]);const k=async()=>{var t,a;if(!x){try{v(!0),E(null),i.UDCL.logStart(p({actionSurface:e.surface,verifyEmailComponent:s.CODE}),{tags:{action_surface:e.surface,verify_email_component:s.CODE}}),await e.onSubmit(r.join("")),i.UDCL.logEnd(p({actionSurface:e.surface,verifyEmailComponent:s.CODE,eventState:"success"}),{tags:{action_surface:e.surface,verify_email_component:s.CODE}}),w(!1),e.onSuccess&&e.onSuccess()}catch(r){const n=null===(a=null===(t=o.filterApiError(r))||void 0===t?void 0:t.error)||void 0===a?void 0:a[".tag"],l=m[n];l?(i.UDCL.logEnd(p({actionSurface:e.surface,verifyEmailComponent:s.CODE,eventState:"rejected"}),{tags:{action_surface:e.surface,verify_email_component:s.CODE,verify_email_fail_reason:l}}),l===f.ATTEMPT_RATE_EXCEEDED?E(_):E(d)):(i.UDCL.logEnd(p({actionSurface:e.surface,verifyEmailComponent:s.CODE,eventState:"failed"}),{tags:{action_surface:e.surface,verify_email_component:s.CODE,verify_email_fail_reason:f.OTHER}}),E(u)),e.onError&&e.onError(r),w(!0),C()}v(!1)}},T=e=>{if(!(e>=6)&&e<6&&e>=0){const r=t.current[e].current;r.focus(),r.select()}},S=e=>e.replace(/[^\d]/g,""),I="small"===e.size?"small":"medium";return c.default.createElement(i.FormRow,null,c.default.createElement(i.Split,{gap:"small"===e.size?"Micro Small":"xsmall"===e.size?{small:"Micro Large",xsmall:"Micro Small"}:"Micro Large",alignX:"center"},r.map(((a,o)=>c.default.createElement(i.Split.Item,{key:`code-text-input-${o}`},c.default.createElement(i.TextInput,{id:`code-text-input-${o}`,"data-testid":`code-test-input-${o}`,ref:t.current[o],autoFocus:0===o,isInvalid:y&&0===o,"aria-errormessage":y?h.current:void 0,width:1,size:I,"aria-label":n.intl.formatMessage({id:"i0ra7m",defaultMessage:"Verification code input field {index}"},{index:o+1}),className:"small"===e.size?"_code-text-input-small_1k60n_29":"xsmall"===e.size?"_code-text-input-xsmall_1k60n_37":"_code-text-input_1k60n_5",wrapperProps:{className:i.cx("_code-text-input-wrapper_1k60n_5",{"_code-text-input-wrapper--xsmall_1k60n_15":"xsmall"===e.size})},onChange:t=>((t,a)=>{const i=S(t.target.value);if(e.logCodeFilled&&e.logCodeFilled(),0!==i.length)if(i.length>1){const e=r[a];if(""===e||i.length>2||!i.startsWith(e)){const e=a+i.length,t=[...r.slice(0,a),...i.split(""),...r.slice(i.length+a)].slice(0,6);l(t),T(e)}else{const e=i.slice(-1);D(a,e),T(a+1)}}else D(a,i),T(a+1)})(t,o),onKeyDown:e=>((e,t)=>{"e"===e.key?e.preventDefault():"Backspace"===e.key?(T(t-1),D(t,""),e.preventDefault()):"ArrowUp"===e.key||"ArrowDown"===e.key?e.preventDefault():"ArrowLeft"===e.key?(T(t-1),e.preventDefault()):"ArrowRight"===e.key?(T(t+1),e.preventDefault()):e.key>="0"&&e.key<="9"&&r[t]===e.key&&(e.preventDefault(),T(t+1))})(e,o),onFocus:e=>e.target.select(),onPaste:e=>((e,t)=>{e.preventDefault();const a=e.clipboardData,i=S(a.getData("Text"));if(0===i.length)return;const n=t+i.length,o=[...r.slice(0,t),...i.split(""),...r.slice(i.length+t)].slice(0,6);l(o),T(n)})(e,o),value:a,autoComplete:"one-time-code",disabled:!!e.disabled,inputMode:"numeric"}))))),c.default.createElement(c.default.Fragment,null,null!==g&&c.default.createElement(i.Box,{marginTop:"16",paddingTop:"2",paddingBottom:"8",paddingLeft:"12",paddingRight:"12"},c.default.createElement(i.FormHelperText,{variant:"alert"},c.default.createElement(i.Box,{display:"flex",alignItems:"center",role:"alert","aria-live":"assertive","aria-atomic":"true",id:h.current},c.default.createElement(i.UIIcon,{src:i.FailLine,size:"medium"}),c.default.createElement(i.Text,{color:"error",size:"medium"},g))))))},e.wrapPassword=async function(e,a){if(""===e)return"";const i=encodeURIComponent(e);try{const e="wrapped_password_"+(null==a?void 0:a.type)+"_";if("RSA-OAEP"===(null==a?void 0:a.type)){const r=void 0!==window.performance?window.performance.now()/1e3:0,n=a.timestamp+r,o=t.b64urldecode(a.key),l=await t.encryptWithPublicKey(o,t.stringToBytes(JSON.stringify({timestamp:n,password:i})),a.version);return e+t.b64urlencode(l)}throw new Error(`Unsupported algorithm: ${null==a?void 0:a.type}`)}catch(e){if(!0===(null==a?void 0:a.plaintextFallback))return r.reportException({err:e,severity:"non-critical",tags:["password-crypto-fallback-error"]}),"wrapped_password_PLAINTEXT_"+i;{let t;throw t=e&&"object"==typeof e&&"isBrowserNotSupported"in e&&e.isBrowserNotSupported?"user-error":"critical",r.reportException({err:e,severity:t,tags:["password-crypto-error"]}),e}}}}));
//# sourceMappingURL=c_verify_email_content_code_input.js-vflIkm-XE.map

//# debugId=39e78b8e-cd30-33eb-93b1-03fe4c8c6bb3