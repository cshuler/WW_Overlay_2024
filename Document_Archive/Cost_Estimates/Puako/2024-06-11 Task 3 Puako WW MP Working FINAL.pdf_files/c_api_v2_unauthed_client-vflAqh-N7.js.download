!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="08a35ded-8981-3a28-9794-daafeac4a894")}catch(e){}}();
define(["exports","./c_watermarking_utils_getImageDefaultSizes","./c_api_v2_routes_password_confirmation_provider","./c_dotlottie_common_chunk-B7OIQIGJ","./c_hive_schemas_sharing-request_access_user_events","./e_core_exception"],(function(e,t,r,n,s,o){"use strict";var i,a,u;e.ApiV2HeaderNames=void 0,(i=e.ApiV2HeaderNames||(e.ApiV2HeaderNames={})).DropboxApiArg="Dropbox-API-Arg",i.DropboxApiSelectAdmin="Dropbox-API-Select-Admin",i.DropboxPathRoot="X-Dropbox-Path-Root",i.DropboxUid="X-Dropbox-Uid",i.DropboxTeamId="X-Dropbox-Teamid",i.DropboxTeamAuthorization="X-Dropbox-Team-Authorization",i.CsrfToken="X-CSRF-Token",i.DropboxRefreshSession="X-Dropbox-Refresh-Session",function(e){e[e.TeamAdminRole=0]="TeamAdminRole",e[e.MTARole=1]="MTARole",e[e.FederationAdminRole=2]="FederationAdminRole"}(a||(a={})),function(e){e[e.AdminAction=0]="AdminAction",e[e.AssumeAction=1]="AssumeAction",e[e.OnBehalfOfAction=2]="OnBehalfOfAction"}(u||(u={}));class c{static parse(e){const t=e[".tag"];return 2===Object.keys(e).length&&null!=e[t]?new l(t,e[t]):new d(t,e)}constructor(e,t,r){this.type=e,this.value=t,this.isScalar=r}}class l extends c{constructor(e,t=null){super(e,t,!0)}toJSON(){const e={".tag":this.type};return null!=this.value&&(e[this.type]=this.value),e}}class d extends c{constructor(e,t={}){super(e,t,!1)}toJSON(){return{".tag":this.type,...this.value||{}}}}class h extends Error{static parseResponse(e,t,r,n,s,o=null){var i,a;null==o&&(o=e in b?b[e]:e>=500?f:h);const u={raw:{status:e,responseBody:r},response:null,summary:null,error:{},headers:t,rpcPath:n};let c=r;try{const e=JSON.parse(r)||{};u.error=e.error,u.summary=e.error_summary||(null===(a=null===(i=e.error)||void 0===i?void 0:i.status)||void 0===a?void 0:a[".tag"])||"",e.user_message&&"string"==typeof e.user_message.text?c=e.user_message.text:"string"==typeof u.summary&&""!==u.summary&&(c=`error_summary: "${u.summary}"`)}catch(e){}u.response=c,n&&!c.startsWith("Error in call to API function")&&(c=`Error in call to API function ${n}: ${c}`);const l=Object.assign(new o(c),u);return s&&(l.stack=s),l}}class p extends h{}class m extends h{}class f extends h{}class g extends h{}function w(e){return e instanceof h}const b={400:class extends h{},401:p,409:m,429:g};class v extends Error{constructor(e,t){super(t),this.name="FetchAbortError",this.response=e}}class _ extends Error{constructor(e,t){super(t),this.name="FetchFailError",this.response=e}}class y extends Error{constructor(e,t){super(t),this.name="FetchResponseError",this.response=e}}function E(e){return"FetchResponseError"===e.name}const x={idleTimeout:500,networkTimeout:6e4};class T{constructor(){this.pendingRequests=0,this.subscribers=new Set,this.didNetworkTimeOut=!1,this.next=e=>{this.subscribers.forEach((t=>t(e)))},this.startCleanupTimeout=()=>{this.abortCleanupTimeout();this.cleanupTimeout=window.setTimeout((()=>{this.didNetworkTimeOut=!0,this.pendingRequests=0,this.next("IDLE")}),x.networkTimeout)},this.abortCleanupTimeout=()=>{window.clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0},this.increment=()=>{this.startCleanupTimeout(),0===this.pendingRequests&&this.next("BUSY"),this.pendingRequests+=1},this.decrement=()=>{this.abortCleanupTimeout(),1===this.pendingRequests?this.next("IDLE"):this.startCleanupTimeout(),this.pendingRequests=Math.max(this.pendingRequests-1,0)},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}}}}class R{constructor(){this.pendingResources=new Set,this.subscribers=new Set,this.didNetworkTimeOut=!1,this.next=e=>{this.subscribers.forEach((t=>t(e)))},this.startCleanupTimeout=()=>{this.abortCleanupTimeout();this.cleanupTimeout=window.setTimeout((()=>{this.didNetworkTimeOut=!0,this.pendingResources=new Set,this.next("IDLE")}),x.networkTimeout)},this.abortCleanupTimeout=()=>{window.clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0},this.add=e=>{e instanceof HTMLImageElement&&!e.src||e instanceof HTMLImageElement&&e.complete||e instanceof HTMLLinkElement&&!e.href||e instanceof HTMLScriptElement&&!e.src||e instanceof HTMLIFrameElement&&!e.src||(this.startCleanupTimeout(),0===this.pendingResources.size&&this.next("BUSY"),this.pendingResources.add(e))},this.remove=e=>{this.abortCleanupTimeout(),this.pendingResources.delete(e),0===this.pendingResources.size?this.next("IDLE"):this.startCleanupTimeout()},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}},(null===window||void 0===window?void 0:window.MutationObserver)&&window.addEventListener("load",(()=>{new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{e instanceof HTMLScriptElement||e instanceof HTMLLinkElement||e instanceof HTMLImageElement||e instanceof HTMLIFrameElement?this.add(e):e.hasChildNodes()&&e instanceof HTMLElement&&e.querySelectorAll("img").forEach(this.add)}))}))})).observe(window.document.documentElement,{childList:!0,subtree:!0}),["load","error"].forEach((e=>{window.document.addEventListener(e,(e=>{(e.target instanceof HTMLScriptElement||e.target instanceof HTMLLinkElement||e.target instanceof HTMLImageElement||e.target instanceof HTMLIFrameElement)&&this.remove(e.target)}),{capture:!0})}))}))}}class A{constructor(){this.incrementAjaxCount=()=>{},this.decrementAjaxCount=()=>{},this.isIdle=()=>!0,this.didNetworkTimeOut=()=>!1,this.resetDidNetworkTimeOut=()=>{},this.subscribe=()=>()=>{}}}class H{constructor(){this.ajaxIdleObservable=new T,this.resourceLoadingIdleObservable=new R,this.subscribers=new Set,this.ajaxIdle=!0,this.scriptLoadingIdle=!0,this.handleUpdate=e=>t=>{const r=this.ajaxIdle&&this.scriptLoadingIdle;"AJAX"===e&&(this.ajaxIdle="IDLE"===t),"RESOURCE_LOADING"===e&&(this.scriptLoadingIdle="IDLE"===t);const n=this.ajaxIdle&&this.scriptLoadingIdle;r!==n&&this.next(n?"IDLE":"BUSY")},this.next=e=>{this.subscribers.forEach((t=>t(e)))},this.incrementAjaxCount=()=>this.ajaxIdleObservable.increment(),this.decrementAjaxCount=()=>this.ajaxIdleObservable.decrement(),this.isIdle=()=>this.ajaxIdle&&this.scriptLoadingIdle,this.didNetworkTimeOut=()=>this.ajaxIdleObservable.didNetworkTimeOut||this.resourceLoadingIdleObservable.didNetworkTimeOut,this.resetDidNetworkTimeOut=()=>{this.ajaxIdleObservable.didNetworkTimeOut=!1,this.resourceLoadingIdleObservable.didNetworkTimeOut=!1},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}},this.ajaxIdleObservable.subscribe(this.handleUpdate("AJAX")),this.resourceLoadingIdleObservable.subscribe(this.handleUpdate("RESOURCE_LOADING"))}}let C;const S=()=>n.isServerSide()||"undefined"==typeof window?new A:(C||(C=new H),C),I=S().incrementAjaxCount,k=S().decrementAjaxCount;function D(e){const t={};return e.forEach(((e,r)=>{t[r]=e})),t}class L{executeRpc(e,t,n,s,o,i){return new Promise(((a,u)=>{r.incrementAjaxCount(),I();const c=()=>{r.decrementAjaxCount(),k()};return fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{...t,"Content-Type":s},body:n,signal:o}).then((e=>e.text().then((t=>({response:e,responseText:t}))))).then((({response:e,responseText:t})=>{if(e.ok)return{response:e,responseText:t};throw new y(e,t)})).then((({response:e,responseText:t})=>(c(),a({headers:D(e.headers),result:JSON.parse(t)})))).catch((t=>(c(),E(t)?u(h.parseResponse(t.response.status,D(t.response.headers),t.message,e.getPath(),i)):u(h.parseResponse(0,{},"Fetch network failure - message aborted or user offline",e.getPath(),i)))))}))}executeBinaryRpc(e,t,n,s,o){return new Promise(((i,a)=>(r.incrementAjaxCount(),I(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{...t,"Content-Type":s},body:n,signal:o}).then((e=>e.ok?e.arrayBuffer().then((t=>({response:e,responseData:t}))):e.text().then((t=>{throw new y(e,t)})))).then((({response:e,responseData:t})=>i({headers:D(e.headers),result:t}))).catch((t=>E(t)?a(h.parseResponse(t.response.status,D(t.response.headers),t.message,e.getPath())):a(h.parseResponse(0,{},"Fetch network failure - message aborted or user offline",e.getPath())))).finally((()=>{r.decrementAjaxCount(),k()})))))}}function O(){return void 0!==n.getYapsProject()&&void 0!==n.getYapsDeployment()?`${n.getYapsProject()}:${n.getYapsDeployment()}`:void 0}const M=6e5,P=(e,t,r)=>Math.min(Math.max(e,t),r),N=(e,t)=>Math.round(e/t)*t,B=async e=>{const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),n=new DataView(r);return{hi:n.getUint32(0),lo:n.getUint32(4)}},j=e=>{const t=(new TextEncoder).encode(e);let r=2166136261;for(const e of t)r^=e,r=16777619*(r>>>0)>>>0;return r>>>0};class U{constructor(){this.buf=[]}u8(e){this.buf.push(255&e)}u32be(e){this.buf.push(e>>>24&255,e>>>16&255,e>>>8&255,255&e)}u64be(e){this.buf.push(e.hi>>>24&255,e.hi>>>16&255,e.hi>>>8&255,255&e.hi),this.buf.push(e.lo>>>24&255,e.lo>>>16&255,e.lo>>>8&255,255&e.lo)}varu(e){let t=e>>>0;for(;t>=128;)this.u8(127&t|128),t>>>=7;this.u8(t)}concat(e){this.buf.push(...e.finish())}finish(){return new Uint8Array(this.buf)}}var W;!function(e){e[e.PlatformHash=0]="PlatformHash",e[e.ArchHash=1]="ArchHash",e[e.BitnessEnum=2]="BitnessEnum",e[e.Mobile=3]="Mobile",e[e.Languages=4]="Languages",e[e.TimeZoneHash=5]="TimeZoneHash",e[e.LocaleHash=6]="LocaleHash",e[e.HWConcurrency=7]="HWConcurrency",e[e.DeviceMemoryGB=8]="DeviceMemoryGB",e[e.TouchBucket=9]="TouchBucket",e[e.Screen=10]="Screen",e[e.PrefersDark=11]="PrefersDark",e[e.ReducedMotion=12]="ReducedMotion",e[e.StorageBucket=13]="StorageBucket",e[e.WebGLVendorHash=14]="WebGLVendorHash",e[e.WebGLRendererHash=15]="WebGLRendererHash"}(W||(W={}));const F=()=>{var e;if("undefined"==typeof navigator)return;const t=navigator;return"string"==typeof(null===(e=null==t?void 0:t.userAgentData)||void 0===e?void 0:e.platform)?t.userAgentData.platform:t.platform},V=async()=>{var e,t,r;const n=navigator,s=await(async()=>{const e=navigator,t=null==e?void 0:e.userAgentData;if(null==t?void 0:t.getHighEntropyValues)try{const e=await t.getHighEntropyValues(["architecture","bitness","fullVersionList","platform"]);return{platform:e.platform,architecture:e.architecture,bitness:e.bitness}}catch{}return{}})(),o="undefined"!=typeof navigator&&Array.isArray(navigator.languages)?navigator.languages.slice(0,5):"undefined"!=typeof navigator&&navigator.language?[navigator.language]:[],i=(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return}})(),a=(()=>{try{return Intl.DateTimeFormat().resolvedOptions().locale}catch{return}})(),u="number"==typeof(null==n?void 0:n.hardwareConcurrency)?P(n.hardwareConcurrency,1,64):void 0,c="number"==typeof(null==n?void 0:n.deviceMemory)?n.deviceMemory:void 0,l="number"==typeof(null==n?void 0:n.maxTouchPoints)?n.maxTouchPoints:0,d="function"==typeof matchMedia?matchMedia("(prefers-color-scheme: dark)").matches:void 0,h="function"==typeof matchMedia?matchMedia("(prefers-reduced-motion: reduce)").matches:void 0;let p,m,f;try{const r=navigator,n=await(null===(t=null===(e=r.storage)||void 0===e?void 0:e.estimate)||void 0===t?void 0:t.call(e));p=(e=>{if("number"!=typeof e||!isFinite(e)||e<=0)return;const t=e/1024**3;return t<32?0:t<128?1:t<256?2:t<512?3:4})(null==n?void 0:n.quota)}catch{}try{const e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(t){const e=t.getExtension("WEBGL_debug_renderer_info");e?(m=t.getParameter(e.UNMASKED_VENDOR_WEBGL),f=t.getParameter(e.UNMASKED_RENDERER_WEBGL)):(m=t.getParameter(t.VENDOR),f=t.getParameter(t.RENDERER))}}catch{}const g=(()=>{if("undefined"==typeof screen)return;const e=screen,t=e.width,r=e.height,n=e.colorDepth,s="undefined"!=typeof window&&"number"==typeof window.devicePixelRatio?window.devicePixelRatio:1;return"number"==typeof t&&"number"==typeof r&&"number"==typeof n?{width:N(t,16),height:N(r,16),dpr10:Math.round(10*s),colorDepth:n}:void 0})();let w,b;"32"===s.bitness?w="32":"64"===s.bitness&&(w="64");try{b=!!(null===(r=null==n?void 0:n.userAgentData)||void 0===r?void 0:r.mobile)}catch{}return{platform:s.platform||F(),architecture:s.architecture,bitness:w,mobile:b,languages:o,timeZone:i,locale:a,hardwareConcurrency:u,deviceMemory:c,maxTouchPoints:l,screen:g,prefersDark:d,reducedMotion:h,storageBucket:p,webglVendor:m,webglRenderer:f}},q=async e=>{var t;let r=0;const n={};if(e.platform&&(n.platformHash=await B(e.platform),r|=1<<W.PlatformHash>>>0),e.architecture&&(n.archHash=await B(e.architecture),r|=1<<W.ArchHash>>>0),e.bitness&&(n.bitnessEnum="32"===e.bitness?1:2,r|=1<<W.BitnessEnum>>>0),"boolean"==typeof e.mobile&&(n.mobile=e.mobile?1:0,r|=1<<W.Mobile>>>0),null===(t=e.languages)||void 0===t?void 0:t.length){const t=e.languages.slice(0,5).map(j);n.languages=t,r|=1<<W.Languages>>>0}var s;e.timeZone&&(n.timeZoneHash=await B(e.timeZone),r|=1<<W.TimeZoneHash>>>0),e.locale&&(n.localeHash=j(e.locale),r|=1<<W.LocaleHash>>>0),"number"==typeof e.hardwareConcurrency&&(n.hw=P(e.hardwareConcurrency,1,64),r|=1<<W.HWConcurrency>>>0),"number"==typeof e.deviceMemory&&(n.mem=e.deviceMemory,r|=1<<W.DeviceMemoryGB>>>0),"number"==typeof e.maxTouchPoints&&(n.touch=(s=e.maxTouchPoints)>=5?3:s>=2?2:s>=1?1:0,r|=1<<W.TouchBucket>>>0),e.screen&&(n.screen={w:e.screen.width>>>0,h:e.screen.height>>>0,dpr10:P(e.screen.dpr10,1,100)>>>0,colorDepth:P(e.screen.colorDepth,1,48)>>>0},r|=1<<W.Screen>>>0),"boolean"==typeof e.prefersDark&&(n.prefersDark=e.prefersDark?1:0,r|=1<<W.PrefersDark>>>0),"boolean"==typeof e.reducedMotion&&(n.reducedMotion=e.reducedMotion?1:0,r|=1<<W.ReducedMotion>>>0),"number"==typeof e.storageBucket&&(n.storageBucket=e.storageBucket,r|=1<<W.StorageBucket>>>0),e.webglVendor&&(n.webglVendorHash=await B(e.webglVendor),r|=1<<W.WebGLVendorHash>>>0),e.webglRenderer&&(n.webglRendererHash=await B(e.webglRenderer),r|=1<<W.WebGLRendererHash>>>0);const o=new U;o.u8(1),o.u32be(r>>>0);const i=new U;if(void 0!==n.platformHash&&i.u64be(n.platformHash),void 0!==n.archHash&&i.u64be(n.archHash),void 0!==n.bitnessEnum&&i.u8(n.bitnessEnum),void 0!==n.mobile&&i.u8(n.mobile),n.languages){i.varu(n.languages.length);for(const e of n.languages)i.u32be(e)}void 0!==n.timeZoneHash&&i.u64be(n.timeZoneHash),void 0!==n.localeHash&&i.u32be(n.localeHash),void 0!==n.hw&&i.u8(n.hw),void 0!==n.mem&&i.u8(n.mem),void 0!==n.touch&&i.u8(n.touch),n.screen&&(i.varu(n.screen.w),i.varu(n.screen.h),i.u8(n.screen.dpr10),i.u8(n.screen.colorDepth)),void 0!==n.prefersDark&&i.u8(n.prefersDark),void 0!==n.reducedMotion&&i.u8(n.reducedMotion),void 0!==n.storageBucket&&i.u8(n.storageBucket),void 0!==n.webglVendorHash&&i.u64be(n.webglVendorHash),void 0!==n.webglRendererHash&&i.u64be(n.webglRendererHash);const a=new Uint8Array([...o.finish(),...i.finish()]);return u=a,btoa(String.fromCharCode(...u)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");var u},G=(()=>{let e=null,t=null;const r=()=>null!==e?Promise.resolve(e):(null!==t||(t=(async()=>{const r=await V(),n=await q(r);return e=n,t=null,n})()),t);return r.reset=()=>{e=null,t=null},r})(),z=e=>{try{const t=atob(e),r=JSON.parse(t);return r.exp?1e3*r.exp:null}catch{return null}},$=(()=>{let e=null,t=null;const r=r=>{if(null!==e&&t===r)return e;const n=M,s=12e5*Math.random()+n;return e=r-s,t=r,e};return r.reset=()=>{e=null,t=null},r})();let Y=!1,J=null;const Z=()=>{Y=!0,null!==J&&clearTimeout(J),J=setTimeout((()=>{Y=!1,J=null}),1e4)},Q={httpEndpoints:["https://iad.dropbox.com/dbz/health","https://dfw.dropbox.com/dbz/health","https://fra.dropbox.com/dbz/health","https://nrt.dropbox.com/dbz/health"],stunServers:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"],samplesPerEndpoint:10,enableWebRtc:!0,timeoutMs:3e4},X=e=>{if(0===e.length)return{mean:0,median:0,min:0,max:0,jitter:0,variance:0,count:0};let t=(e=>{if(e.length<4)return e;const t=[...e].sort(((e,t)=>e-t)),r=t.length,n=Math.floor(.25*r),s=Math.floor(.75*r),o=t[n],i=t[s],a=i-o,u=o-1.5*a,c=i+1.5*a,l=e.filter((e=>e>=u&&e<=c));return l.length<.5*e.length?e:l})(e);0===t.length&&(t=e);const r=[...t].sort(((e,t)=>e-t)),n=t.reduce(((e,t)=>e+t))/t.length,s=r[Math.floor(r.length/2)],o=r[0],i=r[r.length-1],a=t.reduce(((e,t)=>e+Math.pow(t-n,2)),0)/t.length,u=Math.sqrt(a);return{mean:n,median:s,min:o,max:i,jitter:u,variance:a,count:t.length}},K=async(e,t)=>new Promise(((r,n)=>{const s=[];let o=null;const i=()=>{o&&(o.close(),o=null)},a=setTimeout((()=>{i(),n(new Error("STUN measurement timeout"))}),t);try{const t=window.RTCPeerConnection;if(!t)throw new Error("RTCPeerConnection not available");o=new t({iceServers:[{urls:e}]});const u=performance.now();o.onicecandidate=e=>{if(e.candidate){const e=performance.now()-u;s.push(e)}else clearTimeout(a),i(),r(s)},o.onicegatheringstatechange=()=>{o&&"complete"===o.iceGatheringState&&(clearTimeout(a),i(),r(s))},o.createDataChannel("rtt-test"),o.createOffer().then((e=>null==o?void 0:o.setLocalDescription(e))).catch((e=>{clearTimeout(a),i(),n(e)}))}catch(e){clearTimeout(a),i(),n(e)}})),ee=async e=>{const t=`rtt_session_${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`,r=(await Promise.all(e.httpEndpoints.map((t=>(async(e,t,r)=>{const n=[];for(let s=0;s<t;s++){try{const t=new AbortController,s=setTimeout((()=>t.abort()),r),o=performance.now();await fetch(e,{method:"HEAD",mode:"no-cors",cache:"no-store",signal:t.signal});const i=performance.now();clearTimeout(s),n.push({endpoint:e,rtt:i-o,timestamp:o})}catch(e){}s<t-1&&await new Promise((e=>setTimeout(e,100)))}const s=n.map((e=>e.rtt));return{endpoint:e,measurements:n,statistics:X(s)}})(t,e.samplesPerEndpoint,e.timeoutMs))))).filter((e=>e.measurements.length>0));let s;e.enableWebRtc&&(s=await(async(e,t)=>{try{if(n.isServerSide()||"undefined"==typeof window||!window.RTCPeerConnection)return;const r=[],s=[];for(const n of e)try{const e=await K(n,t);e.length>0&&(r.push(...e),s.push(n))}catch(e){}if(0===r.length)return;const o=X(r);return{meanLatency:o.mean,jitter:o.jitter,pattern:r,servers:s,timestamp:Date.now()}}catch(e){return}})(e.stunServers,e.timeoutMs));return{sessionId:t,webrtc:s,http:r,browser:{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,hardwareConcurrency:navigator.hardwareConcurrency||0,screenResolution:`${screen.width}x${screen.height}`,timezone:(()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return"unknown"}})()},timestamp:Date.now(),version:"1.0"}},te=(()=>{let e=null,t=null,r=!1,n=null,s=0,o={};const i=()=>{r=!1,null!==n&&(clearTimeout(n),n=null)};return{shouldUpdate:()=>{if(r)return!1;const n=Date.now();if(null===e)return!0;const s=(null==t?void 0:t.retryInterval)||6e5;return n-e>=s},recordQualityAssessment:r=>{t=r,e=Date.now(),r.shouldSend?s=0:(s+=1,s>2&&(t.retryInterval=Math.min(2*r.retryInterval,48e4)))},updateFailurePatterns:(e,t)=>{t.httpEndpoints.forEach(((t,r)=>{const n=e.http[r];!!(n&&n.measurements.length>=3)||(o[t]=(o[t]||0)+1)})),e.webrtc&&e.webrtc.pattern.length},hasConsistentRestrictions:e=>{const t=Object.values(o).filter((e=>e>=4)).length,r=e.http.some((e=>!!(e&&e.measurements.length>=3)));return t>0&&r&&s>=4},setUpdateInProgress:()=>{r=!0,null!==n&&clearTimeout(n),n=setTimeout((()=>{r=!1,n=null}),12e4)},markUpdateComplete:()=>{r=!1,null!==n&&(clearTimeout(n),n=null)},clearUpdateInProgress:i,reset:()=>{e=null,t=null,s=0,o={},i()}}})(),re=async e=>{try{const t={...Q,...e},r=await ee(t);te.updateFailurePatterns(r,t);const n=((e,t)=>{const r=t.httpEndpoints.length,n=e.http.filter((e=>e.measurements.length>=3)).length,s=!!(e.webrtc&&e.webrtc.pattern.length>0),o=r>0?n/r:0,i={workingHttpEndpoints:n,totalHttpEndpoints:r,hasWebRtc:s,httpSuccessRate:o,expectedReliability:.6*o+(s?.25:0)+.15};return o>=.75?{shouldSend:!0,quality:"high",retryInterval:6e5,details:i}:o>=.5?s?{shouldSend:!0,quality:"medium",retryInterval:3e5,details:i}:te.hasConsistentRestrictions(e)?{shouldSend:!0,quality:"medium",retryInterval:12e5,details:i}:{shouldSend:!1,quality:"medium",retryInterval:12e4,details:i}:n>=1&&te.hasConsistentRestrictions(e)?{shouldSend:!0,quality:"low",retryInterval:15e5,details:i}:{shouldSend:!1,quality:"low",retryInterval:6e4,details:i}})(r,t),s={high:"QUALITY_HIGH",medium:"QUALITY_MEDIUM",low:"QUALITY_LOW"},o={...r,quality:s[n.quality]||"QUALITY_UNKNOWN"};if(te.recordQualityAssessment(n),!n.shouldSend)throw new Error(`Quality assessment: ${n.quality} quality signature, will retry in ${Math.round(n.retryInterval/6e4)} minutes`);await(async e=>{try{const t=await fetch("/verify_session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!t.ok)throw new Error(`Server responded with status: ${t.status}`);const r=await t.json();if("verified"===r.status);else if("session_verification_failed"===r.error)throw new Error("Device verification failed - session may have been reset")}catch(e){throw e}})(o),te.markUpdateComplete()}catch(e){throw te.clearUpdateInProgress(),e}},ne=()=>{if(oe(),(()=>{if(!Y)return;const e=s.Cookies.read("sjar-exists");if(!e)return;const t=z(e);if(!t)return;t-Date.now()>18e5&&(Y=!1,null!==J&&(clearTimeout(J),J=null))})(),Y)return!1;if(!s.Cookies.read("sid-exists"))return!1;const e=s.Cookies.read("sjar-exists"),t=Date.now();if(!e)return Z(),!0;const r=z(e);if(!r)return Z(),!0;if(r-t<=M)return Z(),!0;const n=t>=$(r);return n&&Z(),n},se=async()=>await G(),oe=e=>{s.Cookies.read("sid-exists")&&te.shouldUpdate()&&(te.setUpdateInProgress(),re(e).catch((e=>{o.reportException({err:e,tags:["rtt_device_binding","background_update"],severity:o.SEVERITY.NONCRITICAL})})))};class ie extends L{}class ae{constructor(e,t=!1){this.uploadEndpoints=new Set(["backups/upload_session/append","files/alpha/upload","files/paper/create","files/paper/update","files/upload","files/upload_v2","files/upload_session/append_v2","files/upload_session/append_batch","files/upload_session/finish","files/upload_session/finish_v2","files/upload_session/start","paper/cloud_docs/update","paper/desktop/spaces/upload_log","paper/desktop/upload_log","paper/docs/create","paper/docs/update","support_attachments/upload","hellosign/self_sign","hellosign/send_signature_request","ungated_file_conv_block/convert_to_pdf"]),this.downloadEndpoints=new Set(["backups/download","backups/download_zip","files/download","files/download_zip","files/export","files/get_preview","files/get_thumbnail_v2","paper/docs/download","sharing/get_shared_link_file","sharing/export_shared_link","hellosign/convert_to_pdf_download","privacy_request/fs_user_get_export"]),this.supportedUploadEndpoints=new Set(["backups/upload_session/append","files/paper/create","files/paper/update","files/upload","files/upload_v2","files/upload_session/append_v2","files/upload_session/append_batch","files/upload_session/finish","files/upload_session/finish_v2","files/upload_session/start","paper/cloud_docs/update","paper/desktop/spaces/upload_log","paper/desktop/upload_log","paper/docs/create","paper/docs/update","support_attachments/upload","hellosign/self_sign","hellosign/send_signature_request","ungated_file_conv_block/convert_to_pdf"]),this.supportedDownloadEndpoints=new Set(["backups/download","backups/download_zip","files/download","files/get_thumbnail_v2","sharing/get_shared_link_file","sharing/export_shared_link","hellosign/convert_to_pdf_download","privacy_request/fs_user_get_export"]),this.transport=e||new ie,this.ns=ue.bind(this),this.skipCsrf=t}_upload(e,t,r,n){return this._uploadWithResponseHeaders(e,t,r,n).then((e=>e.result))}_uploadWithResponseHeaders(t,r,n,s){if(!this.uploadEndpoints.has(t))throw new Error(t+" does not use the content-upload endpoint format");if(!this.supportedUploadEndpoints.has(t))throw new Error(t+" is not in the supported list of content-upload endpoints");return this.sessionRefreshHeaders().then((o=>{const i={...this.csrfHeaders(),...o,[e.ApiV2HeaderNames.DropboxApiArg]:this.http_header_safe_json(r),...this._headers(s)};if("string"==typeof n||void 0===n)return this.executeRpc(t,i,n||"","application/octet-stream",s.signal);{const e=new Blob([n],{type:"application/octet-stream"});return this.executeRpc(t,i,e,"application/octet-stream",s.signal)}}))}_download(e,t,r,n){return this._downloadWithResponseHeaders(e,t,r,n).then((e=>e.result))}_downloadWithResponseHeaders(t,r,n,s){if(void 0===s||!s.hasOwnProperty("dangerouslyFetchUserContent")||!s.dangerouslyFetchUserContent)throw new Error("download requires explicit acknowledgement of the risk");if(!this.downloadEndpoints.has(t))throw new Error(t+" does not use the content-download endpoint format");if(!this.supportedDownloadEndpoints.has(t))throw new Error(t+" is not in the supported list of content-download endpoints");return this.sessionRefreshHeaders().then((s=>{const o={...this.csrfHeaders(),...s,[e.ApiV2HeaderNames.DropboxApiArg]:this.http_header_safe_json(r),...this._headers(n)};return this.executeBinaryRpc(t,o,"","application/octet-stream",n.signal)}))}_rpc(e,t,r,n){return this._rpcWithResponseHeaders(e,t,r,n).then((e=>e.result))}_rpcWithResponseHeaders(e,t,r,n){if(this.downloadEndpoints.has(e))throw new Error(e+' does not use the rpc endpoint format. Use "download" instead');if(this.uploadEndpoints.has(e))throw new Error(e+' does not use the rpc endpoint format. Use "upload" instead');return this.sessionRefreshHeaders().then((s=>{const o={...this.csrfHeaders(),...s,...this._headers(r)},i=JSON.stringify(t||null);return this.executeRpc(e,o,i,"application/json",r.signal,n)}))}csrfHeaders(){return this.skipCsrf||n.getPageAuthChannel()===n.AuthChannel.OAUTH_TOKEN?{}:{[e.ApiV2HeaderNames.CsrfToken]:s.mustReadCsrfToken()}}async sessionRefreshHeaders(){if(ne())try{const t=await se();return{[e.ApiV2HeaderNames.DropboxRefreshSession]:t}}catch(e){return o.reportException({err:new Error(`Unexpected error generating fingerprint header: ${e}`),severity:o.SEVERITY.NONCRITICAL,tags:["usc"]}),{}}return{}}async executeRpc(e,r,n,o,i,a){const u=window.location.hostname===t.getDomains().CLIENT_WEB_WEBSERVER?t.getDomains().CLIENT_WEB_WEBSERVER:t.getDomains().WEBSERVER;const c=O();c&&(r["x-dropbox-client-yaps-attribution"]=c);const l=new s.URI({scheme:"https",authority:u,path:"/2/"+e,query:undefined});return await this.transport.executeRpc(l,r,n,o,i,a)}async executeBinaryRpc(e,r,n,o,i){const a=window.location.hostname===t.getDomains().CLIENT_WEB_WEBSERVER?t.getDomains().CLIENT_WEB_WEBSERVER:t.getDomains().WEBSERVER;const u=new s.URI({scheme:"https",authority:a,path:"/2/"+e,query:undefined});return await this.transport.executeBinaryRpc(u,r,n,o,i)}http_header_safe_json(e){return JSON.stringify(e).replace(/[\u007f-\uffff]/g,(function(e){return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)}))}}function ue(e){const t=this,r=(new Error).stack;return{rpc:function(n,s,o){return t._rpc(e+"/"+n,s,o,r)},rpcWithResponseHeaders:function(n,s,o){return t._rpcWithResponseHeaders(e+"/"+n,s,o,r)},upload:function(r,n,s,o){return t._upload(e+"/"+r,n,s,o)},uploadWithResponseHeaders:function(r,n,s,o){return t._uploadWithResponseHeaders(e+"/"+r,n,s,o)},download:function(r,n,s,o){return t._download(e+"/"+r,n,s,o)},downloadWithResponseHeaders:function(r,n,s,o){return t._downloadWithResponseHeaders(e+"/"+r,n,s,o)}}}var ce=Object.freeze({__proto__:null,UnAuthedApiV2Client:class extends ae{constructor(e){super(e,!0)}_headers(e){return{...e.headers}}}});e.ApiError=h,e.ApiV2ClientBase=ae,e.AppError=m,e.CONFIG=x,e.FetchAbortError=v,e.FetchAsyncTransport=L,e.FetchFailError=_,e.FetchResponseError=y,e.FetchSyncTransport=class{executeRpc(e,t,n,s,o){return r.incrementAjaxCount(),I(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{...t,"Content-Type":s},keepalive:!0,body:n,signal:o}).finally((()=>{r.decrementAjaxCount(),k()})),Promise.resolve({headers:{},result:{}})}executeBinaryRpc(e,t,n,s,o){return r.incrementAjaxCount(),I(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{...t,"Content-Type":s},keepalive:!0,body:n,signal:o}).finally((()=>{r.decrementAjaxCount(),k()})),Promise.resolve({headers:{},result:new ArrayBuffer(0)})}},e.RateLimitError=g,e.ServerError=f,e.Union=c,e.UnionScalar=l,e.catchApiError=function(e){return function(t){if(w(t))return e(t);throw t}},e.decrementAjaxCount=k,e.errorIsFetchAbortError=function(e){return"FetchAbortError"===e.name},e.errorIsFetchFailError=function(e){return"FetchFailError"===e.name},e.errorIsFetchResponseError=E,e.filterApiError=e=>e instanceof h?e:void 0,e.generateFingerprintHeader=se,e.getAttributionHeader=O,e.getNetworkIdleObservable=S,e.incrementAjaxCount=I,e.isApiError=w,e.isAppError=function(e){return e instanceof m},e.isAuthError=function(e){return e instanceof p},e.isRateLimitError=function(e){return e instanceof g},e.isServerError=function(e){return e instanceof f},e.shouldRefreshSession=ne,e.unauthed_client_esnext=ce}));
//# sourceMappingURL=c_api_v2_unauthed_client.js-vfl4WGkxj.map

//# debugId=08a35ded-8981-3a28-9794-daafeac4a894