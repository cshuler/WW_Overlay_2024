!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9aca4aa7-7278-334e-8719-0f9cbb2e2e75")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_file","./c_extensions_open_button_utils","./c_core_i18n","./c_ui_sprite","./c_memoize-one","./c_dig-icons_assets_ui-icon_line_undo","./c_dig-icons_assets_ui-icon_line_stacks","./c_dig-icons_assets_ui-icon_line_admin-console","./e_edison","./c_api_v2_routes_password_confirmation_provider","./c_dotlottie_common_chunk-B7OIQIGJ","./e_core_exception","./c_init_data_edison","./c_hive_schemas_sharing-request_access_user_events","./c_src_sink_index","./c_lodash-es_lodash","./c_pap-events_navigation_select_create_folder_action","./c_api_v2_routes_restorations_provider","./e_data_modules_stormcrow","./c_react-use_misc_util","./c_api_v2_unauthed_client","./c_watermarking_utils_getImageDefaultSizes","./c_core_notify","react-dom","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_bem","react/jsx-runtime","./c_spectrum_modal_utility_modal","./c_spectrum_button","./c_spectrum_tertiary_link","./c_icon_templates_actionable_index","./c_spectrum_svg_icon_bundle","./c_spectrum_icon_form_index","./c_icon_templates_stateless_index","./c_ui_image","./c_dig-icons_assets_ui-icon_line_upload","metaserver/static/js/langpack"],(function(e,t,n,o,i,s,r,c,a,l,p,u,d,_,m,A,f,h,I,g,O,y,E,w,v,x,C,S,k,U,b,F,M,B,L,D,T,H,N,W){"use strict";function V(e){return e&&e.__esModule?e:{default:e}}var R=V(t);class P extends R.default.Component{constructor(e){super(e),this.handleMouseOver=()=>{clearTimeout(this.timer),this.timer=setTimeout((()=>{this.props.bylines&&(this.setState({show:!0}),this.props.onDidShow())}),this.props.delay)},this.handleMouseOut=()=>{this.setState({show:!1}),clearTimeout(this.timer)},this.triggerRef=R.default.createRef(),this.state={show:!1}}componentWillUnmount(){clearTimeout(this.timer)}render(){const{children:e,bylines:t,isInActionBar:o}=this.props,i=R.default.Children.only(e);return t?R.default.createElement(R.default.Fragment,null,R.default.createElement(n.Tooltip.Control,{triggerRef:this.triggerRef,open:this.state.show,placement:o?"right":"left"},(e=>{if(e)return e.length>1?R.default.createElement("ul",{className:"extensions-byline-list"},e.map((e=>R.default.createElement("li",{key:e,className:"extensions-byline-list-item"},e)))):R.default.createElement("div",{className:"extensions-byline"},e[0])})(t)),R.default.cloneElement(i,{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,ref:this.triggerRef})):i}}P.defaultProps={delay:500},P.displayName="ExtensionsBylineTooltip";class q extends R.default.Component{render(){const{unityOptions:e,legacyCloudEditorOptions:t,cloudEditorAppActions:i,bylines:a,currentSession:l,previewOption:p,openInReplayOption:u,openInDesktopOption:d,isInActionBar:_,goToFolderOption:m,wrapValuesForActionBar:A,openInNewTabOption:f,openInQuickViewOption:h}=this.props,I=e=>A?o.toActionBarValue(e):e,g=t.map((e=>{const{type:t}=e,o=t===n.OpenButtonAction.OPEN_WITH_CLOUD_DOC?"cloud_doc":"wopi";return R.default.createElement(n.Menu.ActionItem,{key:e.text,value:I(e),withLeftAccessory:e.spriteName?R.default.createElement(s.Sprite,{group:"web",name:e.spriteName,alt:""}):R.default.createElement("img",{alt:"",src:e.iconUrl,width:24,height:24})},R.default.createElement(P,{isInActionBar:_,bylines:a[o],onDidShow:n.handleShowByline(o,l),key:e.text},R.default.createElement("span",null,e.text)))})),O=e.map((e=>R.default.createElement(n.Menu.ActionItem,{key:e.text,value:I(e),withLeftAccessory:function(e){return"ow_desktop"===e.spriteName&&e.type===n.OpenButtonAction.UNITY_FILE?-1!==e.text.indexOf("Dropbox")?R.default.createElement(n.UIIcon,{src:n.DropboxLine}):R.default.createElement(n.UIIcon,{src:n.OpenLine}):R.default.createElement(s.Sprite,{group:"web",name:e.spriteName||"",alt:""})}(e)},e.text)));let y=!1;const E=i.map((e=>{y||(y=o.isWopiAction(e.appAction));const t=e.appAction.handler.editor_name;return R.default.createElement(n.Menu.ActionItem,{key:e.appAction.description,value:I(e),withLeftAccessory:R.default.createElement("img",{alt:"",src:e.appAction.icon.url,width:24,height:24})},R.default.createElement(P,{isInActionBar:_,bylines:a[t],onDidShow:n.handleShowByline(t,l),key:e.appAction.description},R.default.createElement("span",null,e.appAction.description)))})),w=p&&R.default.createElement(n.Menu.ActionItem,{key:p.text,value:I(p),withLeftAccessory:R.default.createElement(n.UIIcon,{src:n.ShowLine})},p.text),v=u&&R.default.createElement(n.Menu.ActionItem,{key:u.text,value:I(u),withLeftAccessory:R.default.createElement(n.UIIcon,{src:n.DropboxReplayLine})},u.text),x=d&&R.default.createElement(n.Menu.ActionItem,{key:d.text,value:I(d),withLeftAccessory:R.default.createElement(n.UIIcon,{src:r.mac?n.FinderLine:n.FileExplorerLine})},d.text),C=f&&R.default.createElement(n.Menu.ActionItem,{key:f.text,value:I(f),withLeftAccessory:R.default.createElement(n.UIIcon,{src:n.GlobeLine})},f.text),S=m&&R.default.createElement(n.Menu.ActionItem,{key:m.text,value:I(m),withLeftAccessory:R.default.createElement(n.UIIcon,{src:c.FolderShowLine})},m.text),k=h&&R.default.createElement(n.Menu.ActionItem,{key:h.text,value:I(h),withLeftAccessory:R.default.createElement(n.UIIcon,{src:c.SidebarShowRightLine})},h.text),U=O.length>0||g.length>0||E.length>0||!!C||!!w||!!v||!!x||!!S||!!k;return y?U&&R.default.createElement(n.Menu.Segment,{key:"open-options"},E,C,S,O,g,w,k,v,x):U&&R.default.createElement(n.Menu.Segment,{key:"open-options"},C,S,O,g,E,w,k,v,x)}}q.displayName="UnityAndCloudEditorsComponent";const K=n.requireCssWithComponent(q,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css","/static/metaserver/static/css/dig-components/index.web-vflumqaCO.css"]);class Q extends R.default.Component{constructor(e){super(e),this.createAppActionClickHandler=e=>()=>{var t,i;const{file:s,user:r,featureFlags:c,telemetryContext:a}=this.props;if(o.redirectToActionOrShowAuth(r,[s],e,c,a,void 0),"redirect"===e.handler[".tag"]){const t=n.getAppActionExtras(e);n.logEvent$2(this.props.currentSession,"select_action",{menu_version:2,...t})}else if("cloud_editor"===e.handler[".tag"]){const t={};o.isWopiAction(e)?(t.type=n.OpenButtonAction.OPEN_WITH,t.userAction=n.OpenInUserAction.OpenInOfficeOnline):t.type=n.OpenButtonAction.OPEN_WITH_CLOUD_DOC,n.logEvent$2(this.props.currentSession,"select_legacy_action",t)}null===(i=(t=this.props).onExtensionClick)||void 0===i||i.call(t,e)},this.wrapperForAction=e=>({appAction:e,handler:this.createAppActionClickHandler(e),userAction:n.OpenInUserAction.OpenWithAppAction,actionName:e.description}),this.renderActionRow=e=>{const t=e.icon;let i;i=t.is_static?o.genericAppIcon:t.url;const s=e.description,r=this.props.isInActionBar?o.toActionBarValue(this.wrapperForAction(e)):this.wrapperForAction(e);return R.default.createElement(n.Menu.ActionItem,{key:e.id,value:r,withLeftAccessory:R.default.createElement("img",{alt:"",src:i,width:24,height:24})},s)},this.renderUnpromotedActions=(e,t)=>{const{user:s,file:r,categoryIdToInfos:c,featureFlags:l,currentSession:p,telemetryContext:u,isInActionBar:d}=this.props,_=e.length>0,m={handler:()=>{const a=[...e,...t];o.showExtensionsMiniDirectoryModal(i.intl.formatMessage({id:"KVD2SP",defaultMessage:"Open or edit with these apps"}),s,r,a,c,l,u,p,void 0),n.logEvent$2(p,_?"select_show_more":"select_add_app",{surface:u&&u.surface,userAction:_?n.OpenInUserAction.OpenMoreApps:n.OpenInUserAction.OpenAddApps})}},A=d?o.toActionBarValue(m):m;return R.default.createElement(n.Menu.ActionItem,{key:i.intl.formatMessage({id:"R/67N/",defaultMessage:"Show more"}),value:A,withLeftAccessory:_&&!d?null:R.default.createElement(n.UIIcon,{src:a.AddCircleLine})},_?i.intl.formatMessage({id:"Gevpqz",defaultMessage:"Connect more apps"}):i.intl.formatMessage({id:"XFA09U",defaultMessage:"Connect apps"}))}}render(){const{appActions:e,openOptions:t,bylines:i,currentSession:s,isInActionBar:r}=this.props,c=n.getOpenOptionsWithLogging(t,s),{unityOptions:a,cloudEditorOptions:p,previewOption:u,openInReplayOption:d,openInDesktopOption:_,goToFolderOption:m,openInNewTabOption:A,openInQuickViewOption:f,installDropboxAppOption:h,manageAsAdminOption:I}=n.partitionOptions(c),{cloudEditors:g,installedActions:O,unpromotedActions:y}=n.partitionActions(e),E=O.length>0,w=y.length>0,v=e=>r?o.toActionBarValue(e):e;return R.default.createElement(R.default.Fragment,null,h&&R.default.createElement(n.Menu.Segment,{withLabel:h.withLabel},R.default.createElement(n.Menu.ActionItem,{key:h.text,value:v(h),withLeftAccessory:R.default.createElement(n.UIIcon,{src:n.DownloadLine})},h.text)),R.default.createElement(K,{isInActionBar:r,unityOptions:a,legacyCloudEditorOptions:p,cloudEditorAppActions:g.map((e=>this.wrapperForAction(e))),bylines:i,currentSession:s,previewOption:u,openInReplayOption:d,openInNewTabOption:A,openInDesktopOption:_,goToFolderOption:m,openInQuickViewOption:f,wrapValuesForActionBar:!!r}),I&&R.default.createElement(n.Menu.Segment,null,R.default.createElement(n.Menu.ActionItem,{key:I.text,value:v(I),withLeftAccessory:R.default.createElement(n.UIIcon,{src:l.AdminConsoleLine})},I.text)),r&&(E||w)&&R.default.createElement(n.Menu.Segment,null,O.map((e=>this.renderActionRow(e))),this.renderUnpromotedActions(O,y)),!r&&E&&R.default.createElement(n.Menu.Segment,{key:"installed-actions"},O.map((e=>this.renderActionRow(e)))),!r&&w&&R.default.createElement(n.Menu.Segment,null,this.renderUnpromotedActions(O,y)))}}Q.displayName="BrowseFilePopoverContentComponent";const $=n.requireCssWithComponent(Q,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css"]);class G extends R.default.Component{constructor(e){super(e),this.createActionClickHandler=e=>()=>{if("cloud_editor"===e.handler[".tag"]){const t=e.handler.editor_name;if(n.isOfficeOnlineEditor(t))return n.openWithOfficeOnline({fileId:this.props.file.file_id,editor:t,source:"open_with_button",surface:"shared_file_popover_content"}),void n.logEvent$2(this.props.currentSession,"select_legacy_action",{type:n.OpenButtonAction.OPEN_WITH});n.UDCL.logEvent("cloud_docs/logic_cleanup",{tags:{editor:t,function:"shared_file_popover_content_component"}});const i=o.isWopiAction(e)?n.OpenButtonAction.OPEN_WITH:n.OpenButtonAction.OPEN_WITH_CLOUD_DOC;n.logEvent$2(this.props.currentSession,"select_legacy_action",{type:i});const s=n.UserActionSourceType.WEB_PREVIEW,r=o.cloudEditorNameToParams(t);n.openWithCloudEditor(n.fileToOpenWithParams(this.props.file),this.props.user,r,!1,s)}}}render(){if(0===this.props.openOptions.length&&0===this.props.cloudEditorAppActions.length)return null;const e=this.props.cloudEditorAppActions.map((e=>({appAction:e,handler:this.createActionClickHandler(e),userAction:n.OpenInUserAction.OpenWithAppAction,actionName:e.description})));return R.default.createElement(K,{unityOptions:[],legacyCloudEditorOptions:this.props.openOptions,cloudEditorAppActions:e,bylines:{},wrapValuesForActionBar:!!this.props.isInActionBar})}}G.displayName="SharedFilePopoverContentComponent";const j=n.requireCssWithComponent(G,["/static/metaserver/static/css/app_actions/index-vflR8Wunv.css"]),z=e=>{const{file:t,user:i,telemetryContext:s,extraOptions:r,isInActionBar:c,previewActionHandler:a,openDesktopActionHandler:l,goToFolderActionHandler:p,replayActionHandler:u,openInNewTabActionHandler:d,quickViewActionHandler:_,onExtensionClick:m,installDropboxAppActionHandler:A,manageAsAdminActionHandler:f}=e,h=n.useAppActions().data,I=n.getOpenActionsForFile(h.actions,t),g=n.parseActionsForUserResult(h),O=g.bylines,y=h.category_infos,E=g.featureFlags,w=n.useUnity(t,i),v=o.getCategoryIdToInfos(y),x=o.getOpenOptionsForFile({file:t,unityInfo:w,extraOptions:r,user:i,isInActionBar:c,previewActionHandler:a,openDesktopActionHandler:l,goToFolderActionHandler:p,replayActionHandler:u,openInNewTabActionHandler:d,quickViewActionHandler:_,installDropboxAppActionHandler:A,manageAsAdminActionHandler:f}),C=s&&(e.currentSession||n.createTelemetryClient({component:"menu_v2"}).session({surface:s.surface,ext:n.getPiiSafeExtension(n.getFileExt(t)||""),feature_flags:E}));if(n.isBrowseFile(t)&&I&&(I.length>0||x.length>0))return R.default.createElement($,{file:t,user:i,openOptions:x,appActions:I,bylines:O,categoryIdToInfos:v,featureFlags:E,telemetryContext:s,currentSession:C,isInActionBar:c,onExtensionClick:m});if(n.isSharedFile(t)){const{cloudEditors:e}=n.partitionActions(I||[]);return R.default.createElement(j,{openOptions:x,cloudEditorAppActions:e,file:t,user:i,currentSession:C,isInActionBar:c})}return null};z.displayName="ExtensionsPopoverContent";const J=new Set([".pptx",".docx",".xlsx",".ppt",".doc",".xls"]),X="open_in_install_desktop_app",Y="previews",Z="preview_toolbar",ee=()=>{window.open("https://www.dropbox.com/downloading?_tk=open_in_explorer_install_dc","_blank")},te={[n.OpenInUserAction.OpenInUnityFolder]:"desktop_folder",[n.OpenInUserAction.OpenInUnity]:"desktop_preview",[n.OpenInUserAction.OpenInReplay]:"replay_preview",[n.OpenInUserAction.PreviewFile]:"web_preview",[n.OpenInUserAction.OpenInDesktop]:"desktop_file",[n.OpenInUserAction.OpenMoreApps]:"connect_more_apps",[n.OpenInUserAction.OpenAddApps]:"connect_apps",[n.OpenInUserAction.OpenInOfficeOnline]:"office_online",[n.OpenInUserAction.InstallDropboxApp]:"downloading_page"},ne={surface:"previews"},oe=({actionContext:e,file:t,user:o,surface:i})=>{const{logUserAction:s,loggingSessionId:r}=n.useFileViewerContext(),c=n.useReplayActionHandler(t),{variant:a}=n.useExperimentVariant("open_in_explorer_install_dc"),l=((e,t,o,i)=>{if(!t||t===n.Variant.OFF)return!1;const s=`.${n.getExtension(e)}`,r=J.has(s),c=i!==n.SDKPreviewSurface.QUICK_VIEW_BROWSE&&i!==n.SDKPreviewSurface.QUICK_VIEW_SEARCH;return r&&!(e instanceof n.FileSharedWithMe)&&n.isLiveFile(e)&&n.isBrowseFile(e)&&!n.isEncryptedFile(e)&&c})(t,a,0,i);n.useLogExposureOnce("open_in_explorer_install_dc",!l);const p=((e,t)=>{if(t===n.Variant.V1&&e)return ee})(l,a);R.default.useEffect((()=>{p&&(e=>{const t=n.getExtension(e),o=t.startsWith(".")?t.slice(1):t,i=n.getFileTypeFromString(o);n.UDCL.logEvent({class:"navigation",action:"shown",object:"content_action_upsell",properties:{contentAction:X,actionSurface:Y,actionElement:Z,fileType:i,upsellVariant:"v1"}},{tags:{content_action:X,action_surface:Y,action_element:Z,...i&&{file_type:i},upsell_variant:"v1"}})})(t)}),[p,t]);const u=R.default.useMemo((()=>({sessionId:r,event:(t,o)=>{var r;if("show_byline"===t)return;const c="string"==typeof(null==o?void 0:o.userAction)?o.userAction:"",a=null!==(r=te[c])&&void 0!==r?r:"third_party_app";let l="previews";i===n.SDKPreviewSurface.QUICK_VIEW_BROWSE?l="browse_quick_view":i===n.SDKPreviewSurface.QUICK_VIEW_SEARCH&&(l="search_quick_view"),s(n.UserAction.OpenIn,e,{...o,destination_surface:a,actionSurface:l})}})),[e,s,r,i]);return R.default.createElement(z,{key:"open-in-action-btn",file:t,user:o,isInActionBar:!0,openDesktopActionHandler:n.makeOpenInDesktopHandler(t,o),replayActionHandler:c,installDropboxAppActionHandler:p,currentSession:u,telemetryContext:ne})};oe.displayName="OpenInMenuContent";const ie=n.withActionCondition(n.openInActionConditions,((e,t)=>t?{icon:n.OpenLine,label:n.OPEN_IN_ACTION_STRING,disabled:{disabled:!1},userAction:n.UserAction.OpenIn,action:{type:"menu",menu:R.default.createElement(oe,{user:e.user,file:e.file,actionContext:n.UserActionContext.FileMenu})}}:void 0),void 0);e.OpenInMenuContent=oe,e.makeOpenInAction=ie}));
//# sourceMappingURL=c_action_plugins_open_in_action_dropdown.js-vflFWg6Za.map

//# debugId=9aca4aa7-7278-334e-8719-0f9cbb2e2e75