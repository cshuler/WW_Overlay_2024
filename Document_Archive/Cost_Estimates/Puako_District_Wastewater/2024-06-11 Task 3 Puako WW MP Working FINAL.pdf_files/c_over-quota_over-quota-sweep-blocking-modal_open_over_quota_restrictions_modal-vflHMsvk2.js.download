!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="87d40147-f9d3-3d9d-b0de-3183122fe803")}catch(e){}}();
define(["require","exports","react","./e_file_viewer_static_scl_page_file","./e_data_modules_stormcrow","./c_over-quota_utils_use_get_plans","./c_core_i18n","./c_growth-components_auto-layout-modal_auto_layout_modal","./c_growth-components_over-quota-file-viewer-modal","./c_over-quota_utils_oq_price_decrease_helper","./c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal_logger","./e_edison","./c_api_v2_routes_password_confirmation_provider","./c_dotlottie_common_chunk-B7OIQIGJ","./e_core_exception","./c_memoize-one","./c_init_data_edison","./c_hive_schemas_sharing-request_access_user_events","./c_src_sink_index","./c_lodash-es_lodash","./c_pap-events_navigation_select_create_folder_action","./c_api_v2_routes_restorations_provider","./c_api_v2_unauthed_client","./c_watermarking_utils_getImageDefaultSizes","./c_core_notify","react-dom","./c_react-use_misc_util","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_bem","react/jsx-runtime","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_dig-icons_assets_ui-icon_line_tag","./c_trial-cards_trial-plan-card","./c_dig-components_meter_index","./c_react-hookz_web_useRafCallback","metaserver/static/js/langpack","./c_custom_campaigns_out_of_space_modal_out_of_space_checkout_modal_logger"],(function(e,o,t,a,n,l,i,r,s,_,c,u,d,v,m,p,f,g,w,C,O,h,P,M,S,q,k,b,E,y,I,L,T,R,A,D,U,N,x){"use strict";function Q(e){return e&&e.__esModule?e:{default:e}}var V=Q(t);const F="OVER_QUOTA_RESTRICTIONS_MODAL",W=({action:o,continueCallback:n,abortCallback:u,filePreview:d,fileName:v,downloadFileHandler:m})=>{var p,f,g,w,C,O,h,P,M,S;const[q,k]=V.default.useState(!1),{user:b}=a.useActiveUser(),{quotaUpsellInfo:E,isLoadingQuotaUpsellInfo:y}=a.useQuotaUpsellInfo(b),{shouldUseSmallSkus:I,shouldUseHeavyDiscount:L}=_.useOverquotaPriceDecrease(b),{plansInfo:T,isLoadingPlansInfo:R}=l.useGetPlans({planNames:["basic","plus"],revenueContentLocation:L?"oq_heavy_discount_modal":"oq_restrictions_modal"}),{plansInfo:A,isLoadingPlansInfo:D}=l.useGetPlans({planNames:["basic","basic500"],revenueContentLocation:"oq_smaller_skus_modal"}),U=I?A:T,N=I?D:R,x=t.useRef(!1),Q="ON"===a.useExperimentVariant("overquota_glide_modal").variant,W=(null===(p=null==E?void 0:E.quota)||void 0===p?void 0:p.used)||0,B=l.getViewMode(o),[G,H]=V.default.useState(window.innerWidth<=l.OVER_QUOTA_RESTRICTIONS_MODAL_MIN_WIDTH_DESKTOP);V.default.useLayoutEffect((()=>{function e(){H(window.innerWidth<=l.OVER_QUOTA_RESTRICTIONS_MODAL_MIN_WIDTH_DESKTOP)}return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);const z=(null===(w=null===(g=null===(f=null==E?void 0:E.quota)||void 0===f?void 0:f.allocation)||void 0===g?void 0:g.individual)||void 0===w?void 0:w.allocated)||0,K=B!==l.ViewMode.UploadOrCreate&&((null===(C=null==E?void 0:E.restrictions)||void 0===C?void 0:C.show_restrictions_warning)||!1),j=void 0!==(null===(O=null==E?void 0:E.quota)||void 0===O?void 0:O.used)&&void 0!==(null===(h=null==T?void 0:T.PLUS)||void 0===h?void 0:h.quota_bytes)&&E.quota.used<T.PLUS.quota_bytes,J=a.getOverQuotaReason(null==E?void 0:E.overquota_reason),X=null!==(P=_.getOrganicOrChurnedFromString(J))&&void 0!==P?P:"unlabeled",Y=null===(M=null==E?void 0:E.restrictions)||void 0===M?void 0:M.overquota_start_time_utc_seconds,Z=Y?Date.now()/1e3-Y:void 0,$=(null===(S=null==E?void 0:E.restrictions)||void 0===S?void 0:S.show_restrictions_warning)&&!!Y&&0!==Y,ee=I?"dropbox500":U&&j?"plus":"none",oe=t.useMemo((()=>({overQuotaSweepBlockingModalAction:o,quotaLimit:z,quotaUsed:W,organicOrChurned:X,secondsOverquota:Z,hardblocked:!K,planShown:ee,restrictionsStartDateShown:$})),[z,W,X,Z,K,o,U,j,$]);if(t.useEffect((()=>{N||y||x.current||(c.logShownOverquotaRestrictionsModal(oe),x.current=!0)}),[oe,N,y]),t.useEffect((()=>{N||y||x.current||(new Promise((function(o,t){e(["./c_custom_campaigns_out_of_space_modal_out_of_space_modal_doorman_wrapper"],o,t)})),new Promise((function(o,t){e(["./c_checkout_components_portable_checkout_frame"],o,t)})).then((function(e){return e.portable_checkout_frame_esnext})))}),[N,y]),N||y)return null;const te=()=>{c.logSelectOverquotaRestrictionsModal("view_plans",oe),Q?(k(!0),a.openDoormanUpsellModal({modalVersion:"glide-upsell-modal-dp-only",trialCardsLocation:a.TrialCardsLocation.OVERQUOTA_RESTRICTIONS_MODAL,reloadPageAfterPurchase:!0,onClose:()=>{K?n():u()},onDisplayed:()=>{a.unmountModal(void 0,F),k(!1)}})):(u(),a.redirect("/out-of-space?_tk=oq_restrictions_modal"),a.unmountModal(void 0,F))},ae=()=>{c.logSelectOverquotaRestrictionsModal("manage_files",oe),a.redirect("/home?_tk=oq_restrictions_modal&pathway=download_and_delete_tooltip_tour&sort_by_size_desc=true"),u(),a.unmountModal(void 0,F)};let ne;m&&(ne=()=>{c.logSelectOverquotaRestrictionsModal("download_file",oe),null==m||m()});if(B===l.ViewMode.Preview&&!K&&!j&&!G)return V.default.createElement(i.Provider,{value:i.intl},V.default.createElement(s.OverQuotaFileViewerModal,{open:!0,onClose:()=>{n(),a.unmountModal(void 0,F)},headerText:l.PREVIEW_TITLE(v||""),bodyText:l.OVER_QUOTA_DELETION_WARNING(a.format_bytes(i.intl,W),a.format_bytes(i.intl,z)),badgeText:l.WARNING_BADGE,ctaText:l.VIEW_PLANS,onCtaClick:te,filePreview:d,secondaryCtaText:l.MANAGE_FILES,secondaryCtaOnClick:ae,tertiaryCtaText:l.DOWNLOAD_FILE,tertiaryCtaOnClick:ne,showCloseButton:!1,isPrimaryCtaLoading:q}));const le=l.getAutoLayoutModalProps({viewMode:B,isMobileView:G,fileName:v,quotaUpsellInfo:E,warningMode:K,usedLessThanPlusQuota:j,filePreview:d,planContent:U,quotaUsedBytes:W,quotaAllocatedBytes:z,shouldUseSmallSkus:I,shouldUseHeavyDiscount:L,onViewPlansClick:te,onCloseClick:e=>{e.preventDefault(),e.stopPropagation(),c.logSelectOverquotaRestrictionsModal("close_button",oe),K?n():u(),a.unmountModal(void 0,F)},onDownloadFileClick:ne,onManageFilesClick:ae,onGetPlanClick:()=>{c.logSelectOverquotaRestrictionsModal("get_plan",oe),l.openPortableCheckoutModal({isOpen:!0,productPlanType:I?a.ProductPlanType.BASIC_PLUS:a.ProductPlanType.PLUS,onCloseClick:()=>{K?n():u(),a.unmountModal(void 0,l.PORTABLE_CHECKOUT_MODAL_ID)},onIframeLoadSuccess:()=>{c.logShownPortableCheckoutModalSuccess(),a.unmountModal(void 0,F)},onIframeLoadError:()=>{u(),c.logShownPortableCheckoutModalError(),a.unmountModal(void 0,F),I?a.redirect("/buy/dbx500?_tk=oq_restrictions_modal"):a.redirect("/buy/plus?_tk=oq_restrictions_modal")},onPurchaseSuccess:()=>{u(),c.logSelectPortableCheckoutModalPurchaseSuccess(),a.reload()}})}});return V.default.createElement(i.Provider,{value:i.intl},V.default.createElement(r.AutoLayoutModal,{...le,isPrimaryCtaLoading:q}))};W.displayName="FunctionalOverQuotaRestrictionsModal";o.openOverQuotaRestrictionsModal=e=>{a.mountModal(V.default.createElement(n.QueryClientProvider,{client:n.queryClient},V.default.createElement(W,{action:e.action,continueCallback:e.continueCallback,abortCallback:e.abortCallback,filePreview:e.filePreview,fileName:e.fileName,downloadFileHandler:e.downloadFileHandler})),void 0,F)}}));
//# sourceMappingURL=c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal.js-vflRKK7q0.map

//# debugId=87d40147-f9d3-3d9d-b0de-3183122fe803