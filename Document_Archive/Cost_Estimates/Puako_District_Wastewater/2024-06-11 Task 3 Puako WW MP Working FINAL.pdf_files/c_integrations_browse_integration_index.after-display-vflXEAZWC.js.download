!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f68b8d3f-be1f-323e-b309-e541cd6c8275")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_file","./c_core_i18n","./c_stacks_async_add_to_stack","./e_data_modules_stormcrow","./e_edison","./c_features_deprecator_index","./c_inband-screen_internals_share-modal-share","./c_src_utils_initials","./c_src_bindings_provider","./c_utils_dsx_dsx-react","./c_dotlottie_common_chunk-B7OIQIGJ","./c_api_v2_unauthed_client","./c_api_v2_routes_password_confirmation_provider","./c_hive_schemas_sharing-request_access_user_events","./c_memoize-one","./c_src_sink_index","./c_shareme24_main","./c_account_email","./c_account_email_verify_reasons","./c_ui_contextual-nudge_campaign-contextual-nudge-section","./c_content-member-list_internals_content-member-list","./c_dig-icons_assets_ui-icon_line_quota-reached","./c_abuse_fingerprintjs_abuse_fpjs_provider","./c_common_components_buttons","./c_abuse_fingerprintjs_abuse_fpjs_context","./c_sharing_sharing_pap_logging_send_share_invite_util","./c_dig-components_typeahead_index","./c_dig-components_chip_index","./c_dig-icons_assets_ui-icon_line_no-fill","./c_over-quota_over-quota-sweep-blocking-modal_show_over_quota_modal_or_continue","./c_settings-page_internals_settings-page-wrapper","./c_dig-icons_assets_ui-icon_line_qr-code","./c_dig-icons_assets_ui-icon_line_settings","./c_dig-icons_assets_ui-icon_line_send","./e_core_exception","./c_init_data_edison","./c_api_v2_routes_restorations_provider","./c_lodash-es_lodash","./c_watermarking_utils_getImageDefaultSizes","./c_core_notify","react-dom","./c_react-use_misc_util","./c_security_csrf_hmac","./c_react-use_useEffectOnce","./c_bem","react/jsx-runtime","metaserver/static/js/langpack","./c_contacts_contact","./c_validators","./c_domain_restriction_utils_response_helpers","./c_proto_storefront_platform_js_init_data_payment_method_pb","./c_proto_storefront_platform_js_init_data_transition_pb","./c_proto_checkout_js_init_data_checkout_page_pb","./c_cash_common_common_pb","./c_proto_storefront_platform_js_init_data_usage_data_pb","./c_dig-icons_assets_ui-icon_line_share","./c_api-v2-client_src_dropbox","./c_react_query_helpers_queries_login_and_register_constants","./c_pap-events_navigation_select_create_folder_action","./c_over-quota_utils_use_get_plans","./c_trial-plan-card_components_header","./c_dig-components_combinations_index","./c_dig-icons_assets_ui-icon_line_tag","./c_trial-cards_trial-plan-card","./c_dig-components_meter_index","./c_react-hookz_web_useRafCallback","./c_over-quota_utils_oq_price_decrease_helper","./c_common_components_layout","./c_user_metadata_api","./c_ui_modal_dig","./c_form","./c_account_email_verify","./c_auth_webauthn","./c_ui_locked-state-modal_open_locked_state_modal","./c_dig-components_card_index","./c_dig-icons_assets_ui-icon_line_upsell","./c_over-quota_over-quota-sweep-blocking-modal_over_quota_sweep_blocking_modal_wrapper","./c_ui_contextual-nudge_atoms","./c_dig-illustrations_spot_bowl-empty","./c_dig-icons_assets_ui-icon_line_team","./c_dig-content-icons_icons_folder-shared-default-small","./c_dig-foundations__global_slot","./c_fingerprintjs_fpjs-pro-static_fp","./c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal","./c_growth-components_auto-layout-modal_auto_layout_modal","./c_growth-components_over-quota-file-viewer-modal","./c_over-quota_over-quota-sweep-blocking-modal_open_over_quota_restrictions_modal_logger","./c_custom_campaigns_out_of_space_modal_out_of_space_checkout_modal_logger","./c_over-quota_over-quota-sweep-blocking-modal_open_locked_state_team_restrictions_modal","./c_checkout_components_portable_checkout_frame","./c_components_order_summary_redesign_order_summary_utils","./c_payments_skus_sku_content","./c_auth_common_captcha","./c_dig-components_tabs_index","./c_components_icons_icon_dropdown_selected","./c_date-fns__lib_requiredArgs_index","./c_date-fns__lib_defaultOptions_index"],(function(e,t,a,n,i,s,r,o,l,c,d,_,g,u,m,p,f,h,E,v,y,S,b,I,M,C,A,T,x,k,N,L,R,w,$,O,D,P,F,U,H,B,j,V,q,z,G,W,K,Y,Z,Q,X,J,ee,te,ae,ne,ie,se,re,oe,le,ce,de,_e,ge,ue,me,pe,fe,he,Ee,ve,ye,Se,be,Ie,Me,Ce,Ae,Te,xe,ke,Ne,Le,Re,we,$e,Oe,De,Pe,Fe,Ue,He,Be,je,Ve,qe){"use strict";function ze(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var Ge=ze(t);a.createApiv2Query({nsClient:i.GetStacksRoutes,rpc:"query_stacks"});const We=a.createApiv2Query({nsClient:a.GetFilesRoutes,rpc:"list_folder"}),Ke=(e,t)=>{We.prefetchQuery(e,{apiArg:{path:t,limit:i.STACK_SIZE_LIMIT}})},Ye=(e,t=!1)=>{const a=We.useQuery({apiArg:{path:e,limit:i.STACK_SIZE_LIMIT}},{staleTime:3e5,enabled:t});return Ge.useMemo((()=>{var e;if(a.isLoading)return{isLoading:!0};if(a.error)return{isLoading:!1,isError:!0,error:a.error.appError};{const t=a.data.apiData;if(t.has_more)return{isLoading:!1,isError:!0,error:{".tag":"too_many_contents"}};const n=[];for(const a of t.entries)if("id"in a){if("folder"===a[".tag"]&&(null===(e=a.sharing_info)||void 0===e?void 0:e.no_access))continue;n.push({file_id:a.id,fq_path:a.name})}return{isError:!1,isLoading:!1,output:n}}}),[a])},Ze=(e,t=!0)=>{t?a.fail(e.formatMessage({id:"ObEiUD",defaultMessage:"Couldn’t complete this request. Try again."})):a.fail(e.formatMessage({id:"VAAIgQ",defaultMessage:"Couldn’t complete this request."}))},Qe=({children:e,onFallback:t,onRequestClose:i})=>{const s=E.useData(),r=Ge.useRef(!1),o=(()=>{const e=n.useIntl();return Ge.useCallback((t=>{switch(t.loadError.type){case"METADATA_ERROR_V2":switch(t.loadError.response.error[".tag"]){case"email_unverified":return a.fail(e.formatMessage({id:"YQ+xBi",defaultMessage:"Verify your email to share this content."})),!0;case"invalid_oid":return a.fail(e.formatMessage({id:"hBQISs",defaultMessage:"This content doesn’t exist."})),!0;case"no_access":return a.fail(e.formatMessage({id:"S0dPqX",defaultMessage:"You don’t have access to this content."})),!0;case"other":return Ze(e),!0;default:return a.exhausts(t.loadError.response.error[".tag"],!1)}case"METADATA_FATAL_V2":return Ze(e),!0;default:return!1}}),[e])})();return Ge.useEffect((()=>{if("error"===s.status&&!r.current){r.current=!0;o(s)?i():t&&t()}}),[s,t,i,o]),Ge.createElement(Ge.Fragment,null,e)};Qe.displayName="DataLoadingErrorWrapper";const Xe=Symbol("ON_SHOW_VERIFY_EMAIL_MODAL"),{useEmitter:Je,defaultEmitter:et}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),s=t(a.Context$6),r=t(a.Context$7),o={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(s),...a.getTags$7(r),isSm24:"true"},l={...a.getProperties$4(n),...a.getProperties$5(i),...a.getProperties$6(s),...a.getProperties$7(r)};e.key===Xe&&(a.UDCL.logEnd("ops.sm24.browse_load",{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"canceled",...l}),{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEvent("ops.sm24.show_verify_email_modal",{tags:o}))})),tt=({children:e,sessionId:t,onRequestClose:n})=>{var i,s;const r=Je(),{viewer:o,isLoading:l}=a.useViewer(),c=!l&&!1===(null===(i=o.active_user)||void 0===i?void 0:i.is_email_verified);return Ge.default.useEffect((()=>{c&&r.select(Xe).emit({sessionId:t})}),[c,t,r]),c?Ge.default.createElement(v.VerifyEmailModal,{viewer:o,user:o.active_user,reason:y.EmailVerificationReasons.SHMODAL,email:null===(s=o.active_user)||void 0===s?void 0:s.email,onShowChange:()=>{o.active_user&&v.ChangeEmail.show(o,o.active_user,y.EmailVerificationReasons.SHMODAL)},onEmailSent:()=>{v.EmailVerification.get_for_user(o,o.active_user).email_sent(void 0,y.EmailVerificationReasons.SHMODAL,!0),n()},onCancel:n}):Ge.default.createElement(Ge.default.Fragment,null,e)};tt.displayName="EmailVerificationWrapper";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/common/components/hanging-notification.module.out-vflxeGBJc.css",(e=>"._hangingNotification_f9a10_3{margin-left:var(--dig-spacing__micro__medium);margin-right:var(--dig-spacing__micro__medium);opacity:0;pointer-events:auto;transform:translateY(-12px);transition:opacity .15s ease-in,transform .15s ease-in}._hangingNotification_f9a10_3._visible_f9a10_16{opacity:1;transform:translateY(0);transition:opacity .2s ease-out,transform .2s ease-out}"));const at="_hangingNotification_f9a10_3",nt="_visible_f9a10_16",it={success:a.CheckmarkCircleLine,error:a.FailLine,warning:a.WarningLine},st=({isVisible:e,message:t,type:n,action:i,isDismissible:s,onDismiss:r,autoDismiss:o,style:l})=>{const c=n?it[n]:null;return Ge.createElement(a.Snackbar$1,{open:e,preferComposition:!0,timeout:o?5e3:void 0,onRequestClose:r,style:l},c&&Ge.createElement(a.Snackbar$1.Accessory,null,Ge.createElement(a.UIIcon,{src:c})),Ge.createElement(a.Snackbar$1.Content,null,Ge.createElement(a.Snackbar$1.Message,null,t),(i||s)&&Ge.createElement(a.Snackbar$1.Actions,null,Ge.createElement(a.Box,{display:"flex",style:{gap:"4px"}},i&&Ge.createElement(a.Button,{variant:"outline",inverse:!0,size:"small",onClick:()=>{try{null==i||i.onClick()}catch(e){}finally{r()}}},i.label),s&&Ge.createElement(a.IconButton,{variant:"outline",inverse:!0,size:"small",onClick:r},Ge.createElement(a.UIIcon,{src:a.CloseLine}))))))};st.displayName="NotificationContent";const rt=({isVisible:e,message:t,type:n,action:i,isDismissible:s,onDismiss:r,autoDismiss:o=!0})=>{const{small:l}=a.useBreakpoint({strategy:"maxWidth"}),c=d.usePlatform()===d.Platforms.DESKTOP,_=((e,t)=>{const[a,n]=Ge.useState(e);return Ge.useEffect((()=>{if(e)return void n(!0);const a=window.setTimeout((()=>n(!1)),t);return()=>window.clearTimeout(a)}),[e,t]),a})(e,250),[g,u]=Ge.useState(!1),m=Ge.useRef({message:t,type:n,action:i});e&&(m.current={message:t,type:n,action:i});const p=m.current,f=e||_?p:{message:"",type:"neutral",action:void 0};return Ge.useEffect((()=>{if(!e||!_)return void u(!1);u(!1);const t=requestAnimationFrame((()=>{const e=requestAnimationFrame((()=>{u(!0)}));return()=>cancelAnimationFrame(e)}));return()=>cancelAnimationFrame(t)}),[e,_]),c||l?Ge.createElement(a.Snackbar$1.Position,null,Ge.createElement(st,{isVisible:e,message:f.message,type:f.type,action:f.action,isDismissible:s,onDismiss:r,autoDismiss:o})):Ge.createElement(a.Box,{left:"0",right:"0",top:"100%",position:"absolute",paddingLeft:"Micro Medium",paddingRight:"Micro Medium",style:{zIndex:-1}},Ge.createElement("div",{className:a.cx(at,{[nt]:g})},Ge.createElement(st,{isVisible:e,message:f.message,type:f.type,action:f.action,isDismissible:s,onDismiss:r,autoDismiss:o,style:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:"var(--dig-radius__large)",borderBottomRightRadius:"var(--dig-radius__large)"}})))};rt.displayName="HangingNotificationContent";const ot=({notification:e,onDismiss:t})=>{var a,n,i;const s=Ge.useRef("idle");null!==e&&(s.current=e.key);const r=null!==(a=null==e?void 0:e.key)&&void 0!==a?a:s.current,o=null!==e;return Ge.createElement(rt,{key:r,isVisible:o,message:null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"",type:null!==(i=null==e?void 0:e.type)&&void 0!==i?i:"neutral",action:null==e?void 0:e.action,isDismissible:null==e?void 0:e.isDismissible,onDismiss:t,autoDismiss:!1!==(null==e?void 0:e.autoDismiss)})};ot.displayName="HangingNotification";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/common/components/mobile-drawer.module.out-vflHjQrar.css",(e=>"._outerWrapper_1lhgo_3{background:var(--dig-color__background__subtle);display:flex;flex-direction:column;height:100%;overflow:hidden}._roundedCorner_1lhgo_11{border-top-left-radius:16px;border-top-right-radius:16px}._container_1lhgo_16{background-color:var(--dig-color__background__base)}._handle_1lhgo_20{background-color:var(--dig-color__border__subtle);border-radius:2px;height:4px;margin:8px auto 0;width:32px}"));const lt="_outerWrapper_1lhgo_3",ct="_roundedCorner_1lhgo_11",dt="_container_1lhgo_16",_t=({isOpen:e,onRequestClose:t,isFullHeight:n,children:i,"aria-label":s,"data-testid":r="mobile-drawer"})=>{const o=n?"100%":"auto";return Ge.createElement(a.Drawer.ModalDrawer,{onRequestClose:t,"aria-label":s,isOpen:e,alignment:"bottom",height:o,className:n?void 0:ct,"data-testid":r,shouldAnimate:!0,hasScrollLock:!0},Ge.createElement(d.FocusLock,{group:"share-modal"},Ge.createElement("div",{className:a.cx(lt,{[ct]:!n})},Ge.createElement(a.Drawer.Container,{className:dt},Ge.createElement(a.Drawer.Body,null,i)))))};function gt(e){return{class:"share",action:"click",object:"share_modal",properties:e}}_t.displayName="MobileDrawer";const ut=Symbol("ON_VIEW_SHARE_MODAL_PAGE"),mt=Symbol("ON_CLICK_MORE_BUTTON"),pt=Symbol("ON_CLICK_SETTINGS_BUTTON"),ft=Symbol("ON_CLICK_STACKS_BUTTON"),ht=Symbol("ON_CLICK_INBAND_BUTTON"),Et=Symbol("ON_CLICK_TRANSFER_BUTTON"),vt=Symbol("ON_CLICK_QR_CODE_BUTTON"),yt=Symbol("ON_CLICK_COPY_LINK_BUTTON"),St=Symbol("ON_CLICK_CONTENT_MEMBER_LIST_BUTTON"),bt=Symbol("ON_CLICK_CLOSE_BUTTON"),It=Symbol("ON_CLICK_CLICKAWAY_BUTTON"),Mt=Symbol("ON_CLICK_COLLAPSED_MEMBER_SUMMARY_BUTTON"),Ct=Symbol("ON_CLICK_INHERITED_SUMMARY_ROW_BUTTON"),{useEmitter:At,defaultEmitter:Tt}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),s=t(a.Context$6),r=t(a.Context$7),o={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(s),...a.getTags$7(r)},l={...a.getProperties$4(n),...a.getProperties$5(i),...a.getProperties$6(s),...a.getProperties$7(r)};e.key===ut?(a.UDCL.logEvent(function(e){return{class:"share",action:"view",object:"share_modal_page",properties:e}}({...l,shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}),{tags:{...o,shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}),a.UDCL.logEvent("ops.sm26.view_page",{tags:{...o,shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}})):e.key===mt?a.UDCL.logEvent(gt({...l,shareModalElement:"more_button",shareModalType:"sm26"}),{tags:{...o,element:"more_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===pt?a.UDCL.logEvent(gt({...l,shareModalElement:"settings_button",shareModalType:"sm26"}),{tags:{...o,element:"settings_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===ft?a.UDCL.logEvent(gt({...l,shareModalElement:"stacks_button",shareModalType:"sm26"}),{tags:{...o,element:"stacks_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===ht?a.UDCL.logEvent(gt({...l,shareModalElement:"inband_button",shareModalType:"sm26"}),{tags:{...o,element:"inband_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===Et?a.UDCL.logEvent(gt({...l,shareModalElement:"transfer_button",shareModalType:"sm26"}),{tags:{...o,element:"transfer_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===vt?a.UDCL.logEvent(gt({...l,shareModalElement:"qr_code_button",shareModalType:"sm26"}),{tags:{...o,element:"qr_code_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===yt?a.UDCL.logEvent(gt({...l,shareModalElement:"copy_link_button",shareModalType:"sm26"}),{tags:{...o,element:"copy_link_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===St?a.UDCL.logEvent(gt({...l,shareModalElement:"content_member_list_button",shareModalType:"sm26"}),{tags:{...o,element:"content_member_list_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===bt?a.UDCL.logEvent(gt({...l,shareModalElement:"close_button",shareModalType:"sm26"}),{tags:{...o,element:"close_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===It?a.UDCL.logEvent(gt({...l,shareModalElement:"clickaway",shareModalType:"sm26"}),{tags:{...o,element:"clickaway",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===Mt?a.UDCL.logEvent(gt({...l,shareModalElement:"collapsed_member_summary_button",shareModalType:"sm26"}),{tags:{...o,element:"collapsed_member_summary_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}}):e.key===Ct&&a.UDCL.logEvent(gt({...l,shareModalElement:"inherited_summary_row_button",shareModalType:"sm26"}),{tags:{...o,element:"inherited_summary_row_button",shareModalPage:e.payload.shareModalPage,shareModalType:"sm26"}})}));var xt;!function(e){e.MAIN="main",e.MORE="more",e.SETTINGS="settings",e.INBAND="inband",e.COPY_LINK="copy_link",e.QR_CODE="qr_code",e.CONTENT_MEMBER_LIST="content_member_list"}(xt||(xt={}));const kt={$props:_.atom({isOpen:!1,onRequestClose:()=>{},onControlledFeatureClicked:()=>{},objectIdentifier:{".tag":"file",fileId:""},onObjectIdentifierChanged:()=>Promise.resolve(),isEncrypted:!1,fileName:"",filePath:"",copyLinkMode:"integrated_v1",inbandSharingMode:"integrated_v1",transferMode:"controlled_v1",transferHandler:()=>{},canUserUseTransfer:!1,canContentUseTransfer:!1,canUserEnableTransfer:!1,isTransferEligibilityLoading:!1,stacksMode:"controlled_v1",stacksHandler:()=>{},canUserCreateStack:!1,isStacksContentLimitExceeded:null,referrerLoggingMetadata:{actionElement:"",actionSurface:"",contentAction:"share",tiburonOrigin:"SHARING_SDK_SANDBOX",screen:"share_screen",shareModalType:"sm26"},objectLoggingMetadata:{type:"file",name:"",size:0},itemCountResult:{isLoading:!0},objectMetadataResult:{isLoading:!0},onDataSuccess:()=>{},onDataError:()=>{},onDataCancel:()=>{}}),$currentPage:_.atom(xt.MAIN),$previousPage:_.atom(null),$clipboardWriter:_.atom(void 0),$inviteTargets:_.atom([]),$inviteMessage:_.atom(""),$initialInputKey:_.atom(void 0),$isSuggestionsOpen:_.atom(!1),$suggestedContacts:_.atom([]),$isConfidentialFolderBannerClosed:_.atom(!1),$initialSettingsTab:_.atom("object_settings"),$isOperationInProgress:_.atom(!1),$itemCount:_.atom(null),$fileNameWithoutExtension:_.atom(""),$extension:_.atom(""),$hangingNotification:_.atom(null),$expandInheritedOnContentMemberListOpen:_.atom(!1)},{StoreProvider:Nt,useStore:Lt}=_.defineStoreProvider((e=>{const t=_.atom(xt.MAIN),n=_.atom(null),i=_.atom(void 0),s=_.atom([]),r=_.atom(""),o=_.atom(!1),l=_.atom([]),c=_.atom(!1),d=_.atom(void 0),g=_.atom("object_settings"),u=_.atom(!1),m=_.proxy((()=>{const{itemCountResult:t}=e.get();return t.isLoading||t.isError?null:t.itemCount})),p=_.proxy((()=>{const{objectIdentifier:t,fileName:n}=e.get();return"file"===t[".tag"]?a.getFileNameAndExtensionFromFileName(n).fileNameWithoutExtension:""})),f=_.proxy((()=>{const{objectIdentifier:t,fileName:n}=e.get();return"file"===t[".tag"]?a.getFileNameAndExtensionFromFileName(n).extension:""})),h=_.atom(null),E=_.atom(!1);return{$props:e,$currentPage:t,$previousPage:n,$clipboardWriter:i,$inviteTargets:s,$inviteMessage:r,$initialInputKey:d,$isSuggestionsOpen:o,$suggestedContacts:l,$isConfidentialFolderBannerClosed:c,$initialSettingsTab:g,$isOperationInProgress:u,$itemCount:m,$fileNameWithoutExtension:p,$extension:f,$hangingNotification:h,$expandInheritedOnContentMemberListOpen:E}}),kt),Rt=e=>{const{objectIdentifier:t}=e,n=(e=>{const{isNonUserRelativeContext:t}=a.useSharingApiContext(),n=null==e?void 0:e.fileId,i="file"===(null==e?void 0:e.type),s=a.getFolderItemCountPackage.useQuery({apiArg:{file_id:null!=n?n:""},pkgArg:{isNonUserRelativeContext:!!t}},{staleTime:3e5,enabled:!i&&!!n});return Ge.useMemo((()=>!s||s.isLoading?{isLoading:!0}:s.isError?{isLoading:!1,isError:!0,error:s.error.appError}:{isLoading:!1,isError:!1,itemCount:s.data.apiData.item_count}),[s])})(t.fileId?{fileId:t.fileId,type:t[".tag"]}:null),i=c.useSharingObjectMetadata(e.objectIdentifier.fileId);return Ge.createElement(Nt,{itemCountResult:n,objectMetadataResult:i,...e})};Rt.displayName="Provider";const wt=(e,t)=>{e.$isOperationInProgress.get()||(t===xt.MAIN&&e.$inviteTargets.set([]),t!==xt.INBAND&&e.$initialInputKey.set(void 0),e.$previousPage.set(e.$currentPage.get()),e.$currentPage.set(t))},$t=e=>{e.$hangingNotification.set(null)},Ot=({children:e,onRequestClose:t})=>{const a=At(),n=Lt(),i=_.useAtom(n.$currentPage);Ge.useEffect((()=>{const e=e=>{"Escape"===e.key&&(a.select(It).emit({shareModalPage:i}),e.preventDefault(),e.stopImmediatePropagation(),t())};return document.addEventListener("keydown",e,!0),()=>{document.removeEventListener("keydown",e,!0)}}),[t]);const s=Ge.useCallback((e=>{if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)){const t=e.target;t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable||t.isContentEditable)||(e.preventDefault(),e.nativeEvent.stopImmediatePropagation())}}),[]);return Ge.createElement(d.FocusLock,{group:"share-modal",autoFocus:!1,returnFocus:!0},Ge.createElement("div",{onKeyDown:s},e))};Ot.displayName="ModalFocusWrapper";const Dt=e=>e.formatMessage({id:"pt0AFj",defaultMessage:"Share folder"}),Pt=e=>e.formatMessage({id:"iqba4e",defaultMessage:"Share file"}),Ft=e=>e.formatMessage({id:"gTmtNI",defaultMessage:"Can’t add more than 200 files to a Stack at a time"}),Ut=e=>e.formatMessage({id:"WUY+xm",defaultMessage:"Close"}),Ht=e=>e.formatMessage({id:"zxZmkD",defaultMessage:"Done"}),Bt=e=>e.formatMessage({id:"LUkF9j",defaultMessage:"More ways to share"}),jt=e=>e.formatMessage({id:"cyXmfq",defaultMessage:"Sharing settings"});a.injectInternalStyle("/static/metaserver/static/js/sharing/features/share-modal/versions/shareme26/layout/layout.module.out-vflsWvmbu.css",(e=>"._header_1flrk_2{align-items:center;background-color:var(--dig-color__background__base);border-radius:var(--dig-radius__xxlarge) var(--dig-radius__xxlarge) 0 0;display:flex;justify-content:space-between;padding:0 0 var(--dig-spacing__macro__small)}._headerInfo_1flrk_11{align-items:flex-start;display:flex;flex-direction:row;flex-shrink:0;gap:var(--dig-spacing__micro__small,8px)}._headerText_1flrk_19{display:flex;flex-direction:column;gap:0}._title_1flrk_25{align-items:center;color:var(--dig-color__text__base);margin-bottom:-4px}._subtitle_1flrk_33,._title_1flrk_25{display:flex;gap:var(--dig-spacing__micro__xsmall,4px)}._subtitle_1flrk_33{align-items:flex-start;color:var(--dig-color__text__subtle);flex-wrap:wrap}._headerSlots_1flrk_41{align-items:center;display:flex;flex-shrink:0;gap:var(--dig-spacing__micro__small,8px);justify-content:flex-end}._body_1flrk_50{display:flex;flex:1;flex-direction:column;gap:var(--dig-spacing__macro__small);min-height:0}._bodyRow_1flrk_58{flex-shrink:0}._bodyRow_1flrk_58,._bodyRowScrollable_1flrk_64{display:flex;flex-direction:column}._bodyRowScrollable_1flrk_64{flex:1;min-height:0;overflow-y:auto}._footer_1flrk_73{align-items:center;background-color:var(--dig-color__background__base);display:flex;padding:var(--dig-spacing__macro__small,24px) 0 0}._footerLeftActions_1flrk_80{margin-right:auto}._footerLeftActions_1flrk_80,._footerRightActions_1flrk_87{align-items:center;display:flex;gap:var(--dig-spacing__micro__small)}._footerRightActions_1flrk_87{margin-left:auto}"));const Vt="_header_1flrk_2",qt="_headerInfo_1flrk_11",zt="_headerText_1flrk_19",Gt="_title_1flrk_25",Wt="_headerSlots_1flrk_41",Kt="_body_1flrk_50",Yt="_bodyRow_1flrk_58",Zt="_bodyRowScrollable_1flrk_64",Qt="_footer_1flrk_73",Xt="_footerLeftActions_1flrk_80",Jt="_footerRightActions_1flrk_87",ea=({children:e,scrollable:t=!1,maxHeight:a})=>{const n=a?{maxHeight:`${a}px`}:void 0;return Ge.createElement("div",{className:t?Zt:Yt,style:n},e)};ea.displayName="Row";const ta=({children:e})=>e?Ge.createElement("div",{"data-testid":"sm26-body",className:Kt},e):null;ta.displayName="BodyBase";const aa=Object.assign(ta,{Row:ea}),na=({icon:e,firstLabel:t,secondLabel:n})=>Ge.createElement(b.Metadata2,{size:"small",withDividers:"bullet"},Ge.createElement(b.Metadata2.Item,null,e&&Ge.createElement(b.Metadata2.UIIcon,{src:e}),Ge.createElement(b.Metadata2.Label,null,Ge.createElement(a.Truncate,{location:.5},t))),n&&Ge.createElement(b.Metadata2.Item,null,Ge.createElement(b.Metadata2.Label,null,n)));na.displayName="HeaderSubtitle";const ia=({backButton:e,title:t,subtitle:i})=>{return Ge.createElement("div",{className:qt},e&&Ge.createElement(a.IconButton,{variant:"borderless",shape:"standard",size:"large","aria-label":(s=n.intl,s.formatMessage({id:"RDsqXu",defaultMessage:"Back"})),onClick:e.onClick,"data-testid":"back-button"},Ge.createElement(a.UIIcon,{src:a.ChevronLeftLine})),Ge.createElement("div",{className:zt},Ge.createElement("div",{className:Gt},Ge.createElement(a.Title,{size:"small",weightVariant:"emphasized"},t)),i&&Ge.createElement(na,{...i})));var s};ia.displayName="HeaderInfo";const sa=e=>{const t=Ge.useRef(null),[n,i]=Ge.useState(!1),s=Ge.useCallback((()=>{i(!0)}),[]),r=Ge.useCallback((()=>{i(!1)}),[]),o=Ge.useCallback((()=>{i(!0)}),[]),l=Ge.useCallback((()=>{i(!1)}),[]);return"custom"===e.type?Ge.createElement(Ge.Fragment,null,e.children):e.isLoading?Ge.createElement("div",{style:{display:"flex",width:"32px",height:"32px",flexShrink:0}},Ge.createElement(a.Skeleton.Box,{height:32,width:32,"data-testid":`${e.testId}-loading`})):e.isDisabled?Ge.createElement(Ge.Fragment,null,Ge.createElement("div",{ref:t,onMouseEnter:s,onMouseLeave:r,onFocus:o,onBlur:l,tabIndex:0,role:"button","aria-label":e.label,"aria-disabled":!0},Ge.createElement(a.IconButton,{variant:"borderless",shape:"standard",size:"medium","data-testid":e.testId,disabled:!0},Ge.createElement(a.UIIcon,{src:e.icon}))),e.disabledTooltip&&Ge.createElement(a.Tooltip.Control,{open:n,placement:"bottom",auto:!0,triggerRef:t},Ge.createElement(a.Text,null,e.disabledTooltip))):Ge.createElement(Ge.Fragment,null,Ge.createElement("div",{ref:t,onMouseEnter:s,onMouseLeave:r,onFocus:o,onBlur:l,"aria-label":e.label},Ge.createElement(a.IconButton,{variant:"borderless",shape:"standard",size:"medium","aria-label":e.label,onClick:e.onClick,"data-testid":e.testId},Ge.createElement(a.UIIcon,{src:e.icon}))),e.label&&Ge.createElement(a.Tooltip.Control,{open:n,placement:"top",auto:!0,triggerRef:t},Ge.createElement(a.Text,null,e.label)))};sa.displayName="Slot";const ra=({info:e,children:t})=>Ge.createElement("div",{"data-testid":"sm26-header",className:Vt},Ge.createElement(a.Split,{width:"100%"},Ge.createElement(a.Split.Item,null,Ge.createElement(ia,{...e})),Ge.createElement(a.Split.Item,{style:{marginLeft:"auto"}},t&&Ge.createElement("div",{className:Wt},t))));ra.displayName="HeaderBase";const oa=Object.assign(ra,{Slot:sa}),la=(e,t=5)=>{const a=Math.max(1,Math.floor(t)),n=Math.max(0,Math.floor(e)),i=Math.pow(10,a)-1;return n>i?`${i.toLocaleString()}+`:n.toLocaleString()},ca=e=>{if(null!==e)return n.intl.formatMessage({id:"u5gsFM",defaultMessage:"{formattedCount} {count, plural, one {item} other {items}}"},{count:e,formattedCount:la(e)})};function da(e){const t=_.useAtom(e.$itemCount),a=_.useStore(e.$fileNameWithoutExtension),n=_.useStore(e.$extension),{fileName:i,objectIdentifier:s}=_.useAtom(e.$props);return"file"!==s[".tag"]?{icon:I.FolderLine,firstLabel:i,secondLabel:ca(t)}:{icon:I.FileLine,firstLabel:a,secondLabel:n?n.toLocaleUpperCase():""}}const _a=()=>{var e;const t=Lt(),i=_.useAtom(t.$props),s=da(t),r=_.useAtom(t.$expandInheritedOnContentMemberListOpen),o=Ge.useRef(r);r&&(o.current=!0),Ge.useEffect((()=>{r&&t.$expandInheritedOnContentMemberListOpen.set(!1)}),[r,t]);const l=Ge.useCallback((()=>{wt(t,t.$previousPage.get()||xt.MAIN)}),[t]),d=Ge.useCallback((e=>{const{shouldOpenLinkSettings:a,initialTab:n}=e;let i;i=(null!=a?a:"edit_link_settings"===n||"view_link_settings"===n)?"edit_link_settings"===n?"edit_link_settings":"view_link_settings":"object_settings",t.$initialSettingsTab.set(i),wt(t,xt.SETTINGS)}),[t]),{onRequestClose:g}=i,u=Ge.useCallback((e=>{e?g():wt(t,xt.MAIN)}),[t,g]),m=Ge.useCallback((()=>{c.invalidateSharingObjectMetadata(i.objectIdentifier),c.invalidateNewApiObjectMetadata(i.objectIdentifier),b.invalidateListSharedLinks(i.objectIdentifier),a.invalidateObjectMembers(i.objectIdentifier),wt(t,xt.INBAND)}),[i.objectIdentifier,t]),p=Ge.useCallback((()=>{wt(t,xt.INBAND)}),[t]);return Ge.createElement(Ge.Fragment,null,Ge.createElement(oa,{info:{backButton:{onClick:l},title:(f=n.intl,f.formatMessage({id:"iQ/N79",defaultMessage:"Who can access"})),subtitle:s}}),Ge.createElement(aa,null,Ge.createElement(aa.Row,{scrollable:!0},Ge.createElement(b.ContentMemberList,{objectIdentifier:i.objectIdentifier,openLinkSettings:d,onRequestClose:u,onConfirmationModalShownChange:null!==(e=i.onConfirmationModalShownChange)&&void 0!==e?e:()=>{},onTransferFolderOwnership:m,onChangeConfidentiality:p,onObjectIdentifierChanged:i.onObjectIdentifierChanged,shouldUseSm26Design:!0,expandInheritedOnLoad:o.current}))));var f};_a.displayName="ContentMemberListPage";const ga=()=>{const e=Lt(),t=_.useAtom(e.$props),i=_.useStore(e.$clipboardWriter),{objectIdentifier:s,onRequestClose:r}=t,o=da(e),l=At(),c=Ge.useCallback((t=>{l.select(pt).emit({shareModalPage:xt.COPY_LINK}),_.batch((()=>{t.shouldOpenLinkSettings?e.$initialSettingsTab.set("edit_link_settings"===t.initialTab?"edit_link_settings":"view_link_settings"):e.$initialSettingsTab.set("object_settings"),wt(e,xt.SETTINGS)}))}),[l,e]),d=Ge.useCallback((()=>{e.$isOperationInProgress.set(!0)}),[e]),g=Ge.useCallback((()=>{e.$isOperationInProgress.set(!1)}),[e]);return Ge.createElement(Ge.Fragment,null,Ge.createElement(oa,{info:{title:(u=n.intl,u.formatMessage({id:"d32enr",defaultMessage:"Copy link to"})),subtitle:o}},Ge.createElement(oa.Slot,{type:"iconButton",icon:a.CloseLine,label:Ut(n.intl),onClick:r,testId:"copy-link-close-button",isLoading:!1,isDisabled:!1,disabledTooltip:null})),Ge.createElement(aa,null,Ge.createElement(aa.Row,null,Ge.createElement(E.CopyLinkScreen,{key:s.fileId,oid:s,settingsHandler:c,onRequestClose:r,clipboardWriter:i,onBlockClickaway:d,onUnblockClickaway:g,shouldUseSm26Design:!0}))));var u};ga.displayName="CopyLinkPage";const ua=e=>e.formatMessage({id:"RYuEPZ",defaultMessage:"Some of these emails aren’t on your Dropbox team."}),ma=e=>e.formatMessage({id:"c7+ulZ",defaultMessage:"This email isn’t on your Dropbox team."}),pa=e=>e.formatMessage({id:"Vp93jb",defaultMessage:"One or more of these emails is no longer active."}),fa=e=>e.formatMessage({id:"Eowy6P",defaultMessage:"Automatic groups can only be added to team folders."}),ha=e=>e.formatMessage({id:"LKdcDm",defaultMessage:"Some of these emails aren’t on your Dropbox team."}),Ea=e=>e.formatMessage({id:"mvBmmQ",defaultMessage:"This email isn’t on your Dropbox team."}),va=e=>e.formatMessage({id:"0IC8VF",defaultMessage:"You don’t have permission to share with some of these people."}),ya=e=>e.formatMessage({id:"8tC+2X",defaultMessage:"Only groups can be added to team folders."}),Sa=e=>e.formatMessage({id:"UrkgWp",defaultMessage:"You don’t have permission to share with some of these people due to restrictions on their end."}),ba=e=>e.formatMessage({id:"S+fqGv",defaultMessage:"One or more of the emails you entered are invalid."}),Ia=e=>e.formatMessage({id:"KxgNgG",defaultMessage:"Add message (optional)"}),Ma=e=>e.formatMessage({id:"30bVmM",defaultMessage:"Add a note"}),Ca=e=>e.formatMessage({id:"Qd1iC2",defaultMessage:"Sharing..."}),Aa=(e,t)=>t?Ca(e):(e=>e.formatMessage({id:"lHCrsZ",defaultMessage:"Share"}))(e),Ta=(e,t)=>"editor"===t[".tag"]?(e=>e.formatMessage({id:"J3CMt1",defaultMessage:"can edit"}))(e):(e=>e.formatMessage({id:"xOIBKS",defaultMessage:"can view"}))(e),xa=(e,t)=>e.formatMessage({id:"lvjqTm",defaultMessage:"Shared <st>{name}</st>."},{st:e=>Ge.createElement("strong",{key:a.getName(t)},e),name:c.Emstring.em_snippet(a.getName(t),a.SNIPPET_SIZES.FILENAME)}),ka=e=>e.formatMessage({id:"nf2M+i",defaultMessage:"There was a problem completing this request."}),Na=e=>e.formatMessage({id:"PbG9/M",defaultMessage:"You don’t have access to this content."}),La=e=>e.formatMessage({id:"ktVMZy",defaultMessage:"Your team settings don’t allow sharing outside your team."}),Ra=e=>e.formatMessage({id:"ccjg/d",defaultMessage:"You entered an invalid name or email address."}),wa=e=>e.formatMessage({id:"KWUYO4",defaultMessage:"You’ve hit the limit of invites for today. Try again later."}),$a=e=>e.formatMessage({id:"CTRWVL",defaultMessage:"You don’t have permission to do this. Contact the owner."}),Oa=e=>e.formatMessage({id:"xoQiJt",defaultMessage:"You haven’t verified your email. Check your email and try again."}),Da=e=>e.formatMessage({id:"kJSilf",defaultMessage:"Couldn’t share, but it might work if you reload the page and try again."}),Pa=e=>e.formatMessage({id:"FysM91",defaultMessage:"Something went wrong on our end. Refresh the page and try again."}),Fa=e=>e.formatMessage({id:"A35Dw0",defaultMessage:"You need to upgrade your account to do this."}),Ua=e=>e.formatMessage({id:"ebZyPl",defaultMessage:"You’re sharing with too many people."}),Ha=e=>e.formatMessage({id:"Bcojaq",defaultMessage:"Contact support"}),Ba=(e,t)=>e.formatMessage({id:"0UrAT5",defaultMessage:"Couldn’t create shared folder. Your Dropbox account is {number, plural, one{1 shared folder} other {{number} shared folders}} over the limit."},{number:t}),ja=e=>e.formatMessage({id:"/sRvdA",defaultMessage:"Folder updates in progress — please try again later."}),Va=(e,t,n)=>{const i=a.getName(n),s=a.getParentFolderName(n);return t?e.formatMessage({id:"5xCeTo",defaultMessage:"Removing members from <strong>{folderName}</strong>…"},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ge.createElement("strong",null,e)}):""===s?e.formatMessage({id:"90I244",defaultMessage:"Sharing <strong>{folderName}</strong> with everyone…"},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ge.createElement("strong",null,e)}):e.formatMessage({id:"16RnmU",defaultMessage:"Sharing <strong>{folderName}</strong> with members of <strong>{parentFolderName}</strong>…"},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),parentFolderName:c.Emstring.em_snippet(s,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ge.createElement("strong",null,e)})},qa=(e,t)=>t?e.formatMessage({id:"1HgFQB",defaultMessage:"Couldn’t remove members. Try again."}):e.formatMessage({id:"ypun4U",defaultMessage:"Couldn’t share folder. Try sharing again."}),za=e=>e.formatMessage({id:"b0sjjf",defaultMessage:"Learn more"}),Ga=()=>{const e=n.useIntl();return Ge.default.createElement(a.Box,{style:{display:"flex",flexDirection:"column",height:"310px"}},Ge.default.createElement(C.ButtonWrapper,null,Ge.default.createElement(C.HorizontalButton,{disabled:!0},Ge.default.createElement(a.Skeleton.Avatar,{size:"medium",style:{marginRight:"var(--dig-spacing__dimension__12)"}}),Ge.default.createElement(a.Skeleton.Text,{size:"large",width:200}))),Ge.default.createElement(a.Box,{style:{marginTop:"var(--dig-spacing__dimension__12)"}},Ge.default.createElement(a.StylelessButton,{disabled:!0,className:C.baseButton,style:{height:"190px",width:"100%",padding:"var(--dig-spacing__dimension__16)"}},Ge.default.createElement(a.Box,{style:{display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"flex-start",rowGap:"var(--dig-spacing__dimension__16)"}},Ge.default.createElement(a.Skeleton.Text,{width:330,style:{margin:0}}),Ge.default.createElement(a.Skeleton.Text,{width:330,style:{margin:0}}),Ge.default.createElement(a.Skeleton.Text,{width:330,style:{margin:0}}))),Ge.default.createElement(a.Box,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"var(--dig-spacing__dimension__12)"}},Ge.default.createElement(a.Skeleton.Text,{size:"large",width:200}),Ge.default.createElement(a.Button,{variant:"primary",size:"medium",fullWidth:!1,disabled:!0},Aa(e,!1)))))};Ga.displayName="LoadingScreen";const Wa=/^['#&A-Za-z0-9._%+-]+@[A-Za-z0-9-][A-Za-z0-9.-]*\.[A-Za-z]{2,15}$/,Ka={$props:_.atom({oid:{".tag":"file",fileId:""},objectMetadataResult:{isLoading:!0},accountMetadataResult:{isLoading:!0},sharingPrefsResult:{isLoading:!0},inviteMessage:"",inviteTargets:[],hasUpdatedAccountMetadata:!1,onCloseClick:()=>{},onTargetsDropdownFocusChange:()=>{},onInviteMessageChange:()=>{},onInviteTargetsChange:()=>{},onShareStart:()=>{},onInbandShareSuccess:()=>{},onShareFailure:()=>{},onStartInband:()=>{},onObjectIdentifierChanged:()=>Promise.resolve(),shouldTransitionAccessoryAreaEnter:!1,isConfidentialFolderBannerClosed:!1}),$inviteTargets:_.atom([]),$inviteMessage:_.atom(""),$inviteTargetValidations:_.atom({}),$isDataBeingUpdated:_.atom(!1),$isInviteSending:_.atom(!1),$shouldPostMessageAsComment:_.atom(!1),$isInviteMessageTooLong:_.atom(!1),$changeConfidentialityData:_.atom(null),$isSuggestionsOpen:_.atom(!1),$isProgressiveButtonHovered:_.atom(!1),$progressiveButtonHoverStartTime:_.atom(0),$componentViewTime:_.atom(0),$inviteTargetsWithValidEmails:_.atom([]),$inviteTargetsWithInvalidEmails:_.atom([]),$objectIdentifierId:_.atom(""),$sharingAccessLevel:_.atom(l.VIEWER),$canInviteViewer:_.atom(!1),$canInviteEditor:_.atom(!1),$isFolder:_.atom(!1),$isConfidentialFolder:_.atom(!1),$isNewFolder:_.atom(!1)},{StoreProvider:Ya,useStore:Za}=_.defineStoreProvider((e=>{const t=_.proxy((()=>e.get().inviteMessage),(t=>e.get().onInviteMessageChange(t))),n=_.proxy((()=>e.get().inviteTargets),(t=>e.get().onInviteTargetsChange(t))),i=_.proxy((()=>n.get().filter((e=>"group"===e[".tag"]||Wa.test(e.email))))),s=_.proxy((()=>n.get().filter((e=>"group"!==e[".tag"]&&!Wa.test(e.email))))),r=_.atom({}),o=_.atom(!1),c=_.atom(!1),d=_.atom(!1),g=_.atom(!1),u=_.atom(null),m=_.atom(!1),p=_.atom(!1),f=_.atom(0),h=_.atom(0),E=_.atom(a.getContentIdOrPathFromObjectIdentifier(e.get().oid)),v=_.proxy((()=>{const t=e.get().sharingPrefsResult;return t.isLoading||t.isError?null:t.output})),y=_.proxy((()=>{const t=e.get().objectMetadataResult;return t.isLoading||t.isError?null:t.output})),S=_.proxy((()=>{const e=v.get(),t=y.get();return!(!e||!t)&&a.getCanInvite(t,l.EDITOR)})),b=_.proxy((()=>{const e=v.get(),t=y.get();return!(!e||!t)&&a.getCanInvite(t,l.VIEWER)})),I=_.proxy((()=>{const e=v.get();return e&&S.get()?l.getUserDefaultInbandAccessLevel(e):l.VIEWER})),M=_.atom(I.get()),C=_.proxy((()=>{const e=y.get();return!!e&&a.getIsFolder(e)})),A=_.proxy((()=>{const e=y.get();return!!e&&a.getIsConfidentialFolder(e)})),T=_.proxy((()=>{var t;return null!==(t=e.get().isNewFolder)&&void 0!==t&&t}));return{$props:e,$inviteMessage:t,$inviteTargets:n,$inviteTargetsWithInvalidEmails:s,$inviteTargetsWithValidEmails:i,$inviteTargetValidations:r,$isDataBeingUpdated:o,$isInviteSending:c,$shouldPostMessageAsComment:d,$isInviteMessageTooLong:g,$changeConfidentialityData:u,$isSuggestionsOpen:m,$isProgressiveButtonHovered:p,$progressiveButtonHoverStartTime:f,$componentViewTime:h,$objectIdentifierId:E,$sharingAccessLevel:M,$canInviteViewer:b,$canInviteEditor:S,$isFolder:C,$isConfidentialFolder:A,$isNewFolder:T}}),Ka),Qa=e=>{const t=c.useSharingObjectMetadata(e.oid.fileId),a=c.useSharingAccountInfo(),n=l.useSharingPrefs();return n.isLoading||t.isLoading||a.isLoading?Ge.createElement(Ga,null):Ge.createElement(Ya,{objectMetadataResult:t,accountMetadataResult:a,sharingPrefsResult:n,...e})};Qa.displayName="Provider";const Xa="share-modal-evolution-access-level-dropdown",Ja=`${Xa}__portaled-menu`,en=()=>{const e=n.useIntl(),t=Za(),i=_.useAtom(t.$sharingAccessLevel),s=_.useAtom(t.$isInviteSending),r=_.useAtom(t.$canInviteEditor),o=_.useAtom(t.$canInviteViewer),c=(r?1:0)+(o?1:0),g=1===c,u=(()=>{const e=d.useLogger(),t=Za(),a=_.useAtom(t.$sharingAccessLevel);return Ge.useCallback((n=>{e("SHARE_MODAL_SHARE__LINK_ACCESS_LEVEL__CHANGE",{previous:a,next:{".tag":n}}),t.$sharingAccessLevel.set({".tag":n})}),[t,e,a])})(),m=a.Emstring.em_snippet(Ta(e,i),Math.floor(7.5),.5),p=m!==Ta(e,i);return Ge.createElement(a.Box,{className:a.cx([`${Xa}`,c>1?`${Xa}__with-menu`:void 0]),borderRadius:"Small",style:{minWidth:"auto",display:"flex",whiteSpace:"pre-wrap",flexWrap:"wrap",alignItems:"center"},"data-testid":"access-level-dropdown"},Ge.createElement(a.Menu.Wrapper,{onSelection:u,style:{verticalAlign:"bottom",whiteSpace:"nowrap",height:"100%"},className:Ja,matchContainingWidth:!0},(({getContentProps:t,getTriggerProps:n})=>Ge.createElement(Ge.Fragment,null,p?Ge.createElement(a.Box,{...n()},Ge.createElement(a.Tooltip,{title:Ta(e,i),openDelay:1e3},Ge.createElement(a.Button,{variant:"opacity","aria-label":Ta(e,i),withDropdownIcon:!0,size:"xlarge",disabled:s||g},m))):Ge.createElement(a.Button,{...n(),variant:"opacity","aria-label":Ta(e,i),withDropdownIcon:!0,size:"xlarge",disabled:s||g},m),Ge.createElement(a.Menu.Content,{"data-sharing-sdk":"1",...t(),placement:"bottom-end"},Ge.createElement(a.Menu.Segment,null,o?Ge.createElement(a.Menu.SelectItem,{key:"view",value:"viewer",selected:"editor"!==i[".tag"]},Ge.createElement(a.Text,null,Ta(e,l.VIEWER))):null,r?Ge.createElement(a.Menu.SelectItem,{key:"edit",value:"editor",selected:"editor"===i[".tag"]},Ge.createElement(a.Text,null,Ta(e,l.EDITOR))):null))))))};en.displayName="AccessLevelDropdown";const tn=e=>{const t=Za(),n=(e=>{const t=d.useEndpoint(l.validateTargets),n=d.useEndpoint(l.targetsSearch),i=d.useLogger(),s=Za();return Ge.useCallback((async()=>{const r=s.$inviteTargets.get();if(0===r.length)return void s.$inviteTargetValidations.set({});const o=s.$inviteTargetsWithInvalidEmails.get(),d=new Set,_=new Map;await Promise.all(o.map((async e=>{if("email"!==e[".tag"])return;const t=await n({query:e.email,limit:10,force_refresh:!1});if("SUCCESS"===t.status){const a=t.output.find((t=>"group"===t[".tag"]&&t.name.toLowerCase()===e.email.toLowerCase()));if(a&&"group"===a[".tag"]){const t=l.getUniqueId(e);d.add(t),_.set(t,a)}}})));const g=o.filter((e=>!d.has(l.getUniqueId(e)))).reduce(((e,t)=>({...e,[l.getUniqueId(t)]:{member:l.toMemberSelector(t),result:{".tag":"disallowed",disallowed:{".tag":"invalid_target"}},target_invite_eligibility:{".tag":"other"}}})),{});if(s.$inviteTargetValidations.set({...s.$inviteTargetValidations.get(),...g}),_.size>0){const e=s.$inviteTargets.get(),t=e.map((e=>{const t=l.getUniqueId(e);return _.get(t)||e}));if(t.some(((t,a)=>t!==e[a])))return void s.$inviteTargets.set(t)}if(0===s.$inviteTargetsWithValidEmails.get().length)return;const u=Object.values(s.$inviteTargetValidations.get()).map((e=>e?c.getUniqueId(e.member):null)),m=s.$inviteTargetsWithValidEmails.get().filter((e=>{const t=c.getUniqueId(l.toMemberSelector(e));return!u.includes(t)}));if(0===m.length)return;const p=a.getIsFile(e)?"file":"folder",f=s.$objectIdentifierId.get();i("SHARE_MODAL_SHARE__PREVALIDATION__API_START",null);const h=await t({access_level:s.$sharingAccessLevel.get(),content_id:f,content_type:{".tag":p},members:m.map(l.toMemberSelector)});if("ERROR"===h.status)return void i("SHARE_MODAL_SHARE__PREVALIDATION__API_ERROR",{error:h.error});if("FATAL"===h.status)return void i("SHARE_MODAL_SHARE__PREVALIDATION__API_FATAL",{error:h.error});i("SHARE_MODAL_SHARE__PREVALIDATION__API_SUCCESS",null);const E=s.$inviteTargets.get(),v=s.$sharingAccessLevel.get(),y=e,S=a.getContentIdOrPathFromObjectIdentifier(s.$props.get().oid);r===E&&s.$sharingAccessLevel.get()===v&&f===S&&e===y&&s.$inviteTargetValidations.set({...s.$inviteTargetValidations.get(),...l.normalize(h.output.results)})}),[s,t,i,e])})(e);Ge.useEffect((()=>{const e=[t.$inviteTargets.obs(n),t.$sharingAccessLevel.obs((()=>{n()})),t.$objectIdentifierId.obs((()=>{t.$inviteTargetValidations.set({}),n()}))];return t.$props.get().inviteTargets.length>0&&n(),()=>e.forEach((e=>e()))}),[])},an=Symbol("ON_IMMEDIATE_TRANSITION"),nn=Symbol("ON_INVITE__START"),sn=Symbol("ON_ADD_FILE_MEMBER_API_ERROR"),rn=Symbol("ON_ADD_FILE_MEMBER_API_FATAL"),on=Symbol("ON_ADD_FILE_MEMBER_API_SUCCESS"),ln=Symbol("ON_SHARE_FILE_FOLDER_FAILURE"),cn=Symbol("ON_SHARE_FILE_FOLDER_FAILURE_CONTINUE"),dn=Symbol("ON_ADD_FOLDER_MEMBER_API_ERROR"),_n=Symbol("ON_ADD_FOLDER_MEMBER_API_FATAL"),gn=Symbol("ON_ADD_FOLDER_MEMBER_API_SUCCESS"),un=Symbol("ON_BEFORE_UNLOAD_DURING_INVITE"),mn=Symbol("ON_UNLOAD_DURING_INVITE"),{useEmitter:pn,defaultEmitter:fn}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),s=t(a.Context$6),r=a.getShareModalTypeFromString("sm24"),o={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(s)},c={...a.getProperties$4(n),...a.getProperties$5(i),...a.getProperties$6(s)};if(e.key!==nn)if(e.key!==on&&e.key!==gn){if(e.key===rn||e.key===_n)return a.UDCL.logEnd(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:"network",fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:{...o,errorReason:"network"},eventState:"failed",key:e.payload.actionKey}),void(Date.now()-e.payload.startTime>11e4&&a.UDCL.logEvent("ops.inband.likely_api_timeout",{tags:o}));if(e.key===ln){const t=l.getShareInviteErrorReasonFromString(T.inbandShareResponseToErrorEnum[e.payload.error])||"undefined_error";return a.UDCL.logEnd(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:t,fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:{...o,errorReason:t},eventState:"failed",key:e.payload.actionKey}),void a.UDCL.logEvent("ops.sm24.share_file_folder_failure",{tags:{...o,errorReason:e.payload.error}})}if(e.key!==cn){if(e.key===dn){const t=l.getShareInviteErrorReasonFromString(T.inbandShareResponseToErrorEnum[e.payload.error])||"undefined_error";return a.UDCL.logEnd(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:t,fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:{...o,errorReason:t},eventState:"failed",key:e.payload.actionKey}),void a.UDCL.logEvent("ops.sm24.add_folder_member_api_failure",{tags:{...o,errorReason:e.payload.error}})}if(e.key===sn){const t=l.getShareInviteErrorReasonFromString(T.inbandShareResponseToErrorEnum[e.payload.error])||"undefined_error";return a.UDCL.logEnd(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,shareInviteErrorReason:t,fromNotifyInherited:!1,eventState:"failed",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:{...o,errorReason:t},eventState:"failed",key:e.payload.actionKey}),void a.UDCL.logEvent("ops.sm24.add_file_member_api_failure",{tags:{...o,errorReason:e.payload.error}})}if(e.key!==an)if(e.key!==un){if(e.key!==mn)return a.exhausts(e,void 0);a.UDCL.logEnd(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,fromNotifyInherited:!1,eventState:"canceled",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:{...o,errorReason:"navigation"},eventState:"canceled",key:e.payload.actionKey})}else{const t=Date.now()-e.payload.startTime,n=Math.round(1e4*t)/1e4;a.UDCL.logEvent("ops.inband.before_unload_during_invite",{tags:{...o,timeBucket:n.toString()}})}else a.UDCL.logEvent(l.PAP_Select_FlexibleSharingEntrypointAction({...c,flexibleSharingEntryPointAction:"inband_immediate",flexibleSharingEntryPointTimeToAction:e.payload.timeSinceView}),{tags:{...o,action:"inband_immediate"}})}else a.UDCL.logEvent("ops.sm24.share_file_folder_failure",{tags:{...o,errorReason:e.payload.error}})}else a.UDCL.logEnd(T.PAP_Send_ShareInvite({validationTraceId:void 0,numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,fromNotifyInherited:!1,sckeySha1:e.payload.sckeySha1,eventState:"success",shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:o,eventState:"success",key:e.payload.actionKey});else a.UDCL.logStart(T.PAP_Send_ShareInvite({numRecipients:e.payload.numRecipients,inbandAccessLevel:e.payload.accessLevel,isNewFolder:e.payload.isNewFolder,fromNotifyInherited:!1,shareModalType:r,actionElement:o.actionElement,actionSurface:o.actionSurface,isDir:"true"===o.isDir,screen:c.screen}),{tags:o,key:e.payload.actionKey})})),hn=e=>{const t=Za(),i=_.useAtom(t.$inviteTargets),s=_.useAtom(t.$inviteTargetValidations),r=n.useIntl(),o=d.useLogger();return Ge.useMemo((()=>{let t=null;const n=Object.values(s).reduce(((e,t)=>"allowed"===t.result[".tag"]&&"outside_of_team"===t.result.allowed[".tag"]||"disallowed"===t.result[".tag"]&&"outside_of_team"===t.result.disallowed[".tag"]?e+1:e),0);for(const c of i){const i=l.getUniqueId(c),d=s[i];if(d)if("disallowed"===d.result[".tag"]){const i=d.result.disallowed[".tag"];if("invalid_target"===i){t={level:"error",message:ba(r)};break}if("invalid_member"===i){if("group"===c[".tag"]){t={level:"error",message:fa(r)};break}t={level:"error",message:pa(r)};break}"outside_of_team"===i?t={level:"error",message:n>1?ha(r):Ea(r)}:"no_permission"===i?t=e&&a.getIsCollection(e)&&"group"===c[".tag"]?{level:"error",message:r.formatMessage({id:"vLSoUY",defaultMessage:"Collection sharing for groups is currently not supported"})}:{level:"error",message:va(r)}:"target_is_individual"===i?t={level:"error",message:ya(r)}:"target_not_same_team_restricted"===i?t={level:"error",message:Sa(r)}:(o("SHARE_MODAL_SHARE__PREVALIDATION__UNKNOWN_TAG",{value:i}),t={level:"error",message:ba(r)})}else if(!t&&"allowed"===d.result[".tag"]){const e=d.result.allowed[".tag"];if("no_warning"===e)continue;"outside_of_team"===e?t=t||{level:"warn",message:n>1?ua(r):ma(r)}:o("SHARE_MODAL_SHARE__PREVALIDATION__UNKNOWN_TAG",{value:e})}}return t}),[o,r,i,s,e])},En=(e,t)=>{const i=Za(),s=n.useIntl(),r=c.useShowSharingNotification(),o=d.useLogger(),g=d.usePlatform(),u=d.useEndpoint(l.addFileMember),m=d.useEndpoint(l.addFolderMember),p=d.useEndpoint(l.validateTargets),f=c.useAction(c.action),h=(()=>{const e=n.useIntl(),t=c.useShowSharingNotification();return Ge.useCallback((a=>"access_error"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Na(e)}),a.error[".tag"]):"user_error"===a.error[".tag"]&&"email_unverified"===a.error.user_error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Oa(e)}),a.error.user_error[".tag"]):"invalid_comment"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:ka(e)}),a.error[".tag"]):"rate_limit"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:wa(e)}),a.error[".tag"]):(a.error[".tag"],t({type:c.SharingNotificationType.FAILURE,message:ka(e)}),a.error[".tag"])),[e,t])})(),E=(()=>{const e=n.useIntl(),t=c.useShowSharingNotification();return Ge.useCallback((a=>"NetworkFailure"!==a.type&&"PollingNetworkFailure"!==a.type||429!==a.value.response.statusCode?"ApiError"===a.type&&"email_unverified"===a.value.response.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Oa(e)}),a.value.response.error[".tag"]):"ApiError"===a.type&&"no_permission"===a.value.response.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:$a(e)}),a.value.response.error[".tag"]):"ApiError"!==a.type||"too_many_mounts"!==a.value.response.error[".tag"]||"tree_size_exceeded"!==a.value.response.error.too_many_mounts[".tag"]&&"home_mounts_exceeded"!==a.value.response.error.too_many_mounts[".tag"]&&"total_mounts_exceeded"!==a.value.response.error.too_many_mounts[".tag"]?"ApiError"===a.type&&"bad_path"===a.value.response.error[".tag"]&&"already_shared"===a.value.response.error.bad_path[".tag"]?a.value.response.error.bad_path[".tag"]:"PollingApiError"===a.type&&"internal_error"===a.value.response.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE_WITH_HELP,message:Da(e),helpUrl:"/support",helpMessage:Ha(e)},{message:Pa(e)}),a.value.response.error[".tag"]):(t({type:c.SharingNotificationType.FAILURE,message:ka(e)}),"PollingTimeout"===a.type?"network":"PollingFailed"===a.type?"failed":"ApiError"===a.type||"PollingApiError"===a.type?a.value.response.error[".tag"]:"undefined"):(t({type:c.SharingNotificationType.FAILURE_WITH_HELP,message:Ba(e,a.value.response.error.too_many_mounts.limit-a.value.response.error.too_many_mounts.current_count),helpMessage:za(e),helpUrl:"https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate"}),a.value.response.error.too_many_mounts[".tag"]):(t({type:c.SharingNotificationType.FAILURE_WITH_HELP,message:ja(e),helpUrl:"/help/9259"}),"network")),[e,t])})(),v=(()=>{const e=n.useIntl(),t=c.useShowSharingNotification();return Ge.useCallback((a=>"access_error"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Na(e)}),a.error[".tag"]):"email_unverified"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Oa(e)}),a.error[".tag"]):"bad_member"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Ra(e)}),a.error[".tag"]):"cant_share_outside_team"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:La(e)}),a.error[".tag"]):"too_many_members"===a.error[".tag"]||"too_many_pending_invites"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Ua(e)}),a.error[".tag"]):"insufficient_plan"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:Fa(e)}),a.error[".tag"]):"team_folder"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:La(e)}),a.error[".tag"]):"no_permission"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:$a(e)}),a.error[".tag"]):"rate_limit"===a.error[".tag"]?(t({type:c.SharingNotificationType.FAILURE,message:wa(e)}),a.error[".tag"]):(t({type:c.SharingNotificationType.FAILURE,message:ka(e)}),a.error[".tag"])),[e,t])})(),y=pn(),{user:S}=a.useActiveUser(),b=l.useOnPostInbandShareHook(),I=_.useAtom(i.$sharingAccessLevel),M=hn(e),{oid:C,onShareStart:T,onShareFailure:x,onInbandShareSuccess:k,onObjectIdentifierChanged:N}=_.useAtom(i.$props),{getVisitorData:L}=A.useAbuseFpjsContext();return Ge.useCallback((async()=>{if(i.$isInviteSending.get())return;const n=i.$inviteTargets.get(),A=I[".tag"],R=i.$isNewFolder.get();let w=C;const $={numRecipients:n.length,accessLevel:"viewer"===A?"view":"edit",actionKey:Math.random().toString(),isNewFolder:R,startTime:Date.now()};if(o("SHARE_MODAL_SHARE__INVITE__START",null),y.select(nn).emit($),T(null),i.$isInviteSending.set(!0),i.$inviteTargetsWithInvalidEmails.get().length>0)return;o("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_START",null);const O=a.getContentIdOrPathFromObjectIdentifier(C),D=await p({members:i.$inviteTargetsWithValidEmails.get().map(l.toMemberSelector),content_type:{".tag":"file"===C[".tag"]?"file":"file_folder"===C[".tag"]?"folder":"shared_folder"},access_level:{".tag":A},content_id:O});if("ERROR"===D.status&&o("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_ERROR",{error:D.error}),"FATAL"===D.status&&o("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_FATAL",{error:D.error}),"SUCCESS"===D.status&&(o("SHARE_MODAL_SHARE__INVITE__VALIDATION_API_SUCCESS",null),i.$inviteTargetValidations.set(l.normalize(D.output.results))),M&&"error"===M.level)return o("SHARE_MODAL_SHARE__INVITE__CANCELLED",null),void i.$isInviteSending.set(!1);const P=e=>(o("SHARE_MODAL_SHARE__INVITE__NAVIGATE_ATTEMPT",null),y.select(un).emit($),e.preventDefault(),e.returnValue="",""),F=()=>{o("SHARE_MODAL_SHARE__INVITE__NAVIGATE_AWAY",null),y.select(mn).emit($)};i.$props.get().onShareStart(null),window.addEventListener("beforeunload",P),window.addEventListener("unload",F);const U=()=>{i.$isInviteSending.set(!1),window.removeEventListener("beforeunload",P),window.removeEventListener("unload",F),x(null)},H=i.$props.get().inviteMessage,B=i.$shouldPostMessageAsComment.get(),j=(null==S?void 0:S.email)||"";if("file"===C[".tag"]){const e=await L("INBAND_SHARE_MODAL_FILE",j);o("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_START",null);const t=await u({access_level:{".tag":A},file:O,members:n.map(l.toMemberSelector),custom_message:H,add_message_as_comment:B&&H.length>0,fp_sealed_result:e.sealedResult});if("ERROR"===t.status){o("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_ERROR",{response:t});const e=h(t);return y.select(sn).emit({...$,error:e}),void U()}if("FATAL"===t.status)return o("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_FATAL",{response:t}),y.select(rn).emit($),U(),void r({type:c.SharingNotificationType.FAILURE_WITH_HELP,message:Da(s),helpUrl:"/support",helpMessage:Ha(s)},{message:Pa(s)});a.invalidateObjectMembers(C),o("SHARE_MODAL_SHARE__INVITE__ADD_FILE_MEMBER_API_SUCCESS",{response:t});const i=t.output[0]&&t.output[0].sckey_sha1&&t.output[0].sckey_sha1;y.select(on).emit({...$,sckeySha1:i})}if("file_folder"===C[".tag"]||"shared_folder"===C[".tag"]||"collection"===C[".tag"]){let t="file_folder"===C[".tag"]?"":"collection"===C[".tag"]?C.nsId:C.sharedFolderId;if("file_folder"===C[".tag"]){o("SHARE_MODAL_SHARE__INVITE__SHARE_FILE_FOLDER__START",null);const n=await f({path:C.path,timeout:12e4,interval:1e3});if(n.success){t=n.value.response.output.shared_folder_id;const e=n.value.response.output.folder_id;g===d.Platforms.DESKTOP&&(w={".tag":"shared_folder",sharedFolderId:t,fileId:e})}else{if("ApiError"!==n.type||"bad_path"!==n.value.response.error[".tag"]||"already_shared"!==n.value.response.error.bad_path[".tag"]){U(),o("SHARE_MODAL_SHARE__INVITE__SHARE_FILE_FOLDER__FAILURE",{output:n});const e=E(n);return void y.select(ln).emit({...$,error:e})}{t=n.value.response.error.bad_path.shared_folder_id;const e=n.value.response.error.bad_path.folder_id;g===d.Platforms.DESKTOP&&(w={".tag":"shared_folder",sharedFolderId:t,fileId:e});const a=E(n);y.select(cn).emit({...$,error:a})}}o("SHARE_MODAL_SHARE__INVITE__SHARE_FILE_FOLDER__SUCCESS",null),await c.invalidateSharingObjectMetadata(w),a.isNewApiMetadata(e)&&await c.invalidateNewApiObjectMetadata(w)}const i=await L("INBAND_SHARE_MODAL_FOLDER",j);o("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_START",null);const _=await m({shared_folder_id:t,...{...H?{custom_message:H}:{}},members:n.map((e=>({access_level:{".tag":A},member:l.toMemberSelector(e)}))),fp_sealed_result:i.sealedResult});if("ERROR"===_.status){o("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_ERROR",{response:_});const e=v(_);return y.select(dn).emit({...$,error:e}),void U()}if("FATAL"===_.status)return o("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_FATAL",{response:_}),y.select(_n).emit($),U(),void r({type:c.SharingNotificationType.FAILURE,message:Da(s)},{message:Pa(s)});o("SHARE_MODAL_SHARE__INVITE__ADD_FOLDER_MEMBER__API_SUCCESS",{response:_}),w={".tag":"shared_folder",sharedFolderId:t,fileId:C.fileId},await a.invalidateObjectMembers(w),await c.invalidateSharingObjectMetadata(w),await c.invalidateNewApiObjectMetadata(w);const u=void 0;y.select(gn).emit({...$,sckeySha1:u})}i.$isInviteSending.set(!1),window.removeEventListener("beforeunload",P),window.removeEventListener("unload",F);const V=1===n.length?((e,t,n)=>e.formatMessage({id:"KvzV8x",defaultMessage:"Shared <st>{name}</st>. {recipient} will receive an email."},{st:e=>Ge.createElement("strong",{key:a.getName(t)},e),name:c.Emstring.em_snippet(a.getName(t),a.SNIPPET_SIZES.FILENAME),recipient:n}))(s,e,l.getContactChipDisplayName(n[0])):((e,t)=>e.formatMessage({id:"ZO+R7/",defaultMessage:"Shared <st>{name}</st>. Emails will be sent to all recipients."},{st:e=>Ge.createElement("strong",{key:a.getName(t)},e),name:c.Emstring.em_snippet(a.getName(t),a.SNIPPET_SIZES.FILENAME)}))(s,e);r({type:c.SharingNotificationType.COMPLETED,message:xa(s,e)},{message:V}),w&&await(null==N?void 0:N(w)),_.batch((()=>{i.$inviteTargets.set([]),i.$inviteMessage.set("")})),k(),"SUCCESS"===D.status&&(i.$props.get().shouldDisablePostInbandShareHooks||b({objectMetadata:e,objectIdentifier:C,inviteTargets:n,targetsValidateResult:D.output,sharingPrefs:t,user:S}))}),[i,I,o,y,T,C,p,M,S,r,s,e,k,x,L,u,h,m,f,g,E,v,N,b,t])},vn=e=>{const t=n.useIntl(),i=d.useLogger(),s=c.useShowSharingNotification();return Ge.useCallback((async(n,r,o,l)=>{const d=((e,t,n)=>{const i=a.getName(n),s=a.getParentFolderName(n);return t?e.formatMessage({id:"7POTZF",defaultMessage:"Members removed from <strong>{folderName}</strong>."},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ge.createElement("strong",null,e)}):void 0===s||""===s?e.formatMessage({id:"nni9pE",defaultMessage:"<strong>{folderName}</strong> shared with everyone."},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ge.createElement("strong",null,e)}):e.formatMessage({id:"qvP8A+",defaultMessage:"<strong>{folderName}</strong> shared with members of <strong>{parentFolderName}</strong>."},{folderName:c.Emstring.em_snippet(i,a.SNIPPET_SIZES.FOLDER_NAME),parentFolderName:c.Emstring.em_snippet(s,a.SNIPPET_SIZES.FOLDER_NAME),strong:e=>Ge.createElement("strong",null,e)})})(t,r,e);s(o?{type:c.SharingNotificationType.COMPLETED_WITH_UNDO,message:d,undoOnClick:()=>null==l?void 0:l(n)}:{type:c.SharingNotificationType.COMPLETED,message:d}),i("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_CONFIDENTIALITY__FINISH",null)}),[t,s,i,e])},yn=e=>{const t=Za(),{oid:i}=_.useAtom(t.$props),s=(e=>{const t=n.useIntl(),i=c.useShowSharingNotification(),s=Za(),r=d.useLogger(),{onObjectIdentifierChanged:o}=_.useAtom(s.$props),l=c.useAction(c.action$1),g=c.useAction(c.action),u=vn(e);return Ge.useCallback((async(n,s,d,_)=>{if("shared_folder"!==n[".tag"]&&"file_folder"!==n[".tag"])return;r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_CONFIDENTIALITY__START",null),i({type:c.SharingNotificationType.IN_PROGRESS,message:Va(t,s,e)});let m=n;if("file_folder"===m[".tag"]){r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_START",null);const l=await g({path:m.path,confidentiality:s?{".tag":"confidential"}:{".tag":"not_confidential"},timeout:12e4,interval:1e3});if(l.success)return r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_SUCCESS",null),m={".tag":"shared_folder",sharedFolderId:l.value.response.output.shared_folder_id,fileId:n.fileId},await(null==o?void 0:o(m)),a.isNewApiMetadata(e)&&await c.invalidateNewApiObjectMetadata(n),u(m,s,d,_),void a.invalidateObjectMembers(m);if("ApiError"!==l.type||"bad_path"!==l.value.response.error[".tag"]||"already_shared"!==l.value.response.error.bad_path[".tag"])return r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_FAILURE",null),void i({type:c.SharingNotificationType.FAILURE,message:qa(t,s)});r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_SUCCESS",null),m={".tag":"shared_folder",sharedFolderId:l.value.response.error.bad_path.shared_folder_id,fileId:n.fileId},await(null==o?void 0:o(m)),a.isNewApiMetadata(e)&&await c.invalidateNewApiObjectMetadata(n),r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SHARE_FILE_FOLDER__API_SUCCESS",null)}if(r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_ACCESS_INHERITANCE__API_START",null),!(await l({setAccessInheritanceArg:{access_inheritance:s?{".tag":"no_inherit"}:{".tag":"inherit"},shared_folder_id:m.sharedFolderId},timeout:12e4,interval:1e3})).success)return r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_ACCESS_INHERITANCE__API_FAILURE",null),void i({type:c.SharingNotificationType.FAILURE,message:qa(t,s)});r("SHARE_MODAL_SHARE__CHANGE_CONFIDENTIALITY__SET_ACCESS_INHERITANCE__API_SUCCESS",null),u(m,s,d,_),a.invalidateObjectMembers(m)}),[t,i,r,e,u,l,g,o])})(e);return Ge.useCallback((async e=>s(i,e,!0,(async t=>s(t,!e,!1)))),[i,s])},Sn=(e,t,n)=>n?((e,t)=>e.formatMessage({id:"6jTcuT",defaultMessage:"Share with {teamName}"},{teamName:c.Emstring.em_snippet(t,a.SNIPPET_SIZES.DISPLAY_NAME)}))(e,t):(e=>e.formatMessage({id:"P5jM9e",defaultMessage:"Share"}))(e),bn=(e,t,n,i,s)=>s?((e,t,n)=>e.formatMessage({id:"ipUgQi",defaultMessage:"Share <b>{folderName}</b> with everyone at {teamName}?"},{folderName:c.Emstring.em_snippet(t,a.SNIPPET_SIZES.FOLDER_NAME),teamName:c.Emstring.em_snippet(n,a.SNIPPET_SIZES.DISPLAY_NAME),b:e=>Ge.createElement("b",{style:{fontWeight:"var(--type__title__standard--fontweight_strong)"}},e)}))(e,n,t):((e,t,n)=>e.formatMessage({id:"znRNbl",defaultMessage:"Share <b>{folderName}</b> with everyone who can access <b>{parentFolderName}</b>?"},{folderName:c.Emstring.em_snippet(t,a.SNIPPET_SIZES.FOLDER_NAME),parentFolderName:c.Emstring.em_snippet(n,a.SNIPPET_SIZES.FOLDER_NAME),b:e=>Ge.createElement("b",{style:{fontWeight:"var(--type__title__standard--fontweight_strong)"}},e)}))(e,n,i),In=(e,t,a,n,i)=>i?((e,t,a)=>e.formatMessage({id:"R8xJiq",defaultMessage:"<b>{folderName}</b> won’t be shared privately any more. Everyone at {teamName} will have access to this folder."},{folderName:t,teamName:a,b:e=>Ge.createElement("b",{style:{fontWeight:"var(--type__body__standard--fontweight_strong)"}},e)}))(e,a,t):((e,t)=>e.formatMessage({id:"ioGEl6",defaultMessage:"Everyone who can access <b>{parentFolderName}</b> will be able to access this folder."},{parentFolderName:t,b:e=>Ge.createElement("b",{style:{fontWeight:"var(--type__body__standard--fontweight_strong)"}},e)}))(e,n),Mn=({objectMetadata:e})=>{const t=n.useIntl(),i=Za(),s=_.useAtom(i.$changeConfidentialityData),r=(()=>{const e=Za();return Ge.useCallback((()=>{e.$changeConfidentialityData.set(null)}),[e])})(),o=yn(e);if(!s)return null;const l=a.getName(e),c=a.getParentFolderName(e),d=""===c,g=Sn(t,s.teamName,d),u=bn(t,s.teamName,l,c,d),m=In(t,s.teamName,l,c,d);return Ge.createElement(Ge.Fragment,null,Ge.createElement(a.Modal,{open:!0,isCentered:!0,withCloseButton:"Close",onRequestClose:r},Ge.createElement(a.Modal.Header,{"data-sharing-sdk":"1",hasBottomSpacing:"title-standard"},Ge.createElement(a.Modal.Title,null,u)),Ge.createElement(a.Modal.Body,{"data-sharing-sdk":"1"},m),Ge.createElement(a.Modal.Footer,{"data-sharing-sdk":"1"},Ge.createElement(a.Button,{variant:"opacity",onClick:r},(e=>e.formatMessage({id:"i3tRYX",defaultMessage:"Cancel"}))(t)),Ge.createElement(a.Button,{variant:"primary",onClick:()=>{o(!1),r()}},g))))};Mn.displayName="ChangeConfidentialityModal";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/inband-screen-v2/internals/message-field.module.out-vflefczAX.css",(e=>"._message-field_cxkr1_1{display:flex;flex-direction:column;flex-grow:1;margin-bottom:-3px;padding-top:0;position:relative}._message-field_cxkr1_1 textarea{background-color:var(--dig-color__background__base);border:1px solid var(--dig-color__border__subtle);flex-grow:1}._message-field_cxkr1_1._message-field-invalid_cxkr1_16 textarea{border-color:var(--dig-color__alert__base)}._message-field-invalid_cxkr1_16 textarea:focus-visible{border-color:var(--dig-color__alert__base);box-shadow:0 0 0 3px var(--dig-color__alert__base--state-1);outline:none}._message-field-with-banner_cxkr1_26 textarea{border-bottom-color:var(--dig-color__primary__surface--state-2);border-bottom-left-radius:0;border-bottom-right-radius:0;min-height:114px}._message-field-textarea-mobile_cxkr1_34{font-size:16px}._top-right-button_cxkr1_38{position:absolute;right:11px;top:8px}._summarized-banner_cxkr1_44{border:1px solid var(--dig-color__primary__surface--state-2);border-top:none;border-top-left-radius:0;border-top-right-radius:0;z-index:-1}._summarized-banner-message_cxkr1_53{color:var(--dig-color__primary__base);font-weight:500}._summarized-banner-icon_cxkr1_58{color:var(--dig-color__foldericon__icon)}"));const Cn="_message-field_cxkr1_1",An="_message-field-invalid_cxkr1_16",Tn="_message-field-textarea-mobile_cxkr1_34",xn=({isInviteMessageTooLong:e})=>{const t=n.useIntl(),i=Za(),s=d.useLogger(),r=_.useStore(i.$isInviteSending),[o,l]=Ge.useState(i.$inviteMessage.get()),[c,g]=Ge.useState(!1),u=Ge.useCallback((e=>{i.$isInviteMessageTooLong.set(e.currentTarget.value.length>2e3),s("SHARE_MODAL_SHARE__MESSAGE_CHANGED",null),l(e.currentTarget.value),i.$inviteMessage.set(e.currentTarget.value)}),[s,i]),m=f.is_mobile_or_tablet();return Ge.createElement(a.Box,{className:a.cx(Cn,{[An]:e}),paddingTop:"Micro Large"},Ge.createElement(a.TextArea,{className:a.cx(m?Tn:void 0),value:o,placeholder:Ia(t),"aria-label":Ma(t),onChange:e=>{l(e.currentTarget.value),c||u(e)},disabled:r,isInvalid:e,"data-testid":"ib-message-field-textarea",onCompositionStart:()=>g(!0),onCompositionEnd:e=>{g(!1),u(e)}}))};xn.displayName="MessageField";a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/inband-screen-v2/internals/share-modal-share.module.out-vflDUldWT.css",(e=>"._action-row_1x6i6_1{display:flex;flex-direction:column;min-height:310px;row-gap:var(--dig-spacing__micro__medium);width:100%}._action-row-expand-from-accessory-area_1x6i6_12{animation:_action-row-expand-accessory-area_1x6i6_1 var(--duration__surface) var(--easing__transition) forwards;min-height:64px;overflow:hidden}._action-section_1x6i6_19{border:1px solid var(--dig-color__border__subtle);border-radius:var(--dig-radius__medium);min-width:0;position:relative;transition:border var(--duration__micro-fast) var(--easing__transition);width:100%;z-index:1}._action-section-top_1x6i6_29{display:flex;height:48px}._action-section-active_1x6i6_34{border-color:var(--dig-color__secondary__base);box-shadow:none}._action-section-active_1x6i6_34,._action-section-active_1x6i6_34:hover,._action-section_1x6i6_19:focus-within{box-shadow:var(--dig-utilities__boxshadow__focus-ring);transition:box-shadow var(--duration__micro-fast) var(--easing__transition)}._accessory-section_1x6i6_46{animation:_fade-in_1x6i6_1 var(--duration__micro-fast) var(--easing__transition) forwards;display:flex;flex-direction:column;flex-grow:1;height:100%;row-gap:var(--dig-spacing__micro__medium);width:100%}._action-row-expand-from-accessory-area_1x6i6_12 ._accessory-section_1x6i6_46{animation:_fade-in_1x6i6_1 var(--duration__surface) var(--easing__transition) forwards}@media (prefers-reduced-motion:reduce){._action-row-expand-from-accessory-area_1x6i6_12,._action-row-expand-from-accessory-area_1x6i6_12 ._accessory-section_1x6i6_46{animation-timing-function:var(--easing__linear)}}@keyframes _action-row-expand-accessory-area_1x6i6_1{0%{max-height:64px;min-height:64px}to{min-height:286px;overflow:visible}}@keyframes _fade-in_1x6i6_1{0%{opacity:0}to{opacity:1}}._action-section-bottom_1x6i6_90{align-items:center;display:flex;height:48px;justify-content:space-between}._add-icon-small_1x6i6_98{height:var(--dig-spacing__dimension__24);margin-top:var(--dig-spacing__dimension__6);min-width:var(--dig-spacing__dimension__24);width:var(--dig-spacing__dimension__24)}._add-icon-small_1x6i6_98 svg{height:var(--dig-spacing__dimension__16);width:var(--dig-spacing__dimension__16)}._add-icon_1x6i6_98,._add-icon_1x6i6_98>svg{transition:min-width var(--duration__surface) var(--easing__transition),width var(--duration__surface) var(--easing__transition),background-color var(--duration__surface) var(--easing__transition),color var(--duration__surface) var(--easing__transition),height var(--duration__surface) var(--easing__transition),margin-top var(--duration__surface) var(--easing__transition)}._add-icon-shrink_1x6i6_123{animation:_shrink-icon_1x6i6_1 var(--duration__micro-fast) var(--easing__transition) forwards}._add-icon-shrink_1x6i6_123>svg{animation:_shrink-icon-svg_1x6i6_1 var(--duration__micro-fast) var(--easing__transition) forwards}@keyframes _shrink-icon_1x6i6_1{0%{height:var(--dig-spacing__dimension__36);margin-top:0;min-width:var(--dig-spacing__dimension__36);width:var(--dig-spacing__dimension__36)}to{height:var(--dig-spacing__dimension__24);margin-top:5px;min-width:var(--dig-spacing__dimension__24);width:var(--dig-spacing__dimension__24)}}@keyframes _shrink-icon-svg_1x6i6_1{0%{height:var(--dig-spacing__dimension__24);width:var(--dig-spacing__dimension__24)}to{height:var(--dig-spacing__dimension__16);width:var(--dig-spacing__dimension__16)}}._add-members-directly-action-section_1x6i6_172{border-color:var(--dig-color__border__subtle);border-radius:var(--dig-radius__small);border-style:solid;border-width:2px;position:relative;z-index:1}._add-members-directly-action-section_1x6i6_172 ._add-icon_1x6i6_98{margin-top:0}._add-members-directly-action-section-active_1x6i6_185,._add-members-directly-action-section_1x6i6_172:focus-within{border-color:var(--dig-color__utility__focus-ring)}._add-members-directly-action-section-active_1x6i6_185 ._add-icon_1x6i6_98,._add-members-directly-action-section_1x6i6_172:focus-within ._add-icon_1x6i6_98,._add-members-directly-action-section_1x6i6_172:hover ._add-icon_1x6i6_98{background:var(--dig-color__primary__base);color:var(--dig-color__background__base)}._add-members-directly-action-section-bottom_1x6i6_197{padding:var(--dig-spacing__micro__medium);padding-top:var(--dig-spacing__micro__medium)}._add-members-directly-action-section-active_1x6i6_185 ._add-icon-sending_1x6i6_202,._add-members-directly-action-section_1x6i6_172:focus-within ._add-icon-sending_1x6i6_202,._add-members-directly-action-section_1x6i6_172:hover ._add-icon-sending_1x6i6_202{background:var(--dig-color__disabled__base)}._add-members-directly-action-section_1x6i6_172 ._add-icon-sending_1x6i6_202>svg,._add-members-directly-action-section-active_1x6i6_185 ._add-icon-sending_1x6i6_202>svg,._add-members-directly-action-section_1x6i6_172:focus-within ._add-icon-sending_1x6i6_202>svg,._add-members-directly-action-section_1x6i6_172:hover ._add-icon-sending_1x6i6_202>svg{color:var(--dig-color__disabled__on-surface)}"));const kn="_action-row_1x6i6_1",Nn="_action-row-expand-from-accessory-area_1x6i6_12",Ln="_action-section_1x6i6_19",Rn="_action-section-top_1x6i6_29",wn="_action-section-active_1x6i6_34",$n="_accessory-section_1x6i6_46",On="_action-section-bottom_1x6i6_90",Dn=Symbol("ON_SHOW_SUGGESTIONS"),Pn=Symbol("ON_SELECT_SUGGESTION"),{useEmitter:Fn,defaultEmitter:Un}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),s=t(a.Context$6),r=t(a.Context$7),o={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(s),...a.getTags$7(r)};e.key!==Dn?e.key!==Pn||a.UDCL.logEvent("ops.sm24.select_tokenizer_suggestion",{tags:{...o,method:e.payload.method,suggestionIndex:e.payload.index.toString()}}):a.UDCL.logEvent("ops.sm24.show_tokenizer_suggestions",{tags:{...o,numSuggestions:e.payload.numSuggestions.toString()}})}));a.injectInternalStyle("/static/metaserver/static/js/sharing/sharing-sdk/legos/targets-tokenizer-v2/internals/targets-tokenizer.module.out-vfl1ljyyT.css",(e=>"._share-tokenizer_1w72x_1{-ms-overflow-style:none;align-items:center;color-scheme:var(--dig-color-scheme);display:flex;max-height:48px;max-width:100%;min-height:40px;min-width:auto;overflow-x:hidden;scrollbar-width:none;width:100%}._share-tokenizer-with-targets_1w72x_17{overflow-x:auto}._share-tokenizer-text-input-container_1w72x_21{border:none;box-shadow:none;cursor:text;min-width:300px;outline:none;position:relative}._share-tokenizer-text-input-container_1w72x_21:focus-within{border:none;box-shadow:none;outline:none}._share-tokenizer-text-input-container_1w72x_21:has(input:focus){border:none;box-shadow:none;outline:none}._share-tokenizer-typeahead-container_1w72x_45{border-radius:var(--dig-radius__small);width:100%}._share-tokenizer-with-targets_1w72x_17:not(._share-tokenizer_1w72x_1) ._share-tokenizer-typeahead-container_1w72x_45{transform:translate(-14px)}input._share-tokenizer-text-input_1w72x_21[type=text]{font-family:var(--type__body__standard--fontfamily);font-size:var(--type__body__standard--fontsize);line-height:var(--type__body__standard--lineheight_label);min-height:var(--dig-spacing__dimension__24);min-width:2ch;width:0}input._share-tokenizer-text-input-mobile_1w72x_67[type=text]{font-size:16px}._screen-reader-only_1w72x_71{height:1px;left:-10000px;overflow:hidden;position:absolute;top:auto;width:1px}"));const Hn="_share-tokenizer_1w72x_1",Bn="_share-tokenizer-with-targets_1w72x_17",jn="_share-tokenizer-text-input-container_1w72x_21",Vn="_share-tokenizer-typeahead-container_1w72x_45",qn="_share-tokenizer-text-input_1w72x_21",zn="_share-tokenizer-text-input-mobile_1w72x_67",Gn="_screen-reader-only_1w72x_71",Wn=e=>e.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."}),Kn=e=>e.formatMessage({id:"Au33+R",defaultMessage:"Successfully connected your contacts from Google"}),Yn=e=>e.formatMessage({id:"sgP44K",defaultMessage:"Failed to connect your contacts from Google"}),Zn=e=>e.formatMessage({id:"6EE+ph",defaultMessage:"Suggested people list"}),Qn=e=>e.formatMessage({id:"CkYgqG",defaultMessage:"Sign in to import contacts"}),Xn=e=>e.formatMessage({id:"2/+46g",defaultMessage:"Connected"}),Jn=e=>e.formatMessage({id:"JbMFlW",defaultMessage:"Importing contacts"}),ei=e=>e.formatMessage({id:"ABdC2z",defaultMessage:"external member"}),ti="IMPORT_CONTACTS",ai=[ti],ni=/['&A-Za-z0-9\._%+-]+@[A-Za-z0-9-][A-Za-z0-9\.-]*\.[A-Za-z]{2,15}/gi,ii=/[,|;>\s]/,si="Enter",ri="Google",oi="/static/images/index/google-logo-color.svg",li=e=>e.map((e=>{if("email"===e[".tag"]||"user"===e[".tag"]){const t=e.email.trim();return t.length===e.email.length?e:{...e,email:t}}return e})),ci=e=>{const t={};return e.filter((e=>{const a=l.getUniqueId(e);return!t[a]&&(t[a]=!0,!0)}))},di=({store:e,target:t,isDisabled:i,maxChars:s})=>{const r=n.useIntl(),o=gi(e,t),d=c.Emstring.em_snippet(l.getContactChipDisplayName(t),null!=s?s:a.SNIPPET_SIZES.EMAIL_SHORT_WITH_OVERFLOW,.6),g=_i(t,r),u=l.getAvatarUrl(t),m=l.getUniqueId(t),p=_.useStore(e.$inviteTargetValidation)[m],[f,h]=Ge.useState(!1),E=p&&"allowed"===p.result[".tag"]&&"no_warning"!==p.result.allowed[".tag"]&&"not_dropbox_user"!==p.result.allowed[".tag"],v=p&&"allowed"===p.result[".tag"]&&"outside_of_team"===p.result.allowed[".tag"],y=Ge.createElement(a.Box,{display:"flex",position:"absolute",alignItems:"center",backgroundColor:"Secondary Base",color:"Background Base",tabIndex:0,borderRadius:"Circular",style:{right:"-1px",bottom:"-1px"}},Ge.createElement(a.UIIcon,{color:"Background Base",height:12,width:12,src:N.ExternalMemberLine})),S=Ge.createElement(a.Box,{position:"relative",marginLeft:"4",marginRight:"4"},Ge.createElement(a.Avatar,{src:u||"",size:"xsmall",hasNoOutline:!0,"aria-hidden":!0},g),E&&y),b=((e,t)=>e.formatMessage({id:"cVF7dM",defaultMessage:"Sharing with {label} - press backspace or delete to remove"},{label:t}))(r,d),I="name"in t&&""!==t.name,M="email"in t&&""!==t.email;return Ge.createElement(a.Tooltip,{openDelay:1e3,title:Ge.createElement(a.Box,{display:"flex",flexDirection:"column",alignItems:"center"},I&&Ge.createElement(a.Tooltip.Text,{withMargin:!1,isBold:!0,size:"small"},t.name),M&&Ge.createElement(a.Tooltip.Text,{withMargin:!1,isBold:!I,color:I?"subtle":void 0,size:"small"},t.email),v&&Ge.createElement(a.Tooltip.Text,{withMargin:!1,color:"subtle",size:"small"},ei(r)))},Ge.createElement(k.Chip,{size:"medium",onDelete:f?o:void 0,variant:"standard",disabled:i,"aria-label":b,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),style:{marginRight:"var(--dig-spacing__micro__xsmall)"}},Ge.createElement(k.Chip.AvatarAccessory,null,S),Ge.createElement(k.Chip.Content,null,d)))};di.displayName="EmailChip";const _i=(e,t)=>"user"===e[".tag"]?c.getUserInitials(e.name,t.locale):"group"===e[".tag"]?c.getGroupInitials(e.name):"email"===e[".tag"]?c.getUserInitials(e.email,t.locale):a.exhausts(e,""),gi=(e,t)=>Ge.useCallback((()=>{const a=e.$inviteTargets.get().filter((e=>e!==t));_.batch((()=>{e.$inviteTargets.set(a),e.$query.set("")}))}),[e,t]),ui=e=>{const t=d.useEndpoint(l.listLinkedServices);return Ge.useCallback((async()=>{if(e.$isLinkedServicesUpdating.get())return;const a=await t(null);"SUCCESS"===a.status?_.batch((()=>{e.$linkedServices.set(a.output),e.$isLinkedServicesUpdating.set(!1)})):_.batch((()=>{e.$linkedServices.set(null),e.$isLinkedServicesUpdating.set(!1)}))}),[e,t])},mi=e=>"user"===e[".tag"]||"group"===e[".tag"]?e.name:"email"===e[".tag"]?e.email:"",pi=({target:e})=>{const t=n.useIntl(),i=l.getUniqueId(e),s=fi(e,t),r=mi(e),o=l.formatSubTitle(e,t),c=l.getAvatarUrl(e);return Ge.createElement(x.Typeahead.Row,{"data-testid":"typeahead-suggestion",className:"targets-tokenizer-suggestion",key:i,value:e,withTitle:r,withSubtitle:o,withLeftAccessory:Ge.createElement(a.Avatar,{src:c||void 0,hasNoOutline:!0,alt:r,"aria-hidden":"true"},s)})};pi.displayName="Suggestion";const fi=(e,t)=>"user"===e[".tag"]?c.getUserInitials(e.name,t.locale):"group"===e[".tag"]?c.getGroupInitials(e.name):"email"===e[".tag"]?c.getUserInitials(e.email,t.locale):a.exhausts(e,""),hi=e=>{const t=n.useIntl(),i=c.useShowSharingNotification(),s=d.useLogger(),r=ui(e),o=d.useRedirectWindowToken();return Ge.useCallback((async()=>{if(e.$isConnectingToGoogle.get()||null===o)return;e.$isConnectingToGoogle.set(!0);let n=null;const l=()=>{i({type:c.SharingNotificationType.FAILURE,message:Yn(t)}),null!==n&&clearInterval(n),window.removeEventListener("message",g),r().then((()=>{e.$isConnectingToGoogle.set(!1)}))},d=new URLSearchParams({service:"1",is_popup:"true",action:"link_contacts",prompt_select:"true",token:o,user_id:e.$user.get().id.toString(),is_desktop:"false"}),_=window.open(`/profile_services/start_auth_flow?${d.toString()}`,"Google","width=600,height=600,resizable=1,scrollbars=1");if(null===_)return l();n=setInterval((()=>{_.closed&&l()}),1e3);const g=o=>{let d;try{d=JSON.parse(o.data)}catch(e){return}if(a.isObjectOf({type:a.isExactly("db:profile_service:auth_complete"),payload:a.isObjectOf({success:a.isBoolean})})(d)){if(d.payload.success)return u=_,s("TEAMS_WEB",{name:a.TeamsWebEventName.ImportContactsComplete,extra:{provider:"google",path:window.location.pathname}}),i({type:c.SharingNotificationType.COMPLETED,message:Kn(t)}),null!==n&&clearInterval(n),window.removeEventListener("message",g),r().then((()=>{e.$isConnectingToGoogle.set(!1)})),void(null==u||u.close());var u;l(),_.close()}};window.addEventListener("message",g)}),[e,t,s,r,o,i])},Ei=e=>(e.match(ni)||[]).map(l.createFromEmail),vi=e=>Ge.useCallback((t=>{const a=t.currentTarget.value,n=(i=a,ii.test(i)?Ei(i):[]);var i;_.batch((()=>{e.$isTypeaheadForcedOpen.set(!1),n.length>0?(e.$inviteTargets.set([...e.$inviteTargets.get(),...n]),e.$query.set("")):e.$query.set(a)}))}),[e]),yi=e=>{const t=(e=>{const t=d.useEndpoint(l.targetsSearch),a=d.useLogger(),i=n.useIntl(),s=c.useShowSharingNotification();return Ge.useCallback((async()=>{const n=e.$query.get(),r=await t({query:n,force_refresh:!1,limit:10});if(e.$query.get()===n){if(a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_START",null),"SUCCESS"!==r.status)return"ERROR"===r.status?a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_ERROR",{response:r}):a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_FATAL",{response:r}),s({type:c.SharingNotificationType.FAILURE,message:Wn(i)}),void e.$searchSuggestionsRaw.set([]);a("TARGETS_TOKENIZER__TARGETS_SEARCH__API_SUCCESS",{response:r}),_.batch((()=>{e.$latestSuggestionsQuery.set(n),e.$searchSuggestionsRaw.set(r.output)}))}}),[e,t,a,s,i])})(e),a=(e=>{const[t,a]=Ge.useState(e);return Ge.useEffect((()=>{const t=setTimeout((()=>a(e)),150);return()=>clearTimeout(t)}),[e]),t})(_.useStore(e.$query));Ge.useEffect((()=>{t()}),[a])},Si=({results:e,suggestionMax:t})=>Ge.createElement("div",{className:Gn,"aria-live":"polite"},e.slice(0,t).map(((e,t)=>Ge.createElement("div",{key:t},e!==ti&&mi(e)))));Si.displayName="ScreenReaderLiveResults";const bi=({store:e})=>{const t=n.useIntl(),i=_.useStore(e.$isConnectingToGoogle),s=_.useStore(e.$isConnectedToGoogle),r=_.useStore(e.$isLinkedServicesUpdating);return d.useRedirectWindowToken()?i?Ge.createElement(x.Typeahead.Row,{"data-testid":"typeahead-import-contacts",className:"typeahead-import-contacts",key:ti,withLeftAccessory:Ge.createElement(a.Avatar,{src:oi}),value:ti,withTitle:ri,withSubtitle:Jn(t)}):r?null:s?Ge.createElement(x.Typeahead.Row,{"data-testid":"typeahead-import-contacts",className:"typeahead-import-contacts",key:ti,withLeftAccessory:Ge.createElement(a.Avatar,{src:oi}),value:ti,withTitle:ri,withSubtitle:Xn(t)}):Ge.createElement(x.Typeahead.Row,{"data-testid":"typeahead-import-contacts",className:"typeahead-import-contacts",key:ti,withLeftAccessory:Ge.createElement(a.Avatar,{src:oi}),value:ti,withTitle:ri,withSubtitle:Qn(t)}):null};bi.displayName="ImportContacts";const Ii=e=>{var t;const i=(e=>{const{isNonUserRelativeContext:t}=a.useSharingApiContext();return _.useInitStore({props:e,isNonUserRelativeContext:t},(e=>{var t,n;const i=_.proxy((()=>e.get().props)),s=_.proxy((()=>e.get().isNonUserRelativeContext)),r=_.store(!1),o=_.store(!1),c=_.store(!1),d=_.store(null!==(t=i.get().autoFocus)&&void 0!==t&&t),g=_.store(!1),u=_.store(null),m=_.store(null!==(n=i.get().initialQuery)&&void 0!==n?n:""),p=_.store(""),f=_.proxy((()=>i.get().isActive)),h=_.proxy((()=>i.get().user)),E=_.proxy((()=>i.get().accessLevel)),v=_.proxy((()=>i.get().isEmailSectionActive)),y=_.proxy((()=>i.get().inviteTargets),(e=>i.get().onInviteTargetsChange(li(ci(e))))),S=_.proxy((()=>i.get().inviteTargetValidation)),b=_.proxy((()=>y.get().length>0)),I=_.proxy((()=>i.get().objectMetadata)),M=_.proxy((()=>a.getCanInvite(I.get(),E.get()))),C=_.proxy((()=>{const e=u.get();return e?l.getIsServiceConnected(e,{".tag":"google"})&&l.getDoesServiceHavePermissionGranted(e,{".tag":"google"},{".tag":"contacts"}):null})),A=_.proxy((()=>h.get().is_team)),T=_.proxy((()=>a.getIsTeamSharedFolder(I.get()))),x=_.proxy((()=>i.get().autoFocus)),k=_.proxy((()=>c.get())),N=_.store([]),L=_.proxy((e=>{const t=T.get(),a=h.get().email,n=y.get().map(l.getUniqueId),i={},r=s.get(),o=N.get().filter((e=>{const s=l.getUniqueId(e);return!(i[s]||(i[s]=!0,n.includes(s)||!l.canCreateLinksForFolder(t,h.get().is_tmr_member)&&"group"!==e[".tag"]||!(r||"email"!==e[".tag"]&&"user"!==e[".tag"]||e.email!==a)))}));return null!==e&&e.length===o.length&&e.every(((e,t)=>e===o[t]),!0)?e:o})),R=_.proxy((e=>{const t=T.get(),a=m.get(),n=t||""===a,i=[...L.get().slice(0,9),...n?[]:ai];return null!==e&&e.length===i.length&&e.reduce(((e,t,a)=>e&&t===i[a]),!0)?e:i}));return{$accessLevel:E,$user:h,$canInvite:M,$inviteTargets:y,$inviteTargetValidation:S,$hasInviteTargets:b,$isConnectedToGoogle:C,$isConnectingToGoogle:r,$isFocused:o,$isLinkedServicesUpdating:c,$isTeamAccount:A,$isTeamFolder:T,$isTypeaheadForcedOpen:d,$isTypeaheadOpen:g,$isUpdatingGoogleConnectionStatus:k,$linkedServices:u,$objectMetadata:I,$query:m,$latestSuggestionsQuery:p,$searchSuggestionsRaw:N,$searchSuggestions:L,$suggestions:R,$isEmailSectionActive:v,$autoFocus:x,$isActive:f,$props:i}}))})(e),{isSuggestionsOpen:s,isInviteSending:r,isActionRowTransitionInProgress:o,inbandInputAreaRef:d,inputRef:g,inviteTargets:u,setSuggestionsOpen:m,onTargetsDropdownFocusChange:p}=e,h=n.useIntl(),E=Ge.useRef(null),v=_.useStore(i.$query),y=_.useStore(i.$inviteTargets),S=_.useStore(i.$hasInviteTargets),b=Ge.useRef(y.length),I=_.useStore(i.$suggestions),M=_.useStore(i.$canInvite),C=_.useStore(i.$isTypeaheadForcedOpen)&&M,A=null!==(t=_.useStore(i.$autoFocus))&&void 0!==t&&t;yi(i),(e=>{const t=ui(e);Ge.useEffect((()=>{t()}),[t])})(i),(e=>{const t=Fn(),a=_.useStore(e.$searchSuggestions),n=_.useStore(e.$isTypeaheadOpen);Ge.useEffect((()=>{if(n){const e=a.slice(0,9).length;e>0&&n&&t.select(Dn).emit({numSuggestions:e})}}),[a,t,n])})(i);const T=(e=>{const t=Fn(),a=hi(e),n=_.useStore(e.$searchSuggestions);return Ge.useCallback(((i,s)=>{_.batch((()=>{var r,o;if(i===ti){if(e.$isTypeaheadForcedOpen.set(!0),e.$isConnectingToGoogle.get())return;if(e.$isConnectedToGoogle.get())return;return e.$query.set(""),void a()}t.select(Pn).emit({index:n.findIndex((e=>e===i)),method:s.nativeEvent instanceof KeyboardEvent?"keyboard":"click"}),e.$query.set(""),e.$inviteTargets.set([...e.$inviteTargets.get(),i]),null===(o=null===(r=e.$props.get().inputRef)||void 0===r?void 0:r.current)||void 0===o||o.focus()}))}),[e,a,t,n])})(i),N=(e=>{const t=Fn();return Ge.useCallback((a=>{const n=e.$query.get();if(a.key===si&&a.shiftKey)return void a.preventDefault();"Backspace"!==a.key&&"Delete"!==a.key||""===n&&e.$inviteTargets.get().length>0&&e.$inviteTargets.set(e.$inviteTargets.get().slice(0,-1));const i=n===e.$latestSuggestionsQuery.get(),s=ni.test(n);if(a.key===si){const a=document.getElementById("targets-tokenizer-input-search");if(a&&"scrollIntoView"in a&&a.scrollIntoView(),i&&!s&&e.$searchSuggestions.get().length>0)t.select(Pn).emit({index:0,method:"keyboard"}),_.batch((()=>{e.$inviteTargets.set([...e.$inviteTargets.get(),e.$searchSuggestions.get()[0]]),e.$query.set("")}));else if(""!==n){const t=Ei(n);t.length>0?_.batch((()=>{e.$inviteTargets.set([...e.$inviteTargets.get(),...t]),e.$query.set("")})):_.batch((()=>{e.$inviteTargets.set([...e.$inviteTargets.get(),l.createFromEmail(n)]),e.$query.set("")}))}}}),[e,t])})(i),L=vi(i),{inputPlaceholder:R,truncatedInputPlaceholder:w}=(e=>{var t;const i=n.useIntl(),s=_.useStore(e.$hasInviteTargets),r=_.useStore(e.$isTeamFolder),o=_.useStore(e.$isTeamAccount),l=_.useStore(e.$user).is_tmr_member,d=null===(t=_.useStore(e.$props).shouldTruncatePlaceholder)||void 0===t||t;return Ge.useMemo((()=>{let e;return e=s?void 0:r&&!l?(e=>e.formatMessage({id:"VMGE6I",defaultMessage:"Group names"}))(i):o?(e=>e.formatMessage({id:"+nKRfb",defaultMessage:"Add an email, name, or group"}))(i):(e=>e.formatMessage({id:"bdV6O3",defaultMessage:"Add an email or name"}))(i),{inputPlaceholder:e,truncatedInputPlaceholder:d&&e?c.Emstring.em_snippet(e,a.SNIPPET_SIZES.TOKENIZER_PLACEHOLDER,1):e}}),[r,o,i,l,s,d])})(i),$=(e=>Ge.useCallback((({isOpen:t})=>{if(t)e.$isTypeaheadOpen.set(!0);else{const t=Ei(e.$query.get());_.batch((()=>{t.length>0&&(e.$inviteTargets.set([...e.$inviteTargets.get(),...t]),e.$query.set("")),e.$isTypeaheadForcedOpen.set(!1),e.$isTypeaheadOpen.set(!1),e.$isFocused.set(!1)}))}}),[e]))(i),O=(e=>Ge.useCallback((()=>{var t,a;null===(a=(t=e.$props.get()).onUserInteraction)||void 0===a||a.call(t),e.$isTypeaheadForcedOpen.set(!1),e.$isFocused.set(!0)}),[e]))(i),[D,P]=Ge.useState(!1),F=(e=>Ge.useCallback((t=>t===ti?Ge.createElement(bi,{store:e}):Ge.createElement(pi,{target:t})),[e]))(i),U=Ge.useRef(!1),H=Ge.useRef(void 0),B=r||!M,j=Ge.useCallback(((e,t)=>{const a=t.includes(ti)?t.length-1:t.length,n=e&&a>0;U.current!==n&&(U.current=n,null==p||p(n)),m(e)}),[p,m]);Ge.useEffect((()=>{const e=H.current;e&&(j(e.isOpen,e.suggestions),H.current=void 0)}));const V=Ge.useCallback((()=>{s||i.$isTypeaheadForcedOpen.set(!0)}),[i.$isTypeaheadForcedOpen,s]),q=Ge.useCallback((()=>{var e;null===(e=null==g?void 0:g.current)||void 0===e||e.focus(),i.$isTypeaheadForcedOpen.set(!0)}),[g,i]);Ge.useEffect((()=>{M&&0===u.length&&!o&&q()}),[M,q,u,o]),Ge.useEffect((()=>{if(b.current<y.length){const e=document.getElementById("targets-tokenizer-input-search");e&&"scrollIntoView"in e&&e.scrollIntoView()}b.current=y.length}),[y.length]);const z=Ge.useCallback((e=>{e.preventDefault();const t=document.getElementById("targets-tokenizer-wrapper");t&&(t.scrollLeft+=e.deltaY+e.deltaX)}),[]);Ge.useEffect((()=>{const e=document.getElementById("targets-tokenizer-wrapper");return e&&e.addEventListener("wheel",z),()=>{e&&e.removeEventListener("wheel",z)}}),[z]);const G=f.is_mobile_or_tablet();Ge.useEffect((()=>{const e=y.length;D&&0===e&&P(!1)}),[D,y.length,P]);const W=Ge.useMemo((()=>{const e=y.length;if(0===e)return null;if(D)return Ge.createElement(Ge.Fragment,null,y.map(((e,t)=>Ge.createElement(di,{store:i,key:t,target:e,isDisabled:B}))));if(1===e)return Ge.createElement(di,{store:i,target:y[0],isDisabled:B});return Ge.createElement(Ge.Fragment,null,Ge.createElement(di,{store:i,key:0,target:y[0],isDisabled:B}),Ge.createElement(k.Chip,{size:"medium",variant:"standard",disabled:B,onClick:e=>{e.stopPropagation(),P(!0)},style:{marginRight:"4px"}},Ge.createElement(k.Chip.Content,null,((e,t)=>e.formatMessage({id:"VwYjK8",defaultMessage:"+ {count} more"},{count:t}))(h,e-1))))}),[D,B,h,i,y,P]);return Ge.createElement(a.DIGContext.Provider,{value:{featureLevel:"experimental"}},Ge.createElement(x.Typeahead.Wrapper,{className:a.cx(Hn,{[Bn]:S}),id:"targets-tokenizer-wrapper",onSelection:T,hasMaxHeight:!0,isPortaled:G,onToggle:$,openMenuOnFocus:!1},(({getTriggerProps:e,getContentProps:t})=>{const{open:n,...i}=t({}),s=(n||C)&&I.length>0;return H.current={isOpen:s,suggestions:I},Ge.createElement(Ge.Fragment,null,Ge.createElement(a.TextInput.Container,{className:a.cx(jn),ref:E,size:"small",onClick:q,"data-uxa-log":"sm24-tokenizer","data-uxa-interactions":"shown"},Ge.createElement(a.Box,{style:{alignItems:"center",display:"flex",flexWrap:"nowrap",margin:"-4px -2px",width:"100%"}},W,Ge.createElement(a.TextInput.Input,{...e({onChange:L,onKeyDown:N,onFocus:O}),className:a.cx(qn,{[zn]:G}),ref:g,disabled:B,value:v,"aria-label":R,placeholder:w,"data-testid":"targets-tokenizer-input",id:"targets-tokenizer-input-search",autoComplete:"off",autoFocus:A,onClick:V,style:s?{width:"auto"}:void 0}))),Ge.createElement(x.Typeahead.Container,{...i,triggerRef:d,open:s,"data-testid":"typeahead-container",className:Vn,auto:!1,placement:"bottom","aria-label":Zn(h)},Ge.createElement(Si,{results:I,suggestionMax:3}),Ge.createElement(x.Typeahead.Results,{results:I,renderRow:F,initialResults:""===v?3:10,maxResults:10})))})))};Ii.displayName="TargetsTokenizer";const Mi=Ge.memo((({isActive:e,objectMetadata:t,accountMetadata:a,inbandInputAreaRef:n,inputRef:i,onFocusChange:s,isActionRowTransitionInProgress:r,initialQuery:o})=>{const l=Za(),g=_.useStore(l.$inviteTargets),u=_.useStore(l.$inviteTargetValidations),m=_.useStore(l.$isInviteSending),p=_.useAtom(l.$sharingAccessLevel),f=(e=>Ge.useMemo((()=>c.convertAccountMetadataToUser(e)),[e]))(a),h=_.useStore(l.$isSuggestionsOpen),E=Ge.useCallback((e=>{l.$isSuggestionsOpen.set(e)}),[l.$isSuggestionsOpen]),v=(()=>{const e=d.useLogger(),t=Za();return Ge.useCallback((a=>{e("SHARE_MODAL_SHARE__INVITE_TARGETS__CHANGE",null),t.$props.get().onInviteTargetsChange(a)}),[t,e])})();return Ge.createElement(Ii,{accessLevel:p,objectMetadata:t,inviteTargets:g,onInviteTargetsChange:v,onTargetsDropdownFocusChange:s,inviteTargetValidation:u,user:f,isInviteSending:m,inbandInputAreaRef:n,inputRef:i,isActive:e,isSuggestionsOpen:h,setSuggestionsOpen:E,shouldTruncatePlaceholder:!1,isActionRowTransitionInProgress:r,initialQuery:o})}));Mi.displayName="TargetsTokenizer";const Ci=({objectMetadata:e,accountMetadata:t,sharingPrefs:i,onCloseClick:s,isConfidentialFolderBannerClosed:r})=>{var o;const c=n.useIntl(),g=Za(),u=Ge.useRef(null),m=Ge.useRef(null),p=d.usePlatform()===d.Platforms.METASERVER,{initialInput:f,onInitialInputUsed:h,onConfidentialFolderBannerClose:E}=_.useAtom(g.$props),v=_.useAtom(g.$isInviteSending),y=_.useAtom(g.$inviteTargets),S=_.useAtom(g.$isConfidentialFolder),b=_.useAtom(g.$isInviteMessageTooLong);Ge.useEffect((()=>{f&&h&&h()}),[f,h]);const I=hn(e),M=En(e,i),C=(()=>{const e=Za();return Ge.useCallback((t=>{e.$changeConfidentialityData.set({teamName:t})}),[e.$changeConfidentialityData])})(),A=null!==(o=a.getOwnerTeamName(e))&&void 0!==o?o:"",T=_.useAtom(g.$isSuggestionsOpen),x=y.length>0,{shouldTransitionAccessoryAreaEnter:k}=_.useAtom(g.$props),[N,R]=Ge.useState(!1),[w,$]=Ge.useState(k),{onStartInband:O}=_.useAtom(g.$props),D=_.useAtom(g.$componentViewTime),P=Ge.useRef(!1),F=pn(),U=Ca(c);Ge.useEffect((()=>{if(!P.current&&D>0){P.current=!0;const e=Date.now()-D;O&&O(),F.select(an).emit({timeSinceView:e})}}),[D,F,O]);const H=Ge.useCallback((()=>{$(!1)}),[$]),B=!N&&!T;return Ge.createElement("div",{className:a.cx(kn,{[Nn]:k}),onAnimationEnd:H},Ge.createElement("div",{id:"shareme24-ib-action-container",style:{width:"100%",position:"relative"},"data-testid":"ib-action-area"},Ge.createElement(a.Box,{className:"banner-group",marginBottom:S?"Micro Small":"0"},!r&&S?Ge.createElement(l.ConfidentialFolderSection,{teamName:A,parentFolderName:a.getParentFolderName(e),isRestoreAccessEnabled:a.getCanDoAction(e,a.UPDATE_CONFIDENTIALITY_TAG),onRestoreAccessClick:C,onBannerClose:E}):null,Ge.createElement(Mn,{objectMetadata:e})),Ge.createElement(a.Box,{display:"flex",flexDirection:"row",columnGap:"Micro Medium"},Ge.createElement(a.Box,{flexDirection:"column",className:a.cx(Ln,{[wn]:N||T}),backgroundColor:"Background Base",onClick:()=>{!(null==m?void 0:m.current)||x||T||m.current.focus()}},Ge.createElement(a.Box,{className:Rn,ref:u,display:"flex",flexDirection:"row",alignItems:"center",width:"100%",style:{minHeight:"var(--dig-spacing__dimension__36)"}},Ge.createElement(Mi,{isActive:N||T,objectMetadata:e,accountMetadata:t,inbandInputAreaRef:u,inputRef:m,onFocusChange:R,isActionRowTransitionInProgress:w,initialQuery:f}))),B&&Ge.createElement(en,null))),Ge.createElement("div",{className:$n},Ge.createElement(xn,{isInviteMessageTooLong:b}),b&&Ge.createElement(a.Text,{color:"error","data-testid":"ib-message-above-limit-message"},((e,t)=>e.formatMessage({id:"dH+HYp",defaultMessage:"Message must be under {limit} characters."},{limit:t}))(c,2e3)),Ge.createElement(a.Box,{className:On},Ge.createElement(a.Button,{disabled:v||null!=I&&"error"===I.level||!x||b,style:{width:"100%",height:"48px",alignSelf:"center"},onClick:()=>{p?L.showOQModalOrContinue({beforeShowModal:()=>{s()},show:L.Show.EnforceRestrictionsOnly,action:"share_add_people",continueCallback:()=>M(),abortCallback:()=>{}}):M()},variant:"primary",size:"xlarge","data-uxa-log":"sharing-modal-footer-button-send-email","data-testid":"ib-share-send-email-button"},v&&Ge.createElement(a.Spinner,{size:"xsmall","aria-valuetext":null==U?void 0:U.toString(),monochromatic:!0,withTrack:!0,style:{marginRight:"var(--spacing__unit--1)"}}),v?U:Aa(c,v)))))};Ci.displayName="InbandShare";const Ai=()=>{const e=Za(),t=_.useAtom(e.$props),{accountMetadataResult:a,objectMetadataResult:n,sharingPrefsResult:i,onCloseClick:s,isConfidentialFolderBannerClosed:r}=t,o=n.isLoading,l=!n.isLoading&&!n.isError,c=a.isLoading,d=!a.isLoading&&!a.isError,g=i.isLoading,u=!i.isLoading&&!i.isError,m=l&&d&&u;return o||c||g?Ge.createElement(Ga,null):m?Ge.createElement(xi,{objectMetadata:n.output,accountMetadata:a.output,sharingPrefs:i.output,onCloseClick:s,isConfidentialFolderBannerClosed:r}):null};Ai.displayName="InbandWithStore";const Ti=e=>Ge.createElement(Qa,{...e},Ge.createElement(Ai,null));Ti.displayName="Inband";const xi=({objectMetadata:e,accountMetadata:t,sharingPrefs:a,onCloseClick:n,isConfidentialFolderBannerClosed:i})=>{const s=Za(),r=_.useAtom(s.$inviteTargets),o=_.useAtom(s.$sharingAccessLevel);return tn(e),Ge.useEffect((()=>{s.$componentViewTime.set(Date.now())}),[s]),Ge.createElement(M.AbuseFpjsProvider,{loadingComponent:Ge.createElement(Ga,null)},Ge.createElement(d.MetadataProvider,{sharingInviteTargets:r,sharingAccessLevel:o},Ge.createElement(Ci,{objectMetadata:e,accountMetadata:t,sharingPrefs:a,onCloseClick:n,isConfidentialFolderBannerClosed:i})))};xi.displayName="InbandInner";const ki=()=>{const e=Lt(),{objectIdentifier:t,objectMetadataResult:i,onRequestClose:s,onInbandShareCompleted:r,onConfirmationModalShownChange:o,shouldResetToMainAfterInbandShare:d,shouldDisablePostInbandShareHooks:g}=_.useAtom(e.$props),u="file"!==t[".tag"],m=At(),p=_.useStore(e.$inviteTargets),f=_.useStore(e.$inviteMessage),h=_.useStore(e.$initialInputKey),v=Ge.useCallback((t=>{e.$inviteMessage.set(t)}),[e]),y=Ge.useCallback((t=>{e.$inviteTargets.set(t)}),[e]),S=Ge.useCallback((()=>{e.$isOperationInProgress.set(!0)}),[e]),I=Ge.useCallback((()=>{e.$isOperationInProgress.set(!1)}),[e]),M=Ge.useCallback((()=>{e.$isOperationInProgress.set(!1),r&&r(),d&&(_.batch((()=>{e.$inviteTargets.set([]),e.$inviteMessage.set("")})),wt(e,xt.MAIN)),a.invalidateObjectMembers(t),c.invalidateSharingObjectMetadata(t),c.invalidateNewApiObjectMetadata(t)}),[e,t,r,d]),C=Ge.useCallback((t=>{e.$isSuggestionsOpen.set(t)}),[e]),A=Ge.useCallback((()=>{}),[]),T=Ge.useCallback((async()=>{}),[]),x=_.useStore(e.$isConfidentialFolderBannerClosed),k=Ge.useCallback((()=>{e.$isConfidentialFolderBannerClosed.set(!0)}),[e.$isConfidentialFolderBannerClosed]),N=da(e),{user:L,isLoading:R}=a.useActiveUser(),w=!i.isLoading&&!i.isError&&null!=i.output&&!a.getIsLinkOnlyMode(i.output)&&(a.getCanInvite(i.output,l.VIEWER)||a.getCanInvite(i.output,l.EDITOR));Ge.useEffect((()=>{w&&!R&&L&&E.prefetch(L,t)}),[w,R,L,t]);return Ge.createElement(Ge.Fragment,null,Ge.createElement(oa,{info:{backButton:{onClick:()=>{wt(e,xt.MAIN)}},title:u?Dt(n.intl):Pt(n.intl),subtitle:N}},Ge.createElement(oa.Slot,{type:"custom"},Ge.createElement(b.ContentMemberFacepileButton,{oid:t,onClick:()=>{m.select(St).emit({shareModalPage:xt.INBAND}),wt(e,xt.CONTENT_MEMBER_LIST)},onView:()=>{}}))),Ge.createElement(aa,null,Ge.createElement(aa.Row,null,Ge.createElement(Ti,{oid:t,inviteMessage:f,inviteTargets:p,hasUpdatedAccountMetadata:!1,onCloseClick:s,onTargetsDropdownFocusChange:C,onInviteMessageChange:v,onInviteTargetsChange:y,onShareStart:S,onShareFailure:I,onInbandShareSuccess:M,onStartInband:A,onConfirmationModalShownChange:o,onConfidentialFolderBannerClose:k,onObjectIdentifierChanged:T,isConfidentialFolderBannerClosed:x,shouldDisablePostInbandShareHooks:g,initialInput:h}))))};ki.displayName="InbandPage";const Ni=e=>{switch(e.type){case"iconButton":return Ge.createElement(a.IconButton,{variant:e.variant,size:"xlarge",onClick:e.onClick,"data-testid":e.testId,disabled:e.disabled,style:{borderRadius:"var(--dig-radius__xlarge)"},"aria-label":e.label},Ge.createElement(a.UIIcon,{src:e.icon,width:24,height:24}));case"button":return Ge.createElement(a.Button,{variant:e.variant,size:"xlarge",onClick:e.onClick,"data-testid":e.testId,withIconStart:e.icon&&Ge.createElement(a.UIIcon,{src:e.icon}),disabled:e.disabled,"aria-label":e.label},e.label);case"custom":return Ge.createElement(Ge.Fragment,null,e.children)}};Ni.displayName="Action";const Li=({children:e})=>{const t=Ge.Children.toArray(e),{leftActions:a,rightActions:n}=t.reduce(((e,t)=>(Ge.isValidElement(t)&&"object"==typeof t.props&&null!==t.props&&("align"in t.props&&"left"===t.props.align?e.leftActions.push(t):"align"in t.props&&"right"===t.props.align&&e.rightActions.push(t)),e)),{leftActions:[],rightActions:[]});return Ge.createElement("div",{"data-testid":"sm26-footer",className:Qt},a.length>0&&Ge.createElement("div",{className:Xt},a),n.length>0&&Ge.createElement("div",{className:Jt},n))};Li.displayName="FooterBase";const Ri=Object.assign(Li,{Action:Ni});a.injectInternalStyle("/static/metaserver/static/js/sharing/features/share-modal/versions/shareme26/pages/main/main.module.out-vflLMlDY5.css",(e=>"._inbandSection_1d338_2{gap:var(--dig-spacing__micro__large)}._inbandSection_1d338_2,._inputSection_1d338_8{display:flex;flex-direction:column}._suggestedChips_1d338_13{align-items:center;display:flex;gap:8px}._memberList_1d338_20{display:flex;flex-direction:column;gap:4px;height:108px}._memberListTitle_1d338_27{color:var(--dig-color__text__subtle);font-size:var(--dig-type__size__text__small);font-style:normal;font-weight:400;line-height:var(--dig-type__lineheight__label__small)}._ownerListing_1d338_35{border-radius:var(--dig-radius__large,12px);height:40px;min-height:40px}._ownerListing_1d338_35,._userInfo_1d338_43{align-items:center;display:flex}._userInfo_1d338_43{flex:1;gap:12px;min-width:0}._permission_1d338_51{align-items:center;background:transparent;border:none;border-radius:var(--dig-radius__large,12px);cursor:pointer;display:flex;gap:4px;height:40px;justify-content:center;padding:4px 10px;transition:background-color .2s}"));const wi="_inbandSection_1d338_2",$i="_inputSection_1d338_8",Oi="_suggestedChips_1d338_13",Di=e=>{const{handleChipClick:t}=e,n=Lt(),i=_.useAtom(n.$inviteTargets),s=(e=>{const{isNonUserRelativeContext:t}=a.useSharingApiContext(),n=a.sharingTargetsSearchPackage.useQuery({apiArg:{...e},pkgArg:{isNonUserRelativeContext:t}},{staleTime:3e5,retryDelay:e=>Math.min(1e3*2**e,3e4),retry:3});return Ge.useMemo((()=>n.isLoading?{isLoading:!0}:n.error?{isLoading:!1,isError:!0,error:n.error.appError}:n.data&&n.data.apiData?{output:n.data.apiData.entries.map((e=>{if("user"===e[".tag"]){const t=e;return""===t.dbx_account_id?l.createFromEmail(t.name):e}return"group"===e[".tag"]?e:null})).filter((e=>null!=e)),isLoading:!1,isError:!1}:{isLoading:!1,isError:!0,error:{".tag":"other"}}),[n])})(),r=s.isLoading,o=!r,c=o&&s.isError,d=(o&&!c?s.output:[]).filter((e=>!i.find((t=>l.getUniqueId(t)===l.getUniqueId(e))))).slice(0,3),g=r,u=o&&!c&&d.length>0,m=Ge.useCallback((e=>{const t=l.getContactChipDisplayName(e);switch(e[".tag"]){case"email":if(t.length>20){const e=t.split("@")[0],n=t.split("@")[1];return`${a.Emstring.em_snippet(e,10)}@${a.Emstring.em_snippet(n,10)}`}return t;case"user":case"group":return a.Emstring.em_snippet(t,20,.5);default:return t}}),[]);return Ge.createElement("div",{className:Oi},g&&Ge.createElement(Pi,{numChips:3}),u&&d.map((e=>Ge.createElement(k.Chip,{key:l.getUniqueId(e),size:"medium",variant:"standard",isSelected:i.includes(e),onClick:()=>t(e),"data-testid":`chip-${l.getUniqueId(e)}`},Ge.createElement(k.Chip.IconAccessory,null,Ge.createElement(a.UIIcon,{src:a.AddLine,size:"small"})),Ge.createElement(k.Chip.Content,null,m(e))))))};Di.displayName="ContactChips";const Pi=({numChips:e})=>Ge.createElement("div",{"data-testid":"chip-skeleton-row",style:{display:"flex",gap:"8px",alignItems:"center"}},Array.from({length:e}).map(((e,t)=>Ge.createElement(k.Chip,{style:{width:"120px"},key:t,size:"medium",variant:"standard",isSelected:!1,onClick:()=>{},"data-testid":`chip-skeleton-${t}`},Ge.createElement(k.Chip.IconAccessory,null,Ge.createElement(a.UIIcon,{src:a.AddLine,size:"small"})),Ge.createElement(k.Chip.Content,null,Ge.createElement(a.Skeleton.Text,{style:{width:"75px",borderRadius:"15px"},key:t}))))));Pi.displayName="ChipSkeletonRow";const Fi=/^[a-zA-Z0-9]$/,Ui=()=>{const e=Lt(),t=_.useAtom(e.$props),{objectIdentifier:i,onRequestClose:s,stacksHandler:r,onControlledFeatureClicked:o,onConfirmationModalShownChange:l,onObjectIdentifierChanged:d,canUserCreateStack:g,isEncrypted:u,isStacksContentLimitExceeded:m}=t,p="file"!==i[".tag"],f=At(),h=Ge.useCallback((t=>{$t(e),wt(e,t)}),[e]),E=t=>{t&&e.$initialInputKey.set(t),f.select(ht).emit({shareModalPage:xt.MAIN}),h(xt.INBAND)},v=Ge.useCallback((()=>{f.select(ft).emit({shareModalPage:xt.MAIN}),r(),o()}),[f,r,o]),y=Ge.useCallback((()=>{f.select(yt).emit({shareModalPage:xt.MAIN}),"integrated_v1"===t.copyLinkMode?h(xt.COPY_LINK):"controlled_v1"===t.copyLinkMode&&(t.copyLinkHandler(),o())}),[f,h,t,o]),S=Ge.useCallback((t=>{const{shouldOpenLinkSettings:a,initialTab:n}=t;let i;i=(null!=a?a:"edit_link_settings"===n||"view_link_settings"===n)?"edit_link_settings"===n?"edit_link_settings":"view_link_settings":"object_settings",e.$initialSettingsTab.set(i),h(xt.SETTINGS)}),[e,h]),I=Ge.useCallback((e=>{e&&s()}),[s]),M=Ge.useCallback((()=>{f.select(pt).emit({shareModalPage:xt.MAIN}),h(xt.SETTINGS)}),[f,h]),C=Ge.useCallback((()=>{f.select(mt).emit({shareModalPage:xt.MAIN}),h(xt.MORE)}),[f,h]),A=Ge.useCallback((()=>{f.select(bt).emit({shareModalPage:xt.MAIN}),s()}),[f,s]),T=Ge.useCallback((()=>{c.invalidateSharingObjectMetadata(i),c.invalidateNewApiObjectMetadata(i),b.invalidateListSharedLinks(i),a.invalidateObjectMembers(i),h(xt.MAIN)}),[i,h]),x=Ge.useCallback((()=>{h(xt.MAIN)}),[h]),k=Ge.useCallback((t=>{(null==t?void 0:t.expandInherited)?(f.select(Ct).emit({shareModalPage:xt.MAIN}),((e,t)=>{e.$expandInheritedOnContentMemberListOpen.set(t)})(e,!0)):f.select(Mt).emit({shareModalPage:xt.MAIN}),h(xt.CONTENT_MEMBER_LIST)}),[f,e,h]),N=da(e),L=Ge.useMemo((()=>{const e=!u;return a.isBrowserSupportedByDash()&&!!g&&e}),[g,u]);return Ge.createElement(Ge.Fragment,null,Ge.createElement(oa,{info:{title:p?Dt(n.intl):Pt(n.intl),subtitle:N}},L&&Ge.createElement(oa.Slot,{type:"iconButton",icon:w.CreateStackLine,label:(O=n.intl,O.formatMessage({id:"fWG4iQ",defaultMessage:"Add to an existing or new stack"})),onClick:v,testId:"header-stacks-page-button",isLoading:null===m,isDisabled:!0===m,disabledTooltip:!0===m?Ft(n.intl):null}),Ge.createElement(oa.Slot,{type:"iconButton",icon:a.MoreHorizontalLine,label:Bt(n.intl),onClick:C,testId:"header-more-page-button",isLoading:!1,isDisabled:!1,disabledTooltip:null}),Ge.createElement(oa.Slot,{type:"iconButton",icon:$.SettingsLine,label:jt(n.intl),onClick:M,testId:"header-settings-page-button",isLoading:!1,isDisabled:!1,disabledTooltip:null})),Ge.createElement(aa,null,Ge.createElement(aa.Row,null,Ge.createElement("div",{className:wi},Ge.createElement("div",{className:$i},Ge.createElement(R.TokenizerButton,{oid:i,onTokenizerButtonClick:E,onTokenizerKeyDown:e=>{"Enter"===e.key?E():Fi.test(e.key)&&E(e.key)},shareModalVersion:"sm26"})),Ge.createElement(Di,{handleChipClick:t=>{e.$inviteTargets.set([t]),h(xt.INBAND)}}))),Ge.createElement(aa.Row,null,Ge.createElement(b.ContentMemberList,{objectIdentifier:i,openLinkSettings:S,onRequestClose:I,onConfirmationModalShownChange:null!=l?l:()=>{},onTransferFolderOwnership:T,onChangeConfidentiality:x,onObjectIdentifierChanged:d,maxLines:3,onViewAllMembers:k,shouldUseSm26Design:!0}))),Ge.createElement(Ri,null,Ge.createElement(Ri.Action,{type:"button",align:"left",variant:"outline",label:"Copy link",icon:a.LinkLine,onClick:y,testId:"main-page-copy-link-button",disabled:"controlled_v1"===t.copyLinkMode&&t.isSimpleCopyLinkPending}),Ge.createElement(Ri.Action,{type:"button",align:"right",variant:"primary",label:Ht(n.intl),onClick:A,testId:"main-page-done-button",disabled:!1})));var O};Ui.displayName="MainPage";const Hi=()=>{const e=Lt(),{onControlledFeatureClicked:t,transferHandler:i}=_.useAtom(e.$props),s=da(e),r=At();return Ge.createElement(Ge.Fragment,null,Ge.createElement(oa,{info:{backButton:{onClick:()=>{wt(e,xt.MAIN)}},title:(o=n.intl,o.formatMessage({id:"pFWXg8",defaultMessage:"More ways to share"})),subtitle:s}}),Ge.createElement(aa,null,Ge.createElement(aa.Row,null,Ge.createElement(a.List,{isSelectable:!0},Ge.createElement(a.List.Item,{onClick:()=>{r.select(vt).emit({shareModalPage:xt.MORE}),wt(e,xt.QR_CODE)},"data-testid":"more-qr-code-button"},Ge.createElement(a.List.Accessory,null,Ge.createElement(a.UIIcon,{src:w.QrCodeLine})),Ge.createElement(a.List.Content,null,Ge.createElement(a.Text,{size:"medium"},"Create QR code")),Ge.createElement(a.List.Accessory,null,Ge.createElement(a.UIIcon,{src:a.ChevronRightLine,color:"var(--dig-color__text__subtle)"}))),Ge.createElement(a.List.Item,{onClick:()=>{r.select(Et).emit({shareModalPage:xt.MORE}),i(),t()},"data-testid":"more-transfer-button"},Ge.createElement(a.List.Accessory,null,Ge.createElement(a.UIIcon,{src:O.DropboxTransferLine})),Ge.createElement(a.List.Content,null,Ge.createElement(a.Text,{size:"medium"},"Transfer a copy")),Ge.createElement(a.List.Accessory,null,Ge.createElement(a.UIIcon,{src:a.ChevronRightLine,color:"var(--dig-color__text__subtle)"})))))));var o};Hi.displayName="MorePage";const Bi=()=>{const e=Lt(),{filePath:t,objectIdentifier:a,fileName:i}=_.useAtom(e.$props),s=da(e);return Ge.createElement(Ge.Fragment,null,Ge.createElement(oa,{info:{backButton:{onClick:()=>{wt(e,xt.MORE)}},title:(r=n.intl,r.formatMessage({id:"yQ6Q51",defaultMessage:"Create QR code"})),subtitle:s}}),Ge.createElement(aa,null,Ge.createElement(aa.Row,null,Ge.createElement(E.GetQrCode,{objectIdentifier:a,fileName:i,filePath:t,onSettingsClick:()=>{wt(e,xt.SETTINGS)},isSm26:!0}))));var r};Bi.displayName="QRCodePage";const ji=()=>{const e=Lt(),{onRequestClose:t}=_.useAtom(e.$props),i=da(e);return Ge.createElement(Ge.Fragment,null,Ge.createElement(oa,{info:{backButton:{onClick:()=>{wt(e,e.$previousPage.get()||xt.MAIN)}},title:(s=n.intl,s.formatMessage({id:"4eFgJP",defaultMessage:"Settings"})),subtitle:i}},Ge.createElement(oa.Slot,{type:"iconButton",icon:a.CloseLine,label:"Close",onClick:t,testId:"settings-close-button",isLoading:!1,isDisabled:!1,disabledTooltip:""})),Ge.createElement(aa,null,Ge.createElement(aa.Row,null,Ge.createElement(a.Text,{size:"medium"},"Placeholder for settings screen"))));var s};ji.displayName="SettingsPage";a.injectInternalStyle("/static/metaserver/static/js/sharing/features/share-modal/versions/shareme26/share-modal.module.out-vflhKe1VN.css",(e=>"._shareModal_huyrg_3{--SM26_MODAL_MIN_HEIGHT:415px;--SM26_MODAL_MAX_HEIGHT:510px;display:flex;flex-direction:column;max-height:var(--SM26_MODAL_MAX_HEIGHT);min-height:var(--SM26_MODAL_MIN_HEIGHT);overflow:hidden;padding:var(--dig-spacing__macro__medium)}._shareModalMobile_huyrg_16{max-height:none;padding:var(--dig-spacing__micro__xlarge) var(--dig-spacing__micro__large)}._shareModalCopyLink_huyrg_22{min-height:auto}._shareModalMobile_huyrg_16._shareModalCopyLink_huyrg_22{padding:var(--dig-spacing__micro__xlarge) var(--dig-spacing__micro__xlarge) var(--dig-spacing__macro__medium)}"));const Vi="_shareModal_huyrg_3",qi="_shareModalMobile_huyrg_16",zi="_shareModalCopyLink_huyrg_22",Gi=({children:e,onDataSuccess:t,onDataError:i,onDataCancel:s,onRequestClose:r,objectIdentifier:o})=>{const l=c.useSharingObjectMetadata(o.fileId),d=!l.isLoading&&l.isError,_=!l.isLoading&&!l.isError,g=d?l.error:void 0,u=Ge.useRef(!1),m=Ge.useRef(!1),p=Ge.useRef(!1),f=(()=>{const e=n.useIntl();return Ge.useCallback((t=>{switch(t){case"no_access":a.fail(e.formatMessage({id:"S0dPqX",defaultMessage:"You don’t have access to this content."}));break;case"invalid_oid":a.fail(e.formatMessage({id:"hBQISs",defaultMessage:"This content doesn’t exist."}));break;case"email_unverified":a.fail(e.formatMessage({id:"YQ+xBi",defaultMessage:"Verify your email to share this content."}));break;default:a.fail(e.formatMessage({id:"ObEiUD",defaultMessage:"Couldn’t complete this request. Try again."}))}}),[e])})();return Ge.useEffect((()=>{_&&!m.current&&(m.current=!0,t())}),[_,t]),Ge.useEffect((()=>{if(d&&!u.current){u.current=!0;const e=null==g?void 0:g[".tag"];f(e),r(),D.reportStack(`Failed to load object metadata for object with id: ${o.fileId}`,{severity:D.SEVERITY.CRITICAL,tags:["sharing","share-modal","sm26-data-loading-error"],exc_extra:{file_id:o.fileId,error:g}}),i()}}),[d,f,o,g,i,r]),Ge.useEffect((()=>()=>{p.current||u.current||m.current||(p.current=!0,s())}),[]),Ge.createElement(Ge.Fragment,null,e)};Gi.displayName="DataLoadingWrapper";const Wi=Symbol("ON_SHOW_VERIFY_EMAIL_MODAL"),{useEmitter:Ki,defaultEmitter:Yi}=a.defineLogger((async({event:e,getContextValue:t})=>{const n=t(a.Context$4),i=t(a.Context$5),s=t(a.Context$6),r=t(a.Context$7),o={...a.getTags$4(n),...a.getTags$5(i),...a.getTags$6(s),...a.getTags$7(r),isSm26:"true"},l={...a.getProperties$4(n),...a.getProperties$5(i),...a.getProperties$6(s),...a.getProperties$7(r)};e.key===Wi&&(a.UDCL.logEnd("ops.sm26.browse_load",{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEnd(a.PAP_Load_ShareModal({eventState:"canceled",...l}),{eventState:"canceled",key:e.payload.sessionId,tags:o}),a.UDCL.logEvent("ops.sm26.show_verify_email_modal",{tags:o}))})),Zi=({children:e,sessionId:t,onRequestClose:n})=>{var i,s;const r=Ki(),{viewer:o,isLoading:l}=a.useViewer(),c=!l&&!1===(null===(i=o.active_user)||void 0===i?void 0:i.is_email_verified);return Ge.default.useEffect((()=>{c&&r.select(Wi).emit({sessionId:t})}),[c,t,r]),c?Ge.default.createElement(v.VerifyEmailModal,{viewer:o,user:o.active_user,reason:y.EmailVerificationReasons.SHMODAL,email:null===(s=o.active_user)||void 0===s?void 0:s.email,onShowChange:()=>{o.active_user&&v.ChangeEmail.show(o,o.active_user,y.EmailVerificationReasons.SHMODAL)},onEmailSent:()=>{v.EmailVerification.get_for_user(o,o.active_user).email_sent(void 0,y.EmailVerificationReasons.SHMODAL,!0),n()},onCancel:n}):Ge.default.createElement(Ge.default.Fragment,null,e)};Zi.displayName="EmailVerificationWrapper";const Qi=()=>{const e=n.useIntl(),t=Lt(),i=_.useStore(t.$currentPage),s=_.useAtom(t.$props),{isOpen:r,onRequestClose:o,objectIdentifier:l}=s,g=_.useStore(t.$hangingNotification),u=_.useStore(t.$isOperationInProgress),m=At(),p=d.usePlatform()===d.Platforms.METASERVER,f=e.formatMessage({id:"U7hqO4",defaultMessage:"Share modal"}),h=Ge.useCallback((()=>{$t(t)}),[t]),v=Ge.useCallback((e=>{((e,t)=>{const a=String(Math.random());e.$hangingNotification.set({...t,key:a})})(t,e)}),[t]),y=s.hangingNotificationRef;Ge.useEffect((()=>{if(y)return y.current=v,()=>{y.current=null}}),[v,y]);const S="sm26_modal",b=S+"-"+a.getContentIdOrPathFromObjectIdentifier(l)+"-"+i,I=a.useCvcInteractiveLogger(S,{shareModalPage:i}),M=Ge.useCallback(I,[I]),{trackedElementRef:C,startCvcMeasurement:A}=a.useComponentVisuallyCompleteCalculator(S,b,M,{reportOnNoChange:!0});Ge.useEffect((()=>{A()}),[A]);Ge.useEffect((()=>{m.select(ut).emit({shareModalPage:i})}),[i,m]);const{small:T}=a.useBreakpoint({strategy:"maxWidth"}),x=a.cx(Vi,{[qi]:T,[zi]:i===xt.COPY_LINK}),k=Ge.createElement(c.HangingNotificationProvider,{value:v},Ge.createElement(Ge.Fragment,null,(i===xt.MAIN||i===xt.MORE)&&!T&&p&&Ge.createElement(E.OverquotaShareBannerComponent,{shouldUseSm26Design:!0}),Ge.createElement("div",{className:x},(()=>{switch(i){case xt.MAIN:return Ge.createElement(Ui,null);case xt.MORE:return Ge.createElement(Hi,null);case xt.SETTINGS:return Ge.createElement(ji,null);case xt.INBAND:return Ge.createElement(ki,null);case xt.COPY_LINK:return Ge.createElement(ga,null);case xt.CONTENT_MEMBER_LIST:return Ge.createElement(_a,null);case xt.QR_CODE:return Ge.createElement(Bi,null);default:return Ge.createElement(Ui,null)}})()),Ge.createElement(ot,{notification:g,onDismiss:h}))),N=Ge.useCallback((()=>{u||(m.select(It).emit({shareModalPage:i}),o())}),[o,m,i,u]);if(T){const e=i===xt.SETTINGS;return Ge.createElement(_t,{isOpen:r,onRequestClose:N,isFullHeight:e,"aria-label":f,"data-testid":"shareme26-drawer"},Ge.createElement("div",{ref:C,key:"share-modal-content"},k))}return Ge.createElement(a.Modal,{open:r,onRequestClose:N,width:500,"aria-label":f,"data-testid":"shareme26-modal"},Ge.createElement(Ot,{onRequestClose:o},Ge.createElement("div",{ref:C,key:"share-modal-content"},k)))};Qi.displayName="ShareModalWithStore";const Xi=e=>{const{isOpen:t,onRequestClose:n}=e,i=d.usePlatform()===d.Platforms.METASERVER,s=Ge.useMemo((()=>Math.random().toString()),[]);return t?i?Ge.createElement(S.ShareBlockingWrapper,{action:a.LockedStateModalAction.SHARE_MODAL,onStatusChange:e=>{e===a.Status.USER_ABORTED_ACTION&&n()}},Ge.createElement(Zi,{sessionId:s,onRequestClose:n},Ge.createElement(Gi,{...e},Ge.createElement(a.ComponentVisuallyCompleteProvider,null,Ge.createElement(Rt,{...e},Ge.createElement(Qi,null)))))):Ge.createElement(Rt,{...e},Ge.createElement(a.ComponentVisuallyCompleteProvider,null,Ge.createElement(Qi,null))):null},Ji=(e,t)=>{var a;return Ge.createElement(d.SharingSdkProvider,{userApiProps:e.user,origin:null===(a=e.shareModalExtras)||void 0===a?void 0:a.origin,actionInfo:{actionSurface:e.actionSurface}},Ge.createElement(ns,{store:t}))},es=(e,t)=>{var a;return Ge.createElement(d.SharingSdkProvider,{userApiProps:e.user,origin:null===(a=e.shareModalExtras)||void 0===a?void 0:a.origin,actionInfo:{actionSurface:e.actionSurface}},Ge.createElement(as,{store:t}))},ts=e=>{const t=(e=>_.useInitStore(e,(e=>{const t=_.store(Date.now()),a=_.store(void 0),n=_.store(e.get().isOpen),i=_.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.anchorRef})),s=_.proxy((()=>{const t=e.get();if("anchored"===t.displayType)return t.overlayPlacement}));return{$isOpen:n,$openFlexibleEntryPointTimestamp:t,$dwellFlexibleEntryPointActionTimestamp:a,$anchorRef:i,$overlayPlacement:s,$props:e}})))(e),{variant:n,isLoading:i}=a.useExperimentVariant("sm26_m1");a.useLogExposureOnce("sm26_m1",i);const s=Ge.useRef(!1);return Ge.useEffect((()=>{if(!s.current&&!i){s.current=!0;const i=n===a.Variant.ON?"sm26":"sm24";a.defaultEmitter$3.select(a.ON_ASYNC_SHOW_SHARE_MODAL).emit({...e,...(t=e.fileOrFolder,{fileExtension:t.ext||void 0,isDir:t.is_dir,sharedObjectType:t.is_dir?t.target_ns?"shared_folder":"folder":"file"}),shareModalType:i})}var t}),[e,i,n]),i?null:n===a.Variant.ON?Ji(e,t):es(e,t)};ts.displayName="ShareModalBrowse";const as=({store:e})=>{var t,r,g;const{user:u,fileOrFolder:m,actionSurface:p,actionElement:f,onActionClicked:h}=e.$props.get(),[v,y]=Ge.useState(a.getObjectIdentifier(m)),S=a.getFilename(m),b=m.is_dir,{shareModalExtras:I,sessionId:M,displayType:C}=_.useStore(e.$props),A=null==I?void 0:I.origin,T=_.useStore(e.$isOpen),x=_.useStore(e.$anchorRef),k=_.useStore(e.$overlayPlacement),N=s.useQueryClient();b&&Ke(N,m.file_id);const L=(e=>Ge.default.useCallback((()=>{e.$props.get().onRequestClose(),e.$dwellFlexibleEntryPointActionTimestamp.set(void 0)}),[e]))(e),R=(e=>Ge.default.useCallback((()=>{var t,a;null===(a=(t=e.$props.get()).onInbandShareCompleted)||void 0===a||a.call(t),e.$isOpen.set(!1),e.$props.get().onRequestClose()}),[e]))(e),w=Ge.useCallback((async e=>{a.markMilestoneAsCompleted(e,d.ActivationTileMilestoneId.SHARE_CONTENT)}),[]);Ge.useEffect((()=>{(async()=>{if(!v.fileId||""===v.fileId){const e=await c.fetchLegacySharingObjectMetadataObjectIdentifier(v);y(e)}})()}),[v]);const $=Ge.useMemo((()=>m.is_dir?m.target_ns?{type:"shared_folder"}:{type:"file_folder"}:{type:"file",name:S,size:m.bytes}),[S,m]),O=Ge.useMemo((()=>({actionSurface:p,actionElement:f,contentAction:"share",tiburonOrigin:A,screen:"share_screen",shareModalType:"sm24"})),[p,f,A]),D=_.useStore(e.$props).onSm24Fallback,{data:P,isLoading:F}=a.useSharingPrefs(),U=null!==(t=null==P?void 0:P.apiData.is_file_transfer_enabled)&&void 0!==t&&t,H=b?i.folderEligibleForTransfer(m):!m.is_cloud_doc,B=u.is_team_admin,j=F,V=!!(null===(g=null===(r=a.useDashAccess().data)||void 0===r?void 0:r.apiData.feature_attributes)||void 0===g?void 0:g.has_stacks_in_fss);let q=null,z=Ge.useMemo((()=>b?null:[{file_id:m.file_id,fq_path:m.fq_path}]),[b,m]);const G=Ye(m.file_id,b);G.isLoading||(G.isError?q="too_many_contents"===G.error[".tag"]:(z=G.output,q=!1));const W=a.useShowCopyLinkMiniModalCallback(),K=Ge.useMemo((()=>"centered"===C?{initialDisplayMode:"centered_v1"}:{initialDisplayMode:"anchored_v1",displayModeRef:x,displayModePositioning:k}),[C,x,k]),Y=Ge.useCallback((()=>{var t;const{actionSurface:a,actionElement:n,user:i,shareModalExtras:s,...r}=e.$props.get();"anchored"===r.displayType&&(null===(t=r.onHoverLocked)||void 0===t||t.call(r,{isOpen:!0}));let o=()=>{};const l=new Promise((e=>{o=e}));if("undefined"!=typeof ClipboardItem&&navigator.clipboard.write){const e=new ClipboardItem({"text/plain":l});navigator.clipboard.write([e])}else l.then((e=>navigator.clipboard.writeText(e)));const c={write:e=>o(e)},d="undefined"!=typeof window&&window.innerWidth<=800?"bottom":k;w(i);const _="anchored"===r.displayType?{isCenteredDisplayed:!1,anchorRef:r.anchorRef,placement:d,yOffsetDistance:5,onHoverLocked:r.onHoverLocked}:{isCenteredDisplayed:!0};W.fn({user:i,filePath:m.file_id,setIsCreatingSharedLink:()=>{},browseFile:m,zIndexOverride:500,actionSurface:a,actionElement:n,origin:null==s?void 0:s.origin,isFromShareMe24Modal:!0,clipboardWriter:c,withLockedStateModal:!1,userActionSource:null==s?void 0:s.userActionSource,..._})}),[e.$props,k,W,w,m]),Z=Ge.useCallback((()=>{const e=`sm24_${p}_${f}`,t=[m];i.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>i.redirectToCreateTransferWithFiles(t,e),userId:u.id})}),[f,p,m,u.id]),Q=(e=>Ge.useCallback((t=>{const n=e.$props.get(),i=n.user,s=n.fileOrFolder,r={...n.shareModalExtras,initialScreen:a.SETTINGS_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:t.shouldOpenLinkSettings,initialTab:t.initialTab};o.markDeprecatedHelperCallsite("browse_integration__asyncShowShareModal"),a.asyncShowShareModal(i,s,r)}),[e]))(e),X=(e=>{const t=a.useExperimentVariant("sharing_access_management_entry_point_expansion"),n=t.isLoading?"OFF":t.variant;return Ge.useCallback((()=>{const t=e.$props.get(),i=t.user,s=t.fileOrFolder,r={...t.shareModalExtras,initialScreen:a.MANAGE_SCREEN,openSettingsFromShareMe24:!0,openLinkSettings:!1};n&&n!==a.Variant.OFF&&a.logExposure({feature:"sharing_access_management_entry_point_expansion",variant:n}),"ON"===n?a.asyncShowAccessManagementBrowse({fileOrFolder:s,user:i,actionSurface:"browse_integration_manage_permissions",actionElement:"access_management",sessionId:Math.random().toString()}):a.asyncShowShareModal(i,s,r)}),[e,n])})(e),J=Ge.useCallback((async()=>{if(!z)return;const{actionSurface:t}=e.$props.get(),s=ss(t),r=b?S:void 0;i.asyncAddToStack(n.intl,N,a.CompatNavigate.navigate,z,s,r)}),[z,S,b,N,e.$props]);return Ge.createElement("div",null,Ge.createElement(tt,{sessionId:M,onRequestClose:L},Ge.createElement(d.MetadataProvider,{sharingObjectIdentifier:v,shareModalSessionId:M},Ge.createElement(a.ContextProvider,{context:l.Context,value:M},Ge.createElement(a.ContextProvider,{context:a.Context$4,value:O},Ge.createElement(a.ContextProvider,{context:a.Context$5,value:$},Ge.createElement(E.Provider,{objectIdentifier:v,sessionId:M,objMetadataNewApiVariant:"OFF"},Ge.createElement(is,{sessionId:M,actionElement:f,actionSurface:p,isDir:b},Ge.createElement(Qe,{onFallback:D,onRequestClose:L},Ge.createElement("div",{"data-testid":"shareme24-browse-internals"},Ge.createElement(E.Main,{...K,isOpen:T,onRequestClose:L,inbandSharingMode:"controlled_v1",copyLinkMode:"controlled_v1",copyLinkHandler:Y,transferMode:"controlled_v1",transferHandler:Z,settingsHandler:Q,manageAccessHandler:X,objectIdentifier:v,isEncrypted:m.is_encrypted,fileName:S,fileSize:m.bytes,filePath:m.fq_path,canUserUseTransfer:U,canContentUseTransfer:H,canUserEnableTransfer:B,isTransferEligibilityLoading:j,referrerLoggingMetadata:O,objectLoggingMetadata:$,onActionClicked:h,onInbandShareCompleted:R,canUserCreateStack:V,isFolderFileCountOverLimit:q,contents:z,createStackHandler:J,onObjectIdentifierChanged:()=>Promise.resolve()})))))))))))};as.displayName="ShareMe24BrowseInternals";const ns=({store:e})=>{var t,r,o;const{user:g,fileOrFolder:u,actionSurface:m,actionElement:p,onActionClicked:f,sessionId:h,shareModalExtras:E}=_.useStore(e.$props),[v,y]=Ge.useState(a.getObjectIdentifier(u)),S=a.getFilename(u),b=u.is_dir,I=null==E?void 0:E.origin,M=_.useStore(e.$isOpen),C=Ge.useCallback((()=>{e.$props.get().onRequestClose()}),[e]),A=Ge.useCallback((()=>{var t,a;null===(a=(t=e.$props.get()).onInbandShareCompleted)||void 0===a||a.call(t)}),[e]);Ge.useEffect((()=>{(async()=>{if(!v.fileId||""===v.fileId){const e=await c.fetchLegacySharingObjectMetadataObjectIdentifier(v);y(e)}})()}),[v]);const T=Ge.useMemo((()=>u.is_dir?u.target_ns?{type:"shared_folder"}:{type:"file_folder"}:{type:"file",name:S,size:u.bytes}),[S,u]),x=Ge.useMemo((()=>({actionSurface:m,actionElement:p,contentAction:"share",tiburonOrigin:I,screen:"share_screen",shareModalType:"sm26"})),[m,p,I]),{data:k,isLoading:N}=a.useSharingPrefs(),L=null!==(t=null==k?void 0:k.apiData.is_file_transfer_enabled)&&void 0!==t&&t,R=b?i.folderEligibleForTransfer(u):!u.is_cloud_doc,w=g.is_team_admin,$=N,O=Ge.useCallback((()=>{const e=`sm26_${m}_${p}`,t=[u];i.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>i.redirectToCreateTransferWithFiles(t,e),userId:g.id})}),[p,m,u,g.id]),D=s.useQueryClient();b&&Ke(D,u.file_id);const P=!!(null===(o=null===(r=a.useDashAccess().data)||void 0===r?void 0:r.apiData.feature_attributes)||void 0===o?void 0:o.has_stacks_in_fss),F=Ye(u.file_id,b),{isFolderFileCountOverLimit:U,contents:H}=Ge.useMemo((()=>b?F.isLoading?{isFolderFileCountOverLimit:null,contents:null}:F.isError?{isFolderFileCountOverLimit:"too_many_contents"===F.error[".tag"],contents:null}:{isFolderFileCountOverLimit:!1,contents:F.output}:{isFolderFileCountOverLimit:!1,contents:[{file_id:u.file_id,fq_path:u.fq_path}]}),[F,b,u]),B=Ge.useCallback((async()=>{if(!H)return;const{actionSurface:t}=e.$props.get(),s=ss(t),r=b?S:void 0;i.asyncAddToStack(n.intl,D,a.CompatNavigate.navigate,H,s,r)}),[H,S,b,D,e.$props]),j=Ge.useCallback((()=>{a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_SUCCESS).emit({sessionId:h,actionElement:p,actionSurface:m,isDir:b,shareModalType:"sm26"})}),[h,p,m,b]),V=Ge.useCallback((()=>{a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_FAILURE).emit({sessionId:h,actionElement:p,actionSurface:m,isDir:b,shareModalType:"sm26"})}),[h,p,m,b]),q=Ge.useCallback((()=>{a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_CANCEL).emit({sessionId:h,actionElement:p,actionSurface:m,isDir:b,shareModalType:"sm26"})}),[h,p,m,b]);return Ge.createElement("div",{"data-testid":"shareme26-browse-internals"},Ge.createElement(d.MetadataProvider,{sharingObjectIdentifier:v,shareModalSessionId:h},Ge.createElement(a.ContextProvider,{context:l.Context,value:h},Ge.createElement(a.ContextProvider,{context:a.Context$4,value:x},Ge.createElement(a.ContextProvider,{context:a.Context$5,value:T},Ge.createElement(Xi,{isOpen:M,objectIdentifier:v,onRequestClose:C,onControlledFeatureClicked:f,copyLinkMode:"integrated_v1",inbandSharingMode:"integrated_v1",onInbandShareCompleted:A,shouldResetToMainAfterInbandShare:!0,shouldDisablePostInbandShareHooks:!1,shouldShowBackButtonOnInbandShare:!1,shouldResetToMainOnSettingsCancel:!1,shouldResetToMainOnSettingsSave:!1,shouldResetToMainOnUnshareComplete:!1,transferMode:"controlled_v1",transferHandler:O,canUserUseTransfer:L,canContentUseTransfer:R,canUserEnableTransfer:w,isTransferEligibilityLoading:$,stacksMode:"controlled_v1",stacksHandler:B,canUserCreateStack:P,isStacksContentLimitExceeded:U,onObjectIdentifierChanged:()=>Promise.resolve(),isEncrypted:u.is_encrypted,fileName:S,filePath:u.fq_path,referrerLoggingMetadata:x,objectLoggingMetadata:T,onDataSuccess:j,onDataError:V,onDataCancel:q}))))))};ns.displayName="ShareMe26BrowseInternals";const is=({children:e,sessionId:t,actionElement:n,actionSurface:i,isDir:s})=>{const r=E.useData(),o=Ge.useRef(!1);return Ge.useEffect((()=>{if(!o.current)return"error"===r.status?(o.current=!0,void a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_FAILURE).emit({sessionId:t,actionElement:n,actionSurface:i,isDir:s,shareModalType:"sm24"})):"loaded"===r.status?(o.current=!0,void a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_SUCCESS).emit({sessionId:t,actionElement:n,actionSurface:i,isDir:s,isSharingBanned:r.accountMetadata.is_sharing_banned,shareModalType:"sm24"})):void 0}),[r.status,t,n,i,s]),Ge.useEffect((()=>()=>{o.current||(o.current=!0,a.defaultEmitter$3.select(a.ON_LOADING_WRAPPER_DETECT_CANCEL).emit({sessionId:t,actionElement:n,actionSurface:i,isDir:s,shareModalType:"sm24"}))}),[]),Ge.createElement(Ge.Fragment,null,e)};is.displayName="DataLoadingLogger";const ss=e=>{switch(e){case"previews":return"previews";case"search":return"search_results_page";case"quick-view-search":return"search_quick_view";case"browse_screen":return"browse_screen";case"quick-view-browse":return"browse_quick_view";default:return`unknown_${e}`}};e.ShareModalBrowse=ts,e.renderShareMe24=es,e.renderShareMe26=Ji}));
//# sourceMappingURL=c_integrations_browse_integration_index.after-display.js-vflhQGa5A.map

//# debugId=f68b8d3f-be1f-323e-b309-e541cd6c8275